var _neon=_neon||{},neonPageId=null,lastMouseClick,lastMouseClickElement;function _trackLastMouseClick(b){var a;b=b?b:event;b.srcElement?a=b.srcElement:b.target&&(a=b.target);lastMouseClickElement=a.localName;"object"==lastMouseClickElement&&(lastMouseClick=(new Date).getTime())}document.onmouseup=_trackLastMouseClick;Object.size=function(b){var a=0,f;for(f in b)b.hasOwnProperty(f)&&a++;return a};
(function(b){function a(){h=!1;for(var e in f){var a=b(f[e]).filter(function(){return b(this).is(":appeared")});a.trigger("appear",[a]);if(q){var c=q.not(a);c.trigger("disappear",[c])}q=a}}var f=[],k=!1,h=!1,n={interval:250,force_process:!1},d=b(window),q;b.expr[":"].appeared=function(e){e=b(e);if(!e.is(":visible"))return!1;var a=d.scrollLeft(),c=d.scrollTop(),m=e.offset(),l=m.left,m=m.top;return m+e.height()>=c&&m-(e.data("appear-top-offset")||0)<=c+d.height()&&l+e.width()>=a&&l-(e.data("appear-left-offset")||
0)<=a+d.width()?!0:!1};b.fn.extend({appear:function(e){var g=b.extend({},n,e||{});e=this.selector||this;if(!k){var c=function(){h||(h=!0,setTimeout(a,g.interval))};b(window).scroll(c).resize(c);k=!0}g.force_process&&setTimeout(a,g.interval);f.push(e);return b(e)}});b.extend({force_appear:function(){return k?(a(),!0):!1}})})(_neonjQuery);
(function(b){_neon.JsonRequester=function(){function a(b){this.fullUrl=b;this.noCacheIE="&noCacheIE="+(new Date).getTime();this.headLoc=document.getElementsByTagName("head").item(0);this.scriptId="JscriptId"+a.scriptCounter++}a.scriptCounter=1;a.prototype.buildScriptTag=function(){this.scriptObj=document.createElement("script");this.scriptObj.setAttribute("type","text/javascript");this.scriptObj.setAttribute("charset","utf-8");this.scriptObj.setAttribute("src",this.fullUrl+this.noCacheIE);this.scriptObj.setAttribute("id",
this.scriptId)};a.prototype.removeScriptTag=function(){this.headLoc.removeChild(this.scriptObj)};a.prototype.addScriptTag=function(){this.headLoc.appendChild(this.scriptObj)};return{sendRequest:function(b){try{bObj=new a(b),bObj.buildScriptTag(),bObj.addScriptTag()}catch(k){}}}}();_neon.utils={getRandomString:function(a){return parseInt(1E8*(1+Math.random()),10).toString().substr(0,a)},isHidden:function(a){return null===a.offsetParent?!0:!1},isAnchor:function(a){return"A"==a.prop("tagName")},sameSiteReferral:function(){var a=
document.referrer;-1!==a.indexOf("http://")?a=a.substr(7):-1!==a.indexOf("https://")&&(a=a.substr(8));return a==window.location.hostname},getPageRequestUUID:function(){for(var a="",b=16;0<b;--b)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.round(61*Math.random())];return a},isOnScreen:function(a){a=b(a);var f=b(window),k=f.scrollTop(),h=f.scrollLeft(),n;n=h+f.width();var f=k+f.height(),d=a.offset();d.right=d.left+a.outerWidth();d.bottom=d.top+a.outerHeight();return!(n<d.left||
h>d.right||f<d.top||k>d.bottom)},getBackgroundImageUrl:function(a){a=b(a).css("background-image");a=a.replace("url(","").replace(")","");return a.substr(7)},getQueryValue:function(a,b){for(var k=a&&a.substring(1).split("&"),h=0,n=k.length;h<n;h++){var d=k[h],q=d.indexOf("=");if((d&&d.substring(0,q))===b)return d.substring(q+1,d.length)}}};_neon.tracker=function(){function a(){for(var c=document.getElementsByTagName("div"),e=c.length,a,b=[],g=0;g<e;g++)a=c[g],a.currentStyle?"none"!==a.currentStyle.backgroundImage&&
b.push(a):window.getComputedStyle&&"none"!==document.defaultView.getComputedStyle(a,null).getPropertyValue("background-image")&&b.push(a);return b}function f(c){lastMouseClick=(new Date).getTime();var a=c.data.imgsrc,l=b(this).offset(),g=l.left-b(window).scrollLeft(),d=l.top-b(window).scrollTop(),f=l.left,l=l.top,a=e[a];"undefined"!==typeof a&&_neon.TrackerEvents.sendImageClickEvent(a[0],a[1],g,d,f,l,c.clientX,c.clientY)}function k(){var c=[],m={};b("img").each(function(){b(this);var a=b(this).attr("src");
if(-1<a.indexOf("neontn")){c.push(a);var e=b(this);$parent=e.parent();try{e.click({imgsrc:e.attr("src")},f),_neon.utils.isAnchor($parent)&&0>$parent.attr("href").indexOf("http://")&&$parent.click({imgsrc:e.attr("src")},f)}catch(l){console.log(l)}m[a]=[b(this).width(),b(this).height()]}});g=a();for(var l=0;l<g.length;l++){var t=_neon.utils.getBackgroundImageUrl(g[l]);c.push(t);m[t]=[b(this).width(),b(this).height()]}e=d(c);_neon.TrackerEvents.sendImagesLoadedEvent(e,m);n(c)}function h(){b(window).bind("load",
function(){k()})}function n(c){b("img").appear();for(var a={},l={},d=[],f=0;f<c.length;f++){var h=b('img[src$="'+c[f]+'"]');d.push(h);a[c[f]]=0;l[c[f]]=0}var k={};setInterval(function(){for(var c={},b=!1,f=0;f<d.length;f++){var p=d[f];p.is(":appeared")&&(p=p.attr("src"),e.hasOwnProperty(p)&&(vidId=e[p][0],thumbId=e[p][1],k.hasOwnProperty(p)||(a[p]=1,_neon.StorageModule.storeThumbnail(vidId,thumbId)),c[p]=1,b=!0))}for(f=0;f<g.length;f++)p=g[f],_neon.utils.isOnScreen(p)&&(p=_neon.utils.getBackgroundImageUrl(p),
e.hasOwnProperty(p)&&(vidId=e[p][0],thumbId=e[p][1],k.hasOwnProperty(p)||(a[p]=1,_neon.StorageModule.storeThumbnail(vidId,thumbId)),c[p]=1,b=!0));if(b){k=c;var c=[],h;for(h in a)1===a[h]&&0==l[h]&&(l[h]=1,c.push(e[h]));0<c.length&&_neon.TrackerEvents.sendImagesVisibleEvent(c)}},1E3);b(window).bind("beforeunload",function(){_neon.StorageModule.getAllThumbnails("session")})}function d(c){for(var a={},e=0;e<c.length;e++){var b=q(c[e]);b&&(a[c[e]]=b)}return a}function q(a){return-1<a.indexOf("neontn")?
(a=a.split("neontn")[1].split(".jpg")[0],[a.split("-")[1],a]):null}var e,g;return{init:function(){h()},getTrackerAccountId:function(){for(var a=document.getElementsByTagName("script"),e=0;e<a.length;e++){sTag=a[e];if(0<=sTag.src.search("neonbootloader")||0<=sTag.src.search("neonbctracker.js"))return sTag.id;if(0<=sTag.src.search("neonoptimizer"))return sTag.src.split("_")[1].split(".js")[0]}},getTrackerType:function(){return"brightcove"},getLastClickNeonElementTS:function(){return lastMouseClick},
getLastClickNeonElement:function(){return lastMouseClickElement},setLastClickNeonElement:function(a){lastMouseClick=(new Date).getTime();lastMouseClickElement=a},mapImagesToTids:k,parseNeonBrightcoveUrl:q}}();_neon.StorageModule=function(){function a(a){return a.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/)[2]}function b(a,g){"undefined"===typeof g&&(g=d);if("undefined"===typeof a){var c=document.URL.split("?")[0];return g+q+c}return g+q+a}function k(a,g,c){var m=parseInt((new Date).getTime()/1E3,10);storageKey=
a==localStorage?d:b();var l=JSON.parse(a.getItem(storageKey));l||(l={});l[g]={thumbId:c,ts:m};a.setItem(storageKey,JSON.stringify(l))}function h(a,b,c){return(a=JSON.parse(a.getItem(b)))?a[c]:!1}function n(a){return ret=h(localStorage,d,a)}var d="neonThumbnails",q="+";return{getUid:function(){var a=localStorage.getItem("uid");a||(a=(new Date).getTime(),a=_neon.utils.getRandomString(4)+_neon.utils.getRandomString(4)+a.toString().substring(11,13),localStorage.setItem("uid",a));return a},storeThumbnail:function(a,
b){k(sessionStorage,a,b);k(localStorage,a,b)},getThumbnail:function(e,d){var c="session",m=b(d);return(m=h(sessionStorage,m,e))?[m,c]:d&&a(document.URL)!=a(d)?null:(m=n(e))?[m,"local"]:null},getThumbnailSessionStorage:function(a,d){var c=b(d);return h(sessionStorage,c,a)},getThumbnailLocalStorage:function(a){return n(a)},getAllThumbnails:function(a){if("session"==a){a=new RegExp(d);for(var b=0;b<sessionStorage.length;b++){var c=sessionStorage.key(b);if(a.test(c))return sessionStorage.getItem(c)}return null}return JSON.parse(localStorage.getItem(d))},
clearPageSessionData:function(a){if("undefined"===typeof a){a=document.URL.split("?")[0];a=b(a);for(var d=0;d<sessionStorage.length;d++){var c=sessionStorage.key(d);c==a&&sessionStorage.removeItem(c)}}}}}();_neon.TrackerEvents=function(){function a(a){h=_neon.tracker.getTrackerAccountId();n=_neon.tracker.getTrackerType();d=document.URL.split("?")[0];q=document.referrer.split("?")[0];var b=(new Date).getTime();"undefined"!==typeof a&&(b=a);return g+"/v2/track?a="+e+"&page="+encodeURIComponent(d)+"&pageid="+
k+"&ttype="+n+"&ref="+encodeURIComponent(q)+"&tai="+h+"&cts="+b}function b(a,e){var d=[],f;for(f in a)a[f]&&(tid=a[f][1],"undefined"!==typeof e&&(tid+="+"+e[f][0]+"+"+e[f][1]),d.push(tid));return d}var k=_neon.utils.getPageRequestUUID(),h,n,d,q,e,g="http://tracker.neon-images.com";return{sendImageClickEvent:function(c,b,d,f,h,k,g,q){e="ic";var n=a(),n=n+("&vid="+c+"&tid="+b);"undefined"!==typeof d&&"undefined"!==typeof f&&"undefined"!==typeof h&&"undefined"!==typeof k&&"undefined"!==typeof g&&(n+=
"&wx="+d+"&wy="+f+"&x="+h+"&y="+k+"&cx="+g+"&cy="+q);_neon.JsonRequester.sendRequest(n)},sendVideoPlayEvent:function(b,d,f,h,k,g){e="vp";var n=a(),n=n+("&vid="+b+"&tid="+d+"&adPlay="+h+"&adelta="+k+"&pcount="+g);"undefined"!==typeof f&&(n+="&playerid="+f);_neon.JsonRequester.sendRequest(n)},sendAdPlayEvent:function(b,d,f,h,k,g){e="ap";g=a(g);g+="&vid="+b+"&tid="+d+"&adelta="+h+"&pcount="+k;"undefined"!==typeof f&&(g+="&playerid="+f);_neon.JsonRequester.sendRequest(g)},sendImagesVisibleEvent:function(c){e=
"iv";c=b(c);var d=a();_neon.JsonRequester.sendRequest(d+("&tids="+c))},sendImagesLoadedEvent:function(c,d){e="il";var g=b(c,d),h=a();_neon.JsonRequester.sendRequest(h+("&tids="+g))},sendVideoClickEvent:function(b,d,f){e="vc";var g=a();_neon.JsonRequester.sendRequest(g+("&vid="+b+"&tid="+d+"&playerid="+f))},setPageLoadId:function(a){k=a},getPageLoadId:function(){return k}}}();_neon.BCNeonPlayerTracker=function(){function a(a,b){b=b.split("?")[0];var c=_neon.tracker.parseNeonBrightcoveUrl(b);null!=
c&&(r[b]=c,a=c[0],c=c[1],v[a]=[c,"player"],_neon.StorageModule.storeThumbnail(a,c))}function b(a){var c=document.referrer.split("?")[0],d=null,e=null,f;f=u&&2E3>=u?!1:!0;if(f){if(1==p&&""!=c){if(a=_neon.StorageModule.getThumbnail(a,c))d=a[0].thumbId,e=a[1];return[d,e]}return v[a]}if("object"==_neon.tracker.getLastClickNeonElement())return v[a];if(a=_neon.StorageModule.getThumbnail(a))return d=a[0].thumbId,e=a[1],[d,e]}function k(){var a={},b=t.getAllMediaCollections();if(0<b.length&&0<b[0].mediaCount){for(var c=
0;c<b[0].mediaCount;c++)if(url=t.getMedia(b[0].mediaIds[c]).thumbnailURL,null!=url){url=url.split("?")[0];a[url]=[120,90];var d=_neon.tracker.parseNeonBrightcoveUrl(url);if(null!=d){r[url]=d;var e=d[0],d=d[1];v[e]=[d,"player"];_neon.StorageModule.storeThumbnail(e,d)}}0<Object.size(r)&&(_neon.TrackerEvents.sendImagesVisibleEvent(r),_neon.TrackerEvents.sendImagesLoadedEvent(r,a))}}function h(a){!1==z&&(p+=1);vid=a.media.id;a=b(vid);var c=null,d=null;null!=a&&(c=a[0],d=a[1],"local"==d&&_neon.TrackerEvents.sendImageClickEvent(vid,
c));_neon.TrackerEvents.sendVideoPlayEvent(vid,c,l,z,u,p);!0==B&&_neon.TrackerEvents.sendAdPlayEvent(vid,c,l,u,p,C)}function n(a){y=(new Date).getTime();if(A){A=!1;var b=_neon.tracker.getLastClickNeonElementTS();null==u&&b&&(u=y-b);x=a=a.media.id;var b=v[a],c=null;b&&(c=b[0]);_neon.TrackerEvents.sendVideoClickEvent(a,c,l)}}function d(a){B=null==x?!0:!1;z=!0;C=(new Date).getTime();p+=1;if(!1==B){a=b(x);var c=null;a&&(c=a[0]);_neon.TrackerEvents.sendAdPlayEvent(x,c,l,u,p)}}function q(a){y=(new Date).getTime();
A=!0;z=!1;x=a.media.id;var b=_neon.tracker.getLastClickNeonElementTS();b&&(u=y-b);x=a=a.media.id;var b=v[a],c=null;b&&(c=b[0]);_neon.TrackerEvents.sendVideoClickEvent(a,c,l)}function e(a){a=a.split(",");for(var b=0;b<a.length;b++)playlist=a[b],t.getPlaylistByID(playlist,g)}function g(a){var b={};a=a.videos;for(var c=0;c<a.length;c++)if(url=a[c].thumbnailURL,null!=url){url=url.split("?")[0];b[url]=[120,90];var d=_neon.tracker.parseNeonBrightcoveUrl(url);if(null!=d){r[url]=d;var e=d[0],d=d[1];v[e]=
[d,"player"];_neon.StorageModule.storeThumbnail(e,d)}}0<Object.size(r)&&(_neon.TrackerEvents.sendImagesVisibleEvent(r),_neon.TrackerEvents.sendImagesLoadedEvent(r,b))}var c=null,m,l=null,t,s,w,x=null,C=null,y=null,A=!0,p=0,z=!1,u=null,B=!1,r={},v={};return{onTemplateReady:function(b){b.target.experience?(APIModules=brightcove.api.modules.APIModules,c?(m=c.getModule(APIModules.VIDEO_PLAYER),t=c.getModule(APIModules.CONTENT),s=c.getModule(APIModules.EXPERIENCE),m.addEventListener(brightcove.api.events.MediaEvent.BEGIN,
h),m.addEventListener(brightcove.api.events.MediaEvent.PLAY,n),m.addEventListener(brightcove.api.events.MediaEvent.CHANGE,q),c.getModule(APIModules.ADVERTISING).addEventListener(brightcove.api.events.AdEvent.START,d),m.getCurrentVideo(function(b){w=b;a(w.id,w.thumbnailURL);0<Object.size(r)&&(_neon.TrackerEvents.sendImagesVisibleEvent(r),imgVisibleSizes={},imgVisibleSizes[Object.keys(r)[0]]=[120,90],_neon.TrackerEvents.sendImagesLoadedEvent(r,imgVisibleSizes))}),s.getExperienceID(function(a){l=a}),
playerHtmlObject=document.getElementById(c.id),playlists=_neon.utils.getQueryValue(playerHtmlObject.data.split("?")[1],"%40playlistTabs"),e(playlists)):(APIModules=brightcove.api.modules.APIModules,s=b.target.experience.getModule(APIModules.EXPERIENCE),s.getExperienceID(function(a){l=a;m=s.experience.getModule(APIModules.VIDEO_PLAYER);m.addEventListener(brightcove.api.events.MediaEvent.BEGIN,h);m.addEventListener(brightcove.api.events.MediaEvent.PLAY,n);m.addEventListener(brightcove.api.events.MediaEvent.CHANGE,
q);s.experience.getModule(APIModules.ADVERTISING).addEventListener(brightcove.api.events.AdEvent.START,d)}))):(w=m.getCurrentVideo(),a(w.id,w.thumbnailURL))},onTemplateLoad:function(a){try{c=brightcove.api.getExperience(a)}catch(b){}null==c&&(c=bcPlayer.getPlayer(a),m=c.getModule(APIModules.VIDEO_PLAYER),s=c.getModule(APIModules.EXPERIENCE),l=s.getExperienceID(),t=c.getModule(APIModules.CONTENT),m.addEventListener(BCMediaEvent.BEGIN,h),m.addEventListener(BCMediaEvent.PLAY,n),m.addEventListener(BCMediaEvent.CHANGE,
q),s.addEventListener(BCExperienceEvent.CONTENT_LOAD,k),advertising=c.getModule(APIModules.ADVERTISING),advertising.addEventListener(BCAdvertisingEvent.AD_START,d))}}}();(function(){function a(){if("complete"===document.readyState||"interactive"===document.readyState)_neon.StorageModule.clearPageSessionData(),clearInterval(f),b(document).bind("touchstart",function(a){lastMouseClick=(new Date).getTime()}),NeonPlayerTracker=_neon.BCNeonPlayerTracker}if(!_neon.UNITTEST){var f=setInterval(a,100);sessionStorage&&
localStorage&&JSON&&_neon.tracker.init()}})()})(_neonjQuery);
