/* Copyright 2008-2013 Adometry, Inc. */
try{var DMTRY=DMTRY||{};DMTRY.CHANNEL=DMTRY.CHANNEL||{};(function(){var c="undefined",d=true,b=false,e="v",g="c";var a=DMTRY.CHANNEL;a.directory=a.directory||[];a.session=a.session||f(999999);a.sendError=function(i){var j="log.dmtry.com",h="http://"+j+"/1.ver?at=e&d=ChannelError&msg="+encodeURIComponent(i);a.sendRequest(h)};a.sendRequest=function(i){var j=2048,h=new Image;h.border=0;h.vspace=0;h.hspace=0;h.height=1;h.width=1;if(h){if(i!=null&&i!=""){i=i.substring(0,j);if(i.length>0){h.src=i}}}else{throw new Error("No image created for log event")}return i};function f(h){var i=Math.random()*(h)+1;return Math.floor(i)}(function(i){var o={};try{var j=function(E){var D=this;D.qsPropertyKeys=E||[];D.propertyMap={}};o.scriptProps=null;o.isMaster=(i===0)?d:b;o.config={brand:"DMTRY",fPattern:/channel\.js/,fpCookie:b,host:"log.dmtry.com",scheme:"",ver:"chl-1.4.2",PATHORDER:["rand","bid","gid","pid","cid","sid","aid","srcid","advid"],TRANSLATE:{},SEND_ONCE:["csync"],SETTINGS:["fplog","scheme"]};o.actions={refer:new j(["at","d","jsv","csync","if","rev","chl_pass","chl","unk","pg"]),link:new j(["at","d","jsv","csync","if","rev","chl_pass","chl","unk","pg"])};o.sendError=function(E){var D=w(o.config,o.scriptProps)+C(o.config,o.loggingProps)+"?at=e&d=ChannelInstError&msg="+encodeURIComponent(E);a.sendRequest(D)};var y=function(){var H={winObj:window,levelsUp:0},G=20,J=b,I=b,F;for(var E=window,D=0;;E=E.parent,D++){if(D==G){D=-1;break}try{if(E.document){H.winObj=E;H.levelsUp=D}else{I=d}}catch(K){I=d}if(E==E.parent){break}else{J=d}}F=D;return{bestWinObj:H.winObj,isTop:(F==H.levelsUp),inFrame:J,nonFriendlyPresent:I}};var r=function(D){if(D==null){throw new Error("invalid config")}var J={elem:null,hash:null},F=D.brand||"tagproc",G=document.getElementsByTagName("script"),I,E,H;for(E=0;E<G.length;E++){J.elem=G[E];I=J.elem.src;if(I.search(D.fPattern)>=0&&J.elem[F]===undefined){J.elem[F]=d;H=(I.indexOf("js#")>0)?I.indexOf("js#"):I.indexOf("js?");if(H>0){J.hash=I.substring(H+3,I.length)}}}return J};var z=function(D,F){if(D==null){throw new Error("invalid config")}var E=y();x(D,F,E);if(o.isMaster===d){s(D,F,E)}};var x=function(F,I,G){var D="refer",J=I.hash,E={};try{E=o.actions[D].propertyMap}catch(H){a.sendError(H.message||"unknown")}if(J!=null&&J.length>0){u(E,F);p(E,J,G);n(F,E);E.at=e;E.d="Conv"}};var s=function(D,K,L){var J="link",E={},N={},I,F,M,H;try{E=o.actions[J].propertyMap}catch(G){a.sendError(G.message||"unknown")}if(L.bestWinObj!=null&&L.bestWinObj.document!=null){N=L.bestWinObj.document;I=N.URL;H=I.indexOf("?");if(H>-1){H=H+1;I=I.substring(H);F=t(I,"&","=");if(F!=null&&typeof F.dmtry!==c){M=F.dmtry;u(E,D);p(E,M,L);n(D,E);E.at=g;E.d="ClickLink"}}}};var u=function(D,E){D.jsv=E.ver||"na";D.rand=f(999999);D.sid=a.session;D.csync=(typeof D.csync!==c)?D.csync:1};var p=function(E,G,L){L=L||y();var F="na",J=o.config.TRANSLATE,D,N,H=B(G),M=L.bestWinObj.document,K;for(N in H){if(H.hasOwnProperty(N)){D=N;if(typeof J[N]!==c){D=J[N]}E[D]=H[N]}}if(L.isTop===b){E["if"]=1;E.pg=M.referrer||F;E.chl=F}else{E.pg=M.URL||F;K=M.referrer;E.chl=(typeof K==="string")?K:F}if(H!=null&&typeof H.chl!==c&&H.chl.length>0){try{E.chl=decodeURIComponent(H.chl);E.chl_pass=1}catch(I){E.chl_pass=2}}};var n=function(F,H){var E={fplog:function(J){if(typeof J!==c){var I=J;I=I.replace(/^(https?:)?\/\//,"").replace(/\/.*$/,"");if(/^([\da-z\.-]+)\.([a-z\.]{2,6})$/.test(I)){F.host=I;F.fpCookie=d}else{o.sendError("Invalid fplog parameter: "+J)}}},scheme:function(J){var I=J.match(/^https?$/i);if(I!=null){F.protocol=I[0].toLowerCase()}}};if(typeof H!==c){for(var D in E){if(E.hasOwnProperty(D)){var G=H[D];if(typeof G!==c&&typeof E[D]==="function"){E[D].call(this,G)}}}}};var B=function(D){if(D!=null&&typeof D==="string"){return t(D,";",":",d)}};var h=function(E,J,I,K){var F="",D,L,G,H=o.actions[I];D=w(E,J);L=C(E,H);G=m(E,H,K);if(D!=null&&L!=null&&G!=null&&D.length>0&&L.length>0&&G.length>0){F=D+L+G}return F};var w=function(E,F){var D=(E&&E.protocol)?(E.protocol+":"):"";if(E.host!=null){D+="//"+E.host+"/"}return D};var C=function(F,E){var I,H,G="",J=[],D=F.PATHORDER;for(I in D){if(D.hasOwnProperty(I)){H=D[I];J.push(E.propertyMap[H]||0)}}if(F.fpCookie===d){G+="fpc/"}G+="redir/"+J.join("/")+"/1.ver";return G};var m=function(E,M,R){var R=(R===b)?b:d,I="",L=M.qsPropertyKeys,P=M.propertyMap,O=null,D,H,K=[],F=[],J=[],N=[],G=/^cus\./i;for(H=0;H<L.length;H++){O=L[H];D=P[O];if(D!=null&&typeof D!="function"){D=k(D);K.push(O+"="+D)}}if(R){for(O in P){if(P.hasOwnProperty(O)&&typeof P[O]!=="function"){if(!A(L,O)&&!A(o.config.PATHORDER,O)&&!A(o.config.SETTINGS,O)){J.push(O)}}}if(J.length>0){for(H=0;H<J.length;H++){O=J[H];D=P[O];if(O.search(G)>-1){K.push(O+"="+D)}else{N.push(O+"="+D)}}if(N.length>0){K.push("cus="+k(N.join(";")))}}}D="";for(H=0;H<E.SETTINGS.length;H++){O=E.SETTINGS[H];if(P.hasOwnProperty(O)&&typeof P[O]!=="function"){D=P[O]+"";if(D.length>0){F.push(O+"="+k(D))}}}if(F.length>0){K.push("config="+k(F.join(";")))}var Q=E.SEND_ONCE;for(H=0;H<Q.length;H++){if(typeof P[Q[H]]!==c){delete P[Q[H]]}}if(K.length>0){I+="?"+K.join("&")}return I};var k=function(E){if(E!=null&&typeof E!="function"){try{E=encodeURIComponent(E)}catch(D){E=escape(E)}}return E};var A=function(D,F){for(var E=0;E<D.length;E++){if(D[E]==F){return d}}return b};var t=function(F,E,M,H){if(F==null||F.length<1){return null}H=(H)?H:b;var N={},D=[],I=F.split(E),K,G,L,J;for(K=0;K<I.length;K++){if(I[K].length>0){G=I[K].indexOf(M);if(G>=0){L=I[K].substring(0,G);J=I[K].substring(G+1);N[L]=J}else{D.push(I[K]);I.splice(K,1);K--}}}if(H){if(D.length>0){N.unk=D.join(";")}}return N};var q=function(){var D;if(o.config==null){throw new Error("invalid config")}o.scriptProps=r(o.config);z(o.config,o.scriptProps);if(o.isMaster===d){D=h(o.config,o.scriptProps,"link");a.sendRequest(D)}D=h(o.config,o.scriptProps,"refer");a.sendRequest(D)};a.directory.push(o);q()}catch(v){var l=v.message||"Unknown Channel Instance Error";if(typeof o.sendError!==c){o.sendError(l)}else{DMTRY.CHANNEL.sendError(l)}}})(a.directory.length)})()}catch(channelError){try{var msg=channelError.message||"Unknown Channel Error";DMTRY.CHANNEL.sendError(msg)}catch(lastEffortError){}};