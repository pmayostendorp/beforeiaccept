/*! BARNES-BUILDER 2015-06-29 */
BN.Items.Configuration.Types.PostalAddress={properties:["id","default","excludeUPS","repositoryId","firstName","lastName","streetAddress1","streetAddress2","addressLocality","addressRegion","addressParentRegion","postalCode","telephone","cellphone","homephone","companyName"],actions:{add:{type:"page",url:SITE_ROOT+"/account/manage/addresses/new.jsp"},"delete":{type:"callback",callback:function(a,b,c){return new BN.Modal.Account.ConfirmDelete("delete-address",c)}},status:{type:"callback",callback:function(a,b,c,d,e){$(e).parents("form").first().submit()}},edit:{type:"callback",callback:function(a,b,c,d,e,f){return new BN.Modal.Account.EditAddress(null,this,null,f||null)}}}},BN.Items.Configuration.Types.CheckoutPostalAddress={properties:["id","default","excludeUPS","repositoryId","firstName","lastName","streetAddress1","streetAddress2","addressLocality","addressRegion","addressParentRegion","postalCode","telephone","cellphone","homephone","companyName","editAddressNickname"],actions:{"delete":{type:"callback",callback:function(a,b,c){return new BN.Modal.Account.ConfirmDelete("delete-address",c)}},status:{type:"callback",callback:function(a,b,c,d,e){$(e).parents("form").first().submit()}},edit:{type:"callback",callback:function(){return new BN.Modal.Checkout.EditShipping(this)}}}},BN.Items.Configuration.Types.CheckoutBillingPostalAddress={properties:["id","default","excludeUPS","repositoryId","firstName","lastName","streetAddress1","streetAddress2","addressLocality","addressRegion","addressParentRegion","postalCode","telephone","cellphone","homephone","companyName"],actions:{"delete":{type:"callback",callback:function(a,b,c){return new BN.Modal.Account.ConfirmDelete("delete-address",c)}},status:{type:"callback",callback:function(a,b,c,d,e){$(e).parents("form").first().submit()}},edit:{type:"callback",callback:function(){return new BN.Modal.Checkout.EditBilling(this)}}}},BN.Items.Configuration.Types.PaymentMethod={properties:["id","default","repositoryId","name","creditCardIcon","creditCardType","creditCardTypeLabel","$PostalAddress","creditCardNumber","expirationMonth","expirationYear","creditCardNickName"],actions:{add:{type:"page",url:SITE_ROOT+"/account/manage/payment/new.jsp"},"delete":{type:"callback",callback:function(a,b,c){return new BN.Modal.Account.ConfirmDelete("delete-payment",c)}},status:{type:"callback",callback:function(a,b,c,d,e){$(e).parents("form").first().submit()}},edit:{type:"callback",callback:function(a,b,c,d,e,f){return new BN.Modal.Account.EditPayment(null,this,null,f||null)}}}};;/*! BARNES-BUILDER 2015-06-29 */
function initializeSearchBarTextForIE(){$("#logoAndSearch #searchBarBN").focus(function(){$("#logoAndSearch form#searchForm").addClass("focused"),($("body").hasClass("ie9")||$("body").hasClass("lt-ie9")||"undefined"!=typeof BN_IS_IE9&&BN_IS_IE9===!0)&&("Search"==$(this).val()||0===$(this).val().length)&&$(this).val("")}),$("#logoAndSearch #searchBarBN").blur(function(){$("#logoAndSearch form#searchForm").removeClass("focused"),($("body").hasClass("ie9")||$("body").hasClass("lt-ie9")||"undefined"!=typeof BN_IS_IE9&&BN_IS_IE9===!0)&&0===$(this).val().length&&$(this).val("Search")}),"undefined"!=typeof BN_IS_IE9&&BN_IS_IE9===!0&&$("#logoAndSearch #searchBarBN").length&&0===$("#logoAndSearch #searchBarBN").val().length&&$("#logoAndSearch #searchBarBN").val("Search")}function checkPriceChange(a){if("Wishlist"==a)var b="#searchGrid";else if("Shopping Bag"==a)var b="#cartItemsContainer";if($(".price-change-array").length){var c=$.trim($(".price-change-array").text());if(""!=c){var d=c.split("|"),e='<div class="general-messaging"><p>The Price of one or more items in your '+a+" has changed</p><ul>";try{$.each(d,function(a,b){if(""!=$.trim(b)){var c=b.split("^");e+="<li>The price of <span>"+c[0]+"</span> has changed from <span><span>"+c[1]+"</span> to "+c[2]+"</span></li>"}})}catch(f){}e+="</ul></div>"}}$(e).insertBefore(b),$("#searchBar").on("keydown",function(a){return(40==a.keyCode||38==a.keyCode)&&($("#headSearchTypeAheadHolder ul li").length>0?(noItems=!0,$(document).focus()):noItems=!1),13==a.keyCode?(chosen="",result="",$("#headSearchTypeAheadHolder ul li a").removeClass("select-item"),noItems=!1,$("#headSearchTypeAheadHolder").hide(),!1):void 0}),$(document).on("keydown",function(a){if(1==noItems){if(40==a.keyCode)return""===chosen?chosen=0:chosen+1<$("#headSearchTypeAheadHolder ul li").length&&chosen++,$("#headSearchTypeAheadHolder ul li a").removeClass("select-item"),$("#headSearchTypeAheadHolder ul li:eq("+chosen+") a").addClass("select-item"),result=$("#headSearchTypeAheadHolder ul li:eq("+chosen+") a").text(),$("#searchBar").val(result),!1;if(38==a.keyCode)return""===chosen?chosen=0:chosen>0&&chosen--,$("#headSearchTypeAheadHolder ul li a").removeClass("select-item"),$("#headSearchTypeAheadHolder ul li:eq("+chosen+") a").addClass("select-item"),result=$("#headSearchTypeAheadHolder ul li:eq("+chosen+") a").text(),$("#searchBar").val(result),!1}})}var noItems=!1,chosen="",result="";$(document).ready(function(){function a(){"undefined"!=typeof gigya&&gigya.socialize.addEventHandlers({onLogin:onLoginHandler,onLogout:logoutFromGS})}if("undefined"==typeof BN_EXTERNAL_DOMAIN_PREFIXED&&$.fn.bnAutoSuggest({searchInputSelector:"#searchBarBN"}),initializeSearchBarTextForIE(),$("#checkoutSteps a").click(function(a){$(this).hasClass("completed")||a.preventDefault()}),$("#globalHeader, #cartItemsContainer").on("focus blur keyup input propertychange",".product-quantity",onlyNumbers),($("#userLinks").length||"undefined"!=typeof BN_EXTERNAL_DOMAIN_PREFIXED)&&(openLoginModal(".sign-in-link",{preventDefault:"conditionally",successCallback:function(){$(".pdpPage").length>0?location.reload():window.location=$(this).attr("href")}}),$("#globalHeader").on("click",".move-to-checkout",function(a){a.preventDefault(),new BN.Modal.Account.LoginCheckout(null,{target:this})})),openLoginModal("#ultraviolet-sign-in",{preventDefault:"always",successCallback:function(){var a=getModalObj("m-ultraviolet"),b=function(){"undefined"!=typeof a&&null!=a&&a.Close(),new BN.Modal.Success(null,{title:"Account Already Linked!",messages:[{type:"success",message:"Your BN.com NOOK account is already linked with your UltraViolet account."}]})},c=function(){"undefined"!=typeof a&&null!=a&&a.Close(),new BN.Modal.Browse.PDP.UltravioletSignIn(null,{target:this},{useCache:!1})};isUvAccountLinked(b,c)}}),openLoginModal(".sign-in-checkout",{preventDefault:"always",successCallback:function(){location.href=$(this).attr("href")}}),openLoginModal(".buy-as-egift",{type:"explicit",preventDefault:"always",successCallback:function(){new BN.Modal.Browse.PDP.BuyEGift(null,{target:this},{useCache:!1,tplParams:{skuId:$(this).attr("data-skuid"),productId:$(this).attr("data-productid")}},null)}}),openLoginModal(".pdpAddToWishlistLink",{type:"explicit",preventDefault:"always",successCallback:function(){var a=getCurrentModal($(this));new BN.Modal.Account.Wishlist.Add(null,{target:this},{tplUrlOverride:$(this).attr("href"),useCache:!1},a)}}),openLoginModal("#writeReviewBtn",{type:"explicit",preventDefault:"always",successCallback:function(a,b){var c=(getCurrentModal($(this)),$("#writeReviewBtn")),d=b?b.data.uid:c.data("uid").toString(),e={"work-id":c.data("work-id").toString(),uid:d,ean:c.data("ean").toString()};return c.attr("data-uid",d),c.attr("data-modal-class","BN.Modal.Gigya.WriteReview"),new BN.Modal.Gigya.WriteReview(null,e)}}),$.receiveMessage(function(a){var b=deparam(a.data);switch(b.type){case"uvSuccess":var c=getModalObj("m-uv-signin-form"),d=function(){"undefined"!=typeof c&&null!=c&&c.Close(),new BN.Modal.Success(null,{title:"Success!",messages:[{type:"success",message:'Your account was linked successfully! <br><br> <p>To watch UltraViolet titles on BN.com, search for the video and select the "Watch Now" option on the product page.<br/><br/>All UltraViolet titles are not available for playback on BN.com.  Please visit <a href="http://www.uvvu.com">www.uvvu.com</a> to see a list of all of your UltraViolet videos.</p>'}]})},e=function(){"undefined"!=typeof c&&null!=c&&c.Close(),new BN.Modal.Success(null,{title:"Error!",messages:[{type:"error",message:"There was a problem linking your UltraViolet account. Please try again."}]})};isUvAccountLinked(d,e);break;case"uvError":var c=getModalObj("m-uv-signin-form"),f="There was a problem linking your UltraViolet account. Please try again.";"undefined"!=typeof b.message&&""!=b.message&&(f=b.message),"undefined"!=typeof c&&null!=c&&c.Close(),new BN.Modal.Success(null,{title:"Error!",messages:[{type:"error",message:f}]});break;case"changeHeight":var g=b.modal,c=getModalObj(g),h=$(c.modal).find("iframe"),i=h.height(b.height);break;case"frameLoaded":var g=b.modal,c=getModalObj(g),h=$(c.modal).find("iframe"),i=h.height(),j={type:"frameHeight",height:i},k=b.frameUrl;$.postMessage(j,k,h.get(0).contentWindow);break;case"removeLoader":$(".spinner").remove();break;case"frameFormSuccess":frameFormSuccess(b);break;case"nookLoginSuccess":var l=b.uxhr;if("undefined"!=typeof l.missingCard&&"addNew"==l.missingCard){var g=b.modal,c=getModalObj(g);new BN.Modal.Checkout.AddCC(null,this,null,c)}else if("undefined"!=typeof l.missingCard&&"showSaved"==l.missingCard){var g=b.modal,c=getModalObj(g);console.log(g),new BN.Modal.Checkout.UseSavedCC(null,this,null,c)}else redirectToNook();break;case"frameResetPwFormSuccess":if(""!=b.redirect)redirectFromFrame(b.redirect);else{var l=b.uxhr;if("undefined"!=typeof l.sentEmail&&"true"==l.sentEmail.toLowerCase()){var g=b.modal,c=getModalObj(g);new BN.Modal.Account.Base("reset-password-confirmation",null,{useCache:!1,tplParams:{email:encodeURIComponent(l.email)}},c)}else if("undefined"!=typeof l.questionAnswerSuccess&&"true"==l.questionAnswerSuccess.toLowerCase()){var g=b.modal,c=getModalObj(g),m={tplParams:{parentUrl:encodeURIComponent(location.href),tplName:"change-password",u:l.userId},useCache:!1};new BN.Modal.Account.ChangePassword(null,null,m,c)}else{if("undefined"==typeof l.changedPassword||"true"!=l.changedPassword.toLowerCase()){var g=b.modal,c=getModalObj(g),m={tplParams:{parentUrl:encodeURIComponent(location.href),tplName:"reset-password",email:l.email,question:encodeURIComponent(l.question)},useCache:!1};new BN.Modal.Account.ForgotPassword(null,null,m,c);break}var g=b.modal,c=getModalObj(g);console.log(c),c.flow().goTo(0,"button").triggerClose("button"),new BN.Modal.Success(null,{title:"We've Changed Your Password",messages:[{type:"success",message:"You have successfully changed your password!"}]})}}break;case"closeModal":var g=b.modal;closeModalInstanceFromFrame(g);break;case"guestCheckout":redirectFromFrame(b.redirect);break;case"forgotPasswordEmail":var g=b.modal,c=getModalObj(g),m={tplParams:{parentUrl:encodeURIComponent(location.href),tplName:"reset-password-email"},useCache:!1};new BN.Modal.Account.ForgotPasswordEmail(null,null,m,c);break;case"createAccount":var g=b.modal,c=getModalObj(g),m={tplParams:{parentUrl:encodeURIComponent(location.href),tplName:"register",isEgift:$("#isEgiftLogin").val(),isNookLogin:$("body").hasClass("nook-login-page")},useCache:!1},n={redirect:!1};new BN.Modal.Account.Register(null,n,m,c);break;case"openLogin":var g=b.modal,c=getModalObj(g);c.Close()}}),$("#ptaChatLink").on("click",function(a){a.preventDefault();var b=$("#chatPtaURL").val();"undefined"!=typeof b&&(window.location.href=b)}),$("#checkBalanceFormSubmit").on("click",function(){$("#checkBalance .err").html("");var a=$("#checkGiftCardNumber").val(),b=$("#checkGiftCardPin").val();return a||b?a?a.match(/^349/)||b?!0:($("#checkBalance .err").html("Please enter giftcard pin"),$("#checkBalance").show(),!1):($("#checkBalance .err").html("Please enter giftcard number"),$("#checkBalance").show(),!1):($("#checkBalance .err").html("Please enter giftcard number and giftcard pin"),$("#checkBalance").show(),!1)}),$("*[rel='ext']").on("click",function(){$this=$(this),$this.attr("target","_blank")}),$(a()),initInstantPurchaseSignIn(),$("a#headerSignoutLink").on("click",function(){$(logoutFromGS())}),$(document).on("click",".bn-share-link",function(a){a.preventDefault();var b=$(this).data("socialsharetype"),c=location.href,d="",e="";if($("body").hasClass("account"))d=$("div.product-image").eq(0).find("img").prop("src"),e=$.trim($(".wishlist-event-name").text());else if($("body").hasClass("pdpPage")){var d="http:"+$("#pdpMainImage").attr("src");console.log("img url: "+d);var e=$("#prodSummary h1").text()+" by "+$("#prodSummary .contributors a").text().replace(/(\r\n|\n|\r)/gm,"").trim();console.log("share title: "+e)}var f={url:c,provider:b,title:e,thumbnailURL:d,shortURLs:"never"};"undefined"!=typeof gigya&&gigya.socialize.postBookmark(f)}),$(".print-this").click(function(a){a.preventDefault(),window.print()}),/\?(.*[&])?signin=true[&]?/i.test(window.location.toString())&&new BN.Modal.Account.Login,BN.Validate.Listen("form"),$("select").selectBox(),Modal.prototype.initOpeners(document.body),$('form.uxhr,form[action*="xhr"]').each(function(){BN.uXHR.Form.apply(this),$(this).on("amplifiFormBeforeSubmit",function(){BN.Validate.ClearErrors(this)})}),$('a.uxhr,a[href*="/xhr"],a[data-service]').each(function(){$(this).on("click",function(a){a.preventDefault();var b=$(this),c=BN.uXHR.getElemDataParams(b),d=c.service;d&&BN.uXHR.getService(d,c,function(){b.triggerHandler("amplifiServiceResponse",arguments)})})}),$(function(){var a=$("nav#refinements").length;a>0&&($("dt.refinementHeader").click(function(){$(this).parent().hasClass("facetCollapsed")?($(this).parent().removeClass("facetCollapsed"),$(this).parent().next("dl").slideDown("slow")):($(this).parent().addClass("facetCollapsed"),$(this).parent().next("dl").slideUp("slow"))}),$("dt.refinementHeader:gt(1):not(#searchWithinContainer)").each(function(){var a,b=$(this).parent().next("dl"),c=b.find(".viewMoreviewLessToggle"),d="";c.length&&(a=c.first().find("a"),a.length&&(d=a.first().html())),"show less"!=d.toLowerCase()&&(b.slideUp("fast"),b.not(":visible")&&$(this).parent().addClass("facetCollapsed"))}))}),$("body").hasClass("wishlist")?checkPriceChange("Wishlist"):$("body").hasClass("shopping-bag")&&checkPriceChange("Shopping Bag"),$("*[rel='ext']").on("click",function(){$this=$(this),$this.attr("target","_blank")}),$("textarea.gift-message").length&&$("textarea.gift-message").each(function(){initializeTextAreaCounter($(this),$(this).parent().find(".limit-notifier"))}),$("#searchForm").on("submit",function(a){!$("#searchBar").val()&&$("#searchBar").length&&a.preventDefault()}),$(".egift-date").datepicker({showOn:"button",buttonImage:"/static/img/sprites/calendar-up.png",buttonImageOnly:!0,minDate:0,maxDate:"+1Y",showOn:"both"}).on("change",function(){var a=$(this).val().split("/");$(this).parent().find("#eGiftMonth").val(a[0]),$(this).parent().find("#eGiftDay").val(a[1]),$(this).parent().find("#eGiftYear").val(a[2])}),$(document).on("click",'#miniCart [data-modal-class="BN.Modal.Account.FreeShippingDetails"]',".free-shipping-details",function(a){a.preventDefault(),new BN.Modal.Account.FreeShippingDetails(null,{target:this},null,null)}),$("[id*=video-carousel] figure").hover(function(){$(this).find(".icon-play").addClass("icon-over")},function(){$(this).find(".icon-play").removeClass("icon-over")}),$(".toggle-panel").on("click",".btn",function(){var a=$(this),b=a.parent(),c=b.siblings(".toggle-content"),d=a.index(),e=c.get(d);return a.hasClass("active")?!1:(a.siblings().removeClass("active"),a.toggleClass("active"),c.hide(),$(e).show(),void 0)}),$("body").hasClass("homepage")){var b,c=0,d=0,e=new Array;$(".footlight .featured-sub-item h4").each(function(){if(b=$(this),topPostion=b.position().top,d!=topPostion){for(currentDiv=0;currentDiv<e.length;currentDiv++)e[currentDiv].height(c);e.length=0,d=topPostion,c=b.height(),e.push(b)}else e.push(b),c=c<b.height()?b.height():c;for(currentDiv=0;currentDiv<e.length;currentDiv++)e[currentDiv].height(c);$(".footlight .featured-sub-item aside .arrow-link").height(c)})}$("body").hasClass("nook-login-page")&&new BN.Modal.Account.Login(null,{target:this},{useCache:!1,tplParams:{isNookLogin:"true",isEgift:$("#isEgiftLogin").val()}}),$("#state").length>0&&autofillStateFix(),$("[data-tooltip-trigger]").length>0&&showTooltip(),"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?consoleLog("Touch-screen enabled"):$("html").first().addClass("desktop")}),$(document).load(function(){});;/*! BARNES-BUILDER 2015-06-29 */
function MiniCart(a,b){this.scope=this,this.cart=$(a);var c=this;$(b).hover(function(a){var b=($(this),"mouseenter"===a.type);b?c.showCart():c.hideCart()})}MiniCart.prototype.getTotal=function(){return this.total},MiniCart.prototype.refreshCart=function(){var a=$.ajax({url:webContextRoot+"/checkout/includes/closeness-qualifier.jsp",type:"post",dataType:"html",cache:!1,async:!0});a.done(function(a){var b=$("#miniCartItems");b.html(a),b.html(a)})},MiniCart.prototype.showCart=function(){this.cart.find(".error-msg").css("display","none"),this.cart.stop(!0).fadeTo(250,1)},MiniCart.prototype.hideCart=function(){var a=this.cart;a.stop(!0).fadeTo(250,0,function(){a.hide()})};var BN=BN||{};;/*! BARNES-BUILDER 2015-06-29 */
var googletag=googletag||{};googletag.cmd=googletag.cmd||[],function(){var a=document.createElement("script");a.async=!0,a.type="text/javascript";var b="https:"==document.location.protocol;a.src=(b?"https:":"http:")+"//www.googletagservices.com/tag/js/gpt.js";var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(a,c)}();