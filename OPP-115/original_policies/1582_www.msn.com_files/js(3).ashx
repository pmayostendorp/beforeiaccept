
typeof window.Mst=="undefined"&&(window.Mst={}),Mst.Search=function(n,t,i,r,u,f){var e=this;e.FadeSpeed=200,e.watermarkTimer=null,e.dropdownTimer=null,$("#"+t).hide(),e.Control=$("#"+n),e.Textbox=e.Control.find(".mstSrc_TextBox"),e.Button=e.Control.find(".mstSrc_Button"),e.Scopes=f,e.CurrentScope=i,e.CurrentVersion=u,e.suggestionsRequestedText="",e.suggestionsRequestedScope=-1,e.CurrentLocale=r,e.WatermarkText=e.Textbox.attr("title"),e.TextboxWidth=e.Textbox.width(),e.BrandWidth=e.Control.find(".mstSrc_InnerBrand").width(),e.BrandToggle=e.Control.find(".mstSrc_InnerBrand.mstSrc_BrandToggle").size()>0,e.processedRequestTime=0;var o=window.attachEvent?"click":"mousedown";e.Button.live(o,$.proxy(e.biTrack,e)),u=="V2"?$($.proxy(e.init,e)):$($.proxy(e.initV3,e))},Mst.Search.prototype={initV3:function(){var i=".mstSrc_Dropdown",t=this,n=t,u,f,r;t.Textbox.width(t.TextboxWidth),t.Textbox.val("").bind("keydown",function(t){n.textboxKeydown(t)}).bind("keyup",function(t){n.textboxKeyup(t)}).bind("cut paste",function(){n.handleCutAndPaste()}),t.Control.find(".mstSrc_Dropdown a").live("mouseenter",function(t){n.selectDropdownItem($(t.currentTarget),!1)}).live("mouseleave",function(){n.selectDropdownItem(null,!1)}),u=function(){n.dropdownTimer!=null&&(window.clearTimeout(n.dropdownTimer),n.dropdownTimer=null);var t=$(".mstSrc_Border").outerWidth();$(i).width(t).slideDown(200)},f=function(){n.dropdownTimer=window.setTimeout(function(){$(i).slideUp(200)},200)},t.Control.find(".mstSrc_TextBox, .mstSrc_Button, .mstSrc_Dropdown a").live({focus:u,blur:f}),t.Control.find(".mstSrc_Sources ul a").click(function(t){n.selectSource($(this)),t.preventDefault()}),r=window.attachEvent?"click":"mousedown",t.Control.find(".mstSrc_Suggestions ul a").live(r,function(){n.Textbox.val($(this).text()),n.biTrack()})},init:function(){var u=".mstSrc_Dropdown",i=".mstSrc_WaterMark",r=".mstSrc_Border",n=this,t=n,f,e,o;typeof n.WatermarkText!="undefined"&&n.WatermarkText!=""&&(n.Control.find(r).prepend('<input class="mstSrc_WaterMark" type="text" readonly="readonly" style="display:none;" value="'+n.WatermarkText+'" />'),n.Textbox.val("").blur($.proxy(n.showWaterMark,n)).focus($.proxy(n.hideWaterMark,n)).change($.proxy(n.checkWaterMarkState,n)).bind("keydown",function(n){t.textboxKeydown(n)}).bind("keyup",function(n){t.textboxKeyup(n)}).bind("cut paste",function(){t.handleCutAndPaste()}),n.Control.find(i).focus($.proxy(n.shiftFocus,n)),n.Textbox.val().length>0?n.hideWaterMark():n.applyWaterMark(),n.Control.find(i).width(n.TextboxWidth)),n.Control.find(".mstSrc_Dropdown a").live("mouseenter",function(n){t.selectDropdownItem($(n.currentTarget),!1)}).live("mouseleave",function(){t.selectDropdownItem(null,!1)}),f=function(){t.dropdownTimer!=null&&(window.clearTimeout(t.dropdownTimer),t.dropdownTimer=null);var n=$(r).outerWidth();$(u).width(n).slideDown(200)},e=function(){t.dropdownTimer=window.setTimeout(function(){$(u).slideUp(200)},200)},n.Control.find(".mstSrc_TextBox, .mstSrc_Button, .mstSrc_Dropdown a").live({focus:f,blur:e}),n.Control.find(".mstSrc_Sources ul a").click(function(n){t.selectSource($(this)),n.preventDefault()}),o=window.attachEvent?"click":"mousedown",n.Control.find(".mstSrc_Suggestions ul a").live(o,function(){t.Textbox.val($(this).text()),t.biTrack()})},selectSource:function(n){var u="currentScope",f=".mstSrc_Sources li",t=this,r,i;window.clearTimeout(t.dropdownTimer),t.dropdownTimer=null,r=n.parent("li").index(f),r!==t.CurrentScope&&(t.CurrentScope=r,$(".mstSrc_Source").val(r),$(f).removeClass(u),n.parent("li").addClass(u),i=$.trim(n.text()),$(".mstSrc_WaterMark").val(i),t.Textbox.attr("title",i),t.Button.attr("title",i),t.getSuggestions()),t.Textbox.get(0).focus()},shiftHighlight:function(n,t){var f=this,r,e,o,u,i;r=f.Control.find(".mstSrc_Dropdown a:visible"),e=f.Control.find(".mstSrc_Dropdown a.selected"),u=e.length?r.index(e):t==="down"?-1:r.length,i=u,t==="down"?(i++,i<r.length||(i=-1)):t==="up"&&(i===0?i=-1:i--),i!==-1?f.selectDropdownItem($(r[i]),!0):f.selectDropdownItem(null,!1)},selectDropdownItem:function(n,t){var r="selected",i=this;i.Control.find(".mstSrc_Dropdown a").removeClass(r),n?(n.addClass(r),t&&(n.closest(".mstSrc_Suggestions").length?i.Textbox.val(n.text()):i.restoreLastTypedText())):i.restoreLastTypedText()},restoreLastTypedText:function(){this.Textbox.val(this.lastTypedText)},showWaterMark:function(){var n=this;n.watermarkTimer==null?n.watermarkTimer=window.setTimeout($.proxy(n.applyWaterMark,n),1e3):n.applyWaterMark()},applyWaterMark:function(){var t=".mstSrc_WaterMark",n=this;n.Textbox.val().length==0&&(n.Control.find(t).fadeIn(n.FadeSpeed,function(){this.style&&this.style.removeAttribute&&this.style.removeAttribute("filter")}),n.BrandToggle?(n.Control.find(".mstSrc_InnerBrand").fadeIn(n.FadeSpeed),n.Control.find(".mstSrc_TextBox, .src_waterMark").width(n.TextboxWidth)):n.Control.find(t).width(n.TextboxWidth))},hideWaterMark:function(){var n=this;n.watermarkTimer!=null&&(window.clearTimeout(n.watermarkTimer),n.watermarkTimer=null),n.Control.find(".mstSrc_WaterMark").fadeOut(n.FadeSpeed,function(){this.style&&this.style.removeAttribute&&this.style.removeAttribute("filter")}),n.BrandToggle&&n.Control.find(".mstSrc_InnerBrand").fadeOut(n.FadeSpeed,$.proxy(n.enlargeTextbox,n))},checkWaterMarkState:function(){var n=this.Textbox.val();n.length>0&&this.hideWaterMark()},textboxKeydown:function(n){var t=this,i;t.keyDown||(t.textOnKeydown=t.Textbox.val()),t.keyDown=!0;if(n.which===13){i=t.Control.find(".mstSrc_Sources a.selected");if(i.length&&i.closest("li.currentScope").length===0){t.selectSource(i),n.preventDefault();return}$.browser.msie||$.browser.opera||t.biTrack()}},textboxKeyup:function(n){var t=this;t.keyDown=!1;if(n.which===40)return t.shiftHighlight(n,"down"),!1;if(n.which===38)return t.shiftHighlight(n,"up"),!1;t.Textbox.val()!==t.textOnKeydown&&(t.lastTypedText=t.Textbox.val(),t.getSuggestions())},handleCutAndPaste:function(){var n=this;setTimeout(function(){n.getSuggestions()},10)},getSuggestions:function(){var n=this;if(n.IsSuggestionsServiceEnabled()==!0){var i=n.Textbox.val().replace(/\s+/gi," "),t,e,f,u,o,r;if(i!==n.suggestionsRequestedText||n.CurrentScope!==n.suggestionsRequestedScope){n.suggestionsRequestedText=i,n.suggestionsRequestedScope=n.CurrentScope,f=+new Date;try{t=n.Scopes[n.CurrentScope],t.SearchScopeType==1&&n.CurrentLocale.toString().toLowerCase()!="en-us"&&(t.AutoSuggest=null),t.AutoSuggest&&i.length>=t.AutoSuggest.MinChars?(e=n["processSuggestions_"+t.AutoSuggest.ResultType],u=n,o=n.formatAutoSuggestRequest(i,t),r={success:function(n){f>u.processedRequestTime&&(u.processedRequestTime=f,e.call(u,n,i,t))}},t.AutoSuggest.JsonpCallbackName&&(r.jsonp=t.AutoSuggest.JsonpCallbackName,r.dataType="jsonp"),$.ajax(o,r)):(n.processedRequestTime=f,n.hideSuggestions())}catch(s){}}}},processSuggestions_bingJSON:function(n,t,i){var u=this,r,f,e,o=!1;try{if(n.AS.Results)for(f=n.AS.Results[0].Suggests,r=0;r<f.length;++r)if(f[r].Txt){o=!0;break}}catch(s){return}if(o){for(u.clearSuggestions(),r=0;r<f.length;++r)e=f[r],e.Txt&&u.addSuggestion(e.Txt,u.formatSearchRequest(Mst.Helper.htmlDecode(e.Txt),i));u.showSuggestions()}else u.hideSuggestions()},processSuggestions_smcUnmarkedArray:function(n,t,i){var r=this,u,f;if(n&&n.length>1){for(r.clearSuggestions(),u=1;u<n.length;++u)f=Mst.Helper.htmlEncode(n[u]),r.addSuggestion(r.highlightQuery(f,t),r.formatSearchRequest(f,i));r.showSuggestions()}else r.hideSuggestions()},highlightQuery:function(n,t){var u="</strong>",f="<strong>",i=n.toLowerCase().indexOf(t.toLowerCase()),r=t.length;return i===-1?n:i===0?n.substr(0,r)+f+n.substring(r)+u:f+n.substr(0,i)+u+n.substr(i,r)+f+n.substring(r+i)+u},formatAutoSuggestRequest:function(n,t){return this.formatRequest(t.AutoSuggest.ServiceUrlFormat,n)},formatSearchRequest:function(n,t){return this.formatRequest(t.SearchUrlFormat,n)},formatRequest:function(n,t){return n.replace(/\{0\}/g,encodeURIComponent(t)).replace(/\{1\}/g,encodeURIComponent(this.CurrentLocale))},clearSuggestions:function(){this.Control.find(".mstSrc_Suggestions ul").html("")},addSuggestion:function(n,t){this.Control.find(".mstSrc_Suggestions ul").append("<li><a href='"+t.replace(/'/g,"&#39;")+"' tabindex='-1' bi:track='false'><span class='mstSrc_Text'>"+n+"</span></a></li>")},fixDropdownContentOldIE:function(){var r,i,n,t;$.browser.msie&&parseInt($.browser.version)<=7&&(r=this,setTimeout(function(){var u="display";i=r.Control.find(".mstSrc_Suggestions"),t=i.css(u),i.css(u,""),i.css(u,t),n=r.Control.find(".mstSrc_Sources"),t=n.css(u),n.css(u,""),n.css(u,t)},1))},hideSuggestions:function(){var t=this,n=this.Control.find(".mstSrc_Suggestions");n.slideUp(200,function(){t.fixDropdownContentOldIE(),n.find("a.selected").removeClass("selected")})},showSuggestions:function(){var n=this;this.Control.find(".mstSrc_Suggestions").slideDown(200,function(){n.fixDropdownContentOldIE()})},enlargeTextbox:function(){var n=".mstSrc_WaterMark";this.Control.find(n).css("display")=="none"&&this.Control.find(n).width(this.TextboxWidth)},shiftFocus:function(){window.setTimeout($.proxy(function(){this.Textbox.get(0).focus()},this),0)},IsSuggestionsServiceEnabled:function(){var n;return n=location.protocol.toString().toLowerCase()=="http:"?!0:!1},biTrack:function(){var t=".mstSrc_TextBox",i=".mstSrc_Source";if($.bi&&$.bi.dataRetrievers.structure){params={};switch($(i).val()){case"0":params.searchtype="Site";break;case"1":params.searchtype="MSCOM";break;case"2":params.searchtype="Bing"}params.interactiontype=3,params.index=$(i).val(),params.searchquery=this.Control.find(t).val(),params.searchitemtitle=$.trim(this.Control.find(t).attr("title")),params.title=params.searchitemtitle,params.parenttypestructure=$.bi.dataRetrievers.structure.getTypeStructure(this.Control.find(t)),params["-bi-description-ignore-"]="search-click",$.bi.record(params)}return!0}},window.Mst.Helper={htmlEncode:function(n){return n=="undefined"||n==null?n:$("<div/>").text(n).html()},htmlDecode:function(n){return n=="undefined"||n==null?n:$("<div/>").html(n).text()},htmlAttrEncode:function(n){return n=this.htmlEncode(n),n=n.replace(/"/g,"&quot;"),n.replace(/'/g,"&#039;")},isIE7:function(){return navigator.appVersion.indexOf("MSIE 7.")!=-1}}
