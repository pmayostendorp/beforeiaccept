(function(m){function x(a){try{return JSON.parse(a)}catch(b){return JANRAIN.SSO.warn("json array did not parse: "+a),[]}}function A(a){var b=document.createElement("a");b.href=a;return b.pathname.replace(/\//g,"_")}function B(a,b){JANRAIN.SSO.debug_log("checkVisited: ",a);var c={found:!1,isLoggedIn:!1};if(null==a||"undefined"===typeof a)return c;for(idx=0;idx<a.length;idx++){var e=a[idx];currentReceiverKey=v(e.xdReceiverURI);if("undefined"!==typeof currentReceiverKey&&currentReceiverKey===b){JANRAIN.SSO.debug_log("checkVisited found "+
b+" on "+e.domain);c.domain=e.domain;c.found=!0;JANRAIN.SSO.debug_log("checkVisited: is "+(e.isLoggedIn?"":"not ")+"logged in");c.isLoggedIn=e.isLoggedIn;break}}return c}function C(){var a=q(window.location.href);if(a.queryKey.token_url&&(a=q(decodeURIComponent(a.queryKey.token_url)),a.queryKey.xd_receiver))return decodeURIComponent(a.queryKey.xd_receiver)}function u(a){cName="";pCOOKIES=[];pCOOKIES=document.cookie.split("; ");for(bb=0;bb<pCOOKIES.length;bb++)NmeVal=[],NmeVal=pCOOKIES[bb].split("\x3d"),
NmeVal[0]==a&&(cName=unescape(NmeVal[1]));1<cName.length&&('"'===cName[0]&&(cName=cName.substr(1,cName.length)),'"'===cName[cName.length-1]&&(cName=cName.substr(0,cName.length-1)));return cName.replace(/\\"/g,'"')}function z(a,b,c,e,h,r){a=a+"\x3d"+escape(b);c&&(c=(new Date((new Date).getTime()+864E5*c)).toGMTString(),a+=";expires\x3d"+c);e&&(a+=";path\x3d"+e);h&&(a+=";domain\x3d"+h);r&&(a+="secure; ");document.cookie=a}function v(a){a=q(a);return a.host+a.path}function q(a){var b=q.options;a=b.parser[b.strictMode?
"strict":"loose"].exec(a);for(var c={},e=14;e--;)c[b.key[e]]=a[e]||"";c[b.q.name]={};c[b.key[12]].replace(b.q.parser,function(a,e,f){e&&(c[b.q.name][e]=f)});return c}function l(a,b){this.origin="https://"+q(a).host;this.path=b;this._iframe=null;this._iframeReady=!1;this._queue=[];this._requests={};this._messageId=0}if(!("undefined"!==typeof m.JANRAIN&&m.JANRAIN.SSO)){JANRAIN={SSO:{}};JANRAIN.SSO.version="3.3.2";JANRAIN.SSO.CAPTURE={};JANRAIN.SSO.ENGAGE={};var E=!1;window.localStorage&&(E=window.localStorage.getItem("janrainSsoDebugEnabled"));
var g,f,n,t,w,s,k,D,F,p,G,y;JANRAIN.SSO.debug_log=function(a,b){E&&(b&&(window.JSON&&window.JSON.stringify&&(b=JSON.stringify(b)),a+=": "+b),d=new Date,a="SSO DEBUG ("+d.toGMTString()+"): "+a,window.console&&window.console.debug?console.debug(a):window.console&&window.console.log&&console.log(a))};JANRAIN.SSO.log=function(a,b){window.console&&window.console.log&&(b&&(window.JSON&&window.JSON.stringify&&(b=JSON.stringify(b)),a+=": "+b),d=new Date,console.log("SSO ("+d.toGMTString()+"): "+a))};JANRAIN.SSO.warn=
function(a){window.console&&window.console.warn&&console.warn("SSO WARNING: "+a)};JANRAIN.SSO.error=function(a){window.console&&window.console.error&&console.error("SSO ERROR: "+a)};JANRAIN.SSO.useCookiesOnly=function(){"undefined"===typeof G&&(G=navigator&&navigator.userAgent&&-1<navigator.userAgent.search("__use_cookies__")?!0:!1);return G};JANRAIN.SSO.remoteStorage=function(a){a=a||f;p||(p=new l(a,"/static/server.html"));return p};JANRAIN.SSO.getSsoServer=function(){return f};JANRAIN.SSO._debugDump=
function(){window.console&&window.console.log&&(console.log("version: "+JANRAIN.SSO.version),console.log("use cookies only: "+JANRAIN.SSO.useCookiesOnly()),console.log("sso server: "+JANRAIN.SSO.getSsoServer()),rs=JANRAIN.SSO.remoteStorage(),rs.getValue(janrain.settings.sso.segment,"get",function(a,b){console.log("session id: "+b.session_id);visitedArray=x(b.visited);if(null!=visitedArray)for(idx=0;idx<visitedArray.length;idx++)domain=visitedArray[idx].domain,xdReceiverURI=visitedArray[idx].xdReceiverURI,
isLoggedIn=visitedArray[idx].isLoggedIn,logoutURI=visitedArray[idx].logoutURI,console.log("visited "+(idx+1)+": "),console.log("        "+domain),console.log("        "+xdReceiverURI),console.log("        "+isLoggedIn),console.log("        "+logoutURI)}))};JANRAIN.SSO.CAPTURE.logout=function(a,b){JANRAIN.SSO.logout(a,b)};JANRAIN.SSO.ENGAGE.logout=function(a,b){JANRAIN.SSO.logout(a,b)};JANRAIN.SSO.CAPTURE.refresh=function(a){JANRAIN.SSO.refresh(a)};JANRAIN.SSO.ENGAGE.refresh=function(a){JANRAIN.SSO.refresh(a)};
JANRAIN.SSO.CAPTURE.refresh_token=function(a){if("undefined"===typeof f||"undefined"===typeof n)JANRAIN.SSO.error("check_login must be called before calling refresh_token");else if(window.localStorage&&!JANRAIN.SSO.useCookiesOnly()){p||(p=new l(sso_server_use,"/static/server.html"));JANRAIN.SSO.log("finding a segment to request new capture token on");JANRAIN.SSO.debug_log("Segments to check: "+F);v(t);var b;F.some(function(a){p.getValue(a,"get",function(c,e){b||(JANRAIN.SSO.log("checking segment: "+
a),!e.session_id||1>e.session_id.length?JANRAIN.SSO.log("no session found"):(JANRAIN.SSO.log("found a session; will request new token"),b=e.session_id))})});setTimeout(function(){if(b){var c=document.createElement("script");c.src=f+"/capture/v1/refresh_token?v\x3d"+(new Date).getTime()+"\x26redirect_uri\x3d"+encodeURIComponent(n)+"\x26callback\x3d"+encodeURIComponent(a)+"\x26client_id\x3d"+encodeURIComponent(s)+"\x26xdreceiver_uri\x3d"+encodeURIComponent(t)+"\x26logout_uri\x3d"+encodeURIComponent(w)+
"\x26session_id\x3d"+encodeURIComponent(b)+"\x26origin\x3d"+encodeURIComponent(m.document.location.href);c.type="text/javascript";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(c,e)}else JANRAIN.SSO.error("no session found; cannot request new capture token")},1E3)}else{var c=document.createElement("script");c.src=f+"/capture/v1/refresh_token?v\x3d"+(new Date).getTime()+"\x26redirect_uri\x3d"+encodeURIComponent(n)+"\x26callback\x3d"+encodeURIComponent(a)+"\x26client_id\x3d"+
encodeURIComponent(s)+"\x26xdreceiver_uri\x3d"+encodeURIComponent(t)+"\x26logout_uri\x3d"+encodeURIComponent(w)+"\x26origin\x3d"+encodeURIComponent(m.document.location.href);c.type="text/javascript";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(c,e)}};JANRAIN.SSO.CAPTURE.set_login=function(a){if("undefined"===typeof f||"undefined"===typeof n)JANRAIN.SSO.error("check_login must be called before calling set_login");else{var b=document.createElement("script");b.src=f+"/capture/v1/set_login?v\x3d"+
(new Date).getTime()+"\x26redirect_uri\x3d"+encodeURIComponent(n)+"\x26code\x3d"+encodeURIComponent(a.code)+"\x26login_callback\x3d"+encodeURIComponent(a.login_callback)+"\x26transaction_id\x3d"+encodeURIComponent(a.transaction_id);b.type="text/javascript";a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a)}};JANRAIN.SSO.CAPTURE.check_login=function(a){f=f||a.sso_server;n=n||a.redirect_uri;t=t||a.xd_receiver;w=w||a.logout_uri;s=s||a.client_id;k=k||a.response_type;JANRAIN.SSO.safariWorkAround(f);
y=!1;a.response_type=a.response_type||"code";a.response_method=a.response_method||"redirect";a.refresh=a.refresh||!1;a.segment=void 0===a.segment?"":a.segment.replace(/ /g,"_");a.supported_segments_ary=[];void 0!==a.supported_segments&&(a.supported_segments_ary=a.supported_segments.split("-"));a.supported_segments_ary.push(a.segment);F=a.supported_segments_ary;void 0===a.logout_uri&&(a.logout_uri="");void 0===a.bp_uri&&(a.bp_uri="");if(window.localStorage&&!JANRAIN.SSO.useCookiesOnly())JANRAIN.SSO.check_login_dispatch(a,
JANRAIN.SSO.CAPTURE.handleSegmentCheck);else{var b="janrain_sso_checked_"+A(a.xd_receiver);if(-1===m.document.cookie.search(RegExp(b)))b=document.createElement("script"),b.src=f+"/capture/v1/sso_check.js?v\x3d"+(new Date).getTime()+"\x26xd_receiver\x3d"+encodeURIComponent(t)+"\x26origin\x3d"+encodeURIComponent(m.document.location.href)+"\x26logout_uri\x3d"+encodeURIComponent(w)+"\x26redirect_uri\x3d"+encodeURIComponent(n)+"\x26client_id\x3d"+encodeURIComponent(s)+"\x26bp_channel\x3d"+encodeURIComponent(a.bp_channel)+
"\x26segment\x3d"+encodeURIComponent(a.segment)+"\x26response_type\x3d"+encodeURIComponent(k)+"\x26response_method\x3d"+encodeURIComponent(a.response_method)+"\x26widget_parameters\x3d"+encodeURIComponent(a.widget_parameters)+"\x26nologin_callback\x3d"+encodeURIComponent(a.nologin_callback)+"\x26transaction_id\x3d"+encodeURIComponent(a.transaction_id)+"\x26refresh\x3d"+a.refresh,b.type="text/javascript",a=document.getElementsByTagName("script")[0],a.parentNode.insertBefore(b,a);else if("undefined"!==
typeof janrain&&janrain.capture&&janrain.capture.ui&&"function"===typeof janrain.capture.ui[a.nologin_callback])janrain.capture.ui[a.nologin_callback]({transactionId:a.transaction_id,result:"already checked"})}};JANRAIN.SSO.CAPTURE.handleSegmentCheck=function(a,b,c,e){var h=[],r={found:!1},f=v(a.xd_receiver),k=q(a.xd_receiver).host;JANRAIN.SSO.log("checking segment "+c);if(!b.visited_expires||"session"===b.visited_expires)b.visited_expires="session","session"!==u("janrainSSO_session")&&(a.refresh=
!0,JANRAIN.SSO.log("visited tracker is session-based but no janrainSSO_session cookie found; will refresh even if marked as logged in"),z("janrainSSO_session","session",null,"/"));if(b.visited&&(h=x(b.visited),r=B(h,f),JANRAIN.SSO.debug_log("handleSegmentCheck visitedStatus",r),!0===r.found))if(!0===r.isLoggedIn)if(JANRAIN.SSO.log("already logged into: "+r.domain),a.refresh&&!y)JANRAIN.SSO.log("overriding with refresh");else{if("undefined"!==typeof janrain&&janrain.capture&&janrain.capture.ui&&"function"===
typeof janrain.capture.ui[a.nologin_callback])janrain.capture.ui[a.nologin_callback]({transactionId:a.transaction_id,result:"already checked"});return}else JANRAIN.SSO.log("found: "+r.domain+" but not logged in");if(!r.found){var l=q(a.xd_receiver);h.push({domain:l.host+l.path,xdReceiverURI:a.xd_receiver,isLoggedIn:!1,logoutURI:a.logout_uri});10<h.length&&h.splice(0,1)}!b.session_id||1>b.session_id.length?(JANRAIN.SSO.log("no session exists; not logging in"),e=function(){if("undefined"!==typeof janrain&&
janrain.capture&&janrain.capture.ui&&"function"===typeof janrain.capture.ui[a.nologin_callback])janrain.capture.ui[a.nologin_callback]({transactionId:a.transaction_id,result:"sso failed - no session exists"})},r.found?e():JANRAIN.SSO._setSession(b.session_id,JSON.stringify(h),b.visited_expires,c,k,e)):(!b.visited&&!y&&(a.refresh=!0,JANRAIN.SSO.log("session exists, but no visited list; forcing a refresh")),e&&!a.refresh||y?(JANRAIN.SSO.log("capture user already logged in to the site; marking as logged in on this segment, too"),
h.some(function(a,b){if(v(a.xdReceiverURI)===f)return h[b].isLoggedIn=!0}),JANRAIN.SSO._setSession(b.session_id,JSON.stringify(h),b.visited_expires,c,k)):(y=!0,JANRAIN.SSO.log("logging in capture user"),JANRAIN.SSO.CAPTURE._login(a,b.session_id,JSON.stringify(h),"JANRAIN.SSO.CAPTURE._loginCallback",c)))};JANRAIN.SSO.CAPTURE._login=function(a,b,c,e,h){if("undefined"===typeof f)JANRAIN.SSO.error("sso server is not defined");else{var r=document.createElement("script");r.src=f+"/capture/loginx?v\x3d"+
(new Date).getTime()+"\x26callback\x3d"+encodeURIComponent(e)+"\x26xd_receiver\x3d"+encodeURIComponent(t)+"\x26origin\x3d"+encodeURIComponent(m.document.location.href)+"\x26logout_uri\x3d"+encodeURIComponent(w)+"\x26redirect_uri\x3d"+encodeURIComponent(n)+"\x26client_id\x3d"+encodeURIComponent(s)+"\x26bp_channel\x3d"+encodeURIComponent(a.bp_channel)+"\x26segment\x3d"+encodeURIComponent(h)+"\x26response_type\x3d"+encodeURIComponent(a.response_type)+"\x26response_method\x3d"+encodeURIComponent(a.response_method)+
"\x26widget_parameters\x3d"+encodeURIComponent(a.widget_parameters)+"\x26transaction_id\x3d"+encodeURIComponent(a.transaction_id)+"\x26session_id\x3d"+encodeURIComponent(b)+"\x26visited\x3d"+encodeURIComponent(c);r.type="text/javascript";a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(r,a)}};JANRAIN.SSO.CAPTURE._loginCallback=function(a){if(!a||"fail"===a.stat)JANRAIN.SSO.error("login failed: "+a.msg);else{JANRAIN.SSO.log("callback from SSO server received");p||(p=new l(f,"/static/server.html"));
JANRAIN.SSO.log("updating SSO session");var b={session_id:decodeURIComponent(a.session_id),visited:decodeURIComponent(a.visited),visited_expires:a.visited_expires};p.setValue(a.segment,"set",b,function(b,e){a.capture_callback&&"jsonp"===a.response_method&&"undefined"!==typeof janrain&&janrain.capture&&janrain.capture.ui&&"function"===typeof a.capture_callback?a.capture_callback():a.redirect_uri&&0<a.redirect_uri.length&&(m.document.location.href=a.redirect_uri)})}};JANRAIN.SSO.ENGAGE.check_login=
function(a){f=f||a.sso_server;t=t||a.xd_receiver;w=w||a.logout_uri;g=a.token_uri;JANRAIN.SSO.safariWorkAround(f);y=!1;a.segment=void 0===a.segment?"":a.segment.replace(/ /g,"_");a.supported_segments_ary=[];void 0!==a.supported_segments&&(a.supported_segments_ary=a.supported_segments.split("-"));a.supported_segments_ary.push(a.segment);void 0===a.logout_uri&&(a.logout_uri="");void 0===a.bp_uri&&(a.bp_uri="");if(void 0===a.xd_receiver)JANRAIN.SSO.error("configuration value xd_receiver undefined");else if(window.localStorage&&
!JANRAIN.SSO.useCookiesOnly())JANRAIN.SSO.check_login_dispatch(a,JANRAIN.SSO.ENGAGE.handleSegmentCheck);else{var b="janrain_sso_checked_"+A(a.xd_receiver);-1===m.document.cookie.search(RegExp(b))&&(b=document.createElement("script"),b.src=a.sso_server+"/session/sso_check.js?v\x3d"+(new Date).getTime()+"\x26xdcomm_uri\x3d"+encodeURIComponent(a.xd_receiver)+"\x26bp_channel\x3d"+encodeURIComponent(a.bp_channel)+"\x26segment\x3d"+encodeURIComponent(a.segment)+"\x26logout_uri\x3d"+encodeURIComponent(a.logout_uri),
b.type="text/javascript",a=document.getElementsByTagName("script")[0],a.parentNode.insertBefore(b,a))}};JANRAIN.SSO.ENGAGE.handleSegmentCheck=function(a,b,c,e){var h=[],r={found:!1},f=v(a.xd_receiver),k=q(a.xd_receiver).host;JANRAIN.SSO.log("checking segment "+c);if(!b.visited_expires||"session"===b.visited_expires)b.visited_expires="session","session"!==u("janrainSSO_session")&&(a.refresh=!0,JANRAIN.SSO.log("visited tracker is session-based but no janrainSSO_session cookie found; will refresh even if marked as logged in"),
z("janrainSSO_session","session",null,"/"));if(b.visited&&(h=x(b.visited),r=B(h,f),JANRAIN.SSO.debug_log("handleSegmentCheck visitedStatus",r),!0===r.found))if(!0===r.isLoggedIn)if(JANRAIN.SSO.log("already logged into: "+r.domain),a.refresh&&!y)JANRAIN.SSO.log("overriding with refresh");else return;else JANRAIN.SSO.log("found: "+r.domain+" but not logged in");if(!r.found){var l=q(a.xd_receiver);h.push({domain:l.host+l.path,xdReceiverURI:a.xd_receiver,isLoggedIn:!1,logoutURI:a.logout_uri});10<h.length&&
h.splice(0,1)}!b.session_id||1>b.session_id.length?(JANRAIN.SSO.log("no session exists; not logging in"),r.found||JANRAIN.SSO._setSession(b.session_id,JSON.stringify(h),b.visited_expires,c,k,function(){})):(!b.visited&&!y&&(a.refresh=!0,JANRAIN.SSO.log("session exists, but no visited list; forcing a refresh")),e&&!a.refresh||y?(JANRAIN.SSO.log("user already logged in to the site; marking as logged in on this segment, too"),h.some(function(a,b){if(v(a.xdReceiverURI)===f)return h[b].isLoggedIn=!0}),
JANRAIN.SSO._setSession(b.session_id,JSON.stringify(h),b.visited_expires,c,k)):(y=!0,JANRAIN.SSO.log("logging in user"),JANRAIN.SSO.ENGAGE._login({session_id:b.session_id,xd_receiver:a.xd_receiver,visited:JSON.stringify(h),callback:"JANRAIN.SSO.ENGAGE._loginCallback",bp_channel:a.bp_channel,logout_uri:a.logout_uri,segment:c})))};JANRAIN.SSO.check_login_dispatch=function(a,b){p||(p=new l(a.sso_server,"/static/server.html"));JANRAIN.SSO.log("checking for session");JANRAIN.SSO.debug_log("Segments to check: "+
a.supported_segments_ary);p.getValue("","getAllVisited",function(c,e){var h=v(a.xd_receiver),f=x(e.allVisited).some(function(a){if(h===v(a.xdReceiverURI))return a.isLoggedIn});a.supported_segments_ary.forEach(function(c){p.getValue(c,"get",function(e,h){b(a,h,c,f)})})})};JANRAIN.SSO._redirectCallback=function(a,b,c,e,h,r,k){(r=r||f)?!h&&!t?(JANRAIN.SSO.error("no session set, due to missing xd_receiver and logged_in_host parameters"),"function"===typeof k&&k()):(p||(p=new l(r,"/static/server.html")),
JANRAIN.SSO.log("updating session"),p.getValue(h,"getSegment",function(c,f){p.getValue(f.segment,"get",function(c,l){var g=[],p;if(l.visited){JANRAIN.SSO.log("visited: "+l.visited);g=x(l.visited);t||(t=C());var m=0;if(t)p=v(t);else for(var n=0;n<g.length;n++)q(g[n].xdReceiverURI).host==h&&m++;1<m&&(JANRAIN.SSO.log("multiple domains match, resetting visited"),g=[]);for(n=0;n<g.length;n++){var m=v(g[n].xdReceiverURI),s=q(g[n].xdReceiverURI);if("undefined"!==typeof m&&(m===p||s.host===h)){!0===g[n].isLoggedIn?
JANRAIN.SSO.log("logging in again to: "+g[n].domain):(JANRAIN.SSO.log("found and logging in to: "+g[n].domain),g[n].isLoggedIn=!0);g=[g[n]];break}}}else JANRAIN.SSO.warn("expected a visited list for segment "+f.segment+" - none found");JANRAIN.SSO._setSSOSession(a,b,JSON.stringify(g),e,r,f.segment,h,function(){"function"===typeof k&&k()})})})):(JANRAIN.SSO.error("no session set, due to missing sso server parameter"),"function"===typeof k&&k())};JANRAIN.SSO._setSSOSession=function(a,b,c,e,h,f,k,g){p||
(p=new l(h,"/static/server.html"));JANRAIN.SSO.debug_log("visited expires:  "+e);b={session_id:a,session_id_expires:b,visited:c,visited_expires:e,host:k};a?JANRAIN.SSO.log("setting session "+b.host+" with segment "+f):JANRAIN.SSO.log("updating the visited list for segment "+f);p.setValue(f,"set",b,function(a,b){"undefined"!==g&&"function"===typeof g&&g()})};JANRAIN.SSO._setSession=function(a,b,c,e,h,g){JANRAIN.SSO._setSSOSession(a,null,b,c,f,e,h,g)};JANRAIN.SSO.ENGAGE._login=function(a){if("undefined"===
typeof f)JANRAIN.SSO.error("sso server is not defined");else{var b=document.createElement("script");b.src=f+"/engage/loginx?v\x3d"+(new Date).getTime()+"\x26callback\x3d"+encodeURIComponent(a.callback)+"\x26xdcomm_uri\x3d"+encodeURIComponent(a.xd_receiver)+"\x26session_id\x3d"+encodeURIComponent(a.session_id)+"\x26visited\x3d"+encodeURIComponent(a.visited)+"\x26logout_uri\x3d"+encodeURIComponent(a.logout_uri)+"\x26bp_channel\x3d"+encodeURIComponent(a.bp_channel)+"\x26segment\x3d"+encodeURIComponent(a.segment);
b.type="text/javascript";a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a)}};JANRAIN.SSO.ENGAGE._loginCallback=function(a){if(!a||"fail"===a.stat)JANRAIN.SSO.error("login failed: "+a.msg);else{JANRAIN.SSO.log("callback from SSO server received");p||(p=new l(f,"/static/server.html"));var b=q(window.location.hostname).host;JANRAIN.SSO.log("updating SSO session");b={session_id:decodeURIComponent(a.session_id),visited:decodeURIComponent(a.visited),visited_expires:a.visited_expires,
host:b};JANRAIN.SSO.debug_log("ENGAGE._loginCallback: "+a.token);p.setValue(a.segment,"set",b,function(b,e){JANRAIN.SSO.ENGAGE.post_token(a.token)})}};JANRAIN.SSO.ENGAGE.post_token=function(a){JANRAIN.SSO.log("posting token "+a+" to "+g);var b=m.document.createElement("form"),c=m.document.createElement("input");c.name="token";c.id="token";c.type="hidden";c.value=a;b.appendChild(c);b.method="POST";-1!=g.search(/\?/)?b.action=g+"\x26token\x3d"+a:b.action=g+"?token\x3d"+a;JANRAIN.SSO.log("form action: "+
b.action);m.parent.document.getElementsByTagName("head")[0].appendChild(b);b.submit()};JANRAIN.SSO.logout=function(a,b){E&&(callback_message="undefined"===typeof b?"callback function undefined":"callback: "+b.name,JANRAIN.SSO.debug_log("logout called "+callback_message+" caller name: '"+arguments.callee.caller.name+"'"));JANRAIN.SSO._deleteChecked();"undefined"!==typeof b&&"function"===typeof b&&(D=b);if("undefined"!==typeof a.sso_server){var c=q(window.location.hostname).host;if(window.localStorage&&
!JANRAIN.SSO.useCookiesOnly())p||(p=new l(a.sso_server,"/static/server.html")),JANRAIN.SSO.log("removing session_id"),p.getValue(c,"getSegment",function(e,f){JANRAIN.SSO.log("got segment "+e+"\x3d"+f.segment);p.getValue(f.segment,"getAllVisited",function(e,h){var g=[],k=[];if(h.allVisited){g=x(h.allVisited);k=JANRAIN.SSO._getLogoutUrls(g,t);JANRAIN.SSO.debug_log("SSO: logoutUrls: ",k);for(var l=[],n=0;n<g.length;n++){var m=q(g[n].xdReceiverURI).host;if(g[n].xdReceiverURI===t||m===c){g[n].isLoggedIn=
!1;l=[g[n]];break}}g=l}toBeDeletedValue=h;toBeDeletedValue.session_id="deleteMe";toBeDeletedValue.visited=JSON.stringify(g);toBeDeletedValue.session_id_expires="deleteMe";JANRAIN.SSO.log("deleting session "+toBeDeletedValue);JANRAIN.SSO.log("deleting session "+toBeDeletedValue.visited);p.setValue(f.segment,"deleteSession",toBeDeletedValue,function(c,e){JANRAIN.SSO.log("session removed "+c+"\x3d"+e);JANRAIN.SSO._doLogout(a.logout_uri,k,b)})})});else{var e=m.document.createElement("script");e.setAttribute("src",
a.sso_server+"/session/logout.js?logout_uri\x3d"+encodeURIComponent(a.logout_uri));document.getElementsByTagName("body")[0].appendChild(e)}}};JANRAIN.SSO._getLogoutUrls=function(a,b){var c=[],e;"undefined"!==typeof b&&(e=v(b));JANRAIN.SSO.debug_log("localSiteKey: "+e);for(var h=0;h<a.length;h++){var f=v(a[h].xdReceiverURI),g=a[h].isLoggedIn;JANRAIN.SSO.debug_log(h+1+" this siteKey: "+f);g&&f!==e&&(JANRAIN.SSO.debug_log("logoutURI: "+a[h].logoutURI),c.push(a[h].logoutURI))}return c};JANRAIN.SSO._deleteChecked=
function(){for(var a=m.document.cookie.split(";"),b=0;b<a.length;b++)-1<a[b].search(/janrain_sso_checked/)&&(m.document.cookie=a[b]+"\x3d;expires\x3d"+(new Date).toGMTString()+";path\x3d/;",JANRAIN.SSO.log("sso removed cookie "+a[b]))};JANRAIN.SSO.refresh=function(a){if("undefined"!==typeof a){var b=m.document.createElement("script");b.setAttribute("src",a+"/session/refresh.js");document.getElementsByTagName("body")[0].appendChild(b)}};JANRAIN.SSO._doLogout=function(a,b,c){onComplete=function(){"undefined"!==
typeof D&&"function"===typeof D?(JANRAIN.SSO.log("calling logout_callback()"),D()):"undefined"!==typeof a&&(JANRAIN.SSO.log("redirecting to "+a),m.document.location.href=a)};JANRAIN.SSO._loadUrls(b,onComplete)};JANRAIN.SSO._loadUrls=function(a,b){onComplete=function(){"undefined"!==typeof b&&"function"===typeof b&&b()};if(null!=a&&0<a.length){var c=0;onFrameLoad=function(){++c;c>=a.length&&onComplete()};for(var e,f=0;f<a.length;f++){m.document.all?(e=document.createElement("div"),e.innerHTML='\x3ciframe onload\x3d"onFrameLoad();"\x3e\x3c/iframe\x3e',
e=e.firstChild):(e=m.document.createElement("iframe"),e.onload=onFrameLoad);var g=decodeURIComponent(a[f]);"https:"===document.location.protocol&&(g=g.replace("^http:","https:"));e.setAttribute("src",g);JANRAIN.SSO.log("calling logout url "+f+" of "+a.length+": "+a[f]);m.document.getElementsByTagName("head")[0].appendChild(e)}}else onComplete()};JANRAIN.SSO.safariWorkAround=function(a){var b=!1,c=navigator.userAgent;if(-1!=c.indexOf("Safari")){var e=c.indexOf("Version");if(-1!=e)var c=c.substring(e+
8),f=parseInt(""+c,10);5<f&&(JANRAIN.SSO.debug_log("Safari version is "+f+", workaround enabled"),b=!0)}b?localStorage.getItem("federateUnlocked")||(JANRAIN.SSO.debug_log("SSO not unlocked yet"),b=encodeURIComponent(location.href),a=a+"/static/server.html?origin\x3d"+b,JANRAIN.SSO.debug_log("Navigating to SSO server at: "+a),localStorage.setItem("federateUnlocked","true"),location.href=a):JANRAIN.SSO.debug_log("safariWorkAround called but not in Safari")};q.options={strictMode:!1,key:"source protocol authority userInfo user password host port relative path directory file query anchor".split(" "),
q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};Array.prototype.forEach=Array.prototype.forEach||function(a,b){var c=this.length>>>0;if("function"!=
typeof a)throw new TypeError;for(var e=0;e<c;e++)e in this&&a.call(b,this[e],e,this)};Array.prototype.some||(Array.prototype.some=function(a,b){if(null==this)throw new TypeError;var c,e=Object(this),f=e.length>>>0;if("function"!==typeof a)throw new TypeError;for(c=0;c<f;c++)if(c in e&&a.call(b,e[c],c,e))return!0;return!1});_array_contains=function(a,b){if("undefined"===typeof a||null===a)return!1;for(var c=a.length;c--;)if(a[c]===b)return!0;return!1};l.prototype={constructor:l,init:function(){var a=
this;if(!this._iframe)if(window.postMessage&&window.JSON&&window.localStorage&&!JANRAIN.SSO.useCookiesOnly()){this._iframe=document.createElement("iframe");this._iframe.style.cssText="position:absolute;width:1px;height:1px;left:-9999px;";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(this._iframe,b);window.addEventListener?(this._iframe.addEventListener("load",function(){a._iframeLoaded()},!1),window.addEventListener("message",function(b){a._handleMessage(b)},!1)):this._iframe.attachEvent&&
(this._iframe.attachEvent("onload",function(){a._iframeLoaded()},!1),window.attachEvent("onmessage",function(b){a._handleMessage(b)}))}else throw Error("Unsupported browser.");this._iframe.src=this.origin+this.path},getValue:function(a,b,c){a={request:{key:a,messageId:++this._messageId,action:b},callback:c};this._iframeReady?this._sendRequest(a):this._queue.push(a);this._iframe||this.init()},setValue:function(a,b,c,e){a={request:{key:a,messageId:++this._messageId,action:b,storedValue:c},callback:e};
this._iframeReady?this._sendRequest(a):this._queue.push(a);this._iframe||this.init()},removeValue:function(a,b){var c={request:{key:a,messageId:++this._messageId,action:"remove"},callback:b};this._iframeReady?this._sendRequest(c):this._queue.push(c);this._iframe||this.init()},_sendRequest:function(a){this._requests[a.request.messageId]=a;this._iframe.contentWindow.postMessage(JSON.stringify(a.request),this.origin)},_iframeLoaded:function(){this._iframeReady=!0;if(this._queue.length){for(var a=0,b=
this._queue.length;a<b;a++)this._sendRequest(this._queue[a]);this._queue=[]}},_handleMessage:function(a){if(a.origin==this.origin){var b;try{b=JSON.parse(a.data)}catch(c){JANRAIN.SSO.warn("json object did not parse: "+array),b={}}"undefined"!==typeof b.messageId&&(this._requests[b.messageId].callback(b.key,b.storedValue),delete this._requests[b.messageId])}}};JANRAIN.SSO.debug_log(navigator.userAgent)}})(this);var JSON;JSON||(JSON={});
(function(){function m(l){return 10>l?"0"+l:l}function x(l){C.lastIndex=0;return C.test(l)?'"'+l.replace(C,function(l){var g=v[l];return"string"===typeof g?g:"\\u"+("0000"+l.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+l+'"'}function A(l,m){var g,f,n,t,w=u,s,k=m[l];k&&"object"===typeof k&&"function"===typeof k.toJSON&&(k=k.toJSON(l));"function"===typeof q&&(k=q.call(m,l,k));switch(typeof k){case "string":return x(k);case "number":return isFinite(k)?""+k:"null";case "boolean":case "null":return""+
k;case "object":if(!k)return"null";u+=z;s=[];if("[object Array]"===Object.prototype.toString.apply(k)){t=k.length;for(g=0;g<t;g+=1)s[g]=A(g,k)||"null";n=0===s.length?"[]":u?"[\n"+u+s.join(",\n"+u)+"\n"+w+"]":"["+s.join(",")+"]";u=w;return n}if(q&&"object"===typeof q){t=q.length;for(g=0;g<t;g+=1)"string"===typeof q[g]&&(f=q[g],(n=A(f,k))&&s.push(x(f)+(u?": ":":")+n))}else for(f in k)Object.prototype.hasOwnProperty.call(k,f)&&(n=A(f,k))&&s.push(x(f)+(u?": ":":")+n);n=0===s.length?"{}":u?"{\n"+u+s.join(",\n"+
u)+"\n"+w+"}":"{"+s.join(",")+"}";u=w;return n}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+m(this.getUTCMonth()+1)+"-"+m(this.getUTCDate())+"T"+m(this.getUTCHours())+":"+m(this.getUTCMinutes())+":"+m(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var B=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
C=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,u,z,v={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},q;"function"!==typeof JSON.stringify&&(JSON.stringify=function(l,m,g){var f;z=u="";if("number"===typeof g)for(f=0;f<g;f+=1)z+=" ";else"string"===typeof g&&(z=g);if((q=m)&&"function"!==typeof m&&("object"!==typeof m||"number"!==typeof m.length))throw Error("JSON.stringify");return A("",{"":l})});
"function"!==typeof JSON.parse&&(JSON.parse=function(l,m){function g(f,l){var q,s,k=f[l];if(k&&"object"===typeof k)for(q in k)Object.prototype.hasOwnProperty.call(k,q)&&(s=g(k,q),void 0!==s?k[q]=s:delete k[q]);return m.call(f,l,k)}var f;l=""+l;B.lastIndex=0;B.test(l)&&(l=l.replace(B,function(f){return"\\u"+("0000"+f.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(l.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return f=eval("("+l+")"),"function"===typeof m?g({"":f},""):f;throw new SyntaxError("JSON.parse");})})();