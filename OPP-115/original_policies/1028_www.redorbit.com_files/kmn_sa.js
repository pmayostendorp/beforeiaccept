var kmn_data=kmn_data||{},kmn_iframe=kmn_iframe||0,kmn_ts=new Date().getTime(),kmn_next=kmn_next||{},kmn_house=kmn_house||{},kmn_cb=kmn_cb||Math.floor((kmn_ts%65536)+(Math.floor(Math.random()*65536)*65536)),kmn_cstat=kmn_cstat||new function(){var a=this;a.async_js=function(f,d){try{var g,b=kmn_sa,c=document.createElement("script");b.setAttributes(c,b.extend(d||{},{src:f,async:true,type:"text/javascript"}));g=document.getElementsByTagName("head")[0];if(g){g.appendChild(c);c.apnd=1}return c}catch(h){}};a.stat_src=function(b,e){var c,d="?",e=e||{};for(c in e){d+=encodeURIComponent(c)+"="+encodeURIComponent(e[c])+"&"}return(b+d.slice(0,-1))};a.save=function(c,g){try{var f=a.stat_src(c,g),b=a.async_js(f,{});b.onload=b.onreadystatechange=function(){if(!b.readyState||b.readyState==="loaded"||b.readyState==="complete"){b.onload=b.onreadystatechange=null;if(b.parentNode){b.parentNode.removeChild(b)}}};return b}catch(d){}}}(),kmn_sa=kmn_sa||new function(){var a=".komoona.com/",c="border:none;padding:0;margin:0;background:transparent;",e="kmn_tag_",f="kmn-debug=true";var b=this,d=kmn_cstat,h=document,g=window;b.options={base_url:"//a"+a,ext_src:"//cdn"+a+"scripts/kmn",debug:0,stat_url:"//stat"+a+"s",np:"//s"+a+"passback/np/",v:"2.55",cs:{}};b.tags={};b.stMx=120;b.ifrmMx=12;b.o=b.options;b.is_iframe=function(){var i=0;try{i=(g.location!==g.parent.location)}catch(j){}return i};b.build_js=function(j,i){return('<script type="text/javascript"'+(i?">"+j:' src="'+j+'">')+"<\/script>")};b.write_js=function(i){h.write(b.build_js(i,0))};b.extend=function(){var l=0,k,j={};for(;l<arguments.length;l++){for(k in arguments[l]){j[k]=j[k]||arguments[l][k]}}return j};b.setAttributes=function(k,j){try{for(var i in j){k.setAttribute(i,j[i])}return k}catch(l){}};b.cssClass=function(k){try{var m=h.createElement("style"),j="",i=h.getElementsByTagName("head")[0];for(var l in k){j+="."+l+"{"+k[l]+"}"}m.appendChild(h.createTextNode(j));m.setAttribute("type","text/css");if(i){i.appendChild(m)}}catch(n){}};b.create_iframe=function(l,j,i){var k=h.createElement("iframe");b.setAttributes(k,b.extend(i||{},{src:l,marginHeight:0,marginWidth:0,frameBorder:0,scrolling:"no"}));if(j){j.appendChild(k)}return k};b.get_np=function(i){if(g.kmn_passbacks&&kmn_passbacks[i]){kmn_np.next(i)}else{if(kmn_next[i]){delete kmn_next[i]}b.write_js(b.o.np+i+".js")}};b.getDoc=function(){try{return(b.is_iframe()?g.frameElement.contentDocument||g.frameElement.contentWindow.document:h)}catch(i){}return null};b.callS2s=function(j,l){if(l.s2sBaseUrl){var i,k,m=b.getDoc(),n={layoutid:j,chain:l.codes,cb:kmn_cb,index:l.full_index-1,uts:new Date().getTime(),inFrame:b.is_iframe()?1:0,url:b.site_url(),tz:new Date().getTimezoneOffset()};if(m){k=(m.characterSet?m.characterSet:m.charset);if(k){n.ch=k}}i=d.stat_src(l.s2sBaseUrl+"GetAd",n);b.log("s2s["+i+"]");return b.build_js(i,0)}return""};b.s2sServerIncrement=function(l,j){if(j>1&&kmn_data[l]){var q=kmn_data[l],o=q.full_index,n=o,m=(o+j-1),k=q.order,p=q.codes;for(;n<m;n++){k=p[n].split("").reverse().join("")+"|"+k}q.order=k;q.full_index=m}};b.useS2sOn=function(j,k){try{var l=kmn_data[j]||{};if(l.s2sCodes){var i=l.s2sCodes.indexOf(k.charAt(0))>-1;if(i&&l.s2sExcludedTags){i=!(l.s2sExcludedTags.indexOf(k)>-1)}return i}}catch(m){}return 0};b.site_url=function(k){var j="",i="";if(g.kmn_siteurl&&k!==0){j=kmn_siteurl}else{j=i=(b.is_iframe()&&h.referrer!=="")?h.referrer:g.location.href;if(j.indexOf("javascript:window")!==-1||j.indexOf("about:blank")!==-1){try{j=g.parent.location.href}catch(l){j=i}}}if(j.length>1024){j=j.replace(/([^:]+:\/\/[^\/]+).*/,"$1")}return j};b.is_debug=function(){try{var l=0,m=0,k=g.location.href,j=k.slice(k.indexOf("?")+1).split("&");for(;l<j.length;l++){if(j[l]===f){m=1}}b.o.debug=m;if(m&&!g.console){g.console={log:function(){}}}}catch(n){}};b.live_tags=function(k){var i,j=[];for(i in b.tags){if(i!==k){j.push(i)}}return j};b.spark=function(j,m){try{var m=m||{},k=b.extend({tagid:j,v:b.o.v,cb:kmn_cb,ds:h.readyState},m),i=b.live_tags(j);if(m.codes){b.set_ts(j,"s")}k.ts=b.get_ts(j);if(i.length){k.p=i.join(";")}if(!k.l){k.d=b.site_url()}b.log("sprk"+b.stringify(k));d.save(b.o.stat_url,k);return k}catch(l){}};b.set_ts=function(j,l){try{var k=(new Date().getTime())-kmn_ts,i=b.tags[j].ts||{};i.t.push(k);i.e.push(l)}catch(m){}return k||-1};b.get_ts=function(k){try{var l=1,j=b.tags[k].ts||{},m=j.e[0]+":"+j.t[0];for(;l<j.t.length;l++){m+="|"+j.e[l]+":"+(j.t[l]-j.t[l-1])}}catch(n){}return m||""};b.log=function(k){if(b.o.debug){var j=new Date(),i=j.getHours()+":"+j.getMinutes()+":"+j.getSeconds()+":"+j.getMilliseconds();g.console.log("["+i+"] "+k)}};b.console=function(i){b.log(i)};b.fetch_np=function(j){try{if(j.indexOf("_")===-1&&!kmn_next[j]&&!kmn_iframe){kmn_next[j]={render:0};var i=d.async_js(b.o.np+j+".js",{id:"np-"+j});if(i.apnd){i.onload=i.onreadystatechange=function(){if(!i.readyState||i.readyState==="loaded"||i.readyState==="complete"){i.onload=i.onreadystatechange=null}kmn_next[j]={render:1};i.removeAttribute("id");b.log("np@d["+b.stringify(kmn_next)+"]")}}else{delete kmn_next[j]}}}catch(k){}};b.initTagParams=function(i){try{b.xd=b.xd||komoona_xd.receive(function(k){b.handle(k.data)});if(!Array.prototype.indexOf&&!g.kmn_bc){b.write_js(b.o.ext_src+"-bc.js")}}catch(j){}b.tags[i]={srv:0,timer:null,ifrm:0,st:0,ts:{t:[],e:[]},hndl:{w:0},cnt:1};b.set_ts(i,"t");b.fetch_np(i);b.statTimer(i)};b.replaceTagParams=function(j,i){if(b.tags[j]){g.clearInterval(b.tags[j].timer);b.tags[i]=b.tags[j];b.statTimer(i)}};b.elemHeight=function(m){var k=-1;try{if(m){if(m.getBoundingClientRect){var l=m.getBoundingClientRect();if(l.top&&l.bottom){k=l.bottom-l.top}}if(k===-1){var j=m.clientHeight||0,n=m.offsetHeight||0,i=m.scrollHeight||0;k=Math.max(n,j,i)}}}catch(o){}return k};b.statsParams=function(i){var k={h:b.elemHeight(h.getElementById(e+i))},j=kmn_data[i];if(g.kmn_siteurl){k.um=kmn_siteurl}if(j){k.o=j.order;k.ch=j.codes.join("|")}return k};b.label=function(l,k){try{var j,o,i=b.tags[l],m=kmn_data[l];if(i.lbl&&m&&(k!==1||i.lbl.def)){o=h.getElementById(e+l);if(o){j=b.setAttributes(h.createElement("a"),{id:"lbl_"+l,"class":"kmn-lbl",target:"_blank",href:i.lbl.lnk});j.appendChild(h.createTextNode(i.lbl.txt));o.style.width=m.w+"px";o.style.height=m.h+"px";o.appendChild(j)}}return j}catch(n){}};b.house=function(i){try{var l=b.statsParams(i),k=(l.h!==-1);if(!b.tags[i].srv){b.tags[i].srv=1;if(l.o.indexOf("h")===-1){l.o="h|"+l.o}l.had=1;l.l=b.site_url();b.set_ts(i,"p")}else{l.house=1;k=(b.tags[i].cnt===1)&&k}b.log("house|"+i+"|"+k+"|"+b.stringify(l));if(k){b.spark(i,l)}}catch(j){}};b.stats=function(i,j){if(!b.tags[i].srv){b.tags[i].srv=1;b.log("stats["+i+"]o["+j.o+"]h["+j.h+"]");j.l=b.site_url();b.spark(i,j)}};b.statWait=function(k,j){var i=k.w++?1:0;if(i){j.wt=k.w}return i};b.statTimer=function(i){b.tags[i].timer=g.setInterval(function(){b.statHandler(i)},250)};b.statHandler=function(l){var s=b.tags[l]||{};if(s.srv){g.clearInterval(s.timer)}else{s.st+=1;var n=b.statsParams(l),k=h.getElementById(e+l),m=n.o||"",t=b.getDataVar(l,"h",50),o=0;if(k){if(s.st===b.stMx){b.spark(l,{o:m,h:n.h,err:"timeout@sa"})}else{if(m.indexOf("h")!==-1){o=1}else{if(n.h>=t){var r=k.getElementsByTagName("iframe");if(r.length===0){if(b.statWait(s.hndl,n)){o=2}}else{var p,q=0;for(p=0;p<r.length;p++){q=(r[p].offsetHeight!==0&&r[p].style.display!=="none")||q}if(q){var j=m.split("|");if(j[0].indexOf("x")!==-1){if(s.ifrm++>=b.ifrmMx){o=3}}else{o=4}}else{if(b.statWait(s.hndl,n)){o=5}}}}}if(o){n.status=o;b.label(l,o);b.set_ts(l,"p");b.stats(l,n)}}}else{if(s.st===50){b.spark(l,{err:"wrapper@sa",o:m})}}}};b.cookieSync=function(i,j){if(!b.o.cs.js){b.o.cs.js=d.async_js(b.o.ext_src+"-cs.js",{})}if(!g.kmn_cs&&!b.o.cs[i]){b.o.cs[i]=g.setInterval(function(){b.cookieSync(i,j)},100)}else{if(g.kmn_cs){g.clearInterval(b.o.cs[i]);kmn_cs.cookieSync(i,j)}}};b.heartbeat=function(i){if(!g.kmn_hb&&!b.o.hb){d.async_js(b.o.ext_src+"-hb.js",{});b.o.hb=g.setInterval(function(){b.heartbeat(i)},50)}else{if(g.kmn_hb){g.clearInterval(b.o.hb);kmn_hb.start(i)}}};b.getDataVar=function(j,i,k){if(kmn_data[j]&&kmn_data[j][i]){return kmn_data[j][i]}return k||null};b.tag=function(k){try{var i,m=0,j=b.tags;b.is_debug();if(g.kmn_size){k=k+"_"+kmn_size.replace("x","_");delete kmn_size}if(g.kmn_passback){kmn_house[k]=kmn_passback;delete kmn_passback}for(i in j){if(h.getElementById(e+i)){m=1}else{if(h.getElementById("kmni_"+i)){m=1}}if(m){g.clearInterval(j[i].timer);j[i].cnt+=1}}if(!j[k]){b.initTagParams(k)}b.dtag(k)}catch(l){b.spark(k,{err:"tag@sa",msg:l.message})}};b.dtag=function(j){var q={},l=b.live_tags(j),p={l:b.site_url(),v:b.o.v,cb:kmn_cb},n="tag/";if(l.length){var m,k=[];for(m in l){k.push(b.getDataVar(l[m],"codes",""))}p.s=l.join(";");p.codes=k.join(";")}if(g.kmn_siteurl){p.um=kmn_siteurl;q.um=b.site_url(0)}if(kmn_iframe){q.asmk=1}if(b.tags[j].cnt>1){p.n=b.tags[j].cnt;p.chain=b.getDataVar(j,"codes","");q=b.extend(q,{err:"duplicate@sa",c:p.n});n="passback/hp/"}var o=d.stat_src(b.o.base_url+n+j+".js",p);if(b.o.debug){o+="&"+f}b.spark(j,q);b.log("tag["+o+"]");if(!kmn_iframe){b.write_js(o)}else{b.atag(j,o)}};b.atag=function(j,n){kmn_iframe=0;b.tags[j].srv=1;try{var k=b.tags[j].cnt,o="kmni_"+j+(k===1?"":"_"+k);h.write('<div id="'+o+'" class="kmn-div"></div>');var l=b.create_iframe("about:blank",h.getElementById(o),{});if(l){var i=b.build_js(n+"&asmk=1",0);b.iframe_content(l,i,j)}}catch(m){}};b.xtag=function(m){var l=m.tid,o=kmn_data[l];try{if(!h.getElementById("kmnx_"+l)){b.tags[l].srv=1;b.log("xtag["+l+"]");var p=0,k=h.getElementById(e+l),j=(k?k.getElementsByTagName(m.e||"ins"):[]);for(;p<j.length;p++){j[p].style.display="none";j[p].style.height="0px"}var n=b.create_iframe("about:blank",k,{id:"kmnx_"+l,width:m.w,height:m.h});if(n){var q=b.build_js("kmn_data['"+l+"']="+b.stringify(o)+";kmn_sa.get_np('"+l+"')",1);b.iframe_content(n,q,l)}}}catch(r){}};b.iframe_content=function(k,i,j){var n=b.build_js("var kmn_cb="+kmn_cb+",kmm_ts="+kmn_ts+(b.o.debug?";kmn_sa.o.debug=1":"")+";kmn_sa.initTagParams('"+j+"');",1),l='<!DOCTYPE HTML><html><head><meta name="robots" content="noindex,nofollow">'+b.build_js(b.o.ext_src+"_sa.js",0)+n+'</head><body style="'+c+'">'+i+"</body></html>";var m=(k.contentDocument?k.contentDocument:(k.contentWindow?k.contentWindow.document:(k.document?k.document:0)));if(m){m.open();m.write(l);m.close()}};b.handle=function(k){b.log("hndl["+k+"]");try{var i=b.parseJson(k);if(i.w&&i.h){if(i.tid){b.xtag(i)}else{if(i.tagid){var j,m=h.getElementById("kmni_"+i.tagid);if(m){j=m.getElementsByTagName("iframe")[0];j.style.display="block";if(!isNaN(i.w)){i.w+="px"}if(!isNaN(i.h)){i.h+="px"}b.setAttributes(j,{width:i.w,height:i.h})}}}}}catch(l){}};b.parseJson=function(j){var i;try{i=g.JSON&&g.JSON.parse?g.JSON.parse(j):(new Function("return "+j))()}catch(k){}return i||{}};b.stringify=function(m){if(g.JSON&&g.JSON.stringify){return g.JSON.stringify(m)}else{var l=typeof(m);if(l!=="object"||m===null){if(l==="string"){m='"'+m+'"'}return String(m)}else{var o,j,k=[],i=(m&&m.constructor===Array);for(o in m){if(m.hasOwnProperty(o)){j=m[o];l=typeof(j);if(l==="string"){j='"'+j+'"'}else{if(l==="object"&&j!==null){j=b.stringify(j)}}k.push((i?"":'"'+o+'":')+String(j))}}return(i?"[":"{")+String(k)+(i?"]":"}")}}}}(),komoona_xd=komoona_xd||(function(){var a=window;return{post:function(b,d,c){if(a.postMessage){c.postMessage(b,d.replace(/([^:]+:\/\/[^\/]+).*/,"$1"))}},receive:function(c){if(a.postMessage){var b=function(d){return c(d)};if(a.addEventListener){a.addEventListener("message",b,false)}else{a.attachEvent("onmessage",b)}return b}}}}());if(window.kmn_placement){var tag=kmn_placement;delete kmn_placement;kmn_sa.tag(tag)};