var debug=wp_e2.debug;debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"starting twp_comments_echo2.js");
(function($){var isRendered=false;var userLoginState=null;var echo_user=null;var onPostCompleteVars={};var onMoreVars={};var isWashingtonpostDomain=true;wp_e2.isMobile=typeof window.mobile_browser!=="undefined"&&window.mobile_browser===1?true:false;wp_e2.initStatus={badge_init:false,wp_e2_init:false,user_init:false,canvas_init:false};wp_e2.wp_site_domain=["washingtonpost.com","digitalink.com"];wp_e2.USER_ROLE_ADMINISTRATOR="administrator";wp_e2.SORT_DESCENDING="reverseChronological";wp_e2.SORT_ASCENDING=
"chronological";wp_e2.MODERATION_REQUIRED="premodreq";wp_e2.MODERATOR_APPROVED="ModeratorApproved";wp_e2.MODERATOR_BANNED="ModeratorBanned";wp_e2.MODERATOR_DELETED="ModeratorDeleted";wp_e2.COMMUNITY_FLAGGED="CommunityFlagged";wp_e2.MODERATOR_FLAGGED="ModeratorFlagged";wp_e2.SYSTEM_FLAGGED="SystemFlagged";wp_e2.UNTOUCHED="Untouched";wp_e2.PHOTO="photo";wp_e2.WEBTYPE_PHOTO="ugc_photo_story";wp_e2.WEBTYPE_BLOG="blogstory";wp_e2.WEBTYPE_PROMO="promo_story";wp_e2.WEBTYPE_DISCUSSION_STORY="discussion_story";
wp_e2.STREAM_BASE="http://www.washingtonpost.com";wp_e2.SUBMIT_BOX_CLASS="comment-box";wp_e2.STREAM_CLASS="echo-stream";wp_e2.COUNTER_CLASS="echo-counter";wp_e2.SUBMIT_BOX_TARGET="."+wp_e2.SUBMIT_BOX_CLASS;wp_e2.STREAM_TARGET="."+wp_e2.STREAM_CLASS;wp_e2.COUNTER_TARGET="."+wp_e2.COUNTER_CLASS;wp_e2.ECHO_CONTAINER=".echo_container";wp_e2.ECHO_CANVAS=".echo_container.echo-canvas";wp_e2.getQuery=function(guid,thisContainer,itemurl,userIdList,streamContainer){streamContainer=typeof streamContainer=="undefined"?
"all":streamContainer;var currContainer=typeof thisContainer=="undefined"?wp_e2:wp_e2[thisContainer];var guid=!guid?currContainer.guid:guid;itemurl=typeof itemurl=="undefined"?"":itemurl;userIdList=typeof userIdList=="undefined"?"":userIdList;var webType=typeof currContainer.webType!=="undefined"?currContainer.webType.toLowerCase():"";var parenturl=typeof currContainer.parenturl=="undefined"?"":currContainer.parenturl;var includechildren=typeof currContainer.includechildren!=="undefined"?currContainer.includechildren:
true;if(includechildren)childrenLevelsToShow=currContainer.streamSettings.childrenMaxDepth;else childrenLevelsToShow=0;var childrenToShow=currContainer.streamSettings[streamContainer].childrenItemsPerPage;var queryFilter=userIdList!=""?"scope: ":"childrenof: ";var userQuery="";if(typeof wp_e2.echo_user!=="undefined"&&typeof wp_e2.echo_user.get("state")!=="undefined"&&wp_e2.echo_user.is("logged"))if(wp_e2.echo_user.get("state")===wp_e2.UNTOUCHED||wp_e2.echo_user.get("state")===wp_e2.MODERATOR_BANNED||
wp_e2.echo_user.get("state")===wp_e2.MODERATOR_DELETED||currContainer.moderationrequired===true)userQuery="OR (-state:"+wp_e2.SYSTEM_FLAGGED+","+wp_e2.MODERATOR_FLAGGED+" AND user.id:'"+wp_e2.echo_user.get("identityUrl")+"')";var itemMarkerQuery=(typeof currContainer.streamSettings.allowedItemMarkers!=="undefined"?" markers: "+currContainer.streamSetting.allowedItemMarkers.toString()+" ":"")+" -markers:ignore ";var userMarkerQuery=typeof currContainer.streamSettings.allowedUserMarkers!=="undefined"&&
currContainer.streamSettings.allowedUserMarkers.toString()!=""?" user.markers: "+currContainer.streamSetting.allowedUserMarkers.toString()+" ":"";var markerQuery="";if(itemMarkerQuery!=""&&userMarkerQuery!="")markerQuery="("+itemMarkerQuery+" OR "+userMarkerQuery+") ";else if(itemMarkerQuery!="")markerQuery="("+itemMarkerQuery+") ";else if(userMarkerQuery!="")markerQuery="("+userMarkerQuery+")";if(currContainer.display_ugc_photos)currContainer.streamSettings.allowedItemStates=[wp_e2.MODERATOR_APPROVED];
var stateQuery="";if(webType===wp_e2.WEBTYPE_PHOTO)stateQuery="(state:"+wp_e2.MODERATOR_APPROVED+" AND -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+") ";else if(currContainer.moderationrequired===true)stateQuery="(state:"+wp_e2.COMMUNITY_FLAGGED+","+wp_e2.MODERATOR_APPROVED+" AND -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+" ) ";else stateQuery="(state:Untouched  AND user.state:"+wp_e2.MODERATOR_APPROVED+") "+"OR (state:"+wp_e2.COMMUNITY_FLAGGED+","+wp_e2.MODERATOR_APPROVED+
","+wp_e2.MODERATOR_DELETED+" AND -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+") ";var streamStateQuery="";if(webType===wp_e2.WEBTYPE_PHOTO)streamStateQuery="(state:"+wp_e2.MODERATOR_APPROVED+" AND -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+") ";else if(currContainer.moderationrequired===true)streamStateQuery="(state:"+wp_e2.COMMUNITY_FLAGGED+","+wp_e2.MODERATOR_APPROVED+" AND -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+" ) ";else streamStateQuery=
"(state:Untouched AND user.state:"+wp_e2.MODERATOR_APPROVED+","+wp_e2.UNTOUCHED+") "+"OR (state:"+wp_e2.COMMUNITY_FLAGGED+","+wp_e2.MODERATOR_APPROVED+","+wp_e2.MODERATOR_DELETED+" AND -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+") ";var childrenStateQuery="";if(webType===wp_e2.WEBTYPE_PHOTO)childrenStateQuery="(state:"+wp_e2.MODERATOR_APPROVED+" AND -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+") ";else if(currContainer.moderationrequired===true)childrenStateQuery=
"(state:"+wp_e2.COMMUNITY_FLAGGED+","+wp_e2.MODERATOR_APPROVED+" AND -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+" ) ";else childrenStateQuery="(state:Untouched  AND user.state:"+wp_e2.MODERATOR_APPROVED+") "+"OR (state:"+wp_e2.COMMUNITY_FLAGGED+","+wp_e2.MODERATOR_APPROVED+" AND -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+") ";var numDisplayItems=0;if(typeof currContainer.streamSettings[streamContainer].maxitems!=="undefined")numDisplayItems=currContainer.streamSettings[streamContainer].maxitems;
var filterQuery=" (("+stateQuery+userQuery+") "+(markerQuery!=""?" AND "+markerQuery:"")+")  ";var twitterQuery="";if(typeof currContainer.source!=="undefined"&&currContainer.source.indexOf("Twitter")>=0)twitterQuery="("+currContainer.streamSettings.request+": "+guid+" ("+streamStateQuery+")"+" "+markerQuery+" source:Twitter"+") ";var washpostQuery="";if(typeof currContainer.source!=="undefined"&&currContainer.source.indexOf("washpost.com")>=0)washpostQuery="("+currContainer.streamSettings.request+
": "+guid+" source:"+currContainer.source.toString()+filterQuery+" )";var streamIdQuery="";if(typeof currContainer.streamid!=="undefined"&&currContainer.streamid!="")streamIdQuery="("+currContainer.streamSettings.request+": "+currContainer.streamid+(typeof currContainer.streamSettings.allowedItemMarkers!=="undefined"&&currContainer.streamSettings.allowedItemMarkers.toString()!=""?" markers: "+currContainer.streamSettings.allowedItemMarkers.toString():"")+" ("+streamStateQuery+")"+")";var query=washpostQuery!=
""?washpostQuery:"";if(typeof wp_e2[thisContainer]!=="undefined"&&wp_e2[thisContainer].displayuserstream)query=queryFilter+guid+" user.id:'"+wp_e2.echo_user.get("identityUrl")+"'"+" itemsPerPage: "+numDisplayItems+" sortOrder:"+currContainer.streamSettings.sortorder+" safeHTML: permissive"+" type:comment"+" -markers: ignore "+" children: "+childrenLevelsToShow+" childrenSortOrder:"+currContainer.streamSettings.childrenSortOrder+" childrenItemsPerPage:"+childrenToShow+" "+" ("+childrenStateQuery+userQuery+
") ";else if(parenturl!="")query=queryFilter+parenturl+" itemsPerPage: "+numDisplayItems+" sortOrder:"+currContainer.streamSettings.sortorder+" safeHTML:"+currContainer.streamSettings.safeHTML+" type:comment"+" childrenItemsPerPage:"+childrenToShow+" children: "+childrenLevelsToShow+" childrenSortOrder:"+currContainer.streamSettings.childrenSortOrder+" "+" (("+childrenStateQuery+userQuery+") "+(markerQuery!=""?" AND "+markerQuery:"")+") ";else if(itemurl!="")query="url: "+itemurl+" itemsPerPage: "+
numDisplayItems+" sortOrder:"+currContainer.streamSettings.sortorder+" safeHTML:"+currContainer.streamSettings.safeHTML+" children: "+childrenLevelsToShow+" childrenSortOrder:"+currContainer.streamSettings.childrenSortOrder+" childrenItemsPerPage:"+childrenToShow+" "+" (("+childrenStateQuery+userQuery+") "+(markerQuery!=""?" AND "+markerQuery:"")+") ";else if(userIdList!="")query=queryFilter+guid+" user.id:"+userIdList+" itemsPerPage: "+numDisplayItems+" sortOrder: "+currContainer.streamSettings.sortorder+
" safeHTML: "+currContainer.streamSettings.safeHTML+" type:comment"+" -markers: ignore "+" children: "+childrenLevelsToShow+" childrenSortOrder:"+currContainer.streamSettings.childrenSortOrder+" childrenItemsPerPage:"+childrenToShow+" "+" ("+childrenStateQuery+userQuery+") ";else{query=query+(streamIdQuery!=""&&query!==""?" OR "+streamIdQuery:streamIdQuery);query=query+(twitterQuery!=""&&query!==""?" OR "+twitterQuery:twitterQuery);query="("+query+")"+" itemsPerPage: "+numDisplayItems+" sortOrder:"+
currContainer.streamSettings.sortorder+" safeHTML:"+currContainer.streamSettings.safeHTML+" children: "+childrenLevelsToShow+" childrenSortOrder:"+currContainer.streamSettings.childrenSortOrder+" childrenItemsPerPage:"+childrenToShow+" "+" (("+childrenStateQuery+userQuery+") "+(markerQuery!=""?" AND "+markerQuery:"")+") "}debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - query - "+thisContainer+": "+query);return query};
wp_e2.init=function(){wp_e2._initOmnitureVariables();if(typeof Echo!=="undefined"){if(typeof Backplane!=="undefined"){debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - initializing backplane");if(!TWP.Util.User.getAuthentication())Backplane.resetCookieChannel();Backplane.init(wp_e2.backplaneSettings)}else debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - no backplane");
if(typeof wapoIdentityInit==="function")wapoIdentityInit();Echo.LoginStateChange=function(loginState){debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - Echo.LoginStateChange triggered for login state: "+loginState);userLoginState=loginState;$(".comment-stream").trigger("wp_e2Init.Complete")}}else debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - no echo present");
debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - init complete");Echo.Events.subscribe({"topic":"Echo.UserSession.onInit","context":"global","handler":function(topic,data,contextId){debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - Echo.UserSession.onInit triggered - "+(wp_e2.echo_user&&wp_e2.echo_user.get("activeIdentities")[0]&&wp_e2.echo_user.get("activeIdentities")[0].username)+
" - synced: "+wp_e2._isUserSynced());wp_e2.echo_user=new Echo.UserSession({"appkey":wp_e2.appkey,"apiBaseURL":wp_e2.apiBaseURL});var accounts=wp_e2.echo_user.get("activeIdentities");var avatar=wp_e2.echo_user.get("avatar");avatar=(avatar||"").replace("http://akiajc2strzaac3fwsta.post-avatars.s3.amazonaws.com","https://s3.amazonaws.com/akiajc2strzaac3fwsta.post-avatars").replace("http://","https://").replace("'",'"');wp_e2.echo_user.set("avatar",avatar);wp_e2._getIgnoredUsers();wp_e2.initStatus.user_init=
true;$(document).trigger("TWP.Echo.User.InitComplete");$(document).trigger("TWP.Apps.Init.Complete")}});Echo.Events.subscribe({"topic":"Echo.UserSession.onInvalidate","context":"global","handler":function(topic,data,contextId){debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - Echo.UserSession.onInvalidate triggered "+(wp_e2.echo_user&&wp_e2.echo_user.get("activeIdentities")[0]&&wp_e2.echo_user.get("activeIdentities")[0].username)+
" - synced: "+wp_e2._isUserSynced());wp_e2.echo_user=new Echo.UserSession({"appkey":wp_e2.appkey,"apiBaseURL":wp_e2.apiBaseURL});var accounts=wp_e2.echo_user.get("activeIdentities");wp_e2.initStatus.user_init=true;$(document).trigger("TWP.Echo.User.InitComplete");$(document).trigger("TWP.Apps.Init.Complete")}});Echo.Events.subscribe({"topic":"Echo.StreamServer.Controls.Stream.onMoreButtonPress","context":"global","handler":function(topic,data,contextId){var thisContainer=$(data.target).closest(wp_e2.ECHO_CONTAINER).attr("id");
if(typeof sendDataToOmniture==="function")try{sendDataToOmniture("echo.onmore","event5",onMoreVars);debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - MORE: omniture event5")}catch(err){debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - MORE: omniture event5"+err)}}});Echo.Events.subscribe({"topic":"Echo.StreamServer.Controls.Submit.onPostComplete",
"context":"global","handler":function(topic,data,contextId){var thisContainer=$(data.target).closest(wp_e2.ECHO_CONTAINER).attr("id");if(typeof sendDataToOmniture==="function")try{onPostCompleteVars.eVar26=wp_e2[thisContainer].display_ugc_photos===true?"submit - ugc":"submit - comments";sendDataToOmniture("echo.onpostcomplete","event3",onPostCompleteVars);debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - Post COmplete: omniture event3");
onPostCompleteVars.eVar26=""}catch(err){debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - Post COmplete: omniture event3 - "+err)}}});Echo.Events.subscribe({"topic":"Echo.StreamServer.Controls.Stream.onRender","context":"global","handler":function(topic,data,contextId){debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - Stream.onRender");
window.wp_pb&&wp_pb.report&&wp_pb.report("global","domChangedQueue")}});Echo.Events.subscribe({"topic":"Echo.StreamServer.Controls.Stream.onRerender","context":"global","handler":function(topic,data,contextId){debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - Stream.onRerender");window.wp_pb&&wp_pb.report&&wp_pb.report("global","domChangedQueue")}});Echo.Events.subscribe({"topic":"Echo.StreamServer.Controls.Stream.onReady",
"context":"global","handler":function(topic,data,contextId){debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - Stream.onReady");window.wp_pb&&wp_pb.report&&wp_pb.report("global","domChangedQueue");window.wp_pb&&wp_pb.report&&wp_pb.report("comments","commentsReady");if(typeof sendDataToOmniture==="function")try{sendDataToOmniture("echo.commentsLoaded","event29",{"eVar26":"comments loaded"});debug&&window.console&&console.log&&
console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - LOADED: omniture event29")}catch(err){debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - LOADED: omniture event29"+err)}if(typeof $.lockfixed=="function"&&$(".lockfix").length>0)$.lockfixed(".echo-apps-conversations-allPostsContainer .echo-apps-conversations-streamHeader",{"fixClass":"lockfixed"})}});Echo.Events.subscribe({"topic":"Echo.StreamServer.Controls.Counter.onUpdate",
"context":"global","handler":function(topic,data,contextId){if(data&&typeof data.data.count!="undefined")$(wp_e2.COUNTER_TARGET).html(data.data.count);debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - Counter.onUpdate")}});Echo.Events.subscribe({"topic":"Echo.StreamServer.Controls.Stream.Item.onRender","context":"global","handler":function(topic,data,contextId){debug&&window.console&&console.log&&console.log("["+(new Date-
TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - Stream.Item.onRender");window.wp_pb&&wp_pb.report&&wp_pb.report("global","domChangedQueue")}});Echo.Events.subscribe({"topic":"Echo.StreamServer.Controls.Stream.Item.onRerender","context":"global","handler":function(topic,data,contextId){debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - Stream.Item.onRerender");window.wp_pb&&wp_pb.report&&wp_pb.report("global",
"domChangedQueue")}});Echo.Events.subscribe({"topic":"Echo.StreamServer.Controls.Submit.onReady","context":"global","handler":function(topic,data,contextId){debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - Submit.onReady")}});Echo.Events.subscribe({"topic":"Echo.StreamServer.Controls.Submit.onRender","context":"global","handler":function(topic,data,contextId){debug&&window.console&&console.log&&console.log("["+(new Date-
TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - Submit.onRender");window.wp_pb&&wp_pb.report&&wp_pb.report("global","domChanged")}});Echo.Events.subscribe({"topic":"Echo.StreamServer.Controls.Submit.onRerender","context":"global","handler":function(topic,data,contextId){debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - Submit.onRerender");window.wp_pb&&wp_pb.report&&wp_pb.report("global","domChanged")}});
Echo.Events.subscribe({"topic":"Echo.IdentityServer.Controls.Auth.onRender","context":"global","handler":function(topic,data,contextId){debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - Echo.IdentityServer.Controls.Auth.onRender triggered - "+(wp_e2.echo_user&&wp_e2.echo_user.get("activeIdentities")[0]&&wp_e2.echo_user.get("activeIdentities")[0].username)+" - synced: "+wp_e2._isUserSynced())}});Echo.Events.subscribe({"topic":"Echo.IdentityServer.Controls.Auth.onRerender",
"context":"global","handler":function(topic,data,contextId){debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - Echo.IdentityServer.Controls.Auth.onRerender triggered - "+(wp_e2.echo_user&&wp_e2.echo_user.get("activeIdentities")[0]&&wp_e2.echo_user.get("activeIdentities")[0].username)+" - synced: "+wp_e2._isUserSynced())}});Echo.Events.subscribe({"topic":"Echo.Canvas.onRender","context":"global","handler":function(topic,
data,contextId){debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - Canvas.onReady")}});wp_e2.initStatus.wp_e2_init=true;$(document).trigger("TWP.Apps.Init.Complete")};wp_e2._getIgnoredUsers=function(){if(typeof wp_e2!=="undefined"&&(wp_e2.echo_user&&wp_e2.echo_user.is("logged"))&&!wp_e2.ignoredUsers){var current_user_id=encodeURI(wp_e2.echo_user.get("identityUrl"));var ignoredUsers=$.getJSON(wp_e2.mongoUserActionUrl+
"?jsonp\x3d?",'q\x3d{"user_id":"'+current_user_id+'","action":"Ignore"}',function(data){wp_e2.ignoredUsers=[];$.each(data.q_results[0].rows,function(index,row){wp_e2.ignoredUsers.push(row.target_user_id)})})}};wp_e2._initOmnitureVariables=function(){var commonVars={};try{commonVars={"eVar1":s.eVar1,"eVar2":s.eVar2,"eVar8":s.eVar8,"eVar17":s.eVar17,"eVar33":s.eVar33}}catch(err){}$.extend(onPostCompleteVars,commonVars);onMoreVars={"eVar26":"load more comments"};$.extend(onMoreVars,commonVars)};wp_e2.setSubmitMarkers=
function(thisContainer){var newMarker=wp_e2[thisContainer].sectionid!==""&&typeof wp_e2[thisContainer].sectionid!=="undefined"?wp_e2[thisContainer].sectionid:"";newMarker+=wp_e2[thisContainer].moderationrequired===true?", "+wp_e2.MODERATION_REQUIRED:"";newMarker+=wp_e2[thisContainer].display_ugc_photos===true?", "+wp_e2.PHOTO:"";wp_e2[thisContainer].submitMarkers=newMarker.split(", ")};wp_e2._getTimeoutValue=function(classType,webType,thisContainer){if(typeof thisContainer!=="undefined"&&wp_e2[thisContainer].allow_comments==
false)webType="closed";else if(typeof webType=="undefined"||webType=="")webType="no_webtype";var timeout=typeof wp_e2.liveUpdatesTimeout[classType][webType]!=="undefined"?wp_e2.liveUpdatesTimeout[classType][webType]:wp_e2.liveUpdatesTimeout[classType]["default"];return timeout};wp_e2._toString=function(myObj,key){for(myKey in myObj){console.log("config"+(typeof key==="undefined"||key===-1?"":"["+key+"]")+"["+myKey+"] \x3d "+myObj[myKey]);if(typeof myObj[myKey]==="object")wp_e2.toString(myObj[myKey],
myKey)}};wp_e2._isUserSynced=function(){var userSynced=false;if(typeof userLoginState!=="undefined"&&userLoginState!==null&&typeof wp_e2.echo_user!=="undefined"&&(userLoginState==="login"&&wp_e2.echo_user.is("logged")||userLoginState==="logout"&&!wp_e2.echo_user.is("logged")))userSynced=true;return userSynced};wp_e2._shareRender=function(element,thisConfig){element.find(".echo-streamserver-controls-stream-item-button-share").on("mouseenter",thisConfig,function(event){var shareOverlay;var thisConfig=
event.data;var thisContainer=thisConfig.config.get("thisContainer");var thisComment=thisConfig.component;event.stopPropagation();if($(this).find(".more").length==0){var FBappId=TWP&&TWP.Data&&TWP.Data.environment&&(TWP.Data.environment=="prod"||TWP.Data.environment=="stage")?"41245586762":"98319225937";var shareControl=$(".comment-share-info").html();var thisCommentURL=thisComment.data.object.id;thisCommentURL=thisCommentURL.replace("http://","");var thisCommentPermalink=wp_e2[thisContainer]&&wp_e2[thisContainer].commentpermalinkurlfacet||
thisComment.data.object.context[0].uri.replace(/_story.html|_blog.html/,"_comment.html");var thisCommentPermalinkURL=thisCommentPermalink+"?commentID\x3d"+thisCommentURL;var conversationHeadline='"'+(thisComment.data.object.context[0].title||$("h1.headline").text()||document.title&&document.title.split(" - ")[0])+'"';var thisAuthorAvatar=thisComment.data.actor.avatar;var FBImageCheck=thisAuthorAvatar.indexOf("facebook");var FBCDNImageCheck=thisAuthorAvatar.indexOf("fbcdn");if(FBImageCheck>0||FBCDNImageCheck>
0)thisAuthorAvatar="http://www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/avatar-default.png";var thisCommentAuthor=thisComment.data.actor.title;var thisFBHeadline=thisCommentAuthor+" commented on ";var thisCommentPermalinkHeadline=thisFBHeadline+conversationHeadline;var thisFBHeadline=thisFBHeadline+"...";thisCommentPermalinkHeadline=encodeURI(thisCommentPermalinkHeadline);var thisFBConversationHeadline=conversationHeadline;conversationHeadline=encodeURI(conversationHeadline);var thisCommentContent=
thisComment.data.object.content;if(thisComment.data.object.content.length>100)thisCommentContent=thisCommentContent.substr(0,100)+"...";var thisFBCommentContent=thisCommentContent;thisCommentContent=escape(thisCommentContent);shareControl=shareControl.replace(/{shareURL}/g,thisCommentPermalinkURL);shareControl=shareControl.replace(/{headline}/g,thisCommentPermalinkHeadline);shareControl=shareControl.replace(/{summaryText}/g,thisCommentContent);shareControl=shareControl.replace(/{FBCaption}/g,conversationHeadline);
shareControl=shareControl.replace(/{FBHeadline}/g,thisFBHeadline);shareControl=shareControl.replace(/{readerAvatar}/g,thisAuthorAvatar);shareControl=shareControl.replace(/{appKey}/g,FBappId);var obj=$(shareControl);obj.appendTo($(this));shareOverlay=$(this).find(".more");$(shareOverlay).show()}else $(this).find("#newsharebar").show()});element.find(".echo-streamserver-controls-stream-item-button-share").on("mouseleave",thisConfig,function(event){event.stopPropagation();$(this).find("#newsharebar").hide()})};
wp_e2._getCookie=function(cookieName){var cookieValue=$.cookie(cookieName);return cookieValue!=null?cookieValue:""};wp_e2._setCookie=function(cookieName,cookieValue,options){$.cookie(cookieName,cookieValue,options)};wp_e2.renderCommentCount=function(elm){if(wp_e2._isUserSynced()){var guid="";var thisContainer=elm.closest(wp_e2.ECHO_CONTAINER).attr("id");if(typeof elm.attr("guid")!=="undefined")guid=elm.attr("guid");if(typeof guid=="undefined"||guid=="")guid=typeof thisContainer!=="undefined"?wp_e2[thisContainer].guid:
wp_e2.guid;try{new Echo.StreamServer.Controls.Counter({"target":elm&&elm.hasClass(wp_e2.COUNTER_CLASS)?elm:elm&&elm.find(wp_e2.COUNTER_TARGET),"apiBaseURL":wp_e2.apiBaseURL+"/v1/","appkey":wp_e2.appkey,"query":wp_e2.getQuery(wp_e2[thisContainer].guid,thisContainer,wp_e2[thisContainer].itemurl),"liveUpdates":{"enabled":true,"polling":{"timeout":wp_e2._getTimeoutValue("counter","default",thisContainer)}},"plugins":[{"name":"PageVisibilityDetectorCount","thisContainer":thisContainer}]})}catch(e){}debug&&
window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"echo2/v2/core/twp_comments_echo2.js - started counter and attached to .echo-counter for stream: ["+thisContainer+"]")}};wp_e2.refreshComments=function(data){Echo.jQuery(data.id+" .echo-apps-conversations-container").trigger("TWP.Comments.RequestRefresh",{"url":data.url,"allow_comments":data.allow_comments});$(window.document).on("TWP.Comments.RefreshComplete",function(event,data){})};wp_e2._getNotes=function(elm){elm.each(function(){var thisContainer=
$(this).attr("id");wp_e2[thisContainer].verifiedcommenteridlist={};wp_e2[thisContainer].verifiedcommenteridlist.idlist="";if(wp_e2[thisContainer].includeverifiedcommenters==true){var requestData={};requestData.echocontainer=thisContainer;requestData.targetUrl=wp_e2[thisContainer].guid;requestData.usermarkers=wp_e2[thisContainer].userMarkersTop;wp_e2.echo_user?requestData.userid=wp_e2.echo_user.get("identityUrl"):"";$.ajax({"url":wp_e2.commentBadgesUrl,"cache":true,"data":requestData,"timeout":3E3,
"dataType":"jsonp"}).always(function(data,status){var temp={};if(status=="success"&&data&&data.content!=""){temp=eval(data.content);var thisContainer=temp.echocontainer;wp_e2[thisContainer].verifiedcommenteridlist.userArray={};$.each(temp.userSet,function(key,obj){wp_e2[thisContainer].verifiedcommenteridlist.userArray[obj.id]={"name":obj.name,"verification_status":obj.verification_status}});wp_e2[thisContainer].verifiedcommenteridlist.idlist=temp.verifiedidlist}wp_e2.initStatus.badge_init=true;$(document).trigger("TWP.Apps.Init.Complete");
if(Echo&&Echo.Events)Echo.Events.publish({"topic":"TWP.Badge.Request.Complete","data":temp})})}else{wp_e2.initStatus.badge_init=true;$(document).trigger("TWP.Apps.Init.Complete")}})};wp_e2.validateVersion=function(){try{setInterval(function(){$.ajax({"url":wp_e2.validateURL,"cache":false,"data":{"outputType":"javascript","v":wp_e2.echo_version||"3.1","sp":"echo_version"},"timeout":3E3,"dataType":"jsonp","jsonp":"callback"}).always(function(data,status){if(status=="success"&&data&&data.version_check!==
"ok")if(data.action=="notify"){$(".echo-apps-conversations-postComposer").find(".echo-feature-notification").remove();$(".echo-apps-conversations-postComposer").append('\x3cdiv class\x3d"echo-feature-notification"\x3eYour version of the Comments application is out of date.  Please refresh your page. \x3c/div\x3e')}else if(data.action=="refresh")location.reload()})},18E5)}catch(e){}};wp_e2.initCanvas=function(elm){var pluginArray=[];var canvasConfig=wp_e2.initConfig(elm);var thisContainer=elm.attr("id");
var thisCanvasId=wp_e2[thisContainer]["data-canvas-id"];var thisCanvasApp=wp_e2[thisContainer]["data-app-instance"];var thisCanvasTarget=$("#"+thisContainer+" .echo-canvas");thisCanvasTarget.attr({"data-app-instance":thisCanvasApp,"data-canvas-id":thisCanvasId});Echo.Loader.override(thisCanvasId,thisCanvasApp,canvasConfig);Echo.Loader.init({"canvases":thisCanvasTarget})};wp_e2.initConfig=function(elm){var thisContainer=elm.attr("id");wp_e2.setSubmitMarkers(thisContainer);var tmpSortOrder=wp_e2&&wp_e2[thisContainer].streamSettings&&
wp_e2[thisContainer].streamSettings.defaultsort?wp_e2[thisContainer].streamSettings.defaultsort:"reverseChronological";var cookieName=["allPosts",encodeURIComponent(wp_e2[thisContainer].guid),"sortOrder"].join(".");tmpSortOrder=wp_e2._getCookie(cookieName)?wp_e2._getCookie(cookieName):tmpSortOrder;var conversationsPluginArray=[{"name":"TWP_Conversations_App","thisContainer":thisContainer}];var canvasConfig={"targetURL":wp_e2&&wp_e2[thisContainer].guid,"streamingControl":{"pauseOnHover":false,"displayStreamingStateHeader":true,
"enablePausePlayToggle":true},"dependencies":{"StreamServer":{"apiBaseURL":wp_e2.apiBaseURL+"/v1/","submissionProxyURL":wp_e2.echoSubmissionProxyURL,"appkey":wp_e2&&wp_e2.appkey,"openLinksInNewWindow":true,"liveUpdates":wp_e2.isMobile?wp_e2.liveUpdates.mobile:wp_e2.liveUpdates.desktop,"item":{}}},"auth":{"plugins":[{"name":"TWP_formAuth","thisContainer":thisContainer}]},"postComposer":{"visible":$("#"+thisContainer).hasClass("submitbox")&&wp_e2[thisContainer].allow_comments===true?true:false,"displaySharingOnPost":false,
"displayCompactForm":true,"plugins":wp_e2[thisContainer].plugins.submitboxPluginArray},"replyComposer":{"visible":($("#"+thisContainer).hasClass("submitbox")||$("#"+thisContainer).hasClass("permalink"))&&wp_e2[thisContainer].allow_comments===true&&!wp_e2.echo_user.userSuspended?true:false,"displayCompactForm":false,"displaySharingOnPost":false,"plugins":wp_e2[thisContainer].plugins.submitboxPluginArray},"topPosts":{"visible":wp_e2&&typeof wp_e2[thisContainer].itemurl=="undefined"&&(wp_e2[thisContainer].includetabs&&
wp_e2[thisContainer].defaulttab=="top"&&wp_e2[thisContainer].itemMarkersTop!=""||wp_e2[thisContainer].includeverifiedcommenters===true&&wp_e2[thisContainer].verifiedcommenteridlist.idlist!=""),"label":wp_e2[thisContainer].includeverifiedcommenters===true?"Commenters mentioned in this story":"Top Comments","queryOverride":wp_e2.getQuery(wp_e2[thisContainer].guid,thisContainer,wp_e2[thisContainer].itemurl,wp_e2[thisContainer].verifiedcommenteridlist.idlist,"top"),"plugins":wp_e2[thisContainer].plugins.streamPluginArray.concat([{"name":"Edit",
"nestedPlugins":[{"name":"TextCounter","limit":wp_e2[thisContainer].commentmaxlength},{"name":"TWP_Edit","thisContainer":thisContainer}]},{"name":"CardUIShim","collapsedContentHeight":291,"labels":{"seeMore":"See More"}},{"name":"TWP_Stream_Item_Top","thisContainer":thisContainer}]),"displaySharingIntent":false,"initialItemsPerPage":wp_e2[thisContainer].streamSettings.top.maxitems,"initialSortOrder":wp_e2[thisContainer].streamSettings.sortorder,"displaySortOrderPulldown":false,"displayCounter":false,
"displayTopPostHighlight":false,"displaySharingIntent":false,"displayLikeIntent":wp_e2[thisContainer].recommend,"displayReplyIntent":wp_e2[thisContainer].includereply,"displayCommunityFlagIntent":wp_e2[thisContainer].includereport,"replyNestingLevels":2,"itemTypes":["comment"],"maxItemBodyCharacters":750,"labels":{"seeMore":"See Morexxx","childrenMoreItems":"See More Replies"},"sortOrderEntries":[{"title":"Newest First ","value":"reverseChronological"},{"title":"Oldest First ","value":"chronological"},
{"title":"Most Replies ","value":"repliesDescending"},{"title":"Most Liked ","value":"likesDescending"}]},"allPosts":{"visible":$("#"+thisContainer).hasClass("stream"),"label":$("#"+thisContainer).hasClass("permalink")||$("#"+thisContainer).hasClass("mycomments")?"":"All Comments","queryOverride":wp_e2.getQuery(wp_e2[thisContainer].guid,thisContainer,wp_e2[thisContainer].itemurl).replace(/sortOrder:\S+/,"sortOrder:"+tmpSortOrder),"displaySharingIntent":false,"plugins":wp_e2[thisContainer].plugins.streamPluginArray.concat([{"name":"Edit",
"nestedPlugins":[{"name":"TextCounter","limit":2E3},{"name":"TWP_Edit","thisContainer":thisContainer}]},{"name":"CardUIShim","collapsedContentHeight":511,"labels":{"seeMore":"See More"}}]),"initialItemsPerPage":wp_e2[thisContainer].streamSettings.all.maxitems,"initialSortOrder":wp_e2[thisContainer].streamSettings.sortorder,"displaySortOrderPulldown":wp_e2[thisContainer].includesorts,"displayCounter":false,"displayTopPostHighlight":false,"displaySharingIntent":false,"displayLikeIntent":wp_e2[thisContainer].recommend,
"displayReplyIntent":wp_e2[thisContainer].includereply,"displayCommunityFlagIntent":wp_e2[thisContainer].includereply,"replyNestingLevels":2,"itemTypes":["comment"],"maxItemBodyCharacters":750,"itemsRefreshInterval":60,"sortOrderEntries":[{"title":"Newest First ","value":"reverseChronological"},{"title":"Oldest First ","value":"chronological"},{"title":"Most Replies ","value":"repliesDescending"},{"title":"Most Liked ","value":"likesDescending"}]},"plugins":wp_e2[thisContainer].plugins.streamPluginArray.concat(wp_e2[thisContainer].plugins.submitPluginArray,
conversationsPluginArray),"query":wp_e2.getQuery(wp_e2[thisContainer].guid,thisContainer,wp_e2[thisContainer].itemurl)};return canvasConfig};wp_e2.initContainers=function(elms){wp_e2.initStatus.canvas_init=true;elms.each(function(){var elm=$(this);if(elm.hasClass("canvas")){wp_e2.initCanvas(elm);wp_e2.renderCommentCount(elm)}else;})};$(window.document).on("TWP.Apps.Init.Complete",function(){if(wp_e2.initStatus&&wp_e2.initStatus.badge_init===true&&wp_e2.initStatus.wp_e2_init===true&&wp_e2.initStatus.user_init===
true&&wp_e2.initStatus.canvas_init===false){wp_e2.initContainers($(wp_e2.ECHO_CONTAINER));wp_e2._getNotes($(wp_e2.ECHO_CONTAINER+".stream"));wp_e2.validateVersion()}});$(window.document).on("TWP.Echo.User.InitComplete",function(){var bannedTimes=wp_e2["suspend_user_markers"]||{},currBanTime="";var userMarkers=wp_e2._isUserSynced()&&wp_e2.echo_user.is("logged")&&wp_e2.echo_user.get("markers")||[];$.each(bannedTimes,function(key,value){if($.inArray(key,userMarkers)>=0){wp_e2.echo_user.userSuspended=
true;return}})});Echo.Loader.config.errorTimeout=15E3;Echo.Loader.config.cdnBaseURL="https://js.washingtonpost.com/",Echo.Loader.config.storageURL={"aws":{"prod":"https://js.washingtonpost.com/wp-stat/echo2/canvases/","dev":"https://js.washingtonpost.com/wp-stat/echo2/canvases/"}};Echo.Loader.initEnvironment(function(){var jsUrl=TWP.Data.enviro.server+"/rw/sites/twpweb/js";debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"starting loader.download");Echo.Loader.download([],
function(){debug&&window.console&&console.log&&console.log("["+(new Date-TWP_Debug.initialTime)/1E3+"]"+"starting wp_e2.init");wp_e2&&wp_e2.init();$(window.document).trigger("TWP.Apps.Init.Complete")})});wp_e2._getNotes($(wp_e2.ECHO_CONTAINER+".stream"))})(jQuery);