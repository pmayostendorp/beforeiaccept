var MailMunchPopover=function(e){this.overlay=document.createElement("div"),this.dialog=document.createElement("div"),MailMunchBaseForm.call(this,e)};MailMunchHelpers.inheritPrototype(MailMunchPopover,MailMunchBaseForm),MailMunchPopover.prototype.loadHTML=function(e){var i=document.getElementById("mailmunch-popover-frame-"+this.viewId);this._loadHTML(i,e)},MailMunchPopover.prototype.prepare=function(){var e=this;if(!this.prepared){this.overlay.className="mailmunch-overlay",this.overlay.id="mailmunch-overlay-"+this.viewId,this.overlay.style.display="none",this.overlay.onclick=function(){e.hide()},document.body.appendChild(this.overlay),MailMunchHelpers.isPhone()?(this._scrollLock=!1,this._topMargin=40,this._currentScale=1,this.dialog.className="mailmunch-popover-mobile",this.dialog.id="mailmunch-popover-"+this.viewId,this.dialog.style.cssText="position:absolute;left:-5000px;top:-5000px;",this.dialog.innerHTML='<div class="mailmunch-popover-container" id="mailmunch-popover-container-'+this.viewId+'"><iframe id="mailmunch-popover-frame-'+this.viewId+'" class="mailmunch-popover-iframe" frameborder="0" scrolling="no" allowtransparency="true" style="max-width: '+this.options.maxWidth+'px;"></iframe></div>'):(this.dialog.className="mailmunch-popover",this.dialog.id="mailmunch-popover-"+this.viewId,this.dialog.style.cssText="position:fixed;left:-5000px;top:-5000px;",this.dialog.innerHTML='<div class="mailmunch-popover-container" id="mailmunch-popover-container-'+this.viewId+'"><div class="mailmunch-inner-overlay" id="mailmunch-inner-overlay-'+this.viewId+'"></div><div class="mailmunch-popover-content" style="max-width: '+this.options.maxWidth+'px;"><div class="mailmunch-popover-iframe-scaler" style="padding-top: '+this.options.iframeHeight+'px;"><iframe id="mailmunch-popover-frame-'+this.viewId+'" class="mailmunch-popover-iframe" frameborder="0" scrolling="no" allowtransparency="true" style="height: '+this.options.iframeHeight+'px;"></iframe></div></div></div>'),document.body.appendChild(this.dialog),this.iframeContainer=document.getElementById("mailmunch-popover-container-"+this.viewId),this.iframe=document.getElementById("mailmunch-popover-frame-"+this.viewId),this.innerOverlay=document.getElementById("mailmunch-inner-overlay-"+this.viewId),this.innerOverlay&&(this.innerOverlay.onclick=function(){e.hide()});var i=[];if("undefined"!=typeof document.querySelectorAll){var o=document.body.querySelectorAll('*[href="#mailmunch-pop-'+e.options.widgetID+'"]');MailMunchHelpers.forEach(o,function(e){i.push(e)})}var t=MailMunchHelpers.getElementsByClassName(document.body,"mailmunch-pop-"+e.options.widgetID);MailMunchHelpers.forEach(t,function(e){i.push(e)}),MailMunchHelpers.forEach(i,function(i){i.onclick=function(){return e.show(!0),!1}}),this._afterPrepare()}},MailMunchPopover.prototype.resizeWidget=function(e,i){this._beforeResize(e,i),this.reposition()},MailMunchPopover.prototype._setOverflow=function(){MailMunchHelpers.addClass(document.documentElement,"mailmunch-pop-open"),MailMunchHelpers.addClass(document.body,"mailmunch-pop-open")},MailMunchPopover.prototype._unsetOverflow=function(){MailMunchHelpers.removeClass(document.documentElement,"mailmunch-pop-open"),MailMunchHelpers.removeClass(document.body,"mailmunch-pop-open")},MailMunchPopover.prototype.show=function(e){var i=this;(this._beforeShow()||e)&&(this.overlay.style.display="block",this.dialog.style.display="block",this.dont_show=!0,""!=i.options.animation&&MailMunchHelpers.addClass(this.iframeContainer,i.options.animation),MailMunchHelpers.isPhone()?(this._scrollLock=!0,this.scaleFrame(),this.scrollToForm(0)):this.options.contentGate&&this._setOverflow(),MailMunchHelpers.setCookie("mailmunch_shown","true",this.options.cookieDuration))},MailMunchPopover.prototype.preview=function(){var e=this;this._beforePreview()&&(this.overlay.style.display="block",this.dialog.style.display="block",this.dont_show=!0,""!=e.options.animation&&MailMunchHelpers.addClass(this.iframeContainer,e.options.animation),MailMunchHelpers.isPhone()?(this._scrollLock=!0,this.scaleFrame(),this.scrollToForm(0)):this.options.contentGate&&this._setOverflow())},MailMunchPopover.prototype.hide=function(){return this.options.contentGate&&!this.subscribed?!1:(this.dialog.style.display="none",this.overlay.style.display="none",""!=this.options.animation&&MailMunchHelpers.removeClass(this.iframeContainer,this.options.animation),void(MailMunchHelpers.isPhone()?this._scrollLock=!1:this.options.contentGate&&this._unsetOverflow()))},MailMunchPopover.prototype.reposition=function(){var e=this,i=document.getElementById("mailmunch-popover-frame-"+this.viewId),o=this.dialog,t=this.overlay;if(t&&"block"==t.style.display||(o.style.display="none"),i.style.height=this.options.iframeHeight+"px",o.style.top="0px",o.style.left="0px",MailMunchHelpers.isPhone());else{var n=MailMunchHelpers.getElementsByClassName(o,"mailmunch-popover-iframe-scaler");MailMunchHelpers.forEach(n,function(i){i.style.paddingTop=e.options.iframeHeight+"px"})}},MailMunchPopover.prototype.inputFocus=function(e){if(MailMunchHelpers.isPhone()){var i=this;this._scrollLock=!1,this._unscaled||(this.unscaleFrame(),clearTimeout(this._scrollTimer),setTimeout(function(){i.scrollToForm(e)},100))}},MailMunchPopover.prototype.unscaleFrame=function(){this._unscaled=!0,this.iframe.style.webkitTransform="none",this.dialog.style.marginTop=this._topMargin+"px",this._currentScale=1},MailMunchPopover.prototype.scaleFrame=function(){if(!this._unscaled){this.iframe.style.webkitTransform="none",this._currentScale=.9*MailMunchHelpers.getScale(this.iframe);var e=MailMunchHelpers.getZoomFactor();this.iframe.style.webkitTransform="scale("+this._currentScale+")",this.dialog.style.marginTop=this._topMargin/e+"px"}},MailMunchPopover.prototype.inputBlur=function(){MailMunchHelpers.isPhone()&&(this._scrollLock=!0)},MailMunchPopover.prototype.scrollToForm=function(e){var i=this.iframe.getBoundingClientRect(),o=this._unscaled?i.width:1.1*i.width,t=MailMunchHelpers.getDocumentWidth()/2-o/2,n=this.dialog.offsetTop+e;window.scrollTo(t,n)},MailMunchPopover.prototype.scrollForm=function(e){var i=this,o=this.iframe.getBoundingClientRect(),t=window.scrollY;if(e){var n=MailMunchHelpers.getZoomFactor(),s=o.height-MailMunchHelpers.getWindowHeight();t=t-s-this._topMargin/n}clearTimeout(this._scrollTimer),this._scrollTimer=setTimeout(function(){i.dialog.style.top=t+"px"},100)},MailMunchPopover.prototype.scrollEvent=function(){if(this._scrollLock){var e=(MailMunchHelpers.getZoomFactor(),MailMunchHelpers.getWindowHeight()),i=this.iframe.getBoundingClientRect();i.height>e?i.bottom<e?this.scrollForm(!0):i.top>this._topMargin&&this.scrollForm():i.top<0?this.scrollForm():i.bottom>e&&this.scrollForm()}},MailMunchPopover.prototype.init=function(){var e=this;if(!this.readied){this.readied=!0;var i=MailMunchHelpers.getParameterByName("mailmunch_preview"),o=""!=i&&i==this.options.widgetID,t=MailMunchHelpers.getCookie("mailmunch_shown");""!=t&&(this.dont_show=!0);var n=MailMunchHelpers.getCookie("mailmunch_subscribed");if(""!=n&&(this.dont_show=!0),this.options.secondPageview){var s="";"undefined"!=typeof this.options.isSecondPageview&&(s=this.options.isSecondPageview),""==s&&(this.dont_show=!0)}if(this._deviceCheck(),this.prepare(),!this.dont_show||o){if(o)return void this.preview();1==this.options.showEntry&&setTimeout(function(){e.show()},this.options.loadingDelay),1==this.options.exitIntent&&MailMunchHelpers.addEvent(document,"mouseout",function(i){i=i?i:window.event;var o=i.relatedTarget||i.toElement;o&&"HTML"!=o.nodeName||e.show()}),MailMunchHelpers.isPhone()&&(MailMunchHelpers.addEvent(window,"scroll",function(i){e.scrollEvent(i)}),MailMunchHelpers.addEvent(window,"touchstart",function(i){e.scrollEvent(i)}))}}};