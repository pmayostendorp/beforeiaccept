/* v:2 f:omni.js */

try{(function($){var VVM_version='1.2.3',jQuery,undef,VVM=null;if(!window.VVM||!window.VVM.version||window.VVM.version.indexOf(VVM_version)!==0){(function(win,undef){if(win.VVM===undef){win.VVM=VVM={};}else{VVM=win.VVM;}
VVM.version='1.2.3';var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype,push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,breaker={};VVM.isEmpty=function(A){return!/\S/.test(A||"");};VVM.isDate=function(A){return Object.prototype.toString.call(A)==='[object Date]';};VVM.isBoolean=function(A){return Object.prototype.toString.call(A)==='[object Boolean]';};VVM.isNull=function(A){return A===null;};VVM.isNumber=function(A){return Object.prototype.toString.call(A)==='[object Number]';};VVM.isObject=function(A){return Object.prototype.toString.call(A)==='[object Object]';};VVM.isArray=function(A){return Object.prototype.toString.call(A)==='[object Array]';};VVM.isString=function(A){return Object.prototype.toString.call(A)==='[object String]';};VVM.isUndefined=function(A){return typeof A==="undefined";};VVM.isjQuery=function(A){return!!(VVM.isObject(A)&&A.jquery&&A instanceof jQuery);}
VVM.identity=function(value){return value;};VVM.bind=function(func,context){var args,bound;if(func.bind===nativeBind&&nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!$.isFunction(func))throw new TypeError;args=slice.call(arguments,2);return bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));ctor.prototype=func.prototype;var self=new ctor;ctor.prototype=null;var result=func.apply(self,args.concat(slice.call(arguments)));if(Object(result)===result)return result;return self;};};VVM.keys=nativeKeys||function(obj){if(obj!==Object(obj))throw new TypeError('Invalid object');var keys=[],key;for(key in obj)if(VVM.has(obj,key))keys[keys.length]=key;return keys;};VVM.values=function(){var values=[];for(var key in obj)if(VVM.has(obj,key))values.push(obj[key]);return values;}
VVM.has=function(obj,key){return hasOwnProperty.call(obj,key);};VVM.toArray=function(obj){if(!obj)return[];if(VVM.isArray(obj))return slice.call(obj);if(obj.length===+obj.length)return VVM.map(obj,VVM.identity);return VVM.values(obj);};VVM.each=VVM.forEach=function(obj,iterator,context){if(obj==null)return;if(nativeForEach&&obj.forEach===nativeForEach){obj.forEach(iterator,context);}else if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++){if(iterator.call(context,obj[i],i,obj)===breaker)return;}}else{for(var key in obj){if(VVM.has(obj,key)){if(iterator.call(context,obj[key],key,obj)===breaker)return;}}}};VVM.map=VVM.collect=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeMap&&obj.map===nativeMap)return obj.map(iterator,context);VVM.each(obj,function(value,index,list){results[results.length]=iterator.call(context,value,index,list);});return results;};VVM.now=Date.now||function(){return+(new Date);};VVM.strstr=function(haystack,needle,bool){var pos=0;haystack+='';pos=haystack.indexOf(needle);if(pos==-1){return false;}else{if(bool){return haystack.substr(0,pos);}else{return haystack.slice(pos);}}};VVM.utf8_decode=function(str_data){var tmp_arr=[],i=0,ac=0,c1=0,c2=0,c3=0;str_data+='';while(i<str_data.length){c1=str_data.charCodeAt(i);if(c1<128){tmp_arr[ac++]=String.fromCharCode(c1);i++;}else if(c1>191&&c1<224){c2=str_data.charCodeAt(i+1);tmp_arr[ac++]=String.fromCharCode(((c1&31)<<6)|(c2&63));i+=2;}else{c2=str_data.charCodeAt(i+1);c3=str_data.charCodeAt(i+2);tmp_arr[ac++]=String.fromCharCode(((c1&15)<<12)|((c2&63)<<6)|(c3&63));i+=3;}}
return tmp_arr.join('');};VVM.utf8_encode=function(argString){if(argString===null||typeof argString==="undefined"){return"";}
var string=(argString+'');var utftext="",start,end,stringl=0;start=end=0;stringl=string.length;for(var n=0;n<stringl;n++){var c1=string.charCodeAt(n);var enc=null;if(c1<128){end++;}else if(c1>127&&c1<2048){enc=String.fromCharCode((c1>>6)|192)+String.fromCharCode((c1&63)|128);}else{enc=String.fromCharCode((c1>>12)|224)+String.fromCharCode(((c1>>6)&63)|128)+String.fromCharCode((c1&63)|128);}
if(enc!==null){if(end>start){utftext+=string.slice(start,end);}
utftext+=enc;start=end=n+1;}}
if(end>start){utftext+=string.slice(start,stringl);}
return utftext;};(function(){var A=[];VVM.url={domain:function(C){var D=((C)?C.replace(/^https*:\/\/|(:|\/).*$/g,""):location.hostname).split("."),B=D.length;return D.slice(B-2,B).join(".")},section:function(){return((location.pathname.split("/")[1]||"").match(/^[^\.]*$/)||[""])[0]},params:function(E,D,C){var B=CN.utils.parseStr((D||location.search),(C||"query"));return(E)?B[E]||"":B},path:function(){if(A.length===0){A=location.pathname.match(/([^\/]+)/g)||[""]}
return A},getFragment:function(){return location.hash.substring(1)||false},setFragment:function(B){location.hash=B||"";return this}}})();VVM.daysInThisMonth=(function(){var today=new Date();return 32-new Date(today.getYear(),today.getMonth(),32).getDate();});VVM.debug={};VVM.debug.level=function(){if(VVM.strstr(document.domain,'local')==false&&VVM.strstr(document.domain,'www0')==false){return'production';}
return'dev';};VVM.debug.setLvl=function(lvl){this.lvl=lvl;};VVM.debug.alert=function(str){if(this.lvl=='production'){return;}
alert(str);};VVM.debug.prv=function(obj,str){if(typeof str!=='undefined'&&str.length>0){VVM.debug.p(str+':');}
if(VVM.isString(obj)||VVM.isNumber(obj)){VVM.debug.p('-- '+obj);return;}
for(i in obj){VVM.debug.p('-- '+i+': '+obj[i]);}};VVM.debug.p=function(txt){if(VVM.debug.level()=='production'||typeof console==='undefined'){return;}
if(typeof console.log==='function'){if(!console.log.apply)console.log(arguments[0]);else console.log.apply(console,VVM.toArray(arguments));}};VVM.debug.error=function(){if(console&&console.error&&typeof console.error.apply==='function'){var args=VVM.toArray(arguments);args.unshift('ERROR:');console.error.apply(console,args);$.each(args,function(i,arg){if(arg instanceof Error){console.log(arg.stack);}})}};VVM.truncate=function(text,length,end){end=end||'...';length=length||150;return(text.length>length)?text.substr(0,length-end.length)+end:text;};VVM.cookiesEnabled=function(){var key='cookiesEn',v=VVM.getCookie(key)
if(v===null){VVM.setCookie(key,'1')
return!!VVM.getCookie(key);}else{return true;}};VVM.getCookie=function(name){var start=document.cookie.indexOf(name+"=");if(start==-1){return null;}
start=start+name.length+1;var end=document.cookie.indexOf(";",start);return unescape(document.cookie.substring(start,((end>0)?end:document.cookie.length)));};VVM.setCookie=function(name,value,expires,path,domain){path=path||'/';if(expires==-1){VVM.delCookie(name,path);}else{if(expires===null){expires=365*20;}else{expires=parseInt(expires);}
if(isFinite(expires)&&expires>0){var today=new Date();var expires_date=new Date(today.getTime()+(expires*86400000));}else{expires=false;}
document.cookie=name+'='+escape(value)+
((expires)?';expires='+expires_date.toGMTString():'')+
((path)?';path='+path:'')+
((domain)?';domain='+domain:'');}};VVM.delCookie=function(name,path,domain){path=path||'/';if(VVM.getCookie(name)){document.cookie=name+'='+
((path)?';path='+path:'')+
((domain)?';domain='+domain:'')+';expires=Thu, 01-Jan-1970 00:00:01 GMT';}};VVM.localStorageAvailable=(function(){try{localStorage.setItem('vvm','vvm');localStorage.removeItem('vvm');return true;}catch(e){return false;}})();;VVM.clearLocalCache=function(key){var i;if(VVM.localStorageAvailable){if(VVM.isString(key)){return window.localStorage.removeItem(key);}
if(key instanceof RegExp&&window.localStorage.length){for(i=0;i<window.localStorage.length;i++){if(key.test(window.localStorage.key(i))){window.localStorage.removeItem(window.localStorage.key(i));i--;}}}}};(function(){var guid=0;VVM.guid=function(){return++guid;}})();;VVM.modals={id:'vvmModalScreen',childId:'vvmModal',modals:[],container:[],push:function(obj){return this.modals.push(obj)-1;},remove:function(key){if(this.modals[key]){this.modals[key]=false;}},getContainer:function(theme){var me=this;theme=theme||'omni';if(!me.container[theme]){me.container[theme]=$('<div/>').addClass(me.id).addClass(me.id+'-'+theme).addClass('trans-50').appendTo('body');}
return me.container[theme];},destroyContainer:function(theme){var me=this;theme=theme||'omni';if(me.container[theme]){me.container[theme]=false;}},hideAll:function(callback,index,keepContainer){index=index||0;keepContainer=keepContainer||false;var me=this,next=index+1,total=me.modals.length;if(total>0){if(next>=total){var newCallback=function(){setTimeout(function(){$('.'+me.id+', .'+me.childId,'body').hide();if(callback){callback();}},400);}
if(me.modals[index]){me.modals[index].hide(newCallback,keepContainer);}else{newCallback();}}else{var newCallback=function(){me.hideAll(callback,next,keepContainer);}
if(me.modals[index]){me.modals[index].hide(newCallback,keepContainer);}else{newCallback();}}}else if(callback){callback();}},hideAllButContainer:function(callback){this.hideAll(callback,0,true);}};VVM.modal=function(params){var me=this;me.parent=VVM.modals;me.version='VVM Modal 2.0';return me.init(params);};VVM.modal.prototype={id:false,key:false,loaded:false,$container:false,$modal:false,init:function(params){var me=this;me.params=$.extend({css:{},content:'<div><p>'+me.version+'</p></div>',autoOpen:false,autoHide:true,theme:'omni',closeBox:true,closeObj:{content:'<span class="omni-icon-close"></span>',callback:function(modal){modal.hide();}},events:{}},params||{});me.id=me.parent.childId;me.key=me.parent.push(me);if(me.params.iframe){me.params.content='<iframe frameBorder="0" src="'+me.params.iframe+'"/>';}
if(me.params.autoOpen){me.show();}
$(win).resize(function(){if(me.visible()){me.refresh()}});$(win).scroll(function(){if(me.visible()){me.refresh()}});return me;},$:function(selector){if(!this.loaded)this.render();return this.$modal.find(selector);},visible:function(){var me=this;return(me.loaded)?me.$modal.is(':visible'):false;},show:function(callback){var me=this,visible=function(){me.$modal.trigger('visible');if('function'===typeof callback){callback();}};if(me.loaded){me.refresh();me.$container.appendTo('body');if(!me.$container.is(':visible')){me.$container.fadeIn();}
me.$modal.appendTo('body');if(!me.visible()){me.$modal.fadeIn(visible);}else{visible();}}else{me.render();me.show(visible);}},render:function(){var me=this;me.$container=me.parent.getContainer(me.params.theme);me.$modal=$('<div/>').data('key',me.key).addClass(me.id).addClass(me.id+'-'+me.params.theme).html(me.params.content).appendTo('body');if(me.params.closeBox){me.$modal.append(me.params.closeObj.content);if(me.params.closeObj.callback){$('>:last-child',me.$modal).click(function(){me.params.closeObj.callback(me);})}}
for(e in me.params.events){if(me.params.events.hasOwnProperty(e)&&'function'===typeof me.params.events[e]){me.$modal.bind(e,me.params.events[e]);}}
me.loaded=true;},refresh:function(){var me=this;if(me.loaded){me.$modal.css(me.params.css).css({'left':function(){return(me.$container.width()/2)-($(this).outerWidth(true)/2)},'top':function(){return(me.$container.height()/2)-($(this).outerHeight(true)/2)}});if(me.params.autoHide){me.$container.bind('click',function(ev){if(me.visible()){ev.stopImmediatePropagation();if(me.params.closeObj&&me.params.closeObj.callback){me.params.closeObj.callback(me);}else{me.hide();}}});}else{me.$container.unbind('click');}}},hide:function(callback,keepContainer){var me=this;keepContainer=keepContainer||false;if(me.loaded&&!me.params.loading){var $others=$('div.'+me.id).filter(':visible').not(me.$modal);me.$container.unbind('click');if(!$others.length){if(!keepContainer){me.$container.fadeOut();}
me.$modal.fadeOut(callback);}else{me.$modal.fadeOut();me.parent.modals[$others.last().data('key')].show(callback);}}else if(callback){callback();}else{me.$modal.fadeOut();var $others=$('div.'+me.id).filter(':visible').not(me.$modal);if($others.length==0&&!keepContainer){me.$container.fadeOut();}
$others.last().before(me.$container);}},destroy:function(callback){var me=this;me.hide(function(){if(!$('div.'+me.id+'-'+me.params.theme).not(me.$modal).length){me.parent.destroyContainer(me.params.theme);}
me.$modal.remove();me.parent.remove(me.key);me.$modal=me.key=me.loaded=false;if(callback){callback();}});},updateCSS:function(css){var me=this;me.params.css=$.extend(me.params.css,css);me.refresh();},setContent:function(content){var me=this;if(content)
me.params.content=content;if(me.loaded){me.$modal.html(me.params.content);if(me.params.closeBox){me.$modal.append(me.params.closeObj.content);if(me.params.closeObj.callback){$('>:last-child',me.$modal).click(function(){me.params.closeObj.callback(me);})}}}},setCloseObj:function(obj){var me=this;if(obj){me.params.closeBox=true;if(typeof obj=='object')
me.params.closeObj=obj;}else{me.params.closeBox=false;}
me.setContent();},getOuterHTML:function(){if(!this.loaded){this.render();}
return $.trim(this.$modal.get(0).outerHTML);}};})(window)}
VVM=window.VVM;VVM.debug.setLvl(location.hostname.match(/^www\./)?0:3);;!function(n){function t(n,t,r){r=(r||0)-1;for(var e=n.length;++r<e;)if(n[r]===t)return r;return-1}function r(n,r){var e=typeof r;if(n=n.k,"boolean"==e||r==d)return n[r];"number"!=e&&"string"!=e&&(e="object");var u="number"==e?r:x+r;return n=n[e]||(n[e]={}),"object"==e?n[u]&&-1<t(n[u],r)?0:-1:n[u]?0:-1}function e(n){var t=this.k,r=typeof n;if("boolean"==r||n==d)t[n]=y;else{"number"!=r&&"string"!=r&&(r="object");var e="number"==r?n:x+n,u=t[r]||(t[r]={});"object"==r?(u[e]||(u[e]=[])).push(n)==this.b.length&&(t[r]=b):u[e]=y}}function u(n){return n.charCodeAt(0)}function a(n,t){var r=n.m,e=t.m;if(n=n.l,t=t.l,n!==t){if(n>t||typeof n=="undefined")return 1;if(n<t||typeof t=="undefined")return-1}return r<e?-1:1}function o(n){var t=-1,r=n.length,u=c();u["false"]=u["null"]=u["true"]=u.undefined=b;var a=c();for(a.b=n,a.k=u,a.push=e;++t<r;)a.push(n[t]);return u.object===false?(g(a),d):a}function i(n){return"\\"+tt[n]}function l(){return _.pop()||[]}function c(){return C.pop()||{a:"",b:d,c:"",k:d,l:d,"false":b,d:"",m:0,e:"",leading:b,f:"",maxWait:0,"null":b,number:d,object:d,push:d,g:d,string:d,h:"",trailing:b,"true":b,undefined:b,i:b,j:b,n:d}}function f(n){return typeof n.toString!="function"&&typeof(n+"")=="string"}function p(){}function s(n){n.length=0,_.length<E&&_.push(n)}function g(n){var t=n.k;t&&g(t),n.b=n.k=n.l=n.object=n.number=n.string=n.n=d,C.length<E&&C.push(n)}function v(n,t,r){t||(t=0),typeof r=="undefined"&&(r=n?n.length:0);var e=-1;r=r-t||0;for(var u=Array(0>r?0:r);++e<r;)u[e]=n[t+e];return u}function h(e){function _(n){return n&&typeof n=="object"&&!qr(n)&&sr.call(n,"__wrapped__")?n:new C(n)}function C(n){this.__wrapped__=n}function E(n,t,r,e){function u(){var e=arguments,c=o?this:t;return a||(n=t[i]),r.length&&(e=e.length?(e=Sr.call(e),l?e.concat(r):r.concat(e)):r),this instanceof u?(c=rt(n.prototype),e=n.apply(c,e),mt(e)?e:c):n.apply(c,e)}var a=ht(n),o=!r,i=t;if(o){var l=e;r=t}else if(!a){if(!e)throw new Zt;t=n}return u}function tt(){var n=c();n.g=L,n.b=n.c=n.f=n.h="",n.e="r",n.i=y,n.j=!!Rr;for(var t,r=0;t=arguments[r];r++)for(var e in t)n[e]=t[e];r=n.a,n.d=/^[^,]+/.exec(r)[0],t=Mt,r="return function("+r+"){",e="var m,r="+n.d+",C="+n.e+";if(!r)return C;"+n.h+";",n.b?(e+="var s=r.length;m=-1;if("+n.b+"){",Pr.unindexedChars&&(e+="if(q(r)){r=r.split('')}"),e+="while(++m<s){"+n.f+";}}else{"):Pr.nonEnumArgs&&(e+="var s=r.length;m=-1;if(s&&n(r)){while(++m<s){m+='';"+n.f+";}}else{"),Pr.enumPrototypes&&(e+="var E=typeof r=='function';"),Pr.enumErrorProps&&(e+="var D=r===j||r instanceof Error;");var u=[];if(Pr.enumPrototypes&&u.push('!(E&&m=="prototype")'),Pr.enumErrorProps&&u.push('!(D&&(m=="message"||m=="name"))'),n.i&&n.j)e+="var A=-1,B=z[typeof r]&&t(r),s=B?B.length:0;while(++A<s){m=B[A];",u.length&&(e+="if("+u.join("&&")+"){"),e+=n.f+";",u.length&&(e+="}"),e+="}";else if(e+="for(m in r){",n.i&&u.push("l.call(r, m)"),u.length&&(e+="if("+u.join("&&")+"){"),e+=n.f+";",u.length&&(e+="}"),e+="}",Pr.nonEnumShadows){for(e+="if(r!==y){var h=r.constructor,p=r===(h&&h.prototype),e=r===H?G:r===j?i:J.call(r),v=w[e];",k=0;7>k;k++)e+="m='"+n.g[k]+"';if((!(p&&v[m])&&l.call(r,m))",n.i||(e+="||(!v[m]&&r[m]!==y[m])"),e+="){"+n.f+"}";e+="}"}return(n.b||Pr.nonEnumArgs)&&(e+="}"),e+=n.c+";return C",t=t("i,j,l,n,o,q,t,u,y,z,w,G,H,J",r+e+"}"),g(n),t(M,tr,sr,ft,qr,dt,Rr,_,rr,nt,Nr,Y,er,yr)}function rt(n){return mt(n)?br(n):{}}function ut(n){return Wr[n]}function ot(){var n=(n=_.indexOf)===Pt?t:n;return n}function it(n){return function(t,r,e,u){return typeof r!="boolean"&&r!=d&&(u=e,e=u&&u[r]===t?m:r,r=b),e!=d&&(e=_.createCallback(e,u)),n(t,r,e,u)}}function lt(n){var t,r;return!n||yr.call(n)!=Q||(t=n.constructor,ht(t)&&!(t instanceof t))||!Pr.argsClass&&ft(n)||!Pr.nodeClass&&f(n)?b:Pr.ownLast?(Jr(n,function(n,t,e){return r=sr.call(e,t),b}),r!==false):(Jr(n,function(n,t){r=t}),r===m||sr.call(n,r))}function ct(n){return Lr[n]}function ft(n){return yr.call(n)==G}function pt(n,t,r,e,u,a){var o=n;if(typeof t!="boolean"&&t!=d&&(e=r,r=t,t=b),typeof r=="function"){if(r=typeof e=="undefined"?r:_.createCallback(r,e,1),o=r(o),typeof o!="undefined")return o;o=n}if(e=mt(o)){var i=yr.call(o);if(!Z[i]||!Pr.nodeClass&&f(o))return o;var c=qr(o)}if(!e||!t)return e?c?v(o):Gr({},o):o;switch(e=Br[i],i){case J:case K:return new e(+o);case V:case Y:return new e(o);case X:return e(o.source,P.exec(o))}i=!u,u||(u=l()),a||(a=l());for(var p=u.length;p--;)if(u[p]==n)return a[p];return o=c?e(o.length):{},c&&(sr.call(n,"index")&&(o.index=n.index),sr.call(n,"input")&&(o.input=n.input)),u.push(n),a.push(o),(c?Tr:Kr)(n,function(n,e){o[e]=pt(n,t,r,m,u,a)}),i&&(s(u),s(a)),o}function st(n){var t=[];return Jr(n,function(n,r){ht(n)&&t.push(r)}),t.sort()}function gt(n){for(var t=-1,r=Rr(n),e=r.length,u={};++t<e;){var a=r[t];u[n[a]]=a}return u}function vt(n,t,r,e,u,a){var o=r===w;if(typeof r=="function"&&!o){r=_.createCallback(r,e,2);var i=r(n,t);if(typeof i!="undefined")return!!i}if(n===t)return 0!==n||1/n==1/t;var c=typeof n,p=typeof t;if(n===n&&(!n||"function"!=c&&"object"!=c)&&(!t||"function"!=p&&"object"!=p))return b;if(n==d||t==d)return n===t;if(p=yr.call(n),c=yr.call(t),p==G&&(p=Q),c==G&&(c=Q),p!=c)return b;switch(p){case J:case K:return+n==+t;case V:return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case X:case Y:return n==Yt(t)}if(c=p==H,!c){if(sr.call(n,"__wrapped__")||sr.call(t,"__wrapped__"))return vt(n.__wrapped__||n,t.__wrapped__||t,r,e,u,a);if(p!=Q||!Pr.nodeClass&&(f(n)||f(t)))return b;var p=!Pr.argsObject&&ft(n)?Qt:n.constructor,g=!Pr.argsObject&&ft(t)?Qt:t.constructor;if(p!=g&&(!ht(p)||!(p instanceof p&&ht(g)&&g instanceof g)))return b}for(g=!u,u||(u=l()),a||(a=l()),p=u.length;p--;)if(u[p]==n)return a[p]==t;var v=0,i=y;if(u.push(n),a.push(t),c){if(p=n.length,v=t.length,i=v==n.length,!i&&!o)return i;for(;v--;)if(c=p,g=t[v],o)for(;c--&&!(i=vt(n[c],g,r,e,u,a)););else if(!(i=vt(n[v],g,r,e,u,a)))break;return i}return Jr(t,function(t,o,l){return sr.call(l,o)?(v++,i=sr.call(n,o)&&vt(n[o],t,r,e,u,a)):void 0}),i&&!o&&Jr(n,function(n,t,r){return sr.call(r,t)?i=-1<--v:void 0}),g&&(s(u),s(a)),i}function ht(n){return typeof n=="function"}function mt(n){return!(!n||!nt[typeof n])}function yt(n){return typeof n=="number"||yr.call(n)==V}function dt(n){return typeof n=="string"||yr.call(n)==Y}function bt(n,t,r){var e=arguments,u=0,a=2;if(!mt(n))return n;if(r===w)var o=e[3],i=e[4],c=e[5];else{var f=y,i=l(),c=l();typeof r!="number"&&(a=e.length),3<a&&"function"==typeof e[a-2]?o=_.createCallback(e[--a-1],e[a--],2):2<a&&"function"==typeof e[a-1]&&(o=e[--a])}for(;++u<a;)(qr(e[u])?xt:Kr)(e[u],function(t,r){var e,u,a=t,l=n[r];if(t&&((u=qr(t))||Mr(t))){for(a=i.length;a--;)if(e=i[a]==t){l=c[a];break}if(!e){var f;o&&(a=o(l,t),f=typeof a!="undefined")&&(l=a),f||(l=u?qr(l)?l:[]:Mr(l)?l:{}),i.push(t),c.push(l),f||(l=bt(l,t,w,o,i,c))}}else o&&(a=o(l,t),typeof a=="undefined"&&(a=t)),typeof a!="undefined"&&(l=a);n[r]=l});return f&&(s(i),s(c)),n}function _t(n){for(var t=-1,r=Rr(n),e=r.length,u=Ht(e);++t<e;)u[t]=n[r[t]];return u}function Ct(n,t,r){var e=-1,u=ot(),a=n?n.length:0,o=b;return r=(0>r?kr(0,a+r):r)||0,a&&typeof a=="number"?o=-1<(dt(n)?n.indexOf(t,r):u(n,t,r)):Tr(n,function(n){return++e<r?void 0:!(o=n===t)}),o}function jt(n,t,r){var e=y;if(t=_.createCallback(t,r),qr(n)){r=-1;for(var u=n.length;++r<u&&(e=!!t(n[r],r,n)););}else Tr(n,function(n,r,u){return e=!!t(n,r,u)});return e}function wt(n,t,r){var e=[];if(t=_.createCallback(t,r),qr(n)){r=-1;for(var u=n.length;++r<u;){var a=n[r];t(a,r,n)&&e.push(a)}}else Tr(n,function(n,r,u){t(n,r,u)&&e.push(n)});return e}function kt(n,t,r){if(t=_.createCallback(t,r),!qr(n)){var e;return Tr(n,function(n,r,u){return t(n,r,u)?(e=n,b):void 0}),e}r=-1;for(var u=n.length;++r<u;){var a=n[r];if(t(a,r,n))return a}}function xt(n,t,r){if(t&&typeof r=="undefined"&&qr(n)){r=-1;for(var e=n.length;++r<e&&t(n[r],r,n)!==false;);}else Tr(n,t,r);return n}function Ot(n,t,r){var e=-1,u=n?n.length:0,a=Ht(typeof u=="number"?u:0);if(t=_.createCallback(t,r),qr(n))for(;++e<u;)a[e]=t(n[e],e,n);else Tr(n,function(n,r,u){a[++e]=t(n,r,u)});return a}function Et(n,t,r){var e=-1/0,a=e;if(!t&&qr(n)){r=-1;for(var o=n.length;++r<o;){var i=n[r];i>a&&(a=i)}}else t=!t&&dt(n)?u:_.createCallback(t,r),Tr(n,function(n,r,u){r=t(n,r,u),r>e&&(e=r,a=n)});return a}function St(n,t,r,e){var u=3>arguments.length;if(t=_.createCallback(t,e,4),qr(n)){var a=-1,o=n.length;for(u&&(r=n[++a]);++a<o;)r=t(r,n[a],a,n)}else Tr(n,function(n,e,a){r=u?(u=b,n):t(r,n,e,a)});return r}function At(n,t,r,e){var u=n,a=n?n.length:0,o=3>arguments.length;if(typeof a!="number")var i=Rr(n),a=i.length;else Pr.unindexedChars&&dt(n)&&(u=n.split(""));return t=_.createCallback(t,e,4),xt(n,function(n,e,l){e=i?i[--a]:--a,r=o?(o=b,u[e]):t(r,u[e],e,l)}),r}function It(n,t,r){var e;if(t=_.createCallback(t,r),qr(n)){r=-1;for(var u=n.length;++r<u&&!(e=t(n[r],r,n)););}else Tr(n,function(n,r,u){return!(e=t(n,r,u))});return!!e}function Bt(n){var e=-1,u=ot(),a=n?n.length:0,i=lr.apply(nr,Sr.call(arguments,1)),l=[],c=a>=O&&u===t;if(c){var f=o(i);f?(u=r,i=f):c=b}for(;++e<a;)f=n[e],0>u(i,f)&&l.push(f);return c&&g(i),l}function Nt(n,t,r){if(n){var e=0,u=n.length;if(typeof t!="number"&&t!=d){var a=-1;for(t=_.createCallback(t,r);++a<u&&t(n[a],a,n);)e++}else if(e=t,e==d||r)return n[0];return v(n,0,xr(kr(0,e),u))}}function Pt(n,r,e){if(typeof e=="number"){var u=n?n.length:0;e=0>e?kr(0,u+e):e||0}else if(e)return e=Ft(n,r),n[e]===r?e:-1;return n?t(n,r,e):-1}function zt(n,t,r){if(typeof t!="number"&&t!=d){var e=0,u=-1,a=n?n.length:0;for(t=_.createCallback(t,r);++u<a&&t(n[u],u,n);)e++}else e=t==d||r?1:kr(0,t);return v(n,e)}function Ft(n,t,r,e){var u=0,a=n?n.length:u;for(r=r?_.createCallback(r,e,1):Wt,t=r(t);u<a;)e=u+a>>>1,r(n[e])<t?u=e+1:a=e;return u}function $t(n){for(var t=-1,r=n?Et(Ur(n,"length")):0,e=Ht(0>r?0:r);++t<r;)e[t]=Ur(n,t);return e}function qt(n,t){for(var r=-1,e=n?n.length:0,u={};++r<e;){var a=n[r];t?u[a]=t[r]:u[a[0]]=a[1]}return u}function Dt(n,t){return Pr.fastBind||dr&&2<arguments.length?dr.call.apply(dr,arguments):E(n,t,Sr.call(arguments,2))}function Rt(n,t,r){function e(){ir(s),ir(g),c=0,s=g=d}function u(){var t=v&&(!h||1<c);e(),t&&(p!==false&&(f=new Kt),i=n.apply(l,o))}function a(){e(),(v||p!==t)&&(f=new Kt,i=n.apply(l,o))}var o,i,l,c=0,f=0,p=b,s=d,g=d,v=y;if(t=kr(0,t||0),r===y)var h=y,v=b;else mt(r)&&(h=r.leading,p="maxWait"in r&&kr(t,r.maxWait||0),v="trailing"in r?r.trailing:v);return function(){if(o=arguments,l=this,c++,ir(g),p===false)h&&2>c&&(i=n.apply(l,o));else{var r=new Kt;!s&&!h&&(f=r);var e=p-(r-f);0<e?s||(s=mr(a,e)):(ir(s),s=d,f=r,i=n.apply(l,o))}return t!==p&&(g=mr(u,t)),i}}function Tt(n){var t=Sr.call(arguments,1);return mr(function(){n.apply(m,t)},1)}function Wt(n){return n}function Lt(n){xt(st(n),function(t){var r=_[t]=n[t];_.prototype[t]=function(){var n=this.__wrapped__,t=[n];return gr.apply(t,arguments),t=r.apply(_,t),n&&typeof n=="object"&&n===t?this:new C(t)}})}function Gt(){return this.__wrapped__}e=e?at.defaults(n.Object(),e,at.pick(n,W)):n;var Ht=e.Array,Jt=e.Boolean,Kt=e.Date,Mt=e.Function,Ut=e.Math,Vt=e.Number,Qt=e.Object,Xt=e.RegExp,Yt=e.String,Zt=e.TypeError,nr=[],tr=e.Error.prototype,rr=Qt.prototype,er=Yt.prototype,ur=e._,ar=Xt("^"+Yt(rr.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),or=Ut.ceil,ir=e.clearTimeout,lr=nr.concat,cr=Ut.floor,fr=Mt.prototype.toString,pr=ar.test(pr=Qt.getPrototypeOf)&&pr,sr=rr.hasOwnProperty,gr=nr.push,vr=rr.propertyIsEnumerable,hr=e.setImmediate,mr=e.setTimeout,yr=rr.toString,dr=ar.test(dr=yr.bind)&&dr,br=ar.test(br=Qt.create)&&br,_r=ar.test(_r=Ht.isArray)&&_r,Cr=e.isFinite,jr=e.isNaN,wr=ar.test(wr=Qt.keys)&&wr,kr=Ut.max,xr=Ut.min,Or=e.parseInt,Er=Ut.random,Sr=nr.slice,Ar=ar.test(e.attachEvent),Ir=dr&&!/\n|true/.test(dr+Ar),Br={};Br[H]=Ht,Br[J]=Jt,Br[K]=Kt,Br[U]=Mt,Br[Q]=Qt,Br[V]=Vt,Br[X]=Xt,Br[Y]=Yt;var Nr={};Nr[H]=Nr[K]=Nr[V]={constructor:y,toLocaleString:y,toString:y,valueOf:y},Nr[J]=Nr[Y]={constructor:y,toString:y,valueOf:y},Nr[M]=Nr[U]=Nr[X]={constructor:y,toString:y},Nr[Q]={constructor:y},function(){for(var n=L.length;n--;){var t,r=L[n];for(t in Nr)sr.call(Nr,t)&&!sr.call(Nr[t],r)&&(Nr[t][r]=b)}}(),C.prototype=_.prototype;var Pr=_.support={};!function(){function n(){this.x=1}var t={0:1,length:1},r=[];n.prototype={valueOf:1};for(var e in new n)r.push(e);for(e in arguments);Pr.argsObject=arguments.constructor==Qt&&!(arguments instanceof Ht),Pr.argsClass=ft(arguments),Pr.enumErrorProps=vr.call(tr,"message")||vr.call(tr,"name"),Pr.enumPrototypes=vr.call(n,"prototype"),Pr.fastBind=dr&&!Ir,Pr.ownLast="x"!=r[0],Pr.nonEnumArgs=0!=e,Pr.nonEnumShadows=!/valueOf/.test(r),Pr.spliceObjects=(nr.splice.call(t,0,1),!t[0]),Pr.unindexedChars="xx"!="x"[0]+Qt("x")[0];try{Pr.nodeClass=!(yr.call(document)==Q&&!({toString:0}+""))}catch(u){Pr.nodeClass=y}}(1),_.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:z,variable:"",imports:{_:_}};var zr={a:"x,F,k",h:"var a=arguments,b=0,c=typeof k=='number'?2:a.length;while(++b<c){r=a[b];if(r&&z[typeof r]){",f:"if(typeof C[m]=='undefined')C[m]=r[m]",c:"}}"},Fr={a:"f,d,I",h:"d=d&&typeof I=='undefined'?d:u.createCallback(d,I)",b:"typeof s=='number'",f:"if(d(r[m],m,f)===false)return C"},$r={h:"if(!z[typeof r])return C;"+Fr.h,b:b};br||(rt=function(n){if(mt(n)){p.prototype=n;var t=new p;p.prototype=d}return t||{}}),Pr.argsClass||(ft=function(n){return n?sr.call(n,"callee"):b});var qr=_r||function(n){return n?typeof n=="object"&&yr.call(n)==H:b},Dr=tt({a:"x",e:"[]",h:"if(!(z[typeof x]))return C",f:"C.push(m)"}),Rr=wr?function(n){return mt(n)?Pr.enumPrototypes&&typeof n=="function"||Pr.nonEnumArgs&&n.length&&ft(n)?Dr(n):wr(n):[]}:Dr,Tr=tt(Fr),Wr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Lr=gt(Wr),Gr=tt(zr,{h:zr.h.replace(";",";if(c>3&&typeof a[c-2]=='function'){var d=u.createCallback(a[--c-1],a[c--],2)}else if(c>2&&typeof a[c-1]=='function'){d=a[--c]}"),f:"C[m]=d?d(C[m],r[m]):r[m]"}),Hr=tt(zr),Jr=tt(Fr,$r,{i:b}),Kr=tt(Fr,$r);ht(/x/)&&(ht=function(n){return typeof n=="function"&&yr.call(n)==U});var Mr=pr?function(n){if(!n||yr.call(n)!=Q||!Pr.argsClass&&ft(n))return b;var t=n.valueOf,r=typeof t=="function"&&(r=pr(t))&&pr(r);return r?n==r||pr(n)==r:lt(n)}:lt,Ur=Ot,Vr=it(function Yr(n,t,r){for(var e=-1,u=n?n.length:0,a=[];++e<u;){var o=n[e];r&&(o=r(o,e,n)),qr(o)?gr.apply(a,t?o:Yr(o)):a.push(o)}return a}),Qr=it(function(n,e,u){var a=-1,i=ot(),c=n?n.length:0,f=[],p=!e&&c>=O&&i===t,v=u||p?l():f;if(p){var h=o(v);h?(i=r,v=h):(p=b,v=u?v:(s(v),f))}for(;++a<c;){var h=n[a],m=u?u(h,a,n):h;(e?!a||v[v.length-1]!==m:0>i(v,m))&&((u||p)&&v.push(m),f.push(h))}return p?(s(v.b),g(v)):u&&s(v),f});Ir&&et&&typeof hr=="function"&&(Tt=Dt(hr,e));var Xr=8==Or($+"08")?Or:function(n,t){return Or(dt(n)?n.replace(q,""):n,t||0)};return _.after=function(n,t){return 1>n?t():function(){return 1>--n?t.apply(this,arguments):void 0}},_.assign=Gr,_.at=function(n){var t=-1,r=lr.apply(nr,Sr.call(arguments,1)),e=r.length,u=Ht(e);for(Pr.unindexedChars&&dt(n)&&(n=n.split(""));++t<e;)u[t]=n[r[t]];return u},_.bind=Dt,_.bindAll=function(n){for(var t=1<arguments.length?lr.apply(nr,Sr.call(arguments,1)):st(n),r=-1,e=t.length;++r<e;){var u=t[r];n[u]=Dt(n[u],n)}return n},_.bindKey=function(n,t){return E(n,t,Sr.call(arguments,2),w)},_.compact=function(n){for(var t=-1,r=n?n.length:0,e=[];++t<r;){var u=n[t];u&&e.push(u)}return e},_.compose=function(){var n=arguments;return function(){for(var t=arguments,r=n.length;r--;)t=[n[r].apply(this,t)];return t[0]}},_.countBy=function(n,t,r){var e={};return t=_.createCallback(t,r),xt(n,function(n,r,u){r=Yt(t(n,r,u)),sr.call(e,r)?e[r]++:e[r]=1}),e},_.createCallback=function(n,t,r){if(n==d)return Wt;var e=typeof n;if("function"!=e){if("object"!=e)return function(t){return t[n]};var u=Rr(n);return function(t){for(var r=u.length,e=b;r--&&(e=vt(t[u[r]],n[u[r]],w)););return e}}return typeof t=="undefined"||F&&!F.test(fr.call(n))?n:1===r?function(r){return n.call(t,r)}:2===r?function(r,e){return n.call(t,r,e)}:4===r?function(r,e,u,a){return n.call(t,r,e,u,a)}:function(r,e,u){return n.call(t,r,e,u)}},_.debounce=Rt,_.defaults=Hr,_.defer=Tt,_.delay=function(n,t){var r=Sr.call(arguments,2);return mr(function(){n.apply(m,r)},t)},_.difference=Bt,_.filter=wt,_.flatten=Vr,_.forEach=xt,_.forIn=Jr,_.forOwn=Kr,_.functions=st,_.groupBy=function(n,t,r){var e={};return t=_.createCallback(t,r),xt(n,function(n,r,u){r=Yt(t(n,r,u)),(sr.call(e,r)?e[r]:e[r]=[]).push(n)}),e},_.initial=function(n,t,r){if(!n)return[];var e=0,u=n.length;if(typeof t!="number"&&t!=d){var a=u;for(t=_.createCallback(t,r);a--&&t(n[a],a,n);)e++}else e=t==d||r?1:t||e;return v(n,0,xr(kr(0,u-e),u))},_.intersection=function(n){for(var e=arguments,u=e.length,a=-1,i=l(),c=-1,f=ot(),p=n?n.length:0,v=[],h=l();++a<u;){var m=e[a];i[a]=f===t&&(m?m.length:0)>=O&&o(a?e[a]:h)}n:for(;++c<p;){var y=i[0],m=n[c];if(0>(y?r(y,m):f(h,m))){for(a=u,(y||h).push(m);--a;)if(y=i[a],0>(y?r(y,m):f(e[a],m)))continue n;v.push(m)}}for(;u--;)(y=i[u])&&g(y);return s(i),s(h),v},_.invert=gt,_.invoke=function(n,t){var r=Sr.call(arguments,2),e=-1,u=typeof t=="function",a=n?n.length:0,o=Ht(typeof a=="number"?a:0);return xt(n,function(n){o[++e]=(u?t:n[t]).apply(n,r)}),o},_.keys=Rr,_.map=Ot,_.max=Et,_.memoize=function(n,t){function r(){var e=r.cache,u=x+(t?t.apply(this,arguments):arguments[0]);return sr.call(e,u)?e[u]:e[u]=n.apply(this,arguments)}return r.cache={},r},_.merge=bt,_.min=function(n,t,r){var e=1/0,a=e;if(!t&&qr(n)){r=-1;for(var o=n.length;++r<o;){var i=n[r];i<a&&(a=i)}}else t=!t&&dt(n)?u:_.createCallback(t,r),Tr(n,function(n,r,u){r=t(n,r,u),r<e&&(e=r,a=n)});return a},_.omit=function(n,t,r){var e=ot(),u=typeof t=="function",a={};if(u)t=_.createCallback(t,r);else var o=lr.apply(nr,Sr.call(arguments,1));return Jr(n,function(n,r,i){(u?!t(n,r,i):0>e(o,r))&&(a[r]=n)}),a},_.once=function(n){var t,r;return function(){return t?r:(t=y,r=n.apply(this,arguments),n=d,r)}},_.pairs=function(n){for(var t=-1,r=Rr(n),e=r.length,u=Ht(e);++t<e;){var a=r[t];u[t]=[a,n[a]]}return u},_.partial=function(n){return E(n,Sr.call(arguments,1))},_.partialRight=function(n){return E(n,Sr.call(arguments,1),d,w)},_.pick=function(n,t,r){var e={};if(typeof t!="function")for(var u=-1,a=lr.apply(nr,Sr.call(arguments,1)),o=mt(n)?a.length:0;++u<o;){var i=a[u];i in n&&(e[i]=n[i])}else t=_.createCallback(t,r),Jr(n,function(n,r,u){t(n,r,u)&&(e[r]=n)});return e},_.pluck=Ur,_.range=function(n,t,r){n=+n||0,r=+r||1,t==d&&(t=n,n=0);var e=-1;t=kr(0,or((t-n)/r));for(var u=Ht(t);++e<t;)u[e]=n,n+=r;return u},_.reject=function(n,t,r){return t=_.createCallback(t,r),wt(n,function(n,r,e){return!t(n,r,e)})},_.rest=zt,_.shuffle=function(n){var t=-1,r=n?n.length:0,e=Ht(typeof r=="number"?r:0);return xt(n,function(n){var r=cr(Er()*(++t+1));e[t]=e[r],e[r]=n}),e},_.sortBy=function(n,t,r){var e=-1,u=n?n.length:0,o=Ht(typeof u=="number"?u:0);for(t=_.createCallback(t,r),xt(n,function(n,r,u){var a=o[++e]=c();a.l=t(n,r,u),a.m=e,a.n=n}),u=o.length,o.sort(a);u--;)n=o[u],o[u]=n.n,g(n);return o},_.tap=function(n,t){return t(n),n},_.throttle=function(n,t,r){var e=y,u=y;return r===false?e=b:mt(r)&&(e="leading"in r?r.leading:e,u="trailing"in r?r.trailing:u),r=c(),r.leading=e,r.maxWait=t,r.trailing=u,n=Rt(n,t,r),g(r),n},_.times=function(n,t,r){n=-1<(n=+n)?n:0;var e=-1,u=Ht(n);for(t=_.createCallback(t,r,1);++e<n;)u[e]=t(e);return u},_.toArray=function(n){return n&&typeof n.length=="number"?Pr.unindexedChars&&dt(n)?n.split(""):v(n):_t(n)},_.transform=function(n,t,r,e){var u=qr(n);return t=_.createCallback(t,e,4),r==d&&(u?r=[]:(e=n&&n.constructor,r=rt(e&&e.prototype))),(u?Tr:Kr)(n,function(n,e,u){return t(r,n,e,u)}),r},_.union=function(n){return qr(n)||(arguments[0]=n?Sr.call(n):nr),Qr(lr.apply(nr,arguments))},_.uniq=Qr,_.unzip=$t,_.values=_t,_.where=wt,_.without=function(n){return Bt(n,Sr.call(arguments,1))},_.wrap=function(n,t){return function(){var r=[n];return gr.apply(r,arguments),t.apply(this,r)}},_.zip=function(n){return n?$t(arguments):[]},_.zipObject=qt,_.collect=Ot,_.drop=zt,_.each=xt,_.extend=Gr,_.methods=st,_.object=qt,_.select=wt,_.tail=zt,_.unique=Qr,Lt(_),_.chain=_,_.prototype.chain=function(){return this},_.clone=pt,_.cloneDeep=function(n,t,r){return pt(n,y,t,r)},_.contains=Ct,_.escape=function(n){return n==d?"":Yt(n).replace(R,ut)},_.every=jt,_.find=kt,_.findIndex=function(n,t,r){var e=-1,u=n?n.length:0;for(t=_.createCallback(t,r);++e<u;)if(t(n[e],e,n))return e;return-1},_.findKey=function(n,t,r){var e;return t=_.createCallback(t,r),Kr(n,function(n,r,u){return t(n,r,u)?(e=r,b):void 0}),e},_.has=function(n,t){return n?sr.call(n,t):b},_.identity=Wt,_.indexOf=Pt,_.isArguments=ft,_.isArray=qr,_.isBoolean=function(n){return n===y||n===false||yr.call(n)==J},_.isDate=function(n){return n?typeof n=="object"&&yr.call(n)==K:b},_.isElement=function(n){return n?1===n.nodeType:b},_.isEmpty=function(n){var t=y;if(!n)return t;var r=yr.call(n),e=n.length;return r==H||r==Y||(Pr.argsClass?r==G:ft(n))||r==Q&&typeof e=="number"&&ht(n.splice)?!e:(Kr(n,function(){return t=b}),t)},_.isEqual=vt,_.isFinite=function(n){return Cr(n)&&!jr(parseFloat(n))},_.isFunction=ht,_.isNaN=function(n){return yt(n)&&n!=+n},_.isNull=function(n){return n===d},_.isNumber=yt,_.isObject=mt,_.isPlainObject=Mr,_.isRegExp=function(n){return!(!n||!nt[typeof n])&&yr.call(n)==X},_.isString=dt,_.isUndefined=function(n){return typeof n=="undefined"},_.lastIndexOf=function(n,t,r){var e=n?n.length:0;for(typeof r=="number"&&(e=(0>r?kr(0,e+r):xr(r,e-1))+1);e--;)if(n[e]===t)return e;return-1},_.mixin=Lt,_.noConflict=function(){return e._=ur,this},_.parseInt=Xr,_.random=function(n,t){n==d&&t==d&&(t=1),n=+n||0,t==d?(t=n,n=0):t=+t||0;var r=Er();return n%1||t%1?n+xr(r*(t-n+parseFloat("1e-"+((r+"").length-1))),t):n+cr(r*(t-n+1))},_.reduce=St,_.reduceRight=At,_.result=function(n,t){var r=n?n[t]:m;return ht(r)?n[t]():r},_.runInContext=h,_.size=function(n){var t=n?n.length:0;return typeof t=="number"?t:Rr(n).length},_.some=It,_.sortedIndex=Ft,_.template=function(n,t,r){var e=_.templateSettings;n||(n=""),r=Hr({},r,e);var u,a=Hr({},r.imports,e.imports),e=Rr(a),a=_t(a),o=0,l=r.interpolate||D,c="__p+='",l=Xt((r.escape||D).source+"|"+l.source+"|"+(l===z?N:D).source+"|"+(r.evaluate||D).source+"|$","g");n.replace(l,function(t,r,e,a,l,f){return e||(e=a),c+=n.slice(o,f).replace(T,i),r&&(c+="'+__e("+r+")+'"),l&&(u=y,c+="';"+l+";__p+='"),e&&(c+="'+((__t=("+e+"))==null?'':__t)+'"),o=f+t.length,t}),c+="';\n",l=r=r.variable,l||(r="obj",c="with("+r+"){"+c+"}"),c=(u?c.replace(S,""):c).replace(A,"$1").replace(I,"$1;"),c="function("+r+"){"+(l?"":r+"||("+r+"={});")+"var __t,__p='',__e=_.escape"+(u?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+c+"return __p}";try{var f=Mt(e,"return "+c).apply(m,a)}catch(p){throw p.source=c,p}return t?f(t):(f.source=c,f)},_.unescape=function(n){return n==d?"":Yt(n).replace(B,ct)},_.uniqueId=function(n){var t=++j;return Yt(n==d?"":n)+t},_.all=jt,_.any=It,_.detect=kt,_.findWhere=kt,_.foldl=St,_.foldr=At,_.include=Ct,_.inject=St,Kr(_,function(n,t){_.prototype[t]||(_.prototype[t]=function(){var t=[this.__wrapped__];return gr.apply(t,arguments),n.apply(_,t)})}),_.first=Nt,_.last=function(n,t,r){if(n){var e=0,u=n.length;if(typeof t!="number"&&t!=d){var a=u;for(t=_.createCallback(t,r);a--&&t(n[a],a,n);)e++}else if(e=t,e==d||r)return n[u-1];return v(n,kr(0,u-e))}},_.take=Nt,_.head=Nt,Kr(_,function(n,t){_.prototype[t]||(_.prototype[t]=function(t,r){var e=n(this.__wrapped__,t,r);return t==d||r&&typeof t!="function"?e:new C(e)})}),_.VERSION="1.3.1",_.prototype.toString=function(){return Yt(this.__wrapped__)},_.prototype.value=Gt,_.prototype.valueOf=Gt,Tr(["join","pop","shift"],function(n){var t=nr[n];_.prototype[n]=function(){return t.apply(this.__wrapped__,arguments)}}),Tr(["push","reverse","sort","unshift"],function(n){var t=nr[n];_.prototype[n]=function(){return t.apply(this.__wrapped__,arguments),this}}),Tr(["concat","slice","splice"],function(n){var t=nr[n];_.prototype[n]=function(){return new C(t.apply(this.__wrapped__,arguments))}}),Pr.spliceObjects||Tr(["pop","shift","splice"],function(n){var t=nr[n],r="splice"==n;_.prototype[n]=function(){var n=this.__wrapped__,e=t.apply(n,arguments);return 0===n.length&&delete n[0],r?new C(e):e}}),_}var m,y=!0,d=null,b=!1,_=[],C=[],j=0,w={},x=+new Date+"",O=75,E=40,S=/\b__p\+='';/g,A=/\b(__p\+=)''\+/g,I=/(__e\(.*?\)|\b__t\))\+'';/g,B=/&(?:amp|lt|gt|quot|#39);/g,N=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,P=/\w*$/,z=/<%=([\s\S]+?)%>/g,F=(F=/\bthis\b/)&&F.test(h)&&F,$=" \t\x0B\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000",q=RegExp("^["+$+"]*0+(?=.$)"),D=/($^)/,R=/[&<>"']/g,T=/['\n\r\t\u2028\u2029\\]/g,W="Array Boolean Date Error Function Math Number Object RegExp String _ attachEvent clearTimeout isFinite isNaN parseInt setImmediate setTimeout".split(" "),L="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),G="[object Arguments]",H="[object Array]",J="[object Boolean]",K="[object Date]",M="[object Error]",U="[object Function]",V="[object Number]",Q="[object Object]",X="[object RegExp]",Y="[object String]",Z={};Z[U]=b,Z[G]=Z[H]=Z[J]=Z[K]=Z[V]=Z[Q]=Z[X]=Z[Y]=y;var nt={"boolean":b,"function":y,object:y,number:b,string:b,undefined:b},tt={"\\":"\\","'":"'","\n":"n","\r":"r","\t":"t","\u2028":"u2028","\u2029":"u2029"},rt=nt[typeof exports]&&exports,et=nt[typeof module]&&module&&module.exports==rt&&module,ut=nt[typeof global]&&global;!ut||ut.global!==ut&&ut.window!==ut||(n=ut);var at=h();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(n._=at,define(function(){return at})):rt&&!rt.nodeType?et?(et.exports=at)._=at:rt._=at:n._=at}(this);var MVN_Controller=(function($,VVM){var domain="www.myvoicenation.com",undef;var MVN_Controller=function(){var me=this;me.version='MVN 2.1';me.onReady=function(obj){me.queue(obj,true);}
me.queue=function(obj,onReady){if(typeof obj==='function'){if(onReady||false){me.readyQueue=me.readyQueue||[];me.readyQueue.push(obj);VVM.debug.p('Added call to onReady');}else{me.queued=me.queued||[];me.queued.push(obj);VVM.debug.p('Added call to queue');}}}
me.clearQueue=function(onReady){var queue,name,i,callback;if(onReady||false){queue=me.readyQueue||[];name='onReady';}else{queue=me.queued||[];name='Queued';}
if(queue.length){while(queue.length>0){callback=queue.shift();setTimeout($.proxy(callback,null,$),0);}
if(onReady){if((me.readyQueue||[]).length){me.clearQueue(true);}else{delete me.readyQueue;}}else{if((me.queued||[]).length){me.clearQueue(false);}else{me.queue=me.onReady=function(obj){if(typeof obj==='function'){setTimeout(obj,0);}}}}
VVM.debug.p('Cleared '+name);}}
me.load=function(obj){$.each(obj||{},function(objName,objParams){VVM.debug.p('Loading '+objName);me[objName]=new objParams.component(me);if(me[objName].autoInit||false){try{me[objName].init(objParams.params||{});}catch(e){VVM.debug.error('unable to load '+objName,e);}}
if(!me.loaded||false){me.loaded=[];}
me.loaded.push(objName);VVM.debug.p('Loaded '+me[objName].version||objName);});}
me.unload=function(){$.each(me.loaded||[],function(){var name=this.toString();VVM.debug.p('Unloading '+me[name].version||name);if(name=='sso'&&MVN.sso){MVN.sso.destroy();}
delete MVN[name];});VVM.debug.p('Unloading '+me.version);if(MVN.params.$toolbar){$(MVN.params.$toolbar).remove();}
delete MVN;return false;}
me.queue(function(){VVM.debug.p('Loaded '+me.version)});}
MVN_Controller.prototype={toString:function(){return this.version;},init:function(params){var me=this;me.params=$.extend({cid:'mvn',sid:'8|24|',appId:false,authDomain:domain,apiAccess:null,toolbar:false,$toolbar:false,redirect:false,localPath:'/',ssoWindowName:'mvnSsoWin',load:{'omni':{component:Omni_Component,params:{}},'sso':{component:EasyXDM_Component,params:{}}}},params||{});me.params.assetDomain=domain;me.params.mediaDomain='media.myvoicenation.com';if(!me.params.toolbar&&!me.params.$toolbar){VVM.debug.p('No Toolbar');me.params.toolbar=me.params.$toolbar=false;}else{me.params.toolbar=me.params.$toolbar=$(me.params.toolbar||me.params.$toolbar);}
if(!me.params.appId){VVM.debug.error('No App Id');return me.unload();}
if(!me.params.redirect){var redirect=location.search.toLowerCase().split('redirect=');if(redirect.length>1){redirect=redirect.pop().split('&').shift();if(redirect!=''){me.params.redirect=(decodeURIComponent(redirect))?decodeURIComponent(redirect):redirect;}}}
me=$.extend(me,{init:function(){},handleResponse:me.params.handleResponse||function(response){var modalName=false;if(response||false){if(response.user&&response.user.id)
me.user=response.user;if(response.flash&&response.flash!="")
me.omni.showMessage(response.flash);if(response.newuser&&response.newuser==true){me.sso.getFlash(true);modalName='fields';response.action='refresh';me.coi=(response.coi&&response.coi==true)?true:false;}else if(window.conv&&response.anon&&response.anon==true){modalName='fields-anon';response.action='refresh';me.omni.actionSrc='lf';}else if(response.welcome){if(me.omni.Modals['fields'])
me.omni.Modals['fields'].hide();modalName='welcome';if(me.coi)
modalName+='-coi';response.action='refresh';}
if(response.action){switch(response.action){case'refresh':me.omni.refresh();if(modalName){if(!me.omni.Modals[modalName])
me.omni.buildModal(modalName);VVM.modals.hideAllButContainer(function(){me.omni.Modals[modalName].show();});}else{VVM.modals.hideAll();}
break;case'reload':if(me.omni.actionSrc=='lf'){VVM.setCookie('lfpost',true);}
if(response.status&&response.status=='success'&&me.params.redirect&&!((me.params.cid=='mvn'||me.params.cid=='mvn2'))){window.location=decodeURIComponent(me.params.redirect);}else{window.location.reload(true);}
break;case'redirect':window.location=me.params.redirect||response.url||((response.status&&response.status=='success')?'/'+((me.params.cid=='mvn')?'profile':'village')+'/settings/':'/');break;case'submit':break;case'canceled':VVM.modals.hideAll();break;case'error':VVM.modals.hideAll();break;}}}}});if(me.params.load||false){me.load(me.params.load);}
try{me.elements=new MVNElements_Component(me);me.elements.generate();}catch(e){VVM.debug.error(e.message||e);}}}
return MVN_Controller;}($,VVM));var Omni_Component=(function($,VVM){var undef;var Omni_Component=function(controller){var me=this;me.MVN=controller;me.version='Omni 1.0';me.autoInit=false;me.actionSrc='local';me.buildAction=function(action,params){if(params||false){$.each(params,function(k,v){action+='|'+k+'['+v+']';});}
return action;};me.getQueryParams=function(){var pairs=window.location.search.substr(1).split('&'),query={};if(pairs.length){$.each(pairs,function(){var p=this.split('=');if(p.length==2){query[p[0]]=decodeURIComponent(p[1].replace(/\+/g," "));}});}
return query;};me.buildTrack=function(action,params,strict){var pos=action.indexOf("->");if(pos===0){action="MVN"+action;}else if(pos==-1){action="MVN->"+action;}
action=[action,''];if(!(strict||false)){var defaults={cid:me.MVN.params.cid,sid:me.MVN.params.sid,src:me.actionSrc};var q=me.getQueryParams();if(q.utm_source)defaults.utms=q.utm_source;if(q.utm_medium)defaults.utmm=q.utm_medium;if(q.utm_campaign)defaults.utmc=q.utm_campaign;params=$.extend(defaults,params||{});}
if(params||false){action[1]='';$.each(params,function(k,v){action[1]+='|'+k+'['+v+']';});action[1]=action[1].substr(1);}
return action.join('|');};};Omni_Component.prototype={init:function(params){var me=this;me.$=$;me.params=$.extend({marketData:{bpb:{name:'Broward/Palm Beach New Times',shortname:'broward-palm-beach',domain:'browardpalmbeach.com'},dal:{name:'Dallas Observer',shortname:'dallas-fort-worth',domain:'dallasobserver.com'},den:{name:'Denver Westword',shortname:'denver-boulder',domain:'westword.com'},hou:{name:'Houston Press',shortname:'houston',domain:'houstonpress.com'},law:{name:'LA Weekly',shortname:'los-angeles',domain:'laweekly.com'},mia:{name:'Miami New Times',shortname:'miami',domain:'miaminewtimes.com'},min:{name:'Minneapolis City Pages',shortname:'minneapolis-st-paul',domain:'citypages.com'},nyv:{name:'New York Village Voice',shortname:'new-york',domain:'villagevoice.com'},ocw:{name:'OC Weekly',shortname:'orange-county',domain:'ocweekly.com'},phx:{name:'Phoenix New Times',shortname:'phoenix',domain:'phoenixnewtimes.com'},stl:{name:'St. Louis RFT',shortname:'st-louis',domain:'riverfronttimes.com'},san:{name:'SF Weekly',shortname:'san-francisco-bay-area',domain:'sfweekly.com'},places:{name:'Voice Places',shortname:'',domain:'voiceplaces.com'},mvn:{name:'My Voice Nation',shortname:'',domain:'myvoicenation.com'},mvn2:{name:'My Voice Nation',shortname:'',domain:'myvoicenation.com'},vdd:{name:'Voice Daily Deals',shortname:'',domain:'voicedailydeals.com'}}},params||{});_.each(me.params.marketData,function(market,id){market.id=id;me.params.marketData[id]=market;})
$.extend(me,{init:function(){},refCity:null,refCid:null,refURL:null,Modals:{},userMenuObj:false,removeSubscribe:false,defaultAvatar:(function(){var avatar;if(me.params.defaultAvatar){avatar=me.params.defaultAvatar;}else if(me.MVN.params.$toolbar){avatar=me.MVN.params.$toolbar.find('#omni-user-menu img').attr('src');}
return avatar||'';}()),avatar:function(){return((me.MVN.user&&me.MVN.user.avatar_asset)?me.mediaImage(me.MVN.user.avatar_asset):me.defaultAvatar);},mediaImage:function(asset,imgDef){if(!asset.match(/^https?:\/\//)){asset='http://'+me.MVN.params.mediaDomain+'/'+asset.replace('.t.','.'+(imgDef===undef?147:imgDef)+'.');}
return asset;},listen:function(){if(me.MVN.params.$toolbar){me.MVN.params.$toolbar.delegate('.omni-dropdown','click',me.omniDropdownToggle);if(me.MVN.params.authDomain=='derp.myvoicenation.com'){$('li.pub',me.MVN.params.$toolbar).show();}}
$(document.body).delegate('[data-omni-track]','click',function(){me.track($(this).data('omni-track'));}).delegate('[data-omni-action]','click',function(){var $this=$(this),additionalParams={},paramExp=/^data-omni-(.*)$/;me.actionSrc=$this.data('omni-src')||'local';me.actionSrcDesc=$this.data('omni-src-desc')||null;_.each($this.get(0).attributes,function(attr){var match=paramExp.exec(attr.name);if(match&&match[1]!=='action'){additionalParams[match[1]]=attr.value;}})
me.action($this.data('omni-action'),undef,undef,additionalParams);}).delegate('[data-omni-user]','mouseenter mouseleave',function(e){var $me=$(this);if($me.is(':visible')||$('img',$me).is(':visible')){if(e.type=='mouseenter'){$me.stop(true);if(me.userMenuObj&&me.userMenuObj.is(':visible')&&me.userMenuObj.data('elIndex')==$('[data-omni-user]').index(this)){me.userMenuObj.stop().fadeTo(200,1);}else{$me.delay(600).queue(function(){me.userMenu($me,true);});}}else{var $target=$(e.toElement||e.relatedTarget);if(!$target.hasClass('vvmUserMenu')&&!$target.parent().hasClass('vvmUserMenu')){me.userMenu($me.stop(true),false);}}}});(function(){var tagNames=['like','article-signup','follow'],tags=[],i=0;for(;i<tagNames.length;i++){tags=tags.concat(VVM.toArray(document.getElementsByTagName('mvn:'+tagNames[i],0)));}
$(tags).each(function(){var element=this,params={};$.each(element.attributes,function(){params[this.name.toLowerCase()]=(this.name.toLowerCase()=='message')?this.value:this.value.toLowerCase();});if(!params.cid)
params.cid=me.MVN.params.cid;if(!params.sid)
params.sid=me.MVN.params.sid;if(params.cid=='places')
params.mid=VVM.getCookie('vpmid');me.morph(element,params);});})();me.refreshLikes();me.refreshFollows();$(document.body).delegate('.mvnFollowButton','click mouseenter mouseleave',function(e){var $el=$(this);if(!$el.hasClass('loading')){if(e.type=='click'){if(me.morphParams.follow_method){var uid=$el.data('user');var followers=me.morphParams.following||{};var follow=!followers[uid];if(me.MVN.user){$el.removeClass('following').addClass('loading').text('');me.MVN.sso.toggleFollow(uid,follow,function(o){$el.removeClass('loading');if(o&&o.status=='success'){if(follow){followers[uid]=true;}else{delete followers[uid];}}
me.refreshFollows(uid);});}else{me.actionSrc='follow';me.action('login');}}}else if($el.hasClass('following')&&$el.data('size')=='small'){$el.text((e.type=='mouseenter')?'Unfollow':'Following');}}});$('<img/>')[0].src='http://assets.myvoicenation.com/img/modal_spin_black.gif';},morphParams:[],morph:function(element,params,run){var $el=$(element),el=$el[0];params=params||{};switch((params.tag&&params.tag.toLowerCase())||el.tagName.substr(4).toLowerCase()){case'article-signup':var style={};var themeColor="black";var slideShowLoaded=false;switch(params.size||'small'){case'large':style.width=550;break;case'slideshow':style.width='100%';style.display='none';style.height='126px';slideShowLoaded=true;if(getCookie('vvms_blackout')==="true"){themeColor="white";}
break;default:params.size='small';style.width=250;break;}
$el.replaceWith($('<iframe frameBorder="0" class="omniWidget-article-signup-'+params.size+'" name="omniWidget-'+Math.random().toString().substr(2)+'"/>').attr('src','http://'+me.MVN.params.authDomain+'/widget/article/'+params.cid+'/'+(params.section||0)+'/'+(params.type||'email')+'/'+params.size+'/'+themeColor+'/').css(style));if(slideShowLoaded){window.slideShowSubscribeLoaded();}
break;case'like':params.size=(params.size&&(params.size=='small')||(params.size=='large'))?params.size:'small';if(!me.morphParams['like_preload_'+params.size]){$.each(['/img/likebutton-'+params.size+'.png','/img/likebutton-hover-'+params.size+'.png','/img/likebutton-active-'+params.size+'.png','/img/likebutton-active-hover-'+params.size+'.png'],function(){$('<img/>')[0].src='//'+me.MVN.params.assetDomain+this.toString();});me.morphParams['like_preload_'+params.size]=true;}
if(!me.morphParams.like){me.morphParams.like=[];}
me.morphParams.like.push({'element':$el,'params':params});if(!me.morphParams.like_method){me.morphParams.like_method=function($el,params,obj){if(obj&&obj.status=='success'){$el.replaceWith($('<div class="mvnLikeWidget '+params.size+'"/>').append($('<span class="mvnLikeWidgetCount"/>').text(obj.likes||0)).append($('<span class="mvnLikeWidgetButton'+(obj.liked?' active':'')+'"/>').data('liked',obj.liked).data('running',false).data('params',params).click(function(){if(me.MVN.user){if(!$(this).data('running')){var liked=$(this).data('liked');var cnt=_.parseInt($(this).prev('.mvnLikeWidgetCount').text())+(liked?-1:1);var btn=$(this).add($('.mvnLikeWidgetButton').filter(function(){return($(this).data('params').location==params.location&&$(this).data('params').event==params.event);})).data('running',true);btn.toggleClass('active',!liked).prev('.mvnLikeWidgetCount').text(cnt);me.MVN.sso.like($.extend({'like':!liked},params),function(){btn.data('liked',!liked).data('running',false);});}}else{me.actionSrc='like';me.action('login');}})));}else{$el.attr('status',(obj&&obj.error)?obj.error:'error');}};}
if(run){me.MVN.sso.like({0:params},function(data){if(data&&data[0]){me.morphParams.like_method($el,params,data[0]);}});}
break;case'follow':if(params.user){var uid=params.user;params.size=params.size||'small';if(el.tagName.toLowerCase()!='button'){var $newEl=$('<button/>');$el.replaceWith($newEl);$el=$newEl;}
$el.attr('class','mvnFollowButton '+params.size+' loading');$el.data('user',uid).data('size',params.size);if(!me.morphParams.follow){me.morphParams.follow={};}
if(!me.morphParams.follow[uid]){me.morphParams.follow[uid]={$elements:$el};}else{me.morphParams.follow[uid].$elements=me.morphParams.follow[uid].$elements.add($el);}
if(!me.morphParams.follow_method){me.morphParams.follow_method=function($elements){$elements.each(function(){var $el=$(this);var params={user:$el.data('user'),size:$el.data('size')};if($el.is(':visible')){var followers=me.morphParams.following||{};$el.attr('class','mvnFollowButton '+params.size);if(followers[params.user]){$el.addClass('following');if(params.size=='small')
$el.text($el.is('.hover')?'Unfollow':'Following');}else if(params.size=='small'){$el.text('Follow');}}});};}
if(run){me.refreshFollows(uid);}}
break;}},refreshLikes:function(){if(me.morphParams.like&&me.morphParams.like_method){var likeObj={},i;$.each(me.morphParams.like,function(i){likeObj[i]=me.morphParams.like[i].params;});me.MVN.sso.like(likeObj,function(data){if(data){var i;$.each(data,function(i){me.morphParams.like_method(me.morphParams.like[i].element,me.morphParams.like[i].params,data[i]);});}});}},refreshFollows:function(uid){if(me.morphParams.follow&&me.morphParams.follow_method){if(me.MVN.user&&!me.morphParams.following){me.MVN.sso.getFollowing(function(following){if(following){me.morphParams.following=following;}else{VVM.debug.p('Failed to populate following');me.morphParams.following={};}
me.refreshFollows(uid||false);});}else{if(!me.morphParams.following){me.morphParams.following={};}
if(uid){if(me.morphParams.follow[uid]){me.morphParams.follow_method(me.morphParams.follow[uid].$elements);}}else{$.each(me.morphParams.follow,function(uid,data){me.morphParams.follow_method(data.$elements);});}}}},userMenu:function($el,show){var prefix='vvmUserMenu';if(show){var id=$el.data('omni-user'),name=$el.data('omni-username'),photo=$el.data('omni-userphoto');if(id&&name){if(!me.userMenuObj){me.userMenuObj=$('<div>').addClass(prefix).html($('<span>').append($('<a>').addClass('userAvatar').append('<img>')).append($('<h4>')).append($('<a>').addClass('button').text('View Profile').attr('title','View Profile').attr('target','_blank')).append($('<button>').attr('title','Follow/Unfollow')));me.userMenuObj.find('button').bind('mouseenter mouseleave',function(ev){$(this).toggleClass('hover',ev.type==='mouseenter');});}
me.userMenuObj.data('elIndex',$('[data-omni-user]').index($el));var $content=$('span:first',me.userMenuObj);$('button',$content).text('').attr('class','mvnFollowButton small loading').show();if(photo){$('img',$content).show().attr({title:name,alt:name,src:me.mediaImage(photo,13)});}else{$('img',$content).hide();}
$('h4',$content).attr('title',name).html(VVM.truncate(name,13));$('a',$content).attr('href','//www.myvoicenation.com/'+name).removeClass('long');if(!me.MVN.user||me.MVN.user.id==id){$('a.button',$content).addClass('long');$('button',$content).attr('class','').hide();}
me.userMenuObj.unbind('mouseleave').bind('mouseleave',function(){me.userMenu($el,false)}).appendTo('body');var $img=($el.find('img').length==1)?$el.find('img'):false;if(!$.fn.setMenuTo){$.fn.setMenuTo=function($el){var $me=$(this);var newClass=prefix;var offset=$el.offset();var leftEdge=$(window).scrollLeft();var rightEdge=leftEdge+$(window).width();offset.left+=$el.outerWidth()/2-$me.outerWidth()/2;offset.top-=$me.outerHeight();offset.opacity=1;if(offset.left+$me.outerWidth()>rightEdge){$('span',$me).attr('class','right');offset.left=(rightEdge-$me.outerWidth());}else if(offset.left<leftEdge){$('span',$me).attr('class','left');offset.left=leftEdge;}else{$('span',$me).removeAttr('class');}
if(offset.top<$(window).scrollTop()){newClass+=' bottom';offset.top+=$me.outerHeight()+$el.outerHeight();}
return $me.css(offset).attr('class',newClass);};}
$(window).bind('resize scroll',function(){if(me.userMenuObj.is(':visible')){me.userMenuObj.setMenuTo($img||$el);}});function showUserMenu(){me.userMenuObj.setMenuTo($img||$el).stop().fadeTo(200,1,function(){if(me.MVN.user&&me.MVN.user.id!=id){me.morph($('button',$content),{user:id,tag:'follow',size:'small'},true);}});}
if(photo){var img=new Image();$(img).load(showUserMenu);img.src=$('img',$content).attr('src');}else{showUserMenu();}}}else if(me.userMenuObj){me.userMenuObj.stop().fadeOut(200,function(){$(this).detach()});}},track:function(track,nonInteractive){if(typeof track=='string'&&(track=$.trim(track))){var pos=track.indexOf('->');var section="MVN";if(pos==0){track=track.substr(2);}else if(pos>0){section=track.substr(0,pos);track=track.substr(pos+2);}
pos=track.indexOf('|');if(typeof _gaq=='object'){track=(pos>0&&track.substr(pos+1).length)?['_trackEvent',section,$.trim(track.substr(0,pos)),$.trim(track.substr(pos+1)),undef,nonInteractive]:['_trackEvent',section,track,undef,undef,nonInteractive]
if(VVM.debug.level()=='production'){(window._gaq=window._gaq||[]).push(track);}else{VVM.debug.p(section+' _trackEvent Called: '+track[2]+((track[3])?' - '+track[3]:''));}}
else if(typeof ga=='function'){track=(pos>0&&track.substr(pos+1).length)?{'hitType':'event','eventCategory':section,'eventAction':$.trim(track.substr(0,pos)),'eventLabel':$.trim(track.substr(pos+1)),'nonInteraction':nonInteractive}:{'hitType':'event','eventCategory':section,'eventAction':track,'nonInteraction':nonInteractive};if(VVM.debug.level()=='production'){ga('send',track);}else{VVM.debug.p('ga_send Called: '+track);}}}},action:function(action,external,callback,params){var external=external||false,prev='';if(typeof params!=='object'){params={};}
$.each(action.split('|').slice(1),function(){var v=this.toString();if(v.substr(v.length-1)==']'){v=v.substr(0,v.length-1);}
var q=v.split('[');if(q.length==2){prev=q[0];params[q[0]]=q[1];}else{params[prev]+='|'+v;}});if(params.redirect){MVN.params.redirect=params.redirect;}
var action=action.split('|').slice(0,1).toString();var modalName=action;switch(action){case'pubon':if(me.MVN.user&&me.MVN.user.publish&&me.MVN.user.publish=="0"){me.showMessage('Enabling Facebook Publish','loading',function(){me.social('facebook','activity',external);});}
break;case'puboff':if(me.MVN.user&&me.MVN.user.publish&&me.MVN.user.publish=="1"){me.showMessage('Disabling Facebook Publish','loading',function(){me.MVN.sso.disablePublish(function(){if(me.MVN.params.$toolbar){$('div.switch > div',me.MVN.params.$toolbar).removeClass('active');$('div#switchOff').addClass('active');}
me.MVN.user.publish="0";me.hideMessage();});});}
break;case'authoff':if(me.MVN.user){me.showMessage('Removing '+params.network.charAt(0).toUpperCase()+params.network.slice(1)+' Association','loading',function(){me.MVN.sso.disableAuth(params.network,function(o){if(o&&o.status=='success'){if(params.network=='facebook'){if(me.MVN.params.$toolbar){$('div.switch > div',me.MVN.params.$toolbar).removeClass('active');$('div#switchOff').addClass('active');}
me.MVN.user.publish="0";}}
me.hideMessage((callback)?function(){callback(o)}:false);});});}
break;case'post':if(me.MVN.user){me.showMessage('Enabling Facebook Post','loading');me.social('facebook','write',external,callback);}
break;case'join-responsive':action='join';params.responsive=true;case'join':if(!external&&me.MVN.setSid){popup=window.open('http://'+me.MVN.params.authDomain+'/sso/attach/?sid='+me.MVN.setSid,'','width=100,height=100');popup.blur();window.focus();me.MVN.setSid=false;}
if(me.Modals[action])
me.Modals[action].destroy();me.buildModal(action,params);if(me.Modals.login){me.Modals.login.hide(function(){me.Modals[action].show()});}else{me.Modals[action].show();}
break;case'login-responsive':action='login';params.responsive=true;case'login':if(!external&&me.MVN.setSid){popup=window.open('http://'+me.MVN.params.authDomain+'/sso/attach/?sid='+me.MVN.setSid,'','width=100,height=100');popup.blur();window.focus();me.MVN.setSid=false;}
if(me.Modals[action]){me.Modals[action].destroy();}
me.buildModal(action,params);if(me.Modals.join){me.Modals.join.hide(function(){me.Modals[action].show()});}else{me.Modals[action].show();}
break;case'saveEvent':if(me.Modals[action])
me.Modals[action].destroy();me.buildModal(action,params);if(me.Modals.saveEvent){me.Modals.saveEvent.hide(function(){me.Modals[action].show()});}else{me.Modals[action].show();}
break;case'logout':me.track(me.buildTrack('Logout',{cid:me.MVN.params.cid,sid:(params.sid||me.MVN.params.sid),src:me.actionSrc}));me.showMessage('Logging Out','loading',function(){me.MVN.sso.logout(function(){VVM.delCookie('livefyre_token','/');VVM.delCookie('MVN[anon]','/');VVM.delCookie('MVN[sid]','/');VVM.clearLocalCache(new RegExp(/^MVN:/));MVN.user=null;window.location.reload(true);});});break;case'facebook':case'twitter':case'yahoo':case'google':if(me.MVN.ssoWindow)
me.MVN.ssoWindow.close();me.showMessage('Connecting to '+action.charAt(0).toUpperCase()+action.slice(1),'loading');me.social(me.buildAction(action,params),false,external,callback);break;case'welcome-close':case'welcome-coi-close':modalName=action.replace('-close','');if(me.Modals[modalName])
me.Modals[modalName].hide();me.MVN.handleResponse({'action':'reload'});break;case'welcome-profile':case'welcome-coi-profile':modalName=action.replace('-profile','');if(me.Modals[modalName])
me.Modals[modalName].hide();window.open('http://'+me.MVN.params.authDomain+'/profile/settings/','_newtab'+Math.random().toString().substr(2));me.MVN.handleResponse({'action':'reload'});break;case'welcome-newsletters':case'welcome-coi-newsletters':case'welcome-txtalerts':case'welcome-coi-txtalerts':modalName=action.match(/(welcome(?:-coi)?)-(\w+)/);if(modalName){var dest=modalName.pop();modalName=modalName.shift();if(me.Modals[modalName])
me.Modals[modalName].hide();window.open('http://'+me.MVN.params.authDomain+'/profile/'+(dest==='txtalerts'?'mobile':dest)+'/'+me.MVN.params.cid+'/'+
(dest==='txtalerts'&&params.txtalert?'?txtalert='+params.txtalert:''),'_newtab'+Math.random().toString().substr(2));me.MVN.handleResponse({'action':'reload'});}else{VVM.error('unable to parse welcome-action');}
break;case'flag':me.action('flag-close');me.buildModal('flag',params);me.Modals[action+'-'+params.type].show();break;case'flag-close':$.each(['flag-page','flag-photo','flag-review'],function(){if(me.Modals[this]){me.Modals[this].destroy();delete me.Modals[this];}});break;case'cookies':if(!me.Modals[action])
me.buildModal(action);me.Modals[action].show();break;}},social:function(network,perms,external,callback){var desktopViewCookie=false;if(VVM.getCookie('mobileStandardView')=="yes"){desktopViewCookie=true;}
external=external||false;if(me.MVN.ssoWindow)
me.MVN.ssoWindow.close();var winArr=['status=0','toolbar=0','location=0','menubar=0','resizable=0','scrollbars=1'],winW,winH;var params={},prev='';$.each(network.split('|').slice(1),function(){var v=this.toString();if(v.substr(v.length-1)==']'){v=v.substr(0,v.length-1);}
var q=v.split('[');if(q.length==2){prev=q[0];params[q[0]]=q[1];}else{params[prev]+='|'+v;}});network=network.split('|').slice(0,1).toString();switch(network){case'yahoo':winW=500;winH=525
break;case'google':winW=875;winH=500;break;case'twitter':winW=620;winH=675;break;case'facebook':winW=640;winH=350;break;default:return;}
winArr.push('width='+winW,'height='+winH);if(!external){if(me.MVN.setSid){popupUrl='http://'+me.MVN.params.authDomain+'/sso/attach/?sid='+me.MVN.setSid+'&social='+network;}else{popupUrl='http://'+me.MVN.params.authDomain+'/done.html';}
me.MVN.ssoWindow=window.open(popupUrl,me.MVN.params.ssoWindowName,winArr);me.MVN.ssoWindow.blur();if(navigator.userAgent.match(/iPad/i)!==null){window.focus();}}
var popup=new easyXDM.Rpc($.extend({},me.MVN.sso.params.XD,{remote:'http://'+me.MVN.params.authDomain+'/sso/social/?appId='+me.MVN.params.appId+'&desktopViewCookie='+desktopViewCookie}),{remote:{openWindow:{}},local:{unload:function(o){if(o&&o.error){VVM.debug.error(o.error);}
popup.destroy();me.MVN.unload();},cookies:function(){popup.destroy();VVM.modals.hideAllButContainer(function(){me.action('cookies');});},socialReturn:function(o){popup.destroy();if(callback){callback(o);}else{me.MVN.handleResponse(o);}}}});popup.openWindow('http://'+me.MVN.params.authDomain+'/sso/social/'+network+'/?sid='+(params.sid||me.MVN.params.sid)+'&cid='+me.MVN.params.cid+((perms||false)?'&type='+perms:'')+'&desktopViewCookie='+desktopViewCookie,me.MVN.params.ssoWindowName,winArr);me.track(me.buildTrack('Social',{cid:me.MVN.params.cid,sid:(params.sid||me.MVN.params.sid),src:me.actionSrc,type:((perms||false)?perms:'default'),network:network}));},addEventWithHash:function(){if(window.location.hash.match(/add-to-calendar$/i)){me.MVN.params.showLoginMessageForEvent=true;if($('.event-button').length==1){$('.event-button').click();}}},buildModal:function(action,params){var modal=false,modalDefaults={autoOpen:false,autoHide:true,theme:'omni',content:'<iframe frameBorder="0" src="http://'+me.MVN.params.authDomain+'/sso/modal/'+action+'/?cid='+me.MVN.params.cid+'"/>',css:{width:500}},paramStr='',query={};params=params||{};$.each(['auto_subs','skip_default_subs'],function(i,prop){if(!params.hasOwnProperty(prop)&&me.MVN.params.hasOwnProperty(prop))
{params[prop]=me.MVN.params[prop];}});switch(action){case'notify':modal={autoOpen:false,autoHide:false,closeBox:false,loading:true,css:{width:80,height:80}}
break;case'cookies':modal=modalDefaults;modal.css.width=300;modal.content=$('<div id="modal-cookies"/>').append($('<p/>').html('Cookies are required to log in to My Voice Nation. Please enable cookies in your browser. For more information on cookie requirements, please click the button below.')).append($('<p/>').append($('<a href="/about/cookies/" alt="" title="Learn how to enable Cookies"><img title="Learn how to enable Cookies" src="//'+me.MVN.params.assetDomain+'/img/mvn/button-mvn-cookies.png"/></a>')));break;case'welcome':case'welcome-coi':var msg='Success!';if(action=='welcome-coi'){msg+='<br/>Check for an email to verify your account!';}
msg+='<hr style="margin-bottom:10px;"/><B>View Your Account To:</B><ul style="font-size:12px;margin-top:5px;font-weight:bold;list-style:disc inside;"><li>Update Your Profile</li><li>Select Newsletters</li></ul>';modal=modalDefaults;var actionBtn,accountButton;switch(me.actionSrc){case'lf':actionBtn=$('<img data-omni-action="'+action+'-close" title="Continue to Comment" src="//'+me.MVN.params.assetDomain+'/img/mvn/button-mvn-comment.png"/>');break;case'fs':actionBtn=$('<img data-omni-action="'+action+'-close" title="Continue to Contest" src="//'+me.MVN.params.assetDomain+'/img/mvn/button-mvn-contest.png"/>');break;default:actionBtn=$('<img data-omni-action="'+action+'-close" title="Go Back to Page" src="//'+me.MVN.params.assetDomain+'/img/mvn/button-mvn-back.png"/>');break;}
switch(me.actionSrc){case'subscribe':accountButton=$('<img data-omni-action="'+action+'-newsletters" title="Go to Profile" src="//'+me.MVN.params.assetDomain+'/img/mvn/button-mvn-account.png"/>');break;case'subtxtalert':accountButton=$('<img data-omni-action="'+action+'-txtalerts'+(me.actionSrcDesc?'|txtalert['+me.actionSrcDesc+']':'')+'" '+'title="Go to Profile" src="//'+me.MVN.params.assetDomain+'/img/mvn/button-mvn-account.png"/>');break;default:accountButton=$('<img data-omni-action="'+action+'-profile" title="Go to Profile" src="//'+me.MVN.params.assetDomain+'/img/mvn/button-mvn-account.png"/>');break;}
modal.content=$('<div id="modal-welcome"/>').append($('<p/>').html(msg)).append($('<p/>').append(accountButton).append(actionBtn));modal.closeObj={content:'<span class="omni-icon-close"></span>',callback:function(){me.action(action+'-close');}}
me.track(me.buildTrack('Registration Complete',{cid:me.MVN.params.cid,sid:(params.sid||me.MVN.params.sid),src:me.actionSrc,coi:((action=='welcome-coi')?'true':'false')}));break;case'fields':modal={autoOpen:false,autoHide:false,closeBox:false,css:{width:420,height:200}}
modal.iframe='http://'+me.MVN.params.authDomain+'/sso/modal/fields-v2/?cid='+me.MVN.params.cid;me.track(me.buildTrack('Fields Modal',{cid:me.MVN.params.cid,sid:(params.sid||me.MVN.params.sid),src:me.actionSrc}));break;case'fields-anon':modal={autoOpen:false,autoHide:true,css:{width:420,height:130}}
modal.iframe='http://'+me.MVN.params.authDomain+'/sso/modal/fields-v2/?cid='+me.MVN.params.cid+'&anon=true';me.track(me.buildTrack('Anon Fields Modal',{cid:me.MVN.params.cid,sid:(params.sid||me.MVN.params.sid),src:me.actionSrc}));break;case'join':modal=modalDefaults;if(params.responsive){var view='join-responsive';if(window.device=='mobile'){modal.css.width=320;modal.css.height=486;}else{modal.css.width=610;modal.css.height=(params.slider&&params.slider==false)?378:535;}}else{var view='join-v2';modal.css.width=610;modal.css.height=(params.slider&&params.slider==false)?242:522;}
modal.iframe='http://'+me.MVN.params.authDomain+'/sso/modal/'+view+'/?'+$.param({cid:me.MVN.params.cid,sid:params.sid||me.MVN.params.sid,anon:(me.actionSrc=='lf'||(params.anon&&params.anon=="1"))?'true':'false',slider:(params.slider&&params.slider==false)?'0':'1',skip_default_subs:params.skip_default_subs||"false",auto_subs:params.auto_subs||undef,slider_style:params.slider_style||undef});me.track(me.buildTrack('Register Modal',{cid:me.MVN.params.cid,sid:(params.sid||me.MVN.params.sid),src:me.actionSrc}));break;case'login':modal=modalDefaults;if(params.responsive){var view='login-responsive';if(window.device=='mobile'){modal.css.width=320;modal.css.height=360;}else{modal.css.width=470;modal.css.height=292;}}else{var view='login-v2';modal.css.width=490;modal.css.height=339;}
var showLoginMessageEvent=false;if(typeof(me.MVN.params.showLoginMessageForEvent)!=="undefined"){showLoginMessageEvent=true;}
modal.iframe='http://'+me.MVN.params.authDomain+'/sso/modal/'+view+'/?'+$.param({cid:me.MVN.params.cid,sid:(params.sid||me.MVN.params.sid),anon:(me.actionSrc=='lf'||(params.anon&&params.anon=="1"))?'true':'false',slider:(params.slider&&params.slider==false)?'0':'1',showLoginMessage:showLoginMessageEvent,});me.track(me.buildTrack('Log In Modal',{cid:me.MVN.params.cid,sid:(params.sid||me.MVN.params.sid),src:me.actionSrc}));break;case'saveEvent':modal=modalDefaults;modal.css.width=518;modal.css.height=294;var sentMarket;if(typeof(MVN.omni.sentMarketMVN)!='undefined'){sentMarket=MVN.omni.sentMarketMVN;MVN.omni.sentMarketMVN=undefined;}else{if(typeof(market)!='undefined'){sentMarket=market.Cities.CityID;}else{sentMarket=MVN.omni.currentMarket.id;}}
modal.iframe='http://'+me.MVN.params.authDomain+'/sso/modal/calendar/?'+$.param({eventId:params.eventId,justSaved:params.justSaved,cid:sentMarket,sid:me.params.sid});break;case'flag':action+='-'+params.type;paramStr=$.param({cid:me.MVN.params.cid,type:params.type,ref:params.ref,theme:params.theme});modal={autoOpen:false,autoHide:true,theme:params.theme||'light',closeBox:false,iframe:'http://'+me.MVN.params.authDomain+'/widget/flag/?'+paramStr,css:{width:450,height:428}}
break;case'feedback':modal={autoOpen:true,autoHide:true,closeBox:true,iframe:'http://'+me.MVN.params.authDomain+'/about/feedback/?'+$.param({type:params.type}),css:{width:450,height:440}}
break;case'friends':modal={autoOpen:true,autoHide:true,closeBox:true,content:'<div id="friends-modal"><ul></ul></div>',css:{width:600,height:550}}
break;case'txtalerts':modal={autoOpen:true,autoHide:true,closeBox:true,content:'<iframe frameBorder="0" src="http://'+me.MVN.params.authDomain+'/sso/txtalerts/"/>',css:{width:490,height:275},events:{subscribed:params.subscribed}}
break;case'subscribe':case'subscribe-responsive':if('string'===typeof orig_OAS_query){var query=orig_OAS_query;}else if('string'===typeof VMG.Ads.query){var query=VMG.Ads.query;}else{VVM.debug.p('OAS_query required for subscribe modal');return;}
var host=location.hostname.split('.');host.shift();host=host.join('.');var section=null,e,decode=function(str){return decodeURIComponent(str.replace(decodeRE," "));},re=/([^&=]+)=?([^&]*)/g;while(section===null&&(e=re.exec(query))){if(e[1]==='Category'){section=e[2];break;}}
modal=modalDefaults;if(action=='subscribe-responsive'){if(window.device=='mobile'){modal.css.width=310;modal.css.height=379;}else{modal.css.width=420;modal.css.height=439;}}else{modal.css.width=400;modal.css.height=299;}
modal.closeObj={content:'<i class="omni-icon-close"></i>',callback:function(){me.Modals.subscribe.params.closeObj.callback=function(){};VVM.setCookie('submodal','-1',3,null,host);me.MVN.omni.track('SubscribeModal->Click|CloseXButton',true);me.Modals.subscribe.hide();}};modal.closeObj.originalCallback=modal.closeObj.callback;modal.events={loading:function(){me.Modals.subscribe.params.closeObj.callback=function(){};},error:function(evnt,params){me.Modals.subscribe.params.closeObj.callback=modal.closeObj.originalCallback;},subscribed:function(evnt,params){me.MVN.omni.track('SubscribeModal->Click|Subscribed',true);VVM.setCookie('submodal','-1',null,null,host);me.Modals.subscribe.hide(function(){me.showMessage('Thank you for subscribing.<br>'+(params.coi?'Please check your email for a link to confirm your subscription.':'Tell us more! &mdash; <a class="view-profile" href="http://www.myvoicenation.com/profile/settings/">View Profile</a>'),function(modal){if(params.new_user){modal.params.closeObj.callback=function(){modal.hide();window.location.reload();};}})},false);},nothanks:function(evnt){me.MVN.omni.track('SubscribeModal->Click|NoThanks',true);VVM.setCookie('submodal','-1',null,null,host);me.Modals.subscribe.hide();},remindme:function(evnt){me.MVN.omni.track('SubscribeModal->Click|RemindMeLater',true);VVM.setCookie('submodal','-1',1,null,host);me.Modals.subscribe.hide();}}
if(action=='subscribe-responsive'){modal.content='<iframe frameBorder="0" src="http://'+me.MVN.params.authDomain+'/widget/subscribe/'+me.MVN.params.cid+'/'+section+'/responsive/" />';}else{modal.content='<iframe frameBorder="0" src="http://'+me.MVN.params.authDomain+'/widget/subscribe/'+me.MVN.params.cid+'/'+section+'/"/>';}
action='subscribe';break;}
if(modal){me.Modals[action]=new VVM.modal(modal);}},showMessage:function(txt,type,callback){var testModal,testText,roundUp;if(arguments.length==1&&typeof txt=='function'){callback=txt;txt=type=false;}else if(arguments.length==2&&typeof type=='function'){callback=type;type=false;}
if("loading|alert|message".indexOf(type||false)==-1)
type='message';if(!me.Modals.notify)
me.buildModal('notify');if(txt||false){me.Modals.notify.setContent('<span class="modal_'+type+' message"><p>'+txt+'</p></span>');testModal=$(me.Modals.notify.getOuterHTML()).css({'width':'auto','height':'auto','position':'absolute','top':-10000,'display':'block'}).appendTo(document.body);testContent=testModal.find('.message');if(window.getComputedStyle){roundUp=Math.ceil(parseFloat(window.getComputedStyle(testContent.get(0)).width))>testContent.width()?1:0;}
me.Modals.notify.updateCSS({width:testContent.outerWidth(true,true)+roundUp+20,height:testContent.outerHeight(true,true)+roundUp});testModal.remove();testModal=testContent=null;}else{me.Modals.notify.setContent('<span class="modal_'+type+'"></span>');me.Modals.notify.updateCSS({width:'auto'});}
if(type=='message'){me.Modals.notify.setCloseObj(true);me.Modals.notify.params.autoHide=true;}else{me.Modals.notify.setCloseObj(false);me.Modals.notify.params.autoHide=false;}
me.Modals.notify.show(function(){if('function'===typeof callback){callback.call(this,me.Modals.notify);}});},hideMessage:function(callback){if(me.Modals.notify){me.Modals.notify.hide(callback);}},closeSubscribe:function(slideUp){me.removeSubscribe=true;if(slideUp){$('.omniWidget-article-signup-slideshow').slideUp();}},omniDropdownToggle:function(ev){if(ev&&!$(ev.target).is('[data-omni-action]')){ev.stopImmediatePropagation();}
var $this=$(this),active=!$this.hasClass('active');function doToggle($el,active){var active=$el.toggleClass('active',active).hasClass('active');$el.find('[data-active-class]').each(function(){var $this=$(this),origClass=$this.data('orig-class'),activeClass=$this.data('active-class');if(origClass===undef){origClass=_.find($this.attr('class').split(' '),function(cls){return!!cls.match(/^omni\-icon/);})
$this.data('orig-class',origClass);}
$this.toggleClass(origClass,!active).toggleClass($this.data('active-class'),active);});}
me.MVN.params.$toolbar.find('.omni-dropdown.active').not(this).each(function(){doToggle($(this));})
doToggle($this,active);if(active){$('html, body').delegate(':not(.omni-dropdown, .omni-dropdown *)','click.omni-dropdown',function(){doToggle($this,false);$('html, body').unbind('.omni-dropdown')})}else{$('html, body').undelegate('.omni-dropdown')}},toolbarTemplate:_.template($('#omni-content-template').detach().html()),refresh:function(){if(me.MVN.params.$toolbar){me.MVN.params.$toolbar.attr('class',me.currentMarket?me.currentMarket.id:'no-market').find('#omni-content').html(me.toolbarTemplate({market:me.currentMarket||false,referrer:me.refCity||false,user:MVN.user||false}))
if(me.MVN.user&&me.avatar()){me.MVN.params.$toolbar.find('#omni-user .omni-icon-mvn').css({'background-image':'url('+me.avatar()+')'});}}},checkReferrer:function(){function getDomain(url){var dom=url&&url.match(/https?:\/\/(.+\.com)/);return dom?dom[1]:null;}
function setReferrer(ref,back){if(back){VVM.setCookie('referrer',back);}else{VVM.delCookie('referrer');}
ref.url=location.protocol+"//www."+ref.domain;ref.back=back||ref.url;ref.direct=!!back;me.refCity=_.clone(ref);me.refCid=me.refCity.id;me.refUrl=me.refCity.url;}
function marketFromUrl(url){var refDomain=getDomain(url);if(refDomain){return _.find(me.params.marketData,function(market){if(refDomain==market.domain||_.contains(refDomain,market.domain)||_.contains(refDomain,'.'+market.id+'.')){return true;}})}}
var ref;if((ref=marketFromUrl(document.referrer))&&ref.id!==me.currentMarket.id){setReferrer(ref,document.referrer);}
else if(ref=marketFromUrl(VVM.getCookie('referrer'))){setReferrer(ref,VVM.getCookie('referrer'));}
if(!ref){if(_.has(me.params.marketData,VVM.getCookie('vpCityId'))){setReferrer(me.params.marketData[VVM.getCookie('vpCityId')]);}}}});me.currentMarket=_.find(me.params.marketData,{id:me.MVN.params.cid});try{me.listen();if(me.MVN.params.$toolbar){if(me.currentMarket&&me.currentMarket.id==='places'){me.checkReferrer();}
me.refresh();me.MVN.params.$toolbar.removeClass('loading');}
me.MVN.clearQueue();}catch(e){VVM.debug.error(e);}}}
return Omni_Component;}($,VVM));var EasyXDM_Component=(function($,VVM){var undef;var EasyXDM_Component=function(controller){var me=this;me.MVN=controller;me.version='EasyXDM 2.4.15.118';me.autoInit=true;}
EasyXDM_Component.prototype={init:function(params){var me=this;me.params=$.extend({XD:{local:me.MVN.params.localPath+'xd.html',swf:me.MVN.params.localPath+'xd.swf',remote:'http://'+me.MVN.params.authDomain+'/sso/index/?appId='+me.MVN.params.appId+(me.MVN.params.apiAccess?'&apiAccess='+me.MVN.params.apiAccess:''),remoteHelper:'http://'+me.MVN.params.authDomain+'/xd.html',channel:'mvn'}},params||{});me.MVN.sso=$.extend(me.MVN.sso,new easyXDM.Rpc(me.params.XD,{local:{init:function(o){if(o&&o.setSid)
me.MVN.setSid=o.setSid;if(o&&o.user){me.MVN.user=o.user;VVM.delCookie('livefyre_token','/');VVM.delCookie('MVN[anon]','/');$(document.body).click(function(){if(me.MVN.setSid){popup=window.open('http://'+me.MVN.params.authDomain+'/sso/attach/?sid='+me.MVN.setSid,'','width=100,height=100');popup.blur();window.focus();me.MVN.setSid=false;}});if(o.user.publish&&o.user.publish=="1"&&window.MVN_PUB)
me.MVN.sso.publish(window.MVN_PUB);}
me.MVN.omni.init(me.MVN.params.load.omni.params||{});if(o&&o.flash&&o.flash!="")
me.MVN.omni.showMessage(o.flash);if(VVM.getCookie('lfpost')){VVM.delCookie('lfpost');if($('#livefyre').length){$('html,body').animate({scrollTop:$('#livefyre').offset().top});}}},unload:function(o){if(o&&o.error){VVM.debug.error(o.error);}
me.MVN.unload();},setCookie:function(){VVM.setCookie.apply(this,arguments);},cookies:function(){VVM.modals.hideAllButContainer(function(){me.MVN.omni.action('cookies');});},socialReturn:function(){},action:function(action){me.MVN.omni.actionSrc='sso';me.MVN.omni.action(action,true);},track:function(params){me.MVN.omni.track(params);},updateModal:function(modal,css){if(me.MVN.omni.Modals[modal]){me.MVN.omni.Modals[modal].updateCSS(css);}},modalEvent:function(modal,e,params){if(me.MVN.omni.Modals.hasOwnProperty(modal)&&me.MVN.omni.Modals[modal].$modal){MVN.omni.Modals[modal].$modal.trigger(e,params);}},updateWidget:function(iframe,css){if($('iframe[name='+iframe+']').length){$('iframe[name='+iframe+']').css(css);}},handleResponse:function(r){me.MVN.handleResponse(r);},showMessage:function(){me.MVN.omni.showMessage.apply(me,_.toArray(arguments));},hideMessage:function(){me.MVN.omni.hideMessage();},closeSubscribe:function(slideUp){me.MVN.omni.closeSubscribe(slideUp);},addEventWithHash:function(){me.MVN.omni.addEventWithHash();},},remote:{getUser:{},authUser:{},forgotPass:{},settings:{},validUsername:{},getUsersForEvent:{},addEvent:{},freeStuffNewsletter:{},activityCounts:{},subscribeToNewsletter:{},saveSmsAjaxTxtAlerts:{},cellcheck:{},getUserAlertSubscriptions:{},logout:{},publish:{},disablePublish:{},disableAuth:{},getFlash:{},getLfToken:{},getFollowing:{},toggleFollow:{},addEventWithHash:{},like:{},}}));}}
return EasyXDM_Component;}($,VVM));var MVNElements_Component=(function($,VVM){var undef;function MVNElements_Component(MVN){var MVNElements=this;var savedParams="";MVNElements.generator('subscribe',function($el){var queue=[],send_queue=[],user_subscriptions=null,user_logged_in=null,active_send=null;function state($el,name,val){switch(name){case'loading':if(val!==undef){if(val){state($el,'disabled',true);$el.addClass('loading').text('Loading...').css({'background-color':'#eeeeee','color':'#000000','opacity':'1'});}else{state($el,'disabled',false);$el.removeClass('loading').text('').css({'color':'#ffffff','opacity':'1'});}
return val;}
return $el.is('.disabled');case'disabled':if(val!==undef){if(val){$el.attr('disabled','disabled').addClass('disabled').css('background-color','#f6b593');}else{$el.removeAttr('disabled').removeClass('disabled').css('background-color','#F16F2B');}
return val;}
return $el.is('.disabled');case'subscribed':if(val!==undef){if(val)$el.addClass('subscribed').text('Unsubscribe').css({'background-color':'#F16F2B','color':'#000000'});else $el.removeClass('subscribed').text('Subscribe').css('background-color','#F16F2B');return val;}
return $el.is('.subscribed');case'error':if(val!==undef){if(val)$el.addClass('error').text('Error!');return val;}
return $el.is('.error');}}
function queueElement($el){var params;if(params=MVNElements.params(['subscription'],['cid','sid'],$el)){$subBttn=$(document.createElement('button')).addClass('mvnElement_subscribe');state($subBttn,'subscribed',false);state($subBttn,'disabled',true);if(!params.sid.match(/[^|]+$/g)){if(window.location.search.match(/[^|]+$/g)){urlSid=window.location.search.match(/[^|]+$/g);params.sid+=urlSid;}}
$subBttn.data('mvnElement_params',params);$el.replaceWith($subBttn);queue.push($subBttn);if(user_logged_in===false||user_subscriptions){processQueue();}}}
function processQueue(){var i,params,els=queue;queue=[];if(user_logged_in!==null){for(i=0;i<els.length;i++){if(VVM.isjQuery(els[i])){params=els[i].data('mvnElement_params');state(els[i],'disabled',false);if(user_logged_in){state(els[i],'subscribed',!!(user_subscriptions[params.cid]&&user_subscriptions[params.cid][params.subscription]));}else{if(typeof responsive!="undefined"){var action='join-responsive';}else{var action='join';}
els[i].removeClass('mvnElement_subscribe');els[i].addClass('disabled').css('background-color','#f6b593');savedParams=MVN.omni.buildAction('join',{sid:params.sid});els[i].attr('data-omni-action',MVN.omni.buildAction(action,{sid:params.sid,auto_subs:[params.subscription],skip_default_subs:true}));els[i].data('omni-src','subscribe');}}}}else{queue=els;VVM.debug.error("MVNElement:SubcribeGenerator:processQueue called before user info available");}}
function processSendQueue(){var i,params,els=send_queue,payload=[];send_queue=[];for(i=0;i<els.length;i++){if(VVM.isjQuery(els[i])){params=els[i].data('mvnElement_params'),payload.push({sub_id:params.subscription,city:params.cid});}else{els.splice(i,1);i--;}}
MVN.sso.subscribeToNewsletter({json:JSON.stringify(payload),sid:params.sid},function(done){if(done.success){for(i=0;i<els.length;i++){state(els[i],'loading',false);state(els[i],'subscribed',!state(els[i],'subscribed'));}}
if(done.errorCall){for(i=0;i<els.length;i++){state(els[i],'error',true);}}
active_send=null;if(send_queue.length>0){processSendQueue();}});}
function subscribeClickHandler(){if(!state($(this),'disabled')){state($(this),'loading',true);send_queue.push($(this));if(active_send===null){processSendQueue();}}}
$('body').delegate('.mvnElement_subscribe','click',subscribeClickHandler);queueElement($el);MVNElements.generator('subscribe',queueElement);MVN.queue(function(){user_logged_in=!!MVN.user;if(user_logged_in){$.ajax({url:'http://'+MVN.params.authDomain+'/village/getMySubscriptions/',dataType:'jsonp',success:function(resp){if(resp&&resp.OK){user_subscriptions=resp.subscriptions;processQueue();}else{VVM.debug.error('Failed request for user subscriptions',resp.errors);}},error:function(err){VVM.debug.error('unable to get user subscriptions -',err);}});}else{processQueue();}});$(MVNElements).bind('generated',function(){MVN.queue(function(){if(!MVN.user){if(jQuery('.topsignup a').length>0){jQuery('.topsignup a').attr('href','#').attr('data-omni-action',savedParams);}
if(jQuery('.bottomsignup a').length>0){jQuery('.bottomsignup a').attr('href','#').attr('data-omni-action',savedParams);}}});});});MVNElements.generator('subtxtalert',function($el){var queue=[],user_logged_in=null,user_alerts=null,cellcheck=['false'];function processAlertQueue(){var els=user_alerts,obj=null;user_alerts=[];if(user_logged_in!==null){if(user_logged_in&&cellcheck!=1){var objArray=[],alertId=null,alertStatus=null;for(objTemp in els){obj=els[objTemp];alertId=obj.id;alertStatus=obj.status;$('.mvnElement_subtxtalert').each(function(){var alertParse=null,matchId=null;$this=$(this);alertParse=$this.data();matchId=alertParse.mvnElement_params.txtalert;if(alertId==matchId){if(alertStatus=='Opt-out'){$this.addClass('subscribe').text('Subscribe');$this.css('background-color','#F16F2B');$this.css('color','#fff');$this.prop('disabled',false);}else if(alertStatus=='Opt-in'){$this.removeClass('subscribe').text('Unsubscribe');$this.addClass('unsubscribed');$this.css('background-color','#eee');$this.css('color','#000');$this.prop('disabled',false);}else if(alertStatus=='Pending'){$this.removeClass('subscribe').text('Pending');$this.addClass('pending');$this.css('background-color','#eee');$this.css('color','#000');$this.prop('disabled',false);}else{$this.addClass('subscribe').text('Subscribe');$this.css('background-color','#F16F2B');$this.css('color','#fff');$this.prop('disabled',false);}}else{$('.subscribe').css('background-color','#F16F2B');}});}}}else{$('.mvnElement_subtxtalert').css('background-color','#f6b593');user_alerts=els;VVM.debug.error("MVNElement:SubcribeGenerator:processQueue called before user info available");}}
function renderEl($el){var params;if(params=MVNElements.params(['txtalert'],['cid','sid'],$el)){if(user_logged_in){var alertBtnColor='#F16F2B';}else{var alertBtnColor='#F6B593';}
$subBttn=$(document.createElement('button')).attr('type','button').addClass('mvnElement_subtxtalert subscribe').text('Subscribe').css('background-color',alertBtnColor).data('mvnElement_params',params);$el.replaceWith($subBttn);if(user_logged_in!==null||user_alerts){processAlertQueue();}}}
$('body').delegate('.mvnElement_subtxtalert','click',function(){var params=$(this).data('mvnElement_params');var me=$(this);if(user_logged_in===null){return false;}else if(user_logged_in){if(cellcheck==1){MVN.omni.buildModal('txtalerts',{subscribed:function(){cellcheck='hascell'
MVN.omni.Modals.txtalerts.hide();me.text("Loading...");me.css('background-color','#eee');me.css('color','#000');me.prop('disabled',true);MVN.sso.saveSmsAjaxTxtAlerts({newsletterId:params.txtalert},function(done){if(done.success){me.text(done.response).removeAttr('disabled');me.removeClass('disabled');me.css('background-color','#eee');me.css('color','#000');me.prop('disabled',false);MVN.sso.getUserAlertSubscriptions({},function(done){if(done.success){user_alerts=done.response.userSubs.campaigns;processAlertQueue()}
if(done.errorCall){VVM.debug.error('unable to get user subscriptions -',done.errorCall);}});processAlertQueue();}
if(done.errorCall){me.text("Error");}});}});}else{me.text("Loading...");me.css('background-color','#eee');me.css('color','#000');me.prop('disabled',true);MVN.sso.saveSmsAjaxTxtAlerts({newsletterId:params.txtalert},function(done){if(done.success){me.text(done.response);if(done.response=='Subscribe'){me.css('background-color','#F16F2B');me.css('color','#fff');me.prop('disabled',false);}else{me.css('background-color','#eee');me.css('color','#000');me.prop('disabled',false);}}
if(done.errorCall){me.text("Error");me.css('background-color','#eee');me.css('color','#000');me.unbind('click');}});}}else{MVN.omni.actionSrc='subtxtalert';MVN.omni.actionSrcDesc=params.txtalert;MVN.omni.action(MVN.omni.buildAction('join',{sid:params.sid}));}});renderEl($el);MVNElements.generator('subtxtalert',renderEl);MVN.queue(function(){user_logged_in=!!MVN.user;if(user_logged_in){MVN.sso.cellcheck({},function(done){if(done.success&&done.response==='hasCell'){MVN.sso.getUserAlertSubscriptions({},function(done){if(done.success){user_alerts=done.response.userSubs.campaigns;processAlertQueue()}
if(done.errorCall){VVM.debug.error('unable to get user subscriptions -',done.errorCall);processAlertQueue();}});}else{$('.mvnElement_subtxtalert').css('background-color','#F16F2B');processAlertQueue();}
if(done.success){cellcheck=done.response;}});}else{processAlertQueue();}});});MVNElements.generator('event',function($el){var user_logged_in=null;var elements=[];var getEvents=false;var userData;var eventId;var dataCityCode;function renderEl($el){var params;var buttonContent;if(MVN.params.cid!='places'){buttonContent='<img src="http://'+MVN.params.authDomain+'/img/addtocalendar.png">';}else{buttonContent='<img src="http://'+MVN.params.authDomain+'/img/addtocalendarred.png">ADD TO CALENDAR';}
$subBttn=$(document.createElement('button')).attr('type','button').addClass('event-button').text('Add+').html(buttonContent).attr('data-id',$el.data('id')).attr('data-name','a');if(typeof($el.data('city-code'))!="undefined"){$subBttn.attr('data-city-code',$el.data('city-code'));}
$el.replaceWith($subBttn);elements.push($el.data('id'));if(user_logged_in!==null){}}
renderEl($el);MVNElements.generator('event',renderEl);MVN.queue(function(){user_logged_in=!!MVN.user;});$(document.body).delegate('.event-button','mouseenter mouseleave',function(e){var $me=$(this);eventId=$me.data('id');if(typeof(eventId)==="number"){eventId=eventId.toString();}
if(eventId.charAt(0)=="0"){eventId=eventId.substring(1);}
if(typeof($me.data('city-code'))!="undefined"){dataCityCode=$me.data('city-code');}
var userImages;if(userData&&userData.users){if(eventId in userData.users){userImages=userData.users[eventId];$me.data('userImages',userImages);}}
$me.data('id');if($me.is(':visible')||$('img',$me).is(':visible')){if(e.type=='mouseenter'){$me.stop(true);if(MVN.omni.eventMenuObj&&MVN.omni.eventMenuObj.is(':visible')&&MVN.omni.eventMenuObj.data('elIndex')==$('.event-button').index(this)){MVN.omni.eventMenuObj.stop().fadeTo(0,1);}else{$me.delay(50).queue(function(){eventMenu($me,true);});}}else{var $target=$(e.toElement||e.relatedTarget);if(!$target.hasClass('vvmEventMenu')&&!$target.parent().hasClass('vvmEventMenu')){eventMenu($me.stop(true),false);}}}}).delegate('.event-button,.addEvent','click',function(e){var $el=$(this);if(e.type=='click'){$(this).text('Loading...')
if(MVN.user){saveEvent=false;if(userData.users[eventId]==undefined){saveEvent=true;}else if(userData.users[eventId]){if(userData.users[eventId].saved==undefined){saveEvent=true;}}
if(typeof(eventId)==="undefined"){eventId=$el.data('id');}
if(saveEvent){var sentMarket;if(typeof(dataCityCode)!='undefined'){MVN.omni.sentMarketMVN=dataCityCode;sentMarket=dataCityCode;}else{if(typeof(market)!='undefined'){sentMarket=market.Cities.CityID;}else{sentMarket=MVN.omni.currentMarket.id;}}
MVN.sso.addEvent(MVN.user.id,eventId,sentMarket,function(o){if(o&&o.status=='success'){userData.users[eventId]={saved:true};showShare(true);}else{showShare(false);}});}else{MVN.omni.sentMarketMVN=$(this).data("city-code");showShare(false);}}else{showShare(false);MVN.omni.actionSrc='saveEvent';MVN.omni.action('login');}}
function showShare(save){if(MVN.params.cid!='places'){buttonContent='<img src="http://'+MVN.params.authDomain+'/img/addtocalendar.png">';}else{buttonContent='<img src="http://'+MVN.params.authDomain+'/img/addtocalendarred.png">ADD TO CALENDAR';}
$el.html(buttonContent);if(MVN.omni.eventMenuObj){MVN.omni.eventMenuObj.hide();}
params={eventId:eventId,justSaved:save};if(MVN.user){MVN.omni.action('saveEvent',false,null,params);}}});function eventMenu($el,show){var prefix='vvmEventMenu';var id=String($el.data('id')),name=$el.data('name'),photo='',eventId=$el.data('id');userImages=$el.data('userImages');var savedUserCount=0;if(typeof(userImages)!=="undefined"){savedUserCount=userImages.count;}
var imageEls="";var counter=0;var savedCount;var savedByUser;if(userImages){for(image in userImages){if(counter<3){if(image!='count'&&image!='saved'){imageEls+="<a target='_blank' href='http://"+MVN.params.authDomain+"/"+userImages[image].username+"'><img src='"+MVN.omni.mediaImage(userImages[image].asset_id,13)+"'></a>";counter++;}else if(image=='count'){savedCount=userImages[image];}}
if(image=='saved'){savedByUser=userImages[image];}}}
if(show){if(!MVN.omni.eventMenuObj){MVN.omni.eventMenuObj=$('<div>').addClass(prefix).html($('<span class="mainContain">').append($('<button>').addClass('addEvent').text('Add to My Events').attr('title','Add to My Events')).append($('<div class="whosgoing">')).append($('<div class="images">')).append($('<div class="count">')).append($('<div class="triangle">')));MVN.omni.eventMenuObj.find('button').bind('mouseenter mouseleave',function(ev){$(this).toggleClass('hover',ev.type==='mouseenter');});}
MVN.omni.eventMenuObj.data('elIndex',$('.event-button').index($el));var $content=$('span:first',MVN.omni.eventMenuObj);$('a',$content).attr('href','#').removeClass('long');MVN.omni.eventMenuObj.unbind('mouseleave').bind('mouseleave',function(){eventMenu($el,false)}).appendTo('body');var $img=($el.find('img').length==1)?$el.find('img'):false;if(!$.fn.setMenuTo){$.fn.setMenuTo=function($el,type){var $me=$(this);var bottomFlag=false;var newClass=prefix;var offset=$el.offset();if(type=='small'){MVN.omni.eventMenuObj.find('span:first').css('height',34);$me.css('height',68);}else{MVN.omni.eventMenuObj.find('span:first').css('height',115);$me.css('height',150);}
MVN.omni.eventMenuObj.find('.whosgoing').html('Who else is going?');var leftEdge=$(window).scrollLeft();var rightEdge=leftEdge+$(window).width();if(MVN.params.cid!='places'){offset.left+=$el.outerWidth()/1.3-$me.outerWidth()/1.3;}else{offset.left+=$el.outerWidth()/2-$me.outerWidth()/2;}
offset.top-=$me.outerHeight();offset.opacity=1;if(offset.left+$me.outerWidth()>rightEdge){$('span',$me).attr('class','right');offset.left=(rightEdge-$me.outerWidth());}else if(offset.left<leftEdge){$('span',$me).attr('class','left');offset.left=leftEdge;}else{$('span',$me).removeAttr('class');}
if(offset.top<$(window).scrollTop()){bottomFlag=true;newClass+=' bottom';offset.top+=$me.outerHeight()+$el.outerHeight();}
if(bottomFlag){offset.top=offset.top-10;$me.find('.triangle').removeClass('toptri').addClass('bottomtri').css('top',10);}else{if(type=='small'){offset.top=offset.top+5;$me.find('.triangle').removeClass('bottomtri').addClass('toptri').css('top',48);}else{offset.top=offset.top+4;$me.find('.triangle').removeClass('bottomtri').addClass('toptri').css('top',130);}}
return $me.css(offset).attr('class',newClass);};}
$(window).bind('resize scroll',function(){if(MVN.omni.eventMenuObj.is(':visible')){var type='big';if(imageEls==""){type='small';}
MVN.omni.eventMenuObj.setMenuTo($img||$el,type);}});function showEventMenu(){if(savedByUser){MVN.omni.eventMenuObj.find('.addEvent').text('Added to My Events');MVN.omni.eventMenuObj.find('.addEvent').addClass('added-event');MVN.omni.eventMenuObj.find('.addEvent').attr("disabled",true);MVN.omni.eventMenuObj.find('.addEvent').css("cursor","auto");}else{MVN.omni.eventMenuObj.find('.addEvent').text('Add to My Events');MVN.omni.eventMenuObj.find('.addEvent').removeClass('added-event');MVN.omni.eventMenuObj.find('.addEvent').attr("disabled",false);MVN.omni.eventMenuObj.find('.addEvent').css("cursor","pointer");}
var type='big';MVN.omni.eventMenuObj.find('.whosgoing').show();if(imageEls==""){MVN.omni.eventMenuObj.find('.whosgoing').hide();type='small';}
MVN.omni.eventMenuObj.find('.images').html(imageEls);if(typeof(savedUserCount)!="undefined"){if(savedUserCount>6){saved=savedUserCount-3;MVN.omni.eventMenuObj.find('.count').html("and "+saved+" more...");}}
MVN.omni.eventMenuObj.setMenuTo($img||$el,type).stop().fadeTo(200,1,function(){});}
showEventMenu();}else if(MVN.omni.eventMenuObj){MVN.omni.eventMenuObj.stop().fadeOut(200,function(){$(this).find('.images').html('');$(this).find('.addEvent').text('Add to My Events');$(this).find('.addEvent').removeClass('added-event');$(this).find('.addEvent').attr("disabled",false);$(this).detach();});}}
function getData(){var mvnUserId;if(MVN.user){mvnUserId=MVN.user.id;}
MVN.sso.getUsersForEvent(JSON.stringify(elements),mvnUserId,function(users){if(users){userData=users;if(userData.users===undefined){userData.users={};}}
MVN.sso.addEventWithHash();});}
$(MVNElements).bind('generated',function(){MVN.queue(function(){getData();});});});MVNElements.generator('signup',function($el){MVN.queue(function(){var params;if(params=MVNElements.params(['message'],null,$el)){$el.replaceWith('<div class="chisel_u r_box mvnSignupWidget">'+'<img src="//'+MVN.params.assetDomain+'/img/mvnLogo-300.png"/>'+'<p>'+params.message+'</p>'+'<img src="//'+MVN.params.assetDomain+'/img/mvnSignupButton.png" '+'data-omni-action="'+MVN.omni.buildAction('join',{sid:params.sid})+'" />');}});});MVNElements.generator('friendActivityCount',function($el){var queue=[],storeKey='friendActivityCount',elClass='mvnElement_'+storeKey,generate_complete=user_logged_in=newElTimeout=null,autorefresh=true,maxRefreshes=45,refreshes=0;function getCount(ev){if(ev)VVM.debug.p('getting count',ev);var done=function(count){$('.'+elClass).text(count===null?' ':count);},newCount=store1.get(storeKey);if(newCount===undef){if(refreshes>maxRefreshes){done(0);return;}
VVM.debug.p('fetching remote '+storeKey);refreshes++;$.ajax({dataType:'jsonp',url:'/profile/ajaxNotificationCounts/friendActivity',success:function(resp){if(resp.OK&&resp.counts&&resp.counts.hasOwnProperty('friendActivity')){newCount=resp.counts['friendActivity'];store1.set(storeKey,newCount);done(newCount);}else{VVM.debug.error('Unable to get friend activity count',VVM.isArray(resp.errors)?resp.errors.join(' AND '):'don\'t know why...');done(null);}},error:function(err){VVM.debug.error('Request for friend activity count failed',err.message||err);done(null);}});}else{done(newCount);}}
function newEl($el){$el.replaceWith($(document.createElement('span')).addClass(elClass).text(' '));}
MVNElements.generator('friendActivityCount',newEl);newEl($el);$(MVNElements).one('generated',function(){generate_complete=true;if(user_logged_in===true){getCount();}})
MVN.queue(function(){user_logged_in=!!MVN.user;if(user_logged_in){store1=new DataStore({key:storeKey,defaultTTL:120000});store1.on(storeKey,'change',getCount);if(autorefresh)store1.on('friendActivityCount','expire',getCount);if(generate_complete===true){getCount();}}else{$('.'+elClass).remove();MVNElements.generator('friendActivityCount',function($el){$el.remove();});}});});MVNElements.generator('eventCount',function($el){var queue=[],storeKey='eventCount',elClass='mvnElement_'+storeKey,newCount,generate_complete=user_logged_in=newElTimeout=null,autorefresh=true,maxRefreshes=45,refreshes=0;function getCount(ev){if(ev)VVM.debug.p('getting count',ev);var done=function(count){$('.'+elClass).text(count===null?' ':count);},newCount=store2.get(storeKey);if(newCount===undef){if(refreshes>maxRefreshes){done(0);return;}
VVM.debug.p('fetching remote '+storeKey);refreshes++;$.ajax({dataType:'jsonp',url:'/profile/ajaxEventCount',success:function(resp){if(resp.OK&&resp.eventCount){newCount=resp.eventCount;store2.set(storeKey,newCount);done(newCount);}else{VVM.debug.error('Unable to get event count',VVM.isArray(resp.errors)?resp.errors.join(' AND '):'don\'t know why...');done(null);}},error:function(err){VVM.debug.error('Request for event count failed',err.message||err);done(null);}});}else{done(newCount);}}
function newEl($el){$el.replaceWith($(document.createElement('span')).addClass(elClass).text(' '));}
MVNElements.generator('eventCount',newEl);newEl($el);$(MVNElements).one('generated',function(){generate_complete=true;if(user_logged_in===true){getCount();}})
MVN.queue(function(){user_logged_in=!!MVN.user;if(user_logged_in){store2=new DataStore({key:storeKey,defaultTTL:120000});store2.on(storeKey,'change',getCount);if(autorefresh)store2.on('eventCount','expire',getCount);if(generate_complete===true){getCount();}}else{$('.'+elClass).remove();MVNElements.generator('eventCount',function($el){$el.remove();});}});});MVNElements.generator('mvnMobileAccount',function($el){var elements=[];var iframe;var page='login';if(typeof($el.data('page'))!="undefined"&&$el.data('page')!=""&&$el.data('page')!="login"){page='register';}
function renderEl($el){$loginArea=$(document.createElement('iframe')).css('height','500').attr('src',iframe);$el.replaceWith($loginArea);}
$(MVNElements).bind('generated',function(){MVN.queue(function(){var sentMarket;if(typeof(market)!='undefined'){sentMarket=market.Cities.CityID;}else{sentMarket=MVN.omni.currentMarket.id;}
var redirect=document.referrer;if(MVN.user){if(redirect==document.URL||redirect==""){if(typeof(market)!='undefined'){window.top.location.href='http://www.'+market.Cities.domain;}else{window.top.location.href='http://www.'+MVN.omni.currentMarket.domain;}}}
iframe='http://'+MVN.params.authDomain+'/sso/mobile/'+page+'/?'+$.param({cid:sentMarket,sid:MVN.params.sid,redirect:document.referrer,redirectSpecial:document.URL});renderEl($el);});MVNElements.generator('mvnMobileAccount',renderEl);});});}
MVNElements_Component.prototype={generator:function(tagname,constructor){if(!this._generators)this._generators={};this._generators[tagname]=constructor;},generate:function(){if(!this._generators)return null;var elems,i,x,tags=VVM.keys(this._generators),selector,$el;for(i=0;i<tags.length;i++){selector='[data-mvn-element="'+tags[i]+'"], [mvn-element="'+tags[i]+'"]';elems=$(document.getElementsByTagName('mvn:'+tags[i])).add(selector);for(x=0;x<elems.length;x++){$el=$(elems[x]);$el.data('MVNElement_tagname',tags[i]);this._generators[tags[i]]($el);}}
$(this).trigger('generated');},params:function(required,optional,$el){try{var resp={},i,name,val;if(required&&VVM.isArray(required)){for(i=0;i<required.length;i++){name=required[i];val=$el.attr('data-'+name);if('undefined'==typeof val){val=$el.attr(name);}
if(typeof val==='undefined'){throw new Error('Missing required param '+name);}else{resp[name]=val;}}}
if(optional&&VVM.isArray(optional)){for(i=0;i<optional.length;i++){name=optional[i];val=$el.attr('data-'+name);if(typeof val==='undefined')val=$el.attr(name);resp[name]=(typeof val==='undefined')?undef:val;}}
if(!resp.cid)resp.cid=MVN.params.cid;if(resp.cid==='places')resp.mid=VVM.getCookie('vpmid');if(!resp.sid)resp.sid=MVN.params.sid;return resp;}catch(e){var tagname=$el.data('MVNElement_tagname');VVM.debug.error('unable to generate MVNElement '+tagname+' - ',e.message);$el.replaceWith(document.createComment(tagname+' - '+e.message));return;}}};return MVNElements_Component;}($,VVM));var DataStore=(function($,VVM){var undef;function DataStore(opts){var stash,key;if(VVM.isObject(opts)){this.config=$.extend(this.config,opts);}
if(VVM.isString(opts)){this.config.key=opts;}
this.config.userId=this.getUserId();if(!this.config.key){throw"Config option \"key\" is required.";}else{this.config.key='MVN:'+this.config.userId+':'+this.config.key;}
if(VVM.localStorageAvailable){stash=window.localStorage.getItem(this.config.key);}
if(typeof stash==='string'){stash=window.JSON.parse(stash);if(stash){for(key in stash){if(stash.hasOwnProperty(key)&&stash[key].exp<VVM.now()){delete stash[key];}}
this.vals=stash;}}
window.onunload=VVM.bind(this.writeStash,this);window.store=this;return{get:VVM.bind(this.getValue,this),set:VVM.bind(this.setValue,this),ttl:VVM.bind(this.getTTE,this),remove:VVM.bind(this.removeValue,this),on:VVM.bind(this.onKeyEvent,this)};};window.DataStore=DataStore;DataStore.prototype={config:{defaultTTL:300000},vals:{},expireTimeouts:{},getUserId:function(){return(MVN.user&&MVN.user.id)||'anon';},removeValue:function(key){delete this.vals[key];},expireVal:function(key){this.removeValue(key);$(this).trigger('expire.'+key);this.expireTimeouts[key]=null;},getValue:function(key){if(this.vals.hasOwnProperty(key)){if(this.vals[key].ttl&&this.vals[key].exp<VVM.now()){this.removeValue(key);}else{return this.vals[key].val;}}},getTTE:function(key){if(this.vals.hasOwnProperty(key)&&this.vals[key].ttl){return this.vals[key].exp-VVM.now();}
return null;},setValue:function(key,val,ttl){this.vals[key]=this.vals.hasOwnProperty(key)?this.vals[key]:{val:null,ttl:0};if(val!==undef){this.vals[key].val=val;}
this.vals[key].ttl=(ttl===undef)?this.config.defaultTTL:ttl;if(this.vals[key].ttl){this.vals[key].exp=VVM.now()+this.vals[key].ttl;if(this.expireTimeouts.hasOwnProperty(key)){this.setExpireTimeout(key);}}else{delete this.vals.exp;delete this.expireTimeouts[key];}
this.stashIsDirty();$(this).trigger('changed.'+key);},setExpireTimeout:function(key){if(this.expireTimeouts[key]){clearTimeout(this.expireTimeouts[key]);}
if(this.vals.hasOwnProperty(key)&&this.vals[key].ttl&&this.vals[key].exp>VVM.now()){this.expireTimeouts[key]=setTimeout(VVM.bind(this.expireVal,this,key),this.getTTE(key));}else{this.expireTimeouts[key]=null;}},stashIsDirty:function(){if(this.cleanStashTimeout!==null){clearTimeout(this.cleanStashTimeout);}
this.cleanStashTimeout=setTimeout(VVM.bind(this.writeStash,this),1000);},writeStash:function(){if(VVM.localStorageAvailable&&this.getUserId()==this.config.userId){window.localStorage.setItem(this.config.key,JSON.stringify(this.vals));}
this.cleanStashTimeout=null;},onKeyEvent:function(key,ev,cb){if(ev==='expire'){this.setExpireTimeout(key);}
$(this).bind(ev+'.'+key,cb);}};return DataStore;}($,VVM))
function loadExternal(path,callback){var type=path.split('.').pop();if(window.jQuery&&type=='js'){VVM.debug.p('Requesting JS file with getScript: '+path);$.getScript(path,callback);}else{if(type=='js'){var el=document.createElement('script');el.setAttribute('type','text/javascript');el.setAttribute('src',path);}else if(type=='css'){var el=document.createElement('link');el.setAttribute('rel','stylesheet');el.setAttribute('type','text/css');el.setAttribute('href',path);}
if(typeof el!='undefined'){VVM.debug.p('Requesting '+type+' file: '+path);if(callback){el.onload=callback;el.onreadystatechange=function(){if(this.readyState=='complete'){callback();}};}
if(navigator.appVersion.indexOf("MSIE")!=-1){setTimeout(function(){document.getElementsByTagName('head')[0].appendChild(el);},250);}else{document.getElementsByTagName('head')[0].appendChild(el);}}}}
(function(){var scripts=document.getElementsByTagName('script'),slen=scripts.length,originaljQuery=window.jQuery,original$=window.$;function jQuery_Callback(){VVM.debug.p('Fired jQuery Callback');$=jQuery=window.jQuery;window.jQuery=originaljQuery;window.$=original$;function easyXDM_Callback(){VVM.debug.p('Fired EasyXDM Callback');MVN.clearQueue(true);}
$(function(){if(!VVM.modal){}
if(!window.easyXDM){loadExternal('//'+domain+'/js/easyxdm.min.js',easyXDM_Callback);}else{easyXDM_Callback();}});}
while(slen--){if(scripts[slen].src&&scripts[slen].src.match(/omni\.js$/)){domain=scripts[slen].src.split('?')[0].split('//')[1].split('/')[0];break;}}
loadExternal('//'+domain+'/css/omni2.css');if(window.easyXDM){easyXDM.DomHelper.requiresJSON('//'+domain+'/js/json2.js');}else if(!window.JSON||false){loadExternal('//'+domain+'/js/json2.js');}
if(!window.jQuery||(window.jQuery.fn.jquery.split('.')[0]==1&&window.jQuery.fn.jquery.split('.')[1]<4)){loadExternal('//'+domain+'/js/jquery-1.6.4.min.js',jQuery_Callback);}else{jQuery_Callback();}})();window.MVN=new MVN_Controller();})(window.jQuery);}catch(e){VVM.debug.error(e);}