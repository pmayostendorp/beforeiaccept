/*
 Copyright 2015 AppNexus.
 All rights reserved.
 oas_manager.js
 http://www.appnexus.com
 Author: Matt Kendall
 Version: 1.1.2
*/
oas_tag=function(q,j){var e={};e.url=oas_tag.url;e.sizes=oas_tag.sizes||{};e.site_page=oas_tag.site_page||"";e.query=oas_tag.query;e.taxonomy=oas_tag.taxonomy||"";e.anchorElementPrefix=oas_tag.anchorElementPrefix||"oas";e.implMode=oas_tag.implMode||{};e.callbackHandler=oas_tag.callbackHandler;e.analytics=oas_tag.analytics||!1;e.allowSizeOverride=oas_tag.allowSizeOverride||!1;e.logging=oas_tag.logging||!1;e.lazyload=oas_tag.lazyload||!1;e.enableRTB=oas_tag.enableRTB||!1;e.enableBackgroundLoading=oas_tag.enableBackgroundLoading||
!1;e.adStyles=oas_tag.adStyles||{};var k="",p={},B=!1,l={},m=[],n={},C=!1,y=!1,w={},D=!0,E=!1,s=[],F={},G=!1,t={},d={SCRIPT_ID_PREFIX:"oas_dx_",DIV_WRAPPER_ID_PREFIX:"oas_div_",IFRAME_ID_PREFIX:"oas_frame_",IMG_TRACK_ID_PREFIX:"oas_img_pixel_",JSONP_CALLBACK:"_RM_HTML_CALLBACK_=oas_tag.displayAds",DX_PATH:"/jp/",DX_PATH_RTB:"/jpl/",DEBUG_MODE:"oas_tag_debug",LOG_INFO:"INFO",LOG_WARN:"WARN",LOG_ERROR:"ERROR",AD:"Ad",CAMPAIGN_ID:"AccCampId",CAMPAIGN_KEY:"CampKey",CAMPAIGN_EXCLUDE_KEY:"ExclCamp",AD_HEIGHT:"H",
AD_WIDTH:"W",AD_POSITION:"Pos",AD_TYPE:"AdType",AD_CLICK_URL:"ClkUrl",AD_IMP_URL:"ImpUrl",AD_FILE_URL:"FileUrl",AD_ALT:"Alt",AD_EXTRA_HTML:"ExtraHT",AD_EXTRA_TEXT:"ExtraTx",AD_TARGET:"TargW",AD_CREATIVE_ID:"CreId",AD_CREATIVE:"Text",REFERRAL:"Ref",BT_SEGMENT:"BTSeg",CPA:"CPA",ECPM:"eCPM",CPC:"CPC",CPM:"CPM",IO:"IO",ADVERTISER:"AdvId"},u=function(a){return"[object Array]"===Object.prototype.toString.call(a)},H=function(){if(!1===e.logging&&!1===B){var a=e,b;b=RegExp("[\\?&]"+d.DEBUG_MODE+"=([^&#]*)").exec(q.location.search);
b=null===b?"":decodeURIComponent(b[1].replace(/\+/g," "));a.logging=!!b;B=!0}return e.logging?!0:!1},h=function(a,b){var c=q,f;if(H())if(b){f=new Date;f=f.getHours()+":"+f.getMinutes()+":"+f.getSeconds()+":"+f.getMilliseconds()+":"+b+":"+a+" - ";var e;e=(new Date).getTime()-F.initialLoad;a=f+ +e+"ms from DX library loading initially";b===d.LOG_INFO?c.console&&c.console.info?c.console.info(a):c.console&&c.console.log&&c.console.log(a):b===d.LOG_WARN?c.console&&c.console.warn?c.console.warn(a):c.console&&
c.console.log&&c.console.log(a):b===d.LOG_ERROR&&(c.console&&c.console.error?c.console.error(a):c.console&&c.console.log&&c.console.log(a))}else c.console&&c.console.log&&c.console.log(a)},I=function(a){this.height=a[d.AD_HEIGHT];this.width=a[d.AD_WIDTH];this.position=a[d.AD_POSITION];this.clickUrl=a[d.AD_CLICK_URL];this.fileUrl=a[d.AD_FILE_URL];this.impUrl=a[d.AD_IMP_URL];this.type=a[d.AD_TYPE];this.alt=a[d.AD_ALT];this.extraHtml=a[d.AD_EXTRA_HTML];this.extraText=a[d.AD_EXTRA_TEXT];this.campaignId=
a[d.CAMPAIGN_ID];this.target=a[d.AD_TARGET];this.creativeId=a[d.AD_CREATIVE_ID];this.creative=a[d.AD_CREATIVE];this.referral=a[d.REFERRAL];this.btSegment=a[d.BT_SEGMENT];this.cpa=a[d.CPA];this.ecpm=a[d.ECPM];this.cpm=a[d.CPC];this.cpc=a[d.CPM];this.io=a[d.IO];this.advertiser=a[d.ADVERTISER]},T=function(a,b,c){this.id=a;this.fn=b;this.event=c},J=function(a){var b;if("function"===typeof a)for(b=0;b<s.length;b++)a(s[b])},K=function(a){return l[a]&&l[a].size?l[a].size[1]:0},L=function(a){return l[a]&&
l[a].size?l[a].size[0]:0},x=function(a){return l[a]&&l[a].displayAd?l[a].displayAd:!1},M=function(a){var b;try{b=a.contentWindow?a.contentWindow.document:a.contentDocument.document?a.contentDocument.document:a.contentDocument}catch(c){}return b},N=function(a){for(var b=M(a).getElementsByTagName("a"),a=0;a<b.length;a++)"_self"===b[a].target&&(b[a].target="_top")},z=function(a){return j.getElementById(e.anchorElementPrefix+"_"+a)||j.getElementById(e.anchorElementPrefix.toUpperCase()+"_"+a)},A=function(a,
b,c){var f;a&&(f=new Image,f.id=d.IMG_TRACK_ID_PREFIX+c,""!==b&&(f.src=b),f.height=0,f.width=0,f.style.display="none",f.onload=function(){try{this.parentNode.removeChild(this)}catch(a){}},a.insertBefore(f,a.firstChild),h("Impression tracking for position: "+c,d.LOG_INFO))},v=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!0):a.attachEvent&&a.attachEvent("on"+b,c)},O=function(a,b){for(var c=0;c<b.length;c++){var f=b[c].split(":");1<f.length&&(h("attemping for these values: "+f[0]+" "+f[1],
d.INFO),a.style[f[0]]=f[1])}},V=function(a,b){if(!b.deployed){var c=b[d.AD_POSITION],f,g=0,i=0;if(!1===x(c))h("Do not display Ad for Pos: "+c,d.LOG_INFO),b.deployed=!0;else if(i=g=0,e.allowSizeOverride?(g=b[d.AD_HEIGHT],"0"===g&&(g=K(c)||a.style.height),i=b[d.AD_WIDTH],"0"===i&&(i=L(c)||a.style.width)):(g=K(c)||a.style.height,i=L(c)||a.style.width),0===g||0===i||""===g||""===i)h("OAS Ad position "+c+" does not have a size set on the container div or in the Creative. Ignoring this placement",d.LOG_ERROR);
else{h("Deploying Ad for "+c+" with Campaign Id: "+b[d.CAMPAIGN_ID]+", Creative ID: "+b[d.AD_CREATIVE_ID],d.LOG_INFO);if(y)for(;a.hasChildNodes();)a.removeChild(a.firstChild);"div"===e.implMode[c]?(f=j.createElement("div"),f.id=d.DIV_WRAPPER_ID_PREFIX+c,e.enableRTB||A(a,b[d.AD_IMP_URL],c)):(f=j.createElement("iframe"),f.id=d.IFRAME_ID_PREFIX+b[d.AD_POSITION],f.style.height=b.H,f.style.width=b.W,f.border="0px",f.hspace="0",f.vspace="0",f.marginWidth="0",f.marginHeight="0",f.style.border="0",f.scrolling=
"no",f.frameBorder="0");f.setAttribute("height",g);f.setAttribute("width",i);f.style.width=i+"px";f.style.height=g+"px";g=f;if(void 0!==e.adStyles[c]||void 0!==e.adStyles.all)if("none"===e.adStyles[c]||"none"===e.adStyles.all)g.removeAttribute("style");else if(""===e.adStyles[c]||""===e.adStyles.all)g.removeAttribute("style");else{g.removeAttribute("style");try{i=[],e.adStyles.all&&(i=e.adStyles.all.split(";")),1<i.length&&O(g,i),i=[],e.adStyles[c]&&(i=e.adStyles[c].split(";")),1<i.length&&O(g,i)}catch(U){h("problem with div style. Check for proper syntax. Error: "+
U.message,d.LOG_WARN)}}a.insertBefore(f,a.firstChild);if("div"===e.implMode[c])f.removeAttribute("height"),f.removeAttribute("width"),f.innerHTML=b[d.AD_CREATIVE],e.enableRTB||A(a,b[d.AD_IMP_URL],c);else{e.enableRTB||v(f,"load",function(){A(a,b[d.AD_IMP_URL],c)});var r=f,g='<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><base target="_top" /><script>inDapIF=true;<\/script></head><body>'+b[d.AD_CREATIVE],g=g+"</body></html>",i=/(opera)(?:.*version)?[ \/]([\w.]+)/,
l=/(msie) ([\w.]+)/,m=/(mozilla)(?:.*? rv:([\w.]+))?/,k=navigator.userAgent,k=k.toLowerCase(),i=(/(webkit)[ \/]([\w.]+)/.exec(k)||i.exec(k)||l.exec(k)||0>k.indexOf("compatible")&&m.exec(k)||[])[1],p;if("msie"===i||"opera"===i)try{q.frames[r.id].text=g,r.src='javascript:window["text"]',v(r,"load",function(){N(r)})}catch(s){h("failed to load iframe content in IE browser: "+s.message,d.LOG_ERROR)}else try{p=M(r),p.open("text/html","replace"),p.write(g),p.close(),v(r,"load",function(){N(r)})}catch(t){h("failed to load iframe content using DOM method: "+
t.message,d.LOG_ERROR)}}var u=w[c]=f;J(function(a){"onload"===a.event?v(u,"load",function(){a.fn(n,c);a.executed=!0}):"onload"===a.event&&"div"===e.implMode[c]&&a.fn(n,c)});b.deployed=!0}}},P=function(a,b){var c,f,g,i,h,j=p||{};for(c=0;c<j[d.AD].length;c++)f=j[d.AD][c],g=a[b],f.deployed||(i=g.id.substr(e.anchorElementPrefix.length+1),h=x(i),(i===f[d.AD_POSITION]||!h)&&V(g,f))},Q=function(a){var b,c=[];if(l[a]&&G&&(b=z(a)))h("attempting to deploy ad immediately for position: "+a,d.LOG_INFO),c.push(b),
P(c,0)},W=function(a){t[a]||(t[a]=q.setInterval(function(){h("checkIfDivIsAvailable for position:"+a,"INFO");z(a)&&(Q(a),q.clearInterval(t[a]))},25),h("adding event handler now for position:"+a,d.LOG_INFO))},R=function(){var a;a=p||{};var b;var c,f,g;if(m){c=[];f=[];for(b=0;b<m.length;b++)g=z(m[b]),null!==g?(c.push(g),f.push(m[b])):e.enableBackgroundLoading&&W(m[b]);if(0===c.length&&("complete"===j.readyState||"interactive"===j.readyState))h("document ready state: "+j.readyState,d.LOG_INFO),h("No OAS anchor divs were found. Ads may not display correctly. Check for proper OAS DIV placements",
d.LOG_WARN);b={divList:c,implementedPosList:f}}else b=void 0;c=b.divList;if(0!==c.length&&a[d.AD]){for(a=0;a<c.length;a++)P(c,a);if(!C&&H()){a=b.implementedPosList;b=m;for(c=0;c<b.length;c++)if(Array.prototype.indexOf)-1===a.indexOf(b[c])&&x(b[c])&&h("OAS Ad Position "+b[c]+" was requested but does not have a defined anchor point on the page. Ignoring this placement.",d.LOG_WARN);else{g=!1;for(f=0;f<a.length;f++)if(a[f]===b[c]){g=!0;break}!g&&x(b[c])&&h("OAS Ad Position "+b[c]+" was requested but does not have a defined anchor point on the page. Ignoring this placement.",
d.LOG_WARN)}C=!0}}},X=function(){function a(a,b){h="&XE";""!==e.taxonomy&&(h+="&"+e.taxonomy);""!==b&&(h+="&"+b);return h+="&if_nt_CookieAccept="+a+"&XE"}if(!e.analytics)return"";var b="",c,d,g,i,h;j.referrer&&"[unknown origin]"!==j.referrer&&(-1===j.referrer.indexOf("?")?b+="tax23_RefDocLoc="+j.referrer.toString():(c=j.referrer,d=c.indexOf("?"),c=c.substring(0,d),b+="tax23_RefDocLoc="+c));c=new Date;d=c.getTime();j.cookie="OAS_SC1="+d.toString()+";path=/;";var k=j.cookie;g=k.indexOf("OAS_SC1=");
-1===g?g="":(g+=8,i=k.indexOf(";",g),-1===i&&(i=k.length),g=k.substring(g,i));g!==d.toString()?c=!1:(c.setTime(d+36E5),c=!0);return c?a.call(this,"Y",b):a.call(this,"N",b)},S=function(){if(D){D=!1;F.initialLoad=(new Date).getTime();h("OAS Manager file loaded succesfully. version: 1.1.2 modified date: 05/07/2015",d.LOG_INFO);if("function"===typeof e.sizes){if(e.sizes(),0===m.length){h('Ad Position and sizes must be defined. Check the "oas_tag.sizes" parameter in the setup script',d.LOG_ERROR);return}}else{h('Ad Position and sizes must be defined. Check the "oas_tag.sizes" parameter in the setup script',
d.LOG_ERROR);return}"function"===typeof e.callbackHandler&&e.callbackHandler();if(""===e.site_page){h("site_page paramater must not be blank",d.LOG_ERROR);return}E=!0}if(E){var a=d.SCRIPT_ID_PREFIX+e.url,b,c,f;j.getElementById(a)?R():(b=(Math.random()+"").substring(2,11),c=j.createElement("script"),c.id=a,c.async=!0,c.type="text/javascript",a="https:"===j.location.protocol?"https://":"http://",f=e.enableRTB?d.DX_PATH_RTB:d.DX_PATH,c.src=a+e.url+f+e.site_page+"/"+b+"/@"+k+"?"+d.JSONP_CALLBACK+(e.query?
"&"+e.query:"")+X(),b=j.getElementsByTagName("script")[0],b.parentNode.insertBefore(c,b))}};e.addEvent=v;e.bindLoad=function(a){function b(){if(!c&&(c=!0,a.call(d),e.enableBackgroundLoading)){var b;h("clear interval loading function executing","INFO");for(b in t)t.hasOwnProperty(b)&&q.clearInterval(t[b])}}var c=!1,d=this,g;if("complete"===j.readyState)b();else if(j.addEventListener)j.addEventListener("DOMContentLoaded",b,!1),q.addEventListener("load",b,!1);else if(j.attachEvent){j.attachEvent("onreadystatechange",
b);q.attachEvent("onload",b);g=!1;try{g=null===q.frameElement}catch(i){}j.documentElement.doScroll&&g&&function r(){try{j.documentElement.doScroll("left")}catch(a){setTimeout(r,1);return}b()}()}};e.loadScript=S;e.definePos=function(a,b,c){c=0!==c;h("calling definePos with position: "+a+" size: "+b+" Display Ad : "+c,d.LOG_INFO);if(a){if(!y){if(!u(b)){h("Cannot define an ad spot without a proper ad size. Please check setup script",d.LOG_ERROR);return}if(2!==b.length){h("Cannot define an ad spot without a height and width dimension. Please check setup script",
d.LOG_ERROR);return}}b&&(b={size:b,displayAd:c},l[a]||(k=""===k?a:k+","+a,m.push(a)),l[a]=b)}else h("Cannot define an ad spot without a position. Please check setup script",d.LOG_ERROR)};e.displayAds=function(a){p=a;G=!0;var b,c;if(a&&p[d.AD])for(a=0;a<p[d.AD].length;a++)if(b=p[d.AD][a])c=b[d.AD_POSITION],n[c]=new I(b);for(a=0;a<m.length;a++)b=m[a],void 0===n[b]&&(h("No eligible ad response for position requested :"+b,d.LOG_INFO),c={},c[d.AD_CREATIVE_ID]="empty.gif",c[d.AD_POSITION]=b,n[b]=new I(c));
R();var e;a=n.constructor();if(null===n||"object"!==typeof n)e=n;else{for(e in n)n.hasOwnProperty(e)&&(a[e]=n[e]);e=a}var g=e;J(function(a){"onload"!==a.event&&(a.fn(g),a.executed=!0)})};e.getAdMetaData=function(a){if(a)return n[a];h("Need to specify a position to get ad meta data",d.LOG_ERROR)};e.reloadAds=function(a){var b;b=j.getElementById(d.SCRIPT_ID_PREFIX+e.url);b.parentNode.removeChild(b);y=!0;"function"===typeof e.sizes&&(l={},k="",m=[],e.sizes(),0===m.length&&h('Ad Position and sizes must be defined. Check the "oas_tag.sizes" parameter in the setup script',
d.LOG_ERROR));if(u(a)){k="";m=[];for(b=0;b<a.length;b++)l[a[b]]?(k=""===k?a[b]:k+","+a[b],m.push(a[b])):h("Cannot reload ad position that was not initially loaded: "+a[b],d.LOG_ERROR)}S()};e.resizeAd=function(a,b,c){a&&w[a]&&(a=w[a],u(b)&&(c=b[0],b=b[1]),a.style.height=b+"px",a.style.width=c+"px")};e.addHandler=function(a,b,c){a&&b&&"function"===typeof b?s.push(new T(a,b,c)):h("Callback Handler not properly defined. Please check for proper syntax.",d.LOG_WARN)};e.removeHandler=function(a){var b,c;
if(a)for(b=0;b<s.length;b++)c=s[b],c.id===a&&s.splice(b,1)};e.loadAd=Q;e.getOasAdElement=function(a){if(a)return w[a]};return e}(window,document);oas_tag.lazyload?"complete"===document.readyState?oas_tag.loadScript():oas_tag.addEvent(window,"load",oas_tag.loadScript):(oas_tag.bindLoad(oas_tag.loadScript),oas_tag.loadScript());
