define(["jquery","underscore","backbone","baseview","pubsub","utils","mousewheel"],function(t,e,o,i,s,n){var r=i.extend({events:{mousewheel:"handleMouseWheel",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchstart:"onTouchStart","mousedown .scrolldragger":"onDraggerMouseDown","mouseenter .scrolldragger":"onDraggerMouseOver","mouseleave .scrolldragger":"onDraggerMouseOut","mousedown .scrollbar":"onBarClick"},removeActiveDelay:300,initialize:function(o){o=t.extend({disabled:!1,contentClass:".scrollable-content",lockPageScroll:!0,delayScroll:!1,minDraggerSize:40,template:null},o),e.bindAll(this,"onDraggerMouseUp","onDraggerMouseMove","onTouchMove","onTouchStop","_setMouseInHouse","_clearMouseInHouse"),this.content=this.$(o.contentClass),this.bar=t(o.template).hide(),this.bar.addClass("scrollbar"),this.dragger=this.bar.find(".scrolldragger"),this.body=n.get("body"),this.$el.append(this.bar),this.isMouseDown=!1,this.isMouseOver=!1,this.draggerOffset=0,i.prototype.initialize.call(this,o),this.refresh()},bindEvents:function(){this.delegateEvents()},unbindEvents:function(t){t||this.undelegateEvents(),this.body.off("."+this.cid),clearInterval(this.accelerationTimer),clearTimeout(this.enterDelay),clearTimeout(this.leaveDelay)},refresh:function(){if(this.content=this.$(this.options.contentClass),!this.options.disabled&&0!==this.content.length)if(this.viewportSize=this.getViewportSize(),this.contentSize=this.getContentSize(),this.contentViewportRatio=this.viewportSize/this.contentSize,this.contentViewportRatio<1){var t=this._calculateDraggerSize(this.viewportSize,this.contentViewportRatio,this.contentSize);this.draggerSize=this._setDraggerSize(t),this.active||(this.bar.show(),this.bindEvents(),this.active=!0,this.origPosition&&this.moveContentToPosition(this.origPosition.left,this.origPosition.top)),this.shiftContent(0,0)}else this.active&&(this.origPosition=this.content.position(),this.moveContentToPosition(0,0),this.bar.hide(),this.unbindEvents(),this.active=!1)},_calculateDraggerSize:function(t,e,o){var i=Math.round(t*e);if(i<this.options.minDraggerSize){var s=o-t,n=t-this.options.minDraggerSize;this.contentViewportRatio=n/s,i=this.options.minDraggerSize}return i},onTouchStart:function(t){var e=t.originalEvent.touches;e.length>1||this.options.disabled||!this.active||(clearInterval(this.accelerationTimer),this.touchX=e[0].pageX,this.touchY=e[0].pageY,this.touchVectorX=0,this.touchVectorY=0,this.touchDragStarted=!1,this.touchLastMove=(new Date).getTime(),this.body.on("touchend."+this.cid,this.onTouchStop),this.body.on("touchcancel."+this.cid,this.onTouchStop),this.body.on("touchmove."+this.cid,this.onTouchMove))},onTouchStop:function(t){if(0===t.originalEvent.touches.length&&(this.body.off("."+this.cid),this.touchDragStarted)){var e=(new Date).getTime(),o=e-this.touchLastMove;return t.preventDefault(),100>o&&this._triggerScrollingDecelerate(this.touchVectorX,this.touchVectorY,1500),!1}},_triggerScrollingDecelerate:function(t,o,i){var s=(new Date).getTime(),n=s+i,r=s,h=window.requestAnimationFrame||window.webkitRequestAnimationFrame,a=e.bind(function(){var e=(new Date).getTime(),u=e-r;r=e,n>e&&h(a),e-=s;var c=this._adjustVelocityVector(t,e,i),g=this._adjustVelocityVector(o,e,i);this.shiftContent(c*u,g*u)},this);this.accelerationTimer=h(a)},_adjustVelocityVector:function(t,e,o){return t*Math.pow(1-e/o,3)},onTouchMove:function(t){if(1===t.originalEvent.touches.length){var e=t.originalEvent.touches,o=e[0].pageX-this.touchX,i=e[0].pageY-this.touchY;if(this.touchDragStarted||Math.abs(o)>10||Math.abs(i)>10){var s=(new Date).getTime();this.touchDragStarted=!0,this.touchX=e[0].pageX,this.touchVectorX=o/(s-this.touchLastMove),this.touchY=e[0].pageY,this.touchVectorY=i/(s-this.touchLastMove),this.touchLastMove=(new Date).getTime(),this.shiftContent(o,i)===!1&&t.preventDefault()}}},onBarClick:function(t){if(1===t.which&&!t.isDefaultPrevented()){t.preventDefault();var e=this.bar.offset(),o=t.pageX-e.left-this.draggerSize/2,i=t.pageY-e.top-this.draggerSize/2;this.moveDraggerToPosition(o,i),this.onDraggerMouseOver(t),this.onDraggerMouseDown(t)}},onDraggerMouseDown:function(t){if(1===t.which){this.isMouseDown=!0,t.preventDefault(),this.body.on("mousemove."+this.cid,this.onDraggerMouseMove),this.body.on("mouseup."+this.cid,this.onDraggerMouseUp);var e=this.dragger.offset();this.draggerClickOffset={left:t.pageX-e.left,top:t.pageY-e.top}}},onDraggerMouseUp:function(t){1===t.which&&(t.preventDefault(),this.isMouseDown=!1,this.body.off("."+this.cid),this.isMouseOver||this.dragger.removeClass("hover"))},onDraggerMouseMove:function(t){if(this.isMouseDown){var e=this.bar.offset(),o=t.pageX-e.left-this.draggerClickOffset.left,i=t.pageY-e.top-this.draggerClickOffset.top;this.moveDraggerToPosition(o,i)}},onDraggerMouseOver:function(){this.isMouseOver=!0,this.dragger.addClass("hover")},onDraggerMouseOut:function(){this.isMouseOver=!1,this.isMouseDown||this.dragger.removeClass("hover")},onMouseEnter:function(){clearTimeout(this.leaveDelay),this.enterDelay=setTimeout(this._setMouseInHouse,300)},onMouseLeave:function(){clearTimeout(this.enterDelay),this.leaveDelay=setTimeout(this._clearMouseInHouse,300)},_setMouseInHouse:function(){this.isMouseInTheHouse=!0},_clearMouseInHouse:function(){this.isMouseInTheHouse=!1},handleMouseWheel:function(t){if(!this.isMouseDown&&this.active&&(!this.options.delayScroll||this.isMouseInTheHouse)){var e=t.deltaY*t.deltaFactor,o=-1*t.deltaX*t.deltaFactor||e;this.shiftContent(o,e)===!1&&t.preventDefault()}},shiftContent:function(t,e){var o=this.content.position(),i=this.content.parent(),s=o.left+t-(parseInt(i.css("padding-left"),10)||0)-(parseInt(i.css("margin-left"),10)||0),n=o.top+e-(parseInt(i.css("padding-top"),10)||0)-(parseInt(i.css("margin-top"),10)||0);return this.moveContentToPosition(s,n)?!1:this.options.lockPageScroll?!1:void 0},destroy:function(){this.unbindEvents(!0),this.bar.remove(),i.prototype.destroy.apply(this,arguments)},moveDraggerToPosition:function(){},moveContentToPosition:function(){},scrollToElement:function(){},animateContentToPosition:function(){},getViewportSize:function(){return 0},getContentSize:function(){return 0},_setDraggerSize:function(t){return t}});return r});
//# sourceMappingURL=base-scroll.js
//# sourceMappingURL=base-scroll.js.map