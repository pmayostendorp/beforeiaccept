define(["jquery","underscore","backbone","baseview","pubsub","state","utils","modules/carousel/gallery","modules/carousel/controls","modules/carousel/thumbs","modules/carousel/companion"],function(t,e,i,s,o,a,l,r,n,h,d){var u=s.extend({events:{mouseenter:"mouseEnter"},selectors:{slides:".slide:not(.partner-placement)",images:".slide:not(.partner-placement,.endslate)",companion:".pag-companion-wrapper"},initialize:function(i){i=t.extend({ads:!0,slideTransition:0,hoverShowControls:!0,hoverTransition:0,interactionDemo:!0,linkPath:null,rotate:!1,controlsSelector:null,gallerySelector:null,thumbsSelector:".thumbs",imageLazySrcAttr:"data-src",scrollerColor:"light",rotateInterval:3e3,autostart:!1},i),e.bindAll(this,"rotateCarousel"),this.index=this.$(".slide.active").index(),-1===this.index&&(this.index=0),this.linkPath=i.linkPath?i.linkPath:"",this.playTimer=null,this.subviews={},this.triggerAdRefresh=0===this.$$(this.selectors.companion).length,this._initializeGallery(i.imageLazySrcAttr,i.slideTransition,i.ads,i.gallerySelector,this.triggerAdRefresh,i.endslateOptions),this._initializeControls(i.hoverShowControls,i.interactionDemo,i.controlsSelector),this._initializeThumbs(i.hoverTransition,i.scrollerColor,i.thumbsSelector),this._initializeCompanion(this.selectors.slides),this.pubSub={"carousel:stoptimer":this.stoptimer,"carousel:starttimer":this.resumeAutoPlay},s.prototype.initialize.call(this,i),i.autostart&&this._startCarouselRotate()},_initializeCompanion:function(t){this.$$(this.selectors.companion).each(e.bind(function(e,i){this.subviews.companion=new d({el:i,slides:this.$$(t)})},this))},_initializeGallery:function(t,e,i,s,o,a){this.subviews.gallery=new r({ads:i,el:s?this.$(s):this.$el,index:this.index,imageLazySrcAttr:t,slideTransition:e,carousel:this,triggerAdRefresh:o,endslateOptions:a})},_initializeControls:function(t,e,i){var s=this.$(this.selectors.images),o=this.$$(this.selectors.slides);this.subviews.controls=new n({el:i?this.$(i):this.$el,hoverShowControls:t,interactionDemo:e,index:this.index,totalSlides:o.length,totalImages:s.length,carousel:this}),this.subviews.controls.render()},_initializeThumbs:function(t,e,i){this.subviews.thumbs=new h({el:i?this.$(i):this.$el,hoverTransition:t,index:this.index,scrollerColor:e,carousel:this})},mouseEnter:function(){this.options.autostart&&this._stopCarouselRotate()},rotateCarousel:function(){var t=this.$$(this.selectors.slides).length-1;this.switchSlide(null,1,!0),this.index!==t||this.options.rotate||this._stopCarouselRotate()},destroy:function(t){this.playTimer&&this._stopCarouselRotate(),s.prototype.destroy.call(this,t)},stoptimer:function(){clearInterval(this.playTimer),this.playTimer=null},switchSlide:function(t,e,i){var s=this.$$(this.selectors.slides).length;if(!this.showingAd&&this.subviews.gallery.shouldShowAd())return this.showingAd=!0,this.slideAdStep=e,void this.triggerEvent("showAd");if(e){this.slideAdStep&&this.slideAdStep!==e&&(e+=this.slideAdStep);var o=this.index+e;t=0>o?s-1:o>=s?0:o}else 0>t?t=0:t>=s&&(t=s-1);(this.index!==t||this.showingAd)&&(this.showingAd=!1,this.slideAdStep=0,this.index=t,this.triggerEvent("goToSlide",t),i||this._trackSlideChange())},_trackSlideChange:function(){var e;e=this.$el.hasClass("galleries")?this.$el:this.$(".galleries");var i=e.attr("data-gallery-id"),s=(e.attr("data-gal-pageurl")||"").replace(/^.*\/\/[^\/]+/,""),l=a.getActivePageInfo().contenttype;l?-1===l.indexOf("gallery")&&(l=t.trim(l)+" gallery"):l="galleries";var r={gallery_id:i,gallery_title:e.attr("data-title"),gallery_index:this.index+1,slide_id:e.find(".slide.active img").attr("data-id"),ssts:e.attr("data-ssts"),cst:(e.attr("data-cst")||"bugpages").replace(/\/+$/,""),contenttype:"snapshot"===i?"snapshot":l,pathName:""===s?this.linkPath:s};o.trigger("slide:change",r),t.ajax({url:window.site_static_path+"html/comscorepvcandidate.xml",cache:!1})},autoplay:function(){this.playTimer?this._stopCarouselRotate():this._startCarouselRotate(!0)},_startCarouselRotate:function(t){0===this.options.rotateInterval?this.stoptimer():this.playTimer=setInterval(this.rotateCarousel,this.options.rotateInterval),t&&this.rotateCarousel(),this.triggerEvent("onPlay")},_stopCarouselRotate:function(){this.stoptimer(),this.options.autostart=!1,this.triggerEvent("onStop")},resumeAutoPlay:function(){this.options.autostart&&!this.playTimer&&this._startCarouselRotate()},toggleThumbnail:function(){this.triggerEvent("viewportResize")},viewportResize:function(){this.triggerEvent("viewportResize")}});return u});
//# sourceMappingURL=carousel.js
//# sourceMappingURL=carousel.js.map