define(["jquery","underscore"],function(e,t){"use strict";var n=function(){this.storage={},this.set("DEBUG",!0),this.set("document",e(document)),this.set("win",e(window)),this.set("body",e("body")),this.set("scrollEl",e("html,body")),this.set("doc",e(document))};return n.prototype={set:function(e,t){this.storage[e]=t},get:function(e){return this.storage[e]},getPageUrl:function(){return this.getOrigin()+window.location.pathname},getOrigin:function(){return window.location.protocol+"//"+window.location.host},getScrollPosition:function(){return window.pageYOffset||document.documentElement.scrollTop},_loadedScripts:{},loadScript:function(e,t,n){return this._loadedScripts[t]=this._loadedScripts[t]||this._requireScript(e,t),this._loadedScripts[t].done(n)},_requireScript:function(t,n){return e.Deferred(function(e){require([t],function(){var r=window[n];r?e.resolve(r):e.reject("Missing symbol: "+n+" from script: "+t)},e.reject)}).fail(function(e){console.error(e)})},openPopup:function(e,t,n){t=t||600,n=n||400;var r=this.popupCoords(t,n);window.open(e,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height="+n+",width="+t+",top="+r.top+",left="+r.left)},isValidUrl:function(e){if(!e)return!1;if(-1!==e.indexOf("mailto:"))return!0;if(-1!==e.indexOf("javascript:"))return!1;if("#"===e[0]){if(1===e.length)return!1}else if(-1!==e.indexOf("../")||"/"!==e[0]&&-1===e.indexOf("://"))return console.error("Attempting to load a relative url, bad code monkey! ("+e+")"),!1;return!0},getNested:function(e,n){return e?(n=Array.prototype.slice.call(arguments,1),t.reduce(n,function(e,t){return e&&e[t]},e)):void 0},getSiteSections:function(){var e=this.getNested(window.site_vars,"sections")||"";return e?e.split("|"):[]},popupCoords:function(e,t){var n=window.screenLeft?window.screenLeft:window.screenX,r=window.screenTop?window.screenTop:window.screenY,i=window.outerWidth?window.outerWidth:document.documentElement.clientWidth,o=window.outerHeight?window.outerHeight:document.documentElement.clientHeight;return{left:n+i/2-e/2,top:r+o/2-t/2-25}},addCommas:function(e){e+="";for(var t=e.split("."),n=t[0],r=t.length>1?"."+t[1]:"",i=/(\d+)(\d{3})/;i.test(n);)n=n.replace(i,"$1,$2");return n+r},lazyLoadImage:function(n,r,i,o,s){var u=!1;return r=r||"data-src",n.each(t.bind(function(t,n){var c=e(n),d=c.attr(r),a=c.attr("src");d&&a!==d&&(this._attachHandler("error",c,o),s&&this._attachHandler("load",c,s),c.attr("src",d),i||c.removeAttr(r),u=!0)},this)),u},_attachHandler:function(e,t,n){var r=function(){t.off(e,r),"error"===e&&t.hide(),n&&n(t)};t.on(e,r)},getSectionPath:function(e){if(e&&(e=this._stripQueryParams(e)),e&&"/"!==e){"/"===e[0]&&(e=e.substring(1));var t=e.indexOf("/");return-1===t?e:e.substring(0,t)}return"home"},getSubSection:function(e){if(e){e=this._stripQueryParams(e),"/"!==e[e.length-1]&&(e+="/");var t=e.indexOf("/",1),n=e.indexOf("/",t+1);if(-1!==t&&-1!==n)return e.substring(t+1,n)}return""},_stripQueryParams:function(e){var t=e.indexOf("?");return-1!==t&&(e=e.substring(0,t)),e},lazyLoadError:function(t){e(this).hide(),t&&t(e(this))},requireSingleUseScript:function(n){return e.Deferred(function(e){require([n],function(t){e.resolveWith(this,[t])},function(t){console.error("failed loading scripts",t),e.reject(t)})}).always(t.bind(function(){this.removeRequireModule(n)},this)).promise()},removeRequireModule:function(t){require.undef(t),e('script[data-requiremodule="'+t+'"]').remove()},getUrlParam:function(e){var t=decodeURI((new RegExp(e+"=(.+?)(&|$)").exec(window.location.search)||[0,!1])[1]);return"false"===t?!1:"true"===t?!0:t},getSessionData:function(e,t){var n=sessionStorage[e];return n&&JSON.parse(n)||t},setSessionData:function(e,n){t.isString(n)||(n=JSON.stringify(n)),sessionStorage.setItem(e,n)},clearSessionData:function(e){sessionStorage.removeItem(e)},isDocumentHidden:function(){return document.hidden||document.webkitHidden||document.mozHidden||document.msHidden||document.oHidden},smartTruncate:function(e,t,n){if(e&&t){if(e.length<=t)return e;n=n||"&hellip;";var r=e.lastIndexOf(" ",t-1),i=r>0?r:t;return e.substr(0,i)+n}}},new n});
//# sourceMappingURL=utils.js
//# sourceMappingURL=utils.js.map