define(["jquery","underscore","utils","managers/cachemanager"],function(e,i,o,t){"use strict";var s=function(t){var s=o.getNested(window.site_vars,"THIRDPARTYAPI","Taboola")||{};this.options=e.extend({apiBase:s.apiBase+s.api_id,apiKey:s.apiKey,widgetUrl:"http://cdn.taboolasyndication.com/libtrc/"+s.publisher_id+"/loader.js",widget:s.widget,taboola_enabled:s.ENABLED},t),this.options.widget&&o.loadScript(this.options.widgetUrl,"_taboola",i.bind(this.getWidget,this))};return s.prototype={setUserTaboolaSession:function(e){t.setValue("taboola_user_session_id",e)},getUserTaboolaSession:function(){return t.getValue("taboola_user_session_id","init")},registerTaboolaClick:function(e,i,o){var t=this.options.apiBase+"/recommendations.notify-click?app.type=desktop&app.apikey="+this.options.apiKey+"&response.id="+o+"&item.type="+i+"&item.id="+e+"&response.session="+this.getUserTaboolaSession();(new Image).src=t},registerTaboolaVisible:function(e){var i=this.options.apiBase+"/recommendations.notify-visible?app.type=desktop&app.apikey="+this.options.apiKey+"&response.id="+e+"&response.session="+this.getUserTaboolaSession();(new Image).src=i},getRelated:function(e,t,s,a,n,r,p,d){if(this.options.taboola_enabled){if(!e)return;t=t||"video",s=s||"video",a=a||6,n=n||window.location.href,r=r||0,d=d===!1?d:!0,p=p||"";var l=this.options.apiBase+"/recommendations.get";l+="?output.callback=define&app.type=desktop&app.apikey="+this.options.apiKey,l+="&source.id="+r+"&source.url="+encodeURIComponent(n)+"&source.type="+t+"&rec.type="+s+"&rec.visible="+d+"&rec.count="+a+"&source.placement="+p+"&user.session="+this.getUserTaboolaSession(),o.requireSingleUseScript(l).done(i.bind(function(i){o.set("taboolaResponseID",i.id),i.list||(i.list={}),this.setUserTaboolaSession(i.session),d&&this.registerTaboolaVisible(i.id),e(i)},this))}},getWidget:function(e){this.options.taboola_enabled&&(this.options.widget.length>1&&console.log("TABOOLA more stories"),e.push({notify:"newPageLoad"}),e.push({article:"auto",target_type:"mix",url:window.location.href}),i.each(this.options.widget,function(i){e.push(-1!==o.getPageUrl().indexOf("/sports/")||-1!==o.getPageUrl().indexOf("/gameon/")?{category:"sports",mode:i.mode,container:i.container}:{mode:i.mode,container:i.container})}))}},s});
//# sourceMappingURL=taboola.js
//# sourceMappingURL=taboola.js.map