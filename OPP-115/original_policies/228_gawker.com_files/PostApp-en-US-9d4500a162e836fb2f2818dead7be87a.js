if("undefined"==typeof tiger)var tiger={};"undefined"==typeof tiger.components&&(tiger.components={}),"undefined"==typeof tiger.components.ad&&(tiger.components.ad={}),"undefined"==typeof tiger.components.agegate&&(tiger.components.agegate={}),"undefined"==typeof tiger.components.annotation&&(tiger.components.annotation={}),"undefined"==typeof tiger.components.blogdropdown&&(tiger.components.blogdropdown={}),"undefined"==typeof tiger.components.channels&&(tiger.components.channels={}),"undefined"==typeof tiger.components.forms&&(tiger.components.forms={}),"undefined"==typeof tiger.components.forms.modals&&(tiger.components.forms.modals={}),"undefined"==typeof tiger.components.forms.search&&(tiger.components.forms.search={}),"undefined"==typeof tiger.components.groupchats&&(tiger.components.groupchats={}),"undefined"==typeof tiger.components.header&&(tiger.components.header={}),"undefined"==typeof tiger.components.header.notifications&&(tiger.components.header.notifications={}),"undefined"==typeof tiger.components.invites&&(tiger.components.invites={}),"undefined"==typeof tiger.components.invites.modals&&(tiger.components.invites.modals={}),"undefined"==typeof tiger.components.liveblog&&(tiger.components.liveblog={}),"undefined"==typeof tiger.components.notifications&&(tiger.components.notifications={}),"undefined"==typeof tiger.components.post&&(tiger.components.post={}),"undefined"==typeof tiger.components.post.button&&(tiger.components.post.button={}),"undefined"==typeof tiger.components.post.inset&&(tiger.components.post.inset={}),"undefined"==typeof tiger.components.post.inset.messages&&(tiger.components.post.inset.messages={}),"undefined"==typeof tiger.components.post.meta&&(tiger.components.post.meta={}),"undefined"==typeof tiger.components.spinner&&(tiger.components.spinner={}),"undefined"==typeof tiger.components.user&&(tiger.components.user={}),"undefined"==typeof tiger.components.user.notifications&&(tiger.components.user.notifications={}),"undefined"==typeof tiger.icons&&(tiger.icons={}),"undefined"==typeof tiger.icons.actions&&(tiger.icons.actions={}),"undefined"==typeof tiger.icons.essential&&(tiger.icons.essential={}),"undefined"==typeof tiger.icons.places&&(tiger.icons.places={}),"undefined"==typeof tiger.messages&&(tiger.messages={}),"undefined"==typeof tiger.page&&(tiger.page={}),"undefined"==typeof tiger.page.notifications&&(tiger.page.notifications={}),"undefined"==typeof tiger.section&&(tiger.section={}),"undefined"==typeof tiger.section.header&&(tiger.section.header={}),"undefined"==typeof tiger.section.sidebar&&(tiger.section.sidebar={}),define("singleton/IframeResizer",["underscore"],function(a){function b(b,c){function d(a,b,c){c.setAttribute(a,b)}if(b&&c){var e=a.filter(document.getElementsByTagName("iframe"),function(a){return decodeURI(a.getAttribute("src"))===decodeURI(c)});a.each(["width","height"],function(c){"number"==typeof b[c]&&a.each(e,d.bind(void 0,c,b[c]))})}}function c(a){var b;if(a.origin.match(e)){try{b=JSON.parse(a.data)}catch(c){return}return b&&b.kinja?b.kinja:!1}}var d,e;return e=/^https?:\/\/(\w+\.)?(kinja.com|gawker-labs.com|localhost:7000|kinja\.dev:9000)$/,d={start:function(){function d(a){var d=c(a);d&&d.resizeFrame&&d.sourceUrl&&b(d.resizeFrame,d.sourceUrl)}window.addEventListener("message",d),window._K_MSGS&&a.each(window._K_MSGS,d),window.removeEventListener("message",window._K_MSG_L),delete window._K_MSG_L}}}),function(){define("module/Main",["backbone","backbone.marionette","jquery","router/AppRouter","singleton/Utils","singleton/Feature","singleton/RavenConfig","singleton/Trackers","singleton/DeviceController","singleton/PerfTracker","module/ads/ads.controller","app/MarionetteApp","singleton/CurrentUser","singleton/CurrentBlog","lib/kriteo","module/foundation/Foundation5","lib/polyfills/json-null-old-android"],function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){var b;g.init(),f.isOn("no3rdparty")?h.loadDummy():(h.load(),i.setDevice(),k.startAds()),f.isOn("remove_approuter")||(b=new d({}),a.history.start({pushState:!1,hashChange:!1})),l.start(),f.isOn("frontendtiming")&&window.setTimeout(function(){j.start()},0)}return c.ajaxSetup({cache:!0}),f.isOn("remove_approuter")||m(),{start:m}})}(),define("view/behaviors/googleAnalytics.behavior",["jquery","underscore","backbone.marionette","lib/amd-wrapped/modernizr","singleton/Feature","singleton/Utils"],function(a,b,c,d,e,f){var g=c.Behavior.extend({events:{"click [data-ga]:not(form)":"onGAClick","submit form[data-ga]":"onGASubmit"},onGAClick:function(b){var c,d=a(b.currentTarget),e=d.closest("a[href]").eq(0);return this.logGAEvent(b),e.length&&(c=e.attr("href"),!/^((http|https):)?\/\//.test(c)||"_blank"===e.attr("target")||b.shiftKey||b.ctrlKey||b.metaKey||(b.preventDefault(),window.setTimeout(function(){window.location.href=c},500))),!0},onGASubmit:function(b){var c=a(b.currentTarget),d=c.attr("action"),e=c.serialize();this.logGAEvent(b),b.preventDefault(),window.setTimeout(function(){window.location.href=d+"?"+e},500)},logGAEvent:function(c){var d=a(c.currentTarget),e=d.attr("data-ga").replace(/[\[\]]/g,"").split(/\s*,\s*/g);e=e.map(function(a){return b.contains(g.validKeys,a)?g.replacePlaceholder(a):a});var f=["send","event"].concat(e);window.ga.apply(this,f)}},{validKeys:["js_pageType","js_pageUrl"],replacePlaceholder:function(a){var b=f.getKinjaMeta();switch(a=a.replace(/js_/g,"")){case"pageType":return b.pageType;case"pageUrl":return window.location.url;default:return""}}});return g}),define("templates/tiger/messages",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.messages.areYouSureToDelPost=function(a,b){var c=b||new d.StringBuilder;return c.append("	Are you sure you want to delete this post?"),b?"":c.toString()},b.messages.areYouSureToDisconnect=function(a,b){var c=b||new d.StringBuilder;return c.append("	Are you sure you want to disconnect this account?"),b?"":c.toString()},b.messages.confirmCloseEditor=function(a,b){var c=b||new d.StringBuilder;return c.append("	Closing the editor will discard any unsaved changes in this post. Is that OK?"),b?"":c.toString()},b.messages.confirmDiscardUnsavedChanges=function(a,b){var c=b||new d.StringBuilder;return c.append("	You have unsaved changes in this post."),b?"":c.toString()},b.messages.confirmHidePost=function(a,b){var c=b||new d.StringBuilder;return c.append("	Are you sure you want to hide this?"),b?"":c.toString()},b.messages.confirmDismissPost=function(a,b){var c=b||new d.StringBuilder;return c.append("	Are you sure you want to dismiss this reply?"),b?"":c.toString()},b.messages.postIsBeingSaved=function(a,b){var c=b||new d.StringBuilder;return c.append("	Your post is being saved, please be patient."),b?"":c.toString()},b.messages.confirmBlockBlog=function(a,b){var c=b||new d.StringBuilder;return c.append("block"==a.action?"Are you sure you want to block "+d.$$escapeHtml(a.username)+" on "+d.$$escapeHtml(a.sitename)+"?":"Are you sure you want to unblock "+d.$$escapeHtml(a.username)+" on "+d.$$escapeHtml(a.sitename)+"?"),b?"":c.toString()},b.messages.quickpostPublish=function(a,b){var c=b||new d.StringBuilder;return c.append("	Save as public"),b?"":c.toString()},b.messages.quickpostSave=function(a,b){var c=b||new d.StringBuilder;return c.append("	Save as private"),b?"":c.toString()},b.messages.quickpostDelete=function(a,b){var c=b||new d.StringBuilder;return c.append("	Delete Post"),b?"":c.toString()},b.messages.publish=function(a,b){var c=b||new d.StringBuilder;return c.append("	Publish"),b?"":c.toString()},b.messages.publishing=function(a,b){var c=b||new d.StringBuilder;return c.append("	Publishing…"),b?"":c.toString()},b.messages.save=function(a,b){var c=b||new d.StringBuilder;return c.append("	Save"),b?"":c.toString()},b.messages.saving=function(a,b){var c=b||new d.StringBuilder;return c.append("	Saving…"),b?"":c.toString()},b.messages.del=function(a,b){var c=b||new d.StringBuilder;return c.append("	Delete"),b?"":c.toString()},b.messages.deleting=function(a,b){var c=b||new d.StringBuilder;return c.append("	Deleting…"),b?"":c.toString()},b.messages.share=function(a,b){var c=b||new d.StringBuilder;return c.append("	Share"),b?"":c.toString()},b.messages.sharing=function(a,b){var c=b||new d.StringBuilder;return c.append("	Sharin"),b?"":c.toString()},b.messages.published=function(a,b){var c=b||new d.StringBuilder;return c.append("	Published"),b?"":c.toString()},b.messages.redirecting=function(a,b){var c=b||new d.StringBuilder;return c.append("	Redirecting…"),b?"":c.toString()},b.messages.manage=function(a,b){var c=b||new d.StringBuilder;return c.append("	Manage"),b?"":c.toString()},b.messages.postReposted=function(a,b){var c=b||new d.StringBuilder;return c.append("	Shared to ",d.$$escapeHtml(a.blogName),'. <a href="',d.$$escapeHtml(a.blogUrl),'">View &raquo;</a>'),b?"":c.toString()},b.messages.postScheduledRepost=function(a,b){var c=b||new d.StringBuilder;return c.append("	Your post has been scheduled to publish."),b?"":c.toString()},b.messages.repostRemoved=function(a,b){var c=b||new d.StringBuilder;return c.append("	Post successfully un-shared from this blog (it may take 1-2 minutes for it to stop displaying)"),b?"":c.toString()},b.messages.unsharePost=function(a,b){var c=b||new d.StringBuilder;return c.append("	Removed share"),b?"":c.toString()},b.messages.areYouSureToUnschedRepost=function(a,b){var c=b||new d.StringBuilder;return c.append("	Are you sure you want to unschedule this repost?"),b?"":c.toString()},b.messages.future=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"future"},f,e),c?"":f.toString()},b.messages.oneSecondAgo=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"seconds"},f,e),c?"":f.toString()},b.messages.someSecondsAgo=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"seconds",amount:a.seconds},f,e),c?"":f.toString()},b.messages.oneMinuteAgo=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"minute"},f,e),c?"":f.toString()},b.messages.someMinutesAgo=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"minutes",amount:a.minutes},f,e),c?"":f.toString()},b.messages.oneHourAgo=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"hours"},f,e),c?"":f.toString()},b.messages.someHoursAgo=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"hours",amount:a.hours},f,e),c?"":f.toString()},b.messages.oneDayAgo=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"days"},f,e),c?"":f.toString()},b.messages.someDaysAgo=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"days",amount:a.days},f,e),c?"":f.toString()},b.messages.oneMonthAgo=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"months"},f,e),c?"":f.toString()},b.messages.someMonthsAgo=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"months",amount:a.months},f,e),c?"":f.toString()},b.messages.oneYearAgo=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"years"},f,e),c?"":f.toString()},b.messages.someYearsAgo=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"years",amount:a.years},f,e),c?"":f.toString()},b.messages.relativeTime=function(a,b){a=a||{};var c=b||new d.StringBuilder;switch(c.append("	"),a.type){case"seconds":c.append(a.amount&&"1"!=a.amount?d.$$escapeHtml(a.amount)+" seconds ago":"1 second ago");break;case"hours":c.append(a.amount&&"1"!=a.amount?d.$$escapeHtml(a.amount)+" hours ago":"an hour ago");break;case"days":c.append(a.amount&&"1"!=a.amount?d.$$escapeHtml(a.amount)+" days ago":"yesterday");break;case"weeks":c.append(a.amount&&"1"!=a.amount?d.$$escapeHtml(a.amount)+" weeks ago":"a week ago");break;case"months":c.append(a.amount&&"1"!=a.amount?d.$$escapeHtml(a.amount)+" months ago":"a month ago");break;case"years":c.append(a.amount&&"1"!=a.amount?d.$$escapeHtml(a.amount)+" years ago":"1 year ago");break;case"future":c.append(d.$$escapeHtml(a.Mddyyhmma));break;case"minutes":c.append(a.amount&&"1"!=a.amount?'<span class="'+(a.timestamp?"minutedisplay-"+d.$$escapeHtml(a.timestamp):"")+'">'+d.$$escapeHtml(a.amount)+"</span> minutes ago":'<span class="'+(a.timestamp?"minutedisplay-"+d.$$escapeHtml(a.timestamp):"")+'">A</span> minute ago');break;case"today":c.append("Today ",d.$$escapeHtml(a.hmma));break;case"yesterday":c.append("Yesterday ",d.$$escapeHtml(a.hmma));break;case"pastweek":c.append(d.$$escapeHtml(a.day)," ",d.$$escapeHtml(a.hmma));break;case"greaterthanweek":c.append(d.$$escapeHtml(a.Mddyyhmma));break;default:c.append("Just now")}return b?"":c.toString()},b.messages.shortRelativeTime=function(a,b){var c=b||new d.StringBuilder;return c.append("	",a.timestamp.minutes?d.$$escapeHtml(a.timestamp.minutes)+"m":a.timestamp.hours?d.$$escapeHtml(a.timestamp.hours)+"h":a.timestamp.days?d.$$escapeHtml(a.timestamp.days)+"d":a.timestamp.weeks?d.$$escapeHtml(a.timestamp.weeks)+"w":a.timestamp.years?d.$$escapeHtml(a.timestamp.years)+"y":"now"),b?"":c.toString()},b.messages.postPublished=function(a,b){var c=b||new d.StringBuilder;return c.append("	Your post has been published."),b?"":c.toString()},b.messages.postSaved=function(a,b){var c=b||new d.StringBuilder;return c.append("	Your post has been saved."),b?"":c.toString()},b.messages.postSaveFailed=function(a,b){var c=b||new d.StringBuilder;return c.append("	Post save failed."),b?"":c.toString()},b.messages.postAlreadyExists=function(a,b){var c=b||new d.StringBuilder;return c.append("	Post was already reposted on this blog."),b?"":c.toString()},b.messages.postTooLong=function(a,b){var c=b||new d.StringBuilder;return c.append("	Your post is too long, please shorten it."),b?"":c.toString()},b.messages.tokenCallFailed=function(a,b){var c=b||new d.StringBuilder;return c.append('	Post failed to save. Please check your network connection and try again.<a class="icon icon-question-circle hover-icon icon-append help-link" href="http://help.gawker.com/customer/portal/articles/1794410-why-am-i-receiving-a-post-save-error-" target="_blank"></a>'),b?"":c.toString()},b.messages.tokenRefreshFailed=function(a,b){var c=b||new d.StringBuilder;return c.append('	Post failed to save. If you logged out of Kinja in another tab, please log in on that tab and try saving again.<a class="icon icon-question-circle hover-icon icon-append help-link" href="http://help.gawker.com/customer/portal/articles/1794410-why-am-i-receiving-a-post-save-error-" target="_blank"></a>'),b?"":c.toString()},b.messages.postSaveTimeout=function(a,b){var c=b||new d.StringBuilder;return c.append("	Post is taking very long to save. Please check your network connection and try again."),b?"":c.toString()},b.messages.postDeleted=function(a,b){var c=b||new d.StringBuilder;return c.append("	The post has been deleted successfully."),b?"":c.toString()},b.messages.repostUnscheduled=function(a,b){var c=b||new d.StringBuilder;return c.append("	The repost has been unscheduled successfully."),b?"":c.toString()},b.messages.postRecommended=function(a,b){var c=b||new d.StringBuilder;return c.append("	You recommended a post."),b?"":c.toString()},b.messages.replySubmitted=function(a,b){var c=b||new d.StringBuilder;return c.append("	Your reply has been submitted."),b?"":c.toString()},b.messages.settingsSaved=function(a,b){var c=b||new d.StringBuilder;return c.append("	Settings saved successfully."),b?"":c.toString()},b.messages.blogPropertySaved=function(a,b){var c=b||new d.StringBuilder;return c.append("	Blog property saved successfully."),b?"":c.toString()},b.messages.blogPropertyCreated=function(a,b){var c=b||new d.StringBuilder;return c.append("	Blog property created successfully."),b?"":c.toString()},b.messages.blogPropertyDeleted=function(a,b){var c=b||new d.StringBuilder;return c.append("	Blog property deleted successfully."),b?"":c.toString()},b.messages.ownerSet=function(a,b){var c=b||new d.StringBuilder;return c.append("	New owner has been set."),b?"":c.toString()},b.messages.cannotDisconnectLoginAccount=function(a,b){var c=b||new d.StringBuilder;return c.append("	You cannot disconnect your login account from Kinja. Please switch your login account, save, and try again."),b?"":c.toString()},b.messages.blogFollowed=function(a,b){var c=b||new d.StringBuilder;return c.append("	You are following ",d.$$escapeHtml(a.blogName),"."),b?"":c.toString()},b.messages.blogFollowFailed=function(a,b){var c=b||new d.StringBuilder;return c.append("	Failed to follow ",d.$$escapeHtml(a.blogName),". Please try again."),b?"":c.toString()},b.messages.blogUnfollowed=function(a,b){var c=b||new d.StringBuilder;return c.append("	You are no longer following ",d.$$escapeHtml(a.blogName),"."),b?"":c.toString()},b.messages.blogUnfollowFailed=function(a,b){var c=b||new d.StringBuilder;return c.append("	Failed to unfollow ",d.$$escapeHtml(a.blogName),". Please try again."),b?"":c.toString()},b.messages.replyCreate=function(a,b){var c=b||new d.StringBuilder;return c.append('<div class="twelve columns end mbx"><div class="reply-create media"><div class="img mrm"><span class="icon icon-bubble-right"></span></div><div class="bd proxima"><span class="msg text-small">No discussion yet. <a href="#" class="js_new-reply-to-post">Start a discussion.</a></span></div></div></div>'),b?"":c.toString()},b.messages.repliesDisabled=function(a,b){var c=b||new d.StringBuilder;return c.append('<div class="twelve columns end mbx"><div class="reply-create media"><div class="img mrm"><span class="icon icon-bubble-right"></span></div><div class="bd proxima"><span class="msg text-small text-light">This discussion is closed</span></div></div></div>'),b?"":c.toString()},b.messages.ajaxError=function(a,b){var c=b||new d.StringBuilder;return c.append("	Sorry, something went wrong.<br>Please try again."),b?"":c.toString()},b.messages.groupchatsRepliesDisabled=function(a,b){var c=b||new d.StringBuilder;return c.append("	This discussion is closed"),b?"":c.toString()},b.messages.unapprovedStartersMessage=function(a,b){var c=b||new d.StringBuilder;return c.append("	Help ",d.$$escapeHtml(a.blog),' identify the best submissions. <span class="icon icon-star inline"></span> compelling replies that ',d.$$escapeHtml(a.blog)," may have overlooked."),b?"":c.toString()},b.messages.moreFooStories=function(a,b){var c=b||new d.StringBuilder;return c.append("	More ",d.$$escapeHtml(a.tag)," stories"),b?"":c.toString()},b.messages.postToMyPersonalBlog=function(a,b){var c=b||new d.StringBuilder;return c.append("	My personal blog only"),b?"":c.toString()},b.messages.filenameContainsSemicolon=function(a,b){var c=b||new d.StringBuilder;return c.append("	The filename cannot contains semicolon"),b?"":c.toString()},b.messages.imageUploadError=function(a,b){var c=b||new d.StringBuilder;return c.append("	Image upload error."),b?"":c.toString()},b.messages.areYouSure=function(a,b){var c=b||new d.StringBuilder;return c.append("	Are you sure?"),b?"":c.toString()},b.messages.assetRecommended=function(a,b){var c=b||new d.StringBuilder;return c.append("	Media recommended."),b?"":c.toString()},b.messages.assetUnrecommended=function(a,b){var c=b||new d.StringBuilder;return c.append("	Removed media recommendation."),b?"":c.toString()},b.messages.linkToDiscussion=function(a,b){var c=b||new d.StringBuilder;return c.append('	<a href="',d.$$escapeHtml(a.url),'" class="proxima discussionpermalink" target="_blank">Link to discussion</a>'),b?"":c.toString()},b.messages.twitterAppUpdated=function(a,b){var c=b||new d.StringBuilder;return c.append('We are updating the Twitter application that you use to connect with Kinja. You will need to re-authorize your account beginning on Jan. 14.<br /><a href="http://product.kinja.com/re-authorizing-your-twitter-account-1493481797">More information here.</a>'),b?"":c.toString()},b.messages.amazonBestSellerReport=function(a,b){var c=b||new d.StringBuilder;return c.append("<p><small>If the blog list is omitted, all blogs will be taken into account. If the limit is set to 0, no limit is set.</small></p>"),b?"":c.toString()},b.messages.amazonTagReport=function(a,b){var c=b||new d.StringBuilder;return c.append("<p><small>Beware: If the checkbox above is unchecked, Amazon statistics and posts will both be filtered by the date picker. This means that earnings and orders for posts which were published earlier will <strong>not</strong> be shown here.</small></p>"),b?"":c.toString()},b.messages.hrNumber=function(a,b){var c=b||new d.StringBuilder;if(c.append("	"),a.value<1e3)c.append(d.$$escapeHtml(a.value));else{var e=Math.floor(a.value%1e3/100);c.append(d.$$escapeHtml(Math.floor(a.value/1e3)),e>0?"."+d.$$escapeHtml(e):"","k")}return b?"":c.toString()},b.messages.postSave=function(a,c,e){a=a||{};var f=c||new d.StringBuilder;return f.append('	<div class="js_post-save-loader loading-full animate"><div class="loading-message-box">',a.showMessage?'<p class="message">Saving...</p><p class="message-still">Still Saving...</p>':""),b.components.spinner.bounce(null,f,e),f.append("</div></div>"),c?"":f.toString()},b.messages.loginSuccess=function(a,b){var c=b||new d.StringBuilder;return c.append("	Login successful."),b?"":c.toString()},b.messages.notifications=function(a,b){var c=b||new d.StringBuilder;return c.append("	",d.$$escapeHtml(a.count)," notifications"),b?"":c.toString()},b.messages.undoDismissMsg=function(a,b){var c=b||new d.StringBuilder;return c.append("	You have successfully dismissed this reply."),b?"":c.toString()},b.messages.undoBlockMsg=function(a,b){var c=b||new d.StringBuilder;return c.append("	You have successfully dismissed this reply and blocked ",d.$$escapeHtml(a.userName)," from ",d.$$escapeHtml(a.blogName)),b?"":c.toString()},b.messages.undoResolveMsg=function(a,b){var c=b||new d.StringBuilder;return c.append("	You have successfully resolved the flag on this reply."),b?"":c.toString()}}),define("templates/tiger/components/notifications/button",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.notifications.button=function(a,c,e){var f=c||new d.StringBuilder;f.append('<a href="#" class="js_notification-trigger hide-for-medium-down toolbar-icon notifications-menu is-loaded ',a.notificationCount>0?"has-notification":"",'" title="'),a.notificationCount>999?b.messages.notifications({count:a.notificationCount},f,e):f.append("Notifications"),f.append('" data-dropdown="notifications-menu"><span class="icon-circle icon-notifications"></span>');var g=new d.StringBuilder(a.notificationCount>999?"infinite":a.notificationCount>99?"hundred":1==a.notificationCount?"only-one":"");return g=g.toString(),f.append('<span class="notification-count js_notification-count ',d.$$escapeHtml(g),'">'),b.components.notifications.count(a,f,e),f.append("</span></a>"),c?"":f.toString()},b.components.notifications.count=function(a,b){var c=b||new d.StringBuilder;c.append("	");var e=new d.StringBuilder(a.notificationCount>999?"∞":a.notificationCount?d.$$escapeHtml(a.notificationCount):"");return e=e.toString(),c.append(e?d.$$escapeHtml(e):""),b?"":c.toString()}}),define("templates/tiger/components/header/notifications",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.header.notifications.notificationsEmpty=function(a,b){var c=b||new d.StringBuilder;return c.append('	<li class="text-center pvm js_notification-item">You have no unread notifications.</li>'),b?"":c.toString()},b.components.header.notifications.notificationsSpinner=function(a,c,e){var f=c||new d.StringBuilder;return f.append('	<li class="js_spinner notifications-spinner">'),b.components.spinner.bounce(null,f,e),f.append("</li>"),c?"":f.toString()},b.components.header.notifications.globalNotificationsDropdown=function(a,b){var c=b||new d.StringBuilder;return c.append('	<section class="notif-list"><div class="notif-list-scroll-wrapper"><ul class="js_notification-list menu-list"></ul></div><ul class="menu-list see-all-link"><li class="more"><a class="js_event-link js_see-all-notifications" data-ga="[Notifications Menu, See All Notifications Click]" href="//kinja.com/dashboard/notifications">See all notifications</a></li></ul></section>'),b?"":c.toString()},b.components.header.notifications.globalNotificationEvent=function(a,c,e){var f=c||new d.StringBuilder;switch(f.append("	"),a.item.variant){case"PresentableApproval":b.components.header.notifications.approval(a,f,e);break;case"PresentableUserFollow":b.components.header.notifications.userfollow(a,f,e);break;case"PresentableBlogFollow":b.components.header.notifications.blogfollow(a,f,e);break;case"PresentableMessage":b.components.header.notifications.message(a,f,e);break;case"PresentablePostFollow":b.components.header.notifications.postfollow(a,f,e);break;case"PresentablePostLikeGroup":a.item.sourceAuthorData&&a.item.sourceAuthorData.id&&b.components.header.notifications.postlikegroup(a,f,e);break;case"PresentableReply":b.components.header.notifications.reply(a,f,e);break;case"PresentableRepost":b.components.header.notifications.repostpost(a,f,e);break;case"PresentableShare":b.components.header.notifications.sharepost(a,f,e)}return f.append('<span class="unread-marker"></span>'),c?"":f.toString()},b.components.header.notifications.blogfollow=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");var g=e.features.svgicons;f.append('<a href="//kinja.com/',d.$$escapeHtml(a.item.sourceAuthorData.screenName),'" data-ga="[Notifications Menu, Follow Notification Click]" class="js_event-link event-follow"><div class="row collapse"><div class="col small-2 center">'),g?(f.append('<span class="icon--svg">'),b.icons.essential.add(null,f,e),f.append("</span>")):f.append('<span class="icon icon-plus-circle"></span>'),f.append('</div><div class="col small-10"><time>',d.$$escapeHtml(a.item.relativeTime),'</time></div></div><div class="row collapse"><div class="col small-2 center"><span class="avatar">');var h=new d.StringBuilder("avt-small");return h=h.toString(),f.append('<img src="',d.$$escapeHtml(window.kinja.imageUrl(a.item.sourceAuthorData.avatar.id,h,a.item.sourceAuthorData.avatar.format)),'" /></span></div><div class="col small-10"><span class="txt"><span class="name">',d.$$escapeHtml(a.item.sourceAuthorData.defaultBlog.displayName),'</span><span class="event-msg">started following you.</span></span></div></div></a>'),c?"":f.toString()},b.components.header.notifications.approval=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");var g=e.features.svgicons;if(f.append('<a href="http://',d.$$escapeHtml(a.item.sourceBlogData.canonicalHost),'" data-ga="[Notifications Menu, Follow Notification Click]" class="js_event-link event-follow"><div class="row collapse"><div class="col small-2 center">'),g?(f.append('<span class="icon--svg">'),b.icons.essential.add(null,f,e),f.append("</span>")):f.append('<span class="icon icon-thumbsup"></span>'),f.append('</div><div class="col small-10"><time>',d.$$escapeHtml(a.item.relativeTime),'</time></div></div><div class="row collapse"><div class="col small-2 center"><span class="avatar">'),a.item.sourceBlogData.avatar){var h=new d.StringBuilder("avt-small");h=h.toString(),f.append('<img src="',d.$$escapeHtml(window.kinja.imageUrl(a.item.sourceBlogData.avatar.id,h,a.item.sourceBlogData.avatar.format)),'" />')}else f.append('<img src="',d.$$escapeHtml(a.imgPath),'icons/icon-kinja-nav.png" />');return f.append('</span></div><div class="col small-10"><span class="txt"><span class="name">',d.$$escapeHtml(a.item.sourceBlogData.displayName),'</span><span class="event-msg">',e.features.approvemessage?"approved you":"started following you","</span></span></div></div></a>"),c?"":f.toString()},b.components.header.notifications.reply=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");var g=(a.item.reply,a.item.sourceAuthorData.displayName),h=e.features.svgicons;f.append(e.features.hide_pending_replies&&!a.item.postData.approved?'<span class="pending-label">Pending approval</span>':"",'<a href="',d.$$escapeHtml(a.item.postData.permalink),'" data-ga="[Notifications Menu, Reply Notification Click]" class="js_event-link event-reply"><div class="row collapse"><div class="col small-2 center">'),h?(f.append('<span class="icon--svg">'),b.icons.essential.bubble(null,f,e),f.append("</span>")):f.append('<span class="icon icon-bubble-round"></span>'),f.append('</div><div class="col small-10"><time>',d.$$escapeHtml(a.item.relativeTime),'</time></div></div><div class="row collapse"><div class="col small-2 center">');var i=new d.StringBuilder("avt-small");return i=i.toString(),f.append('<span class="avatar">',a.item.sourceAuthorData.avatar?'<img src="'+d.$$escapeHtml(window.kinja.imageUrl(a.item.sourceAuthorData.avatar.id,i,a.item.sourceAuthorData.avatar.format))+'" />':'<span class="avatar-default"></span>','</span></div><div class="col small-10"><span class="txt"><span class="name"><span class="ellipsis">',d.$$filterNoAutoescape(g),'</span> <span class="text-normal text-small">replied to you:</span></span>&nbsp;<span class="msg-excerpt">',d.$$truncate(d.$$filterNoAutoescape(a.item.postData.plaintext),80,!0),"</span></span></div></div></a>"),c?"":f.toString()},b.components.header.notifications.postlikegroup=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");var g=a.item.sourceAuthorsData.length,h=e.features.svgicons;f.append('<a href="',d.$$escapeHtml(a.item.postData.permalink),'" data-ga="[Notifications Menu, Recommend Group Notification Click]" class="js_event-link event-like"><div class="row collapse"><div class="col small-2 center">'),h?(f.append('<span class="icon--svg">'),b.icons.essential.star(null,f,e),f.append("</span>")):f.append('<span class="icon icon-star"></span>'),f.append('</div><div class="col small-10"><time>',d.$$escapeHtml(a.item.relativeTime),'</time></div></div><div class="row collapse"><div class="col small-2 center"><span class="avatar">');var i=new d.StringBuilder("avt-small");return i=i.toString(),f.append('<img src="',d.$$escapeHtml(window.kinja.imageUrl(a.item.sourceAuthorData.avatar.id,i,a.item.sourceAuthorData.avatar.format)),'" /></span></div><div class="col small-10"><span class="txt">',a.item.postData.headline?1==g?'<span class="name">'+d.$$escapeHtml(a.item.sourceAuthorData.displayName)+' </span><span class="event-msg">and one other recommended <strong>'+d.$$filterNoAutoescape(a.item.postData.headline)+"</strong>.</span>":g>1?'<span class="name">'+d.$$escapeHtml(a.item.sourceAuthorData.displayName)+' </span><span class="event-msg">and '+d.$$escapeHtml(a.item.sourceAuthorsData.length)+" others recommended <strong>"+d.$$filterNoAutoescape(a.item.postData.headline)+"</strong>.</span>":'<span class="name">'+d.$$escapeHtml(a.item.sourceAuthorData.displayName)+' </span><span class="event-msg">recommended <strong>'+d.$$filterNoAutoescape(a.item.postData.headline)+"</strong>.</span></span>":1==g?'<span class="name">'+d.$$escapeHtml(a.item.sourceAuthorData.displayName)+' </span><span class="event-msg">and one other recommended your post.</span></span>':g>1?'<span class="name">'+d.$$escapeHtml(a.item.sourceAuthorData.displayName)+' </span><span class="event-msg">and '+d.$$escapeHtml(a.item.sourceAuthorsData.length)+" others recommended your post</strong>.</span></span>":'<span class="name">'+d.$$escapeHtml(a.item.sourceAuthorData.displayName)+' </span><span class="event-msg">recommended your post.</span></span>',"</span></div></div></a>"),c?"":f.toString()},b.components.header.notifications.message=function(a,c,e){var f=c||new d.StringBuilder,g=e.features.svgicons;f.append('<div><div class="row collapse" data-ga="[Notifications Menu, Message Notification Click]"><div class="col small-2 center">'),g?(f.append('<span class="icon--svg">'),b.icons.actions.lightning(null,f,e),f.append("</span>")):f.append('<span class="icon icon-megaphone"></span>'),f.append('</div><div class="col small-10"><time>',d.$$escapeHtml(a.item.relativeTime),'</time></div></div><div class="row collapse"><div class="col small-2 center"><span class="avatar">');
var h=new d.StringBuilder("avt-small");return h=h.toString(),f.append('<img src="',d.$$escapeHtml(window.kinja.imageUrl(null==a.item.sourceAuthorData?null:a.item.sourceAuthorData.avatar.id,h,null==a.item.sourceAuthorData?null:a.item.sourceAuthorData.avatar.format)),'" /></span></div><div class="col small-10"><span class="txt"><span class="name">',d.$$escapeHtml(null==a.item.sourceAuthorData?null:a.item.sourceAuthorData.displayName),'</span> messaged you:<br><span class="msg-excerpt">',d.$$escapeHtml(a.item.message),"</span></span></div></div></div>"),c?"":f.toString()},b.components.header.notifications.postfollow=function(a,b){var c=b||new d.StringBuilder;return b?"":c.toString()},b.components.header.notifications.sharepost=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");var g=e.features.svgicons;f.append('<a href="',d.$$escapeHtml(a.item.sharedData.permalink),'" data-ga="[Notification Menu, Menu - Share Notification]" class="js_event-link event-share"><div class="row collapse"><div class="col small-2 center">'),g?(f.append('<span class="icon--svg">'),b.icons.essential.externalLink(null,f,e),f.append("</span>")):f.append('<span class="icon icon-share"></span>'),f.append('</div><div class="col small-10"><time>',d.$$escapeHtml(a.item.relativeTime),'</time></div></div><div class="row collapse"><div class="col small-2 center"><span class="avatar">');var h=new d.StringBuilder("avt-small");return h=h.toString(),f.append('<img src="',d.$$escapeHtml(window.kinja.imageUrl(a.item.sourceAuthorData.avatar.id,h,a.item.sourceAuthorData.avatar.format)),'" /></span></div><div class="col small-10"><span class="txt"><span class="name">',d.$$escapeHtml(a.item.sourceAuthorData.displayName),'</span><span class="event-msg">shared your post as <strong>',d.$$filterNoAutoescape(a.item.sharedData.headline),"</strong></span></span></div></div></a>"),c?"":f.toString()},b.components.header.notifications.repostpost=function(a,c,e){var f=c||new d.StringBuilder,g=e.features.svgicons;if(a.item.postActionData){f.append('<a href="',d.$$escapeHtml(a.item.postActionData.post.permalink),'" data-ga="[Notification Menu, Menu - Repost Notification]" class="js_event-link event-share"><div class="row collapse"><div class="col small-2 center">'),g?(f.append('<span class="icon--svg">'),b.icons.essential.externalLink(null,f,e),f.append("</span>")):f.append('<span class="icon icon-share"></span>'),f.append('</div><div class="col small-10"><time>',d.$$escapeHtml(a.item.relativeTime),'</time></div></div><div class="row collapse"><div class="col small-2 center"><span class="avatar">');var h=new d.StringBuilder("avt-small");h=h.toString(),f.append('<img src="',d.$$escapeHtml(window.kinja.imageUrl(a.item.sourceAuthorData.avatar.id,h,a.item.sourceAuthorData.avatar.format)),'" /></span></div><div class="col small-10"><span class="txt">',a.item.postActionData.post.headline?'<span class="name">'+d.$$escapeHtml(a.item.sourceAuthorData.displayName)+'</span><span class="event-msg">reposted <strong>'+d.$$filterNoAutoescape(a.item.postActionData.post.headline)+"</strong></span>":'<span class="name">'+d.$$escapeHtml(a.item.sourceAuthorData.displayName)+'</span><span class="event-msg">reposted your reply</span>',"</span></div></div></a>")}return c?"":f.toString()},b.components.header.notifications.globalNotificationsButton=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");var g=new d.StringBuilder(a.notificationCount>999?"infinite":a.notificationCount>99?"hundred":1==a.notificationCount?"only-one":"");g=g.toString();var h=e.features.svgicons;return f.append('<a class="js_notif show-for-large-up js_menu-button ',a.notificationCount?"has-notification":"",'" data-dropdown="js_notifications--dropdown" data-ga="[Notifications Menu, Notifications Menu Click, ',a.notificationCount?"New":"Neutral",']">'),a.notificationCount?(f.append('<span class="js_notifications-count notif-circle ',d.$$escapeHtml(g),'">'),b.components.header.notifications.count(a,f,e),f.append("</span>")):(f.append('<span class="notif-circle">'),h?b.icons.actions.lightning(null,f,e):f.append(e.features.outline_icons?'<span class="icon icon-lightning"></span>':'<span class="icon icon-lightning-fill"></span>'),f.append("</span>")),f.append('</a><a class="js_notif show-for-medium-down js_offcanvas-notif right-off-canvas-toggle js_menu-button ',a.notificationCount?"has-notification":"",'" data-ga="[Notifications Menu, Notifications Menu Click, ',a.notificationCount?"New":"Neutral",']">'),a.notificationCount?(f.append('<span class="js_notifications-count notif-circle ',d.$$escapeHtml(g),'">'),b.components.header.notifications.count(a,f,e),f.append("</span>")):(f.append('<span class="notif-circle">'),h?b.icons.actions.lightning(null,f,e):f.append(e.features.outline_icons?'<span class="icon icon-lightning"></span>':'<span class="icon icon-lightning-fill"></span>'),f.append("</span>")),f.append("</a>"),c?"":f.toString()},b.components.header.notifications.count=function(a,b){var c=b||new d.StringBuilder;return c.append("	",a.notificationCount>999?"∞":d.$$escapeHtml(a.notificationCount)),b?"":c.toString()},b.components.header.notifications.userfollow=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");var g=e.features.svgicons;f.append('<a href="//kinja.com/',d.$$escapeHtml(a.item.sourceAuthorData.screenName),'" data-ga="[Notifications Menu, Follow Notification Click]" class="js_event-link event-follow"><div class="row collapse"><div class="col small-2 center">'),g?(f.append('<span class="icon--svg">'),b.icons.essential.add(null,f,e),f.append("</span>")):f.append('<span class="icon icon-plus-circle"></span>'),f.append('</div><div class="col small-10"><time>',d.$$escapeHtml(a.item.relativeTime),'</time></div></div><div class="row collapse"><div class="col small-2 center"><span class="avatar">');var h=new d.StringBuilder("avt-small");return h=h.toString(),f.append('<img src="',d.$$escapeHtml(window.kinja.imageUrl(a.item.sourceAuthorData.avatar.id,h,a.item.sourceAuthorData.avatar.format)),'" /></span></div><div class="col small-10"><span class="txt"><span class="name">',d.$$escapeHtml(a.item.sourceAuthorData.displayName),'</span><span class="event-msg">started following you.</span></span></div></div></a>'),c?"":f.toString()}}),define("app/notifdropdown/NotificationButton",["backbone.marionette","jquery","app/account/account.channel","singleton/Feature","view/behaviors/googleAnalytics.behavior","templates/tiger/messages","templates/tiger/components/notifications/button","templates/tiger/components/header/notifications"],function(a,b,c,d,e){var f=a.ItemView.extend({template:tiger.components.header.notifications.globalNotificationsButton,tagName:"span",attributes:function(){return{"data-ga":"["+["Notifications Menu","Notifications Button Click",this.model.get("notificationCount")?"New":"Neutral"].join(", ")+"]"}},behaviors:{GoogleAnalyticsBehavior:{behaviorClass:e}},activeClass:"active",modelEvents:{"change:notificationCount":"render"},render:function(){a.ItemView.prototype.render.apply(this)},doClick:function(a){this.model.isLoggedIn()?this.toggleClass():(a.stopPropagation(),this.requireLogin())},requireLogin:function(){c.trigger("loginRequired",{source:"notificationButton"})},toggleClass:function(){this.$el.toggleClass(this.activeClass)}});return f}),define("model/Notification",["jquery","config","backbone","apiclient/profile"],function(a,b,c,d){var e=c.Model.extend({sync:function(a,b){return"delete"===a?d.deleteNotification({notificationId:b.get("id")}):void 0}});return e}),define("singleton/DateUtils",["singleton/Renderer","moment","templates/tiger/messages"],function(a,b){var c={getRelativeTime:function(b){var c=Math.round(((new Date).getTime()-parseInt(b,10))/1e3),d=Math.round(c/60),e=Math.round(c/3600),f=Math.round(c/86400),g=Math.round(c/2592e3),h=Math.round(c/31536e3),i=a.renderTemplate,j="";return j=60>c?1===c?i(tiger.messages.oneSecondAgo):i(tiger.messages.someSecondsAgo,{seconds:c}):60>d?1===d?i(tiger.messages.oneMinuteAgo):i(tiger.messages.someMinutesAgo,{minutes:d}):24>e?1===e?i(tiger.messages.oneHourAgo):i(tiger.messages.someHoursAgo,{hours:e}):30>f?1===f?i(tiger.messages.oneDayAgo):i(tiger.messages.someDaysAgo,{days:f}):12>g?1===g?i(tiger.messages.oneMonthAgo):i(tiger.messages.someMonthsAgo,{months:g}):1===h?i(tiger.messages.oneYearAgo):i(tiger.messages.someYearsAgo,{years:h}),j.textContent.replace(/^\s+|\s+$/g,"")},getMDYYYYHHMM:function(a){return b(a).format("M/D/YYYY H:mm")},getMDYYYY:function(a){return b(a).format("M/D/YYYY")},getDateTimeLocalString:function(a){return b(a).format("YYYY-MM-DDTHH:mm:ss")},getTimeInMilliseconds:function(a){return new Date(a).getTime()}};return c}),define("apiclient/notification",["config","apiclient/apirequest","apiclient/gettoken"],function(a,b,c){var d,e=a.api.mantle.url,f=a.api.notification.url;return d={getNotificationCount:b.getJson(c.append(f+"/notification/views/unseenCount")),deleteNotification:b.deleteJson(c.append(f+"/notification/{{notificationId}}")),getNotifications:b.getJson(c.append(e+"/notifications/paginated/{{userId}}"))}}),define("collection/Notifications",["jquery","underscore","backbone","model/Notification","singleton/CurrentUser","singleton/Utils","singleton/DateUtils","apiclient/notification"],function(a,b,c,d,e,f,g,h){var i=c.Collection.extend({model:d,initialize:function(a,d){c.Collection.prototype.initialize.call(this,a,d),this.options=b.extend(this.options,d||{})},sync:function(a,b,c){return h.getNotifications({markAsRead:!0,userId:e.id,maxReturned:5},c)},parse:function(a){return!a||!a.data||!a.meta||a.meta.error||a.meta.success&&a.meta.success!==!0?[]:b.map(a.data.items,function(a){return a.relativeTime=g.getRelativeTime(a.createdAt),a.variant=a.$variant,a})}});return i}),define("templates/tiger/components/post/meta/avatar-display",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.post.meta.avatarDisplay=function(a,c,e){a=a||{};var f=c||new d.StringBuilder;return f.append('	<div class="avatar avatar-container js_avatar-container"',a.dropdownName?' data-dropdownhover="'+d.$$escapeHtml(a.dropdownName)+'"':"",">"),e.features.svgicons?(f.append('<span class="icon--svg">'),b.icons.essential.checkmark(null,f,e),f.append("</span>")):f.append('<span class="icon icon-checkmark icon-followed"></span>'),f.append(a.url&&"http://"!=a.url?'<a href="'+d.$$escapeHtml(a.url)+'"'+(a.nofollow?' rel="nofollow"':"")+">":"",'<span class="img-border',a.avatar?"":" hide",'"><img src="',a.avatar?d.$$escapeHtml(a.avatar):"",'" /></span><span class="avatar-default',a.avatar?" hide":"",'"></span>',a.url&&"http://"!=a.url?"</a>":"","</div>"),c?"":f.toString()}}),define("templates/tiger/components/post/meta/meta-components",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.post.meta.byline=function(a,b){var c=b||new d.StringBuilder;if(c.append("	","repost"==a.mode&&a.reposter?d.$$escapeHtml(a.reposter.displayName)+' <span class="text-italic">shared a post by</span> '+(""==a.post.byline?'<a href="//kinja.com/'+d.$$escapeHtml(a.post.author.screenName)+'" class="text-light"'+(a.post.isPromoted?' rel="nofollow"':"")+">"+d.$$escapeHtml(a.post.author.displayName)+"</a>":d.$$escapeHtml(window.kinja.stripHtmlTags(a.post.byline,""))):""),a.post.showByline&&(!a.post.postAction||!a.post.postAction.author)&&"repost"!=a.mode){if(c.append('<span class="display-name author vcard">',""==a.post.byline?'<a href="//kinja.com/'+d.$$escapeHtml(a.post.author.screenName)+"\" onclick=\"window.ga('send', 'event', 'byline', 'click', "+(a.pageType?" '"+d.$$escapeHtml(a.pageType)+"' ":" 'private'")+');" '+(a.post.isPromoted?' rel="nofollow"':"")+' class="fn url">'+d.$$escapeHtml(a.post.author.displayName)+"</a>":d.$$escapeHtml(window.kinja.stripHtmlTags(a.post.byline,"")),"</span>"),a.post.allowReplies&&"reply"!=a.mode){var e=a.post.sharedPost?a.post.sharedPost.replyCount:a.post.replyCount?a.post.replyCount:0;c.append(e&&e>0?' <a href="'+("permalink"!=a.pageType?d.$$escapeHtml(a.post.permalink):"")+'#replies" class="text-light'+("reply"==a.mode?" js_expand-branch":" js_reply-to-post-disabled")+"\" rel=\"nofollow\" onClick=\"window.ga('send', 'event', 'Front page click', 'click', 'Front page click - post comments');\">"+(1==e?"and "+d.$$escapeHtml(e)+" other":"and "+d.$$escapeHtml(e)+" others")+"</a>":"")}c.append("reply"==a.mode&&a.post.replyMeta.parentAuthor?'&nbsp;replied to a post by&nbsp;<span class="strong">'+(""==a.post.replyMeta.parentByline?'<a href="//kinja.com/'+d.$$escapeHtml(a.post.replyMeta.parentAuthor.screenName)+'" class="text-light"'+(a.post.isPromoted?' rel="nofollow"':"")+">"+d.$$escapeHtml(a.post.replyMeta.parentAuthor.displayName)+"</a>":d.$$escapeHtml(a.post.replyMeta.parentByline))+"</span>":"")}return c.append(a.post.postAction&&a.post.postAction.author&&"repost"!=a.mode?d.$$escapeHtml(a.post.postAction.author.displayName)+' <span class="text-italic">'+("shared-reply"==a.mode?"shared a reply by":"shared a post by")+"</span> "+(""==a.post.byline?'<a href="//kinja.com/'+d.$$escapeHtml(a.post.author.screenName)+'" class="text-light"'+(a.post.isPromoted?' rel="nofollow"':"")+">"+d.$$escapeHtml(a.post.author.displayName)+"</a>":d.$$escapeHtml(window.kinja.stripHtmlTags(a.post.byline,""))):"","profileposts"==a.pageType?'<p class="posted-on-blog">posted on<a href="//'+d.$$escapeHtml(a.post.defaultBlogHost)+'"> '+d.$$escapeHtml(a.post.defaultBlogName)+"</a></p>":""),b?"":c.toString()},b.components.post.meta.topByline=function(a,c,e){var f=c||new d.StringBuilder;if(f.append("	"),a.post.showByline)if(""==a.post.byline){f.append('<span class="display-name author vcard"><a href="//kinja.com/',d.$$escapeHtml(a.post.author.screenName),'" target="_self" ',a.post.isPromoted?'rel="nofollow"':""," ",a.dropdownName?' data-dropdownhover-anchor="'+d.$$escapeHtml(a.dropdownName)+'"':""," class=\"fn url\" onclick=\"window.ga('send', 'event', 'byline', 'click', 'permalink');\" >",d.$$escapeHtml(a.post.author.displayName),"</a>");var g=(null==e.replyData?null:e.replyData.atUser)==a.post.authorBlogName;if(f.append(g?'<span class="moderator-name">, Host</span>':""),"reply"==a.mode&&(null==a.post.replyMeta?null:null==a.post.replyMeta.parentAuthor?null:a.post.replyMeta.parentAuthor.displayName)&&(f.append('<span class="reply-author replyto-author">'),e.features.svgicons?(f.append('<span class="icon--svg">'),b.icons.essential.chevronRight(null,f,e),f.append("</span>")):f.append('<span class="icon icon-arrow-small-right text-light"></span>'),f.append(d.$$escapeHtml((null==a.post.replyMeta?null:a.post.replyMeta.showParentByline)&&""!=(null==a.post.replyMeta?null:a.post.replyMeta.parentByline)?window.kinja.stripHtmlTags(a.post.replyMeta.parentByline,""):a.post.replyMeta.parentAuthor.displayName),"</span>")),f.append(a.contributors?' <span class="text-normal text-tiny">'+(1==a.contributors?"and 1 other":a.contributors>1?"and "+d.$$escapeHtml(a.contributors)+" others":"")+"</span>":"","</span>"),a.blog&&a.post.isStarter&&a.post.defaultBlogId!=a.post.author.defaultBlogId&&a.post.defaultBlogId!=a.blog.id||a.forSharedPost){f.append('<span class="published-on">');for(var h=a.post.blogs,i=h.length,j=0;i>j;j++){var k=h[j];f.append(k.id==a.post.defaultBlogId?' on <a class="blog-name" href="http://'+d.$$escapeHtml(k.canonicalHost)+'" target="_self" '+(a.post.isPromoted?'rel="nofollow"':"")+">"+d.$$escapeHtml(k.displayName)+"</a>":"")}f.append("</span>")}}else f.append('<span class="display-name">',d.$$escapeHtml(window.kinja.stripHtmlTags(a.post.byline,"")),"</span>");return f.append(a.post.postAction&&a.post.postAction.author&&a.post.postAction.author.displayName?'<span class="reposted-by">shared by <span class="text-upper">'+d.$$escapeHtml(a.post.postAction.author.displayName)+"</span></span>":""),c?"":f.toString()},b.components.post.meta.promotedByline=function(a,c,e){var f=c||new d.StringBuilder;if(f.append('	<span class="meta-promoted"><span class="promoted-dot">&middot;</span> '),(a.post.sponsored||a.post.isBillboardPost)&&(f.append('<span class="sponsored-label text-upper">Sponsored</span>'),e.features.svgicons?(f.append('<span class="icon--svg">'),b.icons.essential.starCircle(null,f,e),f.append("</span>")):f.append('<span class="icon icon-star-circle mhs"></span>')),a.post.isPromoted){var g=new d.StringBuilder(a.post.promotion&&a.post.promotion.byline&&""!=a.post.promotion.byline?d.$$escapeHtml(a.post.promotion.byline):a.post.promotion&&a.post.promotion.authorDisplayName?d.$$escapeHtml(a.post.promotion.authorDisplayName):"");g=g.toString(),f.append('Promoted by <span class="js_promoted_displayName">',d.$$filterNoAutoescape(g),"</span>")}return f.append("</span>"),c?"":f.toString()},b.components.post.meta.publishTime=function(a,c,e){var f=c||new d.StringBuilder;return f.append('	<span class="publish-time js_publish_time" data-publishtime="',d.$$escapeHtml(a.post.publishTimeMillis),'">'),a.post.postAction&&a.post.postAction.createTime?(f.append('<a class="hover-switch" href="',d.$$escapeHtml(a.post.permalink),'" target="_self" ',a.post.isPromoted?'rel="nofollow"':"",">"),b.components.post.meta.formattedTime({time:a.post.postAction.createTime,showRelativeTime:a.showRelativeTime},f,e),f.append("</a>")):a.post.publishTime&&("SCHEDULED"==a.post.status?(f.append('Scheduled: <a class="hover-switch" href="',d.$$escapeHtml(a.post.permalink),'" target="_self" ',a.post.isPromoted?'rel="nofollow"':"",">"),b.components.post.meta.formattedTime({time:a.post.publishTime,showRelativeTime:a.showRelativeTime},f,e),f.append("</a>"),e.features.svgicons?(f.append('<span class="icon--svg u-inline">'),b.icons.actions.clock(null,f,e),f.append("</span>")):f.append('<span class="icon icon-clock inline"></span>')):"DRAFT"==a.post.status?(f.append("Draft"),e.features.svgicons?(f.append('<span class="icon--svg u-inline">'),b.icons.actions.write(null,f,e),f.append("</span>")):f.append('<span class="icon icon-pencil-alt inline"></span>'),f.append('<a class="hover-switch" href="',d.$$escapeHtml(a.post.permalink),'" target="_self" ',a.post.isPromoted?'rel="nofollow"':"",">"),b.components.post.meta.formattedTime({time:a.post.publishTime,showRelativeTime:a.showRelativeTime},f,e),f.append("</a>")):(f.append('<a class="hover-switch" href="',d.$$escapeHtml(a.post.permalink),'" target="_self" ',a.post.isPromoted?'rel="nofollow"':"",">"),b.components.post.meta.formattedTime({time:a.post.publishTime,showRelativeTime:a.showRelativeTime},f,e),f.append("</a>"))),f.append("</span>"),c?"":f.toString()},b.components.post.meta.avatarContainer=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");var g=new d.StringBuilder("avt-small");if(g=g.toString(),a.post.showByline&&""==a.post.byline&&(null==a.post.author?null:a.post.author.avatar)){b.components.post.meta.avatarPopover({author:a.post.author,idName:d.$$escapeHtml(a.post.id)+"-hovercard"},f,e);var h="gif"==a.post.author.avatar.format?"jpg":a.post.author.avatar.format;b.components.post.meta.avatarDisplay({url:"//kinja.com/"+a.post.author.screenName,avatar:window.kinja.imageUrl(a.post.author.avatar.id,g,h),nofollow:a.post.isPromoted,dropdownName:d.$$escapeHtml(a.post.id)+"-hovercard"},f,e)}else a.post.salesAvatarMap?b.components.post.meta.avatarDisplay({avatar:window.kinja.imageUrl(a.post.salesAvatarMap.id,g)},f,e):b.components.post.meta.avatarDisplay(null,f,e);return c?"":f.toString()},b.components.post.meta.avatarPopover=function(a,c,e){var f=c||new d.StringBuilder;if(f.append('<div id="',d.$$escapeHtml(a.idName),'" class="f-dropdown author-hovercard content small whitelisted-links js_avatar-popover" data-dropdownhover-content>'),a.author.avatar){f.append('<span class="floated-container img-60 avatar-container js_avatar-container">');var g=new d.StringBuilder("avt-medium");g=g.toString(),f.append('<span class="avatar">'),e.features.svgicons?(f.append('<span class="icon--svg">'),b.icons.essential.checkmark(null,f,e),f.append("</span>")):f.append('<span class="icon icon-checkmark icon-followed"></span>'),f.append(a.author.avatar.id&&a.author.avatar.format?'<img data-src="'+d.$$escapeHtml(window.kinja.imageUrl(a.author.avatar.id,g,a.author.avatar.format))+'" alt="'+d.$$escapeHtml(a.author.screenName)+'" />':'<span class="avatar-default"></span>',"</span>")}return f.append('<div class="js_follow-controls js_user-follow-controls" data-authorid="',d.$$escapeHtml(a.author.id),'"><h4>',d.$$escapeHtml(a.author.displayName),'</h4><a href="//kinja.com/',d.$$escapeHtml(a.author.screenName),"\" class=\"button tiny secondary mrs\" target=\"_blank\" onclick=\"window.ga('send', 'event', 'Group Chats', 'click', 'Hover card - profile page button click');\">Profile</a><a href=\"#\" class=\"button tiny secondary js_followforuser mrs\" onclick=\"window.ga('send', 'event', 'Group Chats', 'click', 'Hover card - follow button click');\">Follow</a><a href=\"#\" class=\"button tiny secondary js_unfollowforuser mrs hide\">Unfollow</a></div></div>"),c?"":f.toString()},b.components.post.meta.postInfo=function(a,c,e){var f=c||new d.StringBuilder;return f.append('	<span class="meta-tools"><div class="view-count-container"></div><a data-likecount="',d.$$escapeHtml(a.post.likes),'" href="#" class="js_like button-recommend-post hover-icon" title="Recommend"><span class="js_like_count">',a.post.likes&&a.post.likes>0?d.$$escapeHtml(a.post.likes):"","</span>"),e.features.svgicons?(f.append('<span class="icon--svg u-appended js_like_icon">'),b.icons.essential.star(null,f,e),f.append("</span>")):f.append(e.features.png_iconset?'<span class="icon medium icon-star icon-append js_like_icon"></span>':'<span class="icon icon-star icon-append js_like_icon"></span>'),f.append("</a></span>"),c?"":f.toString()},b.components.post.meta.postViewCount=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),a.isBlip&&!a.isBillboardPost||a.forSharedPost||a.viewstats&&a.viewstats.nonUniqueFormatted&&"0"!=a.viewstats.nonUniqueFormatted&&("permalink"==a.pageType||"dashboard"==a.pageType||"manageblog"==a.pageType)&&(f.append('<span class="view-count" ',a.viewstats.uniqueFormatted?' title="'+d.$$escapeHtml(a.viewstats.uniqueFormatted)+' New Visitors"':"",">",d.$$escapeHtml(a.viewstats.nonUniqueFormatted)),e.features.svgicons?(f.append('<span class="icon--svg u-appended">'),b.icons.essential.flame(null,f,e),f.append("</span>")):f.append('<span class="icon icon-fire icon-append"></span>'),f.append("</span>")),c?"":f.toString()}}),define("templates/tiger/components/user/notifications",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.user.notifications.headline=function(a,b){var c=b||new d.StringBuilder;return c.append("	",(null==a.post?null:a.post.headline)?d.$$filterNoAutoescape(null==a.post?null:a.post.headline):a.starterHeadline?d.$$filterNoAutoescape(a.starterHeadline):(null==a.post?null:a.post.plaintext)?d.$$truncate(d.$$escapeHtml(a.post.plaintext),80,!0):""),b?"":c.toString()},b.components.user.notifications.thumb=function(a,b){var c=b||new d.StringBuilder;return c.append("	",(null==a.post?null:a.post.headline)||a.starterHeadline?"":(null==a.post?null:null==a.post.images?null:null==a.post.images[0]?null:a.post.images[0].src)?'<span class="img-border"><img class="thumb" src="'+d.$$escapeHtml(a.post.images[0].src)+'"></span>':(null==a.post?null:null==a.post.videos?null:null==a.post.videos[0].thumbnails?null:null==a.post.videos[0].thumbnails[0]?null:a.post.videos[0].thumbnails[0].src)?'<span class="img-border"<img class="thumb" src="'+d.$$escapeHtml(a.post.videos[0].thumbnails[0].src)+'"></span>':""),b?"":c.toString()},b.components.user.notifications.item=function(a,c,e){{var f=c||new d.StringBuilder;e.features.svgicons}if(null!=a.item){var g=new d.StringBuilder("FOLLOW"==a.item.type&&a.item.follow?"follow":"USER_FOLLOW"==a.item.type&&a.item.userFollow?"userFollow":"BLOG_FOLLOW"==a.item.type&&a.item.blogFollow?"blogFollow":"APPROVAL"==a.item.type&&a.item.approval?"approval":"REPLY"==a.item.type&&a.item.reply?"reply":"LIKE_GROUP"==a.item.type&&a.item.likeGroup?"likeGroup":"REPOST"==a.item.type&&(null==a.item.repost?null:null==a.item.repost.postAction?null:a.item.repost.postAction.post)?"repost":"SHARE"==a.item.type&&(null==a.item.share?null:a.item.share.post)?"share":"MESSAGE"==a.item.type&&a.item.message?"message":"unsupported");switch(g=g.toString()){case"follow":a.item.follow.blog.displayName&&b.components.user.notifications.event({displayName:a.item.follow.blog.displayName,url:"http://"+a.item.follow.blog.canonicalHost,action:" started following you",avatar:a.item.follow.author.avatar,iconfont:"icon-plus-circle",time:a.item.createTime,item:a.item,type:g},f,e);break;case"userFollow":b.components.user.notifications.event({displayName:a.item.userFollow.author.displayName,url:"//kinja.com/"+a.item.userFollow.author.screenName,action:" started following you",avatar:a.item.userFollow.author.avatar,iconfont:"icon-plus-circle",time:a.item.createTime,item:a.item,type:g},f,e);break;case"blogFollow":b.components.user.notifications.event({displayName:a.item.blogFollow.author.displayName,url:"http://"+a.item.blogFollow.author.defaultBlog.canonicalHost,action:" started following you",avatar:a.item.blogFollow.author.avatar,iconfont:"icon-plus-circle",time:a.item.createTime,item:a.item,type:g},f,e);break;case"approval":a.item.approval.blog.displayName&&b.components.user.notifications.event({displayName:a.item.approval.blog.displayName,url:"http://"+a.item.approval.blog.canonicalHost,action:" started following you",avatar:a.item.approval.blog.avatar,iconfont:"icon-plus-circle",time:a.item.createTime,item:a.item,type:g},f,e);break;case"message":b.components.user.notifications.event({displayName:a.item.message.author.displayName,url:"#",action:" messaged you:",avatar:a.item.message.author.avatar,eventIcon:"bubble-round icon downsized",time:a.item.createTime,item:a.item,type:g},f,e);break;case"reply":var h=new d.StringBuilder;b.components.user.notifications.headline({post:a.item.reply.parent,starterHeadline:a.item.reply.starterHeadline},h,e);var i=new d.StringBuilder;b.components.user.notifications.thumb({post:a.item.reply.parent,starterHeadline:a.item.reply.starterHeadline},i,e),b.components.user.notifications.event({displayName:a.item.reply.author.displayName,avatar:a.item.reply.author.avatar,url:a.item.reply.post.permalink,title:h.toString(),thumb:i.toString(),action:"replied to "+(a.item.reply.parent.isStarter?"your post":"you in"),compact:a.item.reply.post.plaintext,time:a.item.createTime,eventIcon:(a.item.reply.parent.isStarter?"bubble-round":"bubble-double")+" icon downsized js_reply-action",item:a.item,type:g},f,e);break;case"likeGroup":var j=new d.StringBuilder;b.components.user.notifications.headline({post:a.item.likeGroup.post},j,e);var k=new d.StringBuilder;b.components.user.notifications.thumb({post:a.item.likeGroup.post},k,e),b.components.user.notifications.recommend({displayName:a.item.likeGroup.authors[0].displayName,avatar:a.item.likeGroup.authors[0].avatar,title:j.toString(),thumb:k.toString(),url:a.item.likeGroup.post.permalink,action:" recommended your "+(a.item.likeGroup.post.isStarter?"post":"reply"),time:a.item.createTime,iconfont:"icon-star",item:a.item,type:g},f,e);break;case"repost":var l=new d.StringBuilder;b.components.user.notifications.headline({post:a.item.repost.postAction.post},l,e);var m=new d.StringBuilder;b.components.user.notifications.thumb({post:a.item.repost.postAction.post},m,e),b.components.user.notifications.event({displayName:a.item.repost.author.displayName,avatar:a.item.repost.author.avatar,url:a.item.repost.postAction.post.permalink,action:" reposted ",title:l.toString(),thumb:m.toString(),time:a.item.createTime,iconfont:"icon-share",item:a.item,type:g},f,e);break;case"share":var n=new d.StringBuilder;b.components.user.notifications.headline({post:a.item.share.post},n,e);var o=new d.StringBuilder;b.components.user.notifications.thumb({post:a.item.share.post},o,e),b.components.user.notifications.event({displayName:a.item.share.author.displayName,avatar:a.item.share.author.avatar,url:a.item.share.author.defaultBlog?"http://"+a.item.share.author.defaultBlog.canonicalHost:"#",url:a.item.share.post.permalinkPath,action:" shared ",title:n.toString(),thumb:o.toString(),time:a.item.createTime,iconfont:"icon-share",item:a.item,type:g},f,e);break;default:f.append("<!-- missing: ",a.item.type," -->")}}return c?"":f.toString()},b.components.user.notifications.event=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");var g=e.features.svgicons;f.append('<li class="',e.features.hide_pending_replies&&(null==a.item.reply?null:null==a.item.reply.post?null:a.item.reply.post.approved)?"approved":e.features.hide_pending_replies&&null!=(null==a.item.reply?null:null==a.item.reply.post?null:a.item.reply.post.approved)?"unapproved":""," ",0==a.item.seen?"unseen":"",' js_notification-item cursor-pointer proxima private-list-item" data-createtime=',d.$$escapeHtml(a.item.createTimeMillis)," data-event-type=",d.$$escapeHtml(a.type),">",e.features.hide_pending_replies&&null!=(null==a.item.reply?null:null==a.item.reply.post?null:a.item.reply.post.approved)?'<span class="pending-label">Pending approval</span>':"",'<div class="event-avatar">');var h=new d.StringBuilder("avt-small");if(h=h.toString(),f.append('<span class="floated-container img-30"><span class="avatar">'),(null==a.avatar?null:a.avatar.id)&&(null==a.avatar?null:a.avatar.format)?b.components.post.meta.avatarDisplay({avatar:window.kinja.imageUrl(a.avatar.id,h,a.avatar.format)},f,e):f.append("approval"==a.type?'<img src="/assets/images/icons/icon-kinja-nav.png">':'<span class="avatar-default"></span>'),f.append("</span></span></div>",a.thumb?'<div class="compact-thumb">'+d.$$filterNoAutoescape(a.thumb)+"</div>":""),a.item[a.type].author&&b.components.post.meta.avatarPopover({author:a.item[a.type].author,idName:"event-"+d.$$escapeHtml(a.item.id)+"-hovercard"},f,e),f.append('<div class="event-main">',a.item[a.type].author?'<a href="//kinja.com/'+d.$$escapeHtml(a.item[a.type].author.screenName)+'" target="_self" class="event-author" '+(a.item[a.type].author?'data-dropdownhover="event-'+d.$$escapeHtml(a.item.id)+'-hovercard"':"")+">"+d.$$escapeHtml(a.displayName?a.displayName:"")+"</a> "+d.$$escapeHtml(a.action)+" "+(a.title?'<a href="'+d.$$escapeHtml(a.url)+'" class="event-title">'+d.$$filterNoAutoescape(a.title)+"</a>"+(a.eventIcon?":<br>":""):""):"","approval"==a.type?(a.item.approval.blog.displayName?'<a href="//'+d.$$escapeHtml(a.item.approval.blog.canonicalHost)+'" target="_self" class="event-author">'+d.$$escapeHtml(a.item.approval.blog.displayName)+"</a>":"")+" "+(e.features.approvemessage?"approved you":"started following you"):""),a.compact)if(e.features.hide_pending_replies&&!(null==a.item.reply?null:null==a.item.reply.post?null:a.item.reply.post.approved)){var i=window.kinja.truncateHtml(window.kinja.stripHtmlTags(a.compact,"<p><br><em><i><b><strong>"),80);f.append('<blockquote class="event-compact">',d.$$filterNoAutoescape(i),"</blockquote>")}else{var j=window.kinja.truncateHtml(window.kinja.stripHtmlTags(a.compact,"<p><br><em><i><b><strong>"),500);f.append('<blockquote class="event-compact">',d.$$filterNoAutoescape(j),"</blockquote>")}return f.append(a.item.message?'<blockquote class="event-compact">'+(a.item.message.text?d.$$filterNoAutoescape(a.item.message.text):a.item.message.message?d.$$filterNoAutoescape(a.item.message.message):"")+"</blockquote>":"",a.item.reply?(null==a.item.reply.post?null:null==a.item.reply.post.images?null:null==a.item.reply.post.images[0]?null:a.item.reply.post.images[0].src)?e.features.hide_pending_replies&&!(null==a.item.reply?null:null==a.item.reply.post?null:a.item.reply.post.approved)?'<div><span class="icon icon-image image-placeholder"></span></div>':'<div><img class="thumb" src="'+d.$$escapeHtml(a.item.reply.post.images[0].src)+'"></div>':(null==a.item.reply.post?null:null==a.item.reply.post.post?null:null==a.item.reply.post.post.videos?null:null==a.item.reply.post.post.videos[0].thumbnails?null:null==a.item.reply.post.post.videos[0].thumbnails[0]?null:a.item.reply.post.post.videos[0].thumbnails[0].src)?e.features.hide_pending_replies&&!(null==a.item.reply?null:null==a.item.reply.post?null:a.item.reply.post.approved)?'<div><span class="icon icon-image image-placeholder"></span></div>':'<div><img class="thumb" src="'+d.$$escapeHtml(a.item.reply.post.videos[0].thumbnails[0].src)+'"></div>':"":"",'<div class="event-time"><span class="mrs" ',null!=(null==a.item.reply?null:a.item.reply.postid)?"data-postid="+d.$$escapeHtml(a.item.reply.postid):"",">"),a.eventIcon&&(g?(f.append('<span class="icon--svg u-downsized">'),(-1!=a.eventIcon.indexOf("bubble-round")||-1!=a.eventIcon.indexOf("bubble-double"))&&b.icons.essential.bubble(null,f,e),f.append("</span>")):f.append('<span class="icon-',d.$$escapeHtml(a.eventIcon),'"></span>')),a.iconfont&&(g?(f.append('<span class="icon--svg">'),-1!=a.iconfont.indexOf("icon-plus-circle")?b.icons.essential.add(null,f,e):-1!=a.iconfont.indexOf("icon-star")?b.icons.essential.star(null,f,e):-1!=a.iconfont.indexOf("icon-share")?b.icons.essential.externalLink(null,f,e):-1!=a.iconfont.indexOf("icon-image")&&b.icons.essential.image(null,f,e),f.append("</span>")):f.append('<span class="icon ',d.$$escapeHtml(a.iconfont),'"></span>')),f.append('</span><a href="',d.$$escapeHtml(a.url),'" class="timestamp hover-switch">'),b.page.notifications.formattedTime(a,f,e),f.append("</a></div></div></li>"),c?"":f.toString()
},b.components.user.notifications.recommend=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");var g=e.features.svgicons;f.append('<li class="',0==a.item.seen?"unseen":"",' js_notification-item cursor-pointer proxima private-list-item" data-createtime=',d.$$escapeHtml(a.item.createTimeMillis),' data-event-type="recommend"><div class="event-avatar">');var h=new d.StringBuilder("avt-small");h=h.toString(),f.append('<span class="floated-container img-30"><span class="avatar">'),(null==a.avatar?null:a.avatar.id)&&b.components.post.meta.avatarDisplay({avatar:window.kinja.imageUrl(a.avatar.id,h,a.avatar.format)},f,e),f.append("</span></span></div>",a.thumb?'<div class="compact-thumb">'+d.$$filterNoAutoescape(a.thumb)+"</div>":"",'<div class="event-main">');for(var i=0,j=a.item.likeGroup.authors,k=j.length,l=0;k>l;l++){var m=j[l];b.components.post.meta.avatarPopover({author:m,idName:"event-"+d.$$escapeHtml(a.item.id)+"-"+d.$$escapeHtml(m.screenName)+"-hovercard"},f,e),f.append('<a class="js_liker ',l>i?"hide":"",'" href="//kinja.com/',d.$$escapeHtml(m.screenName),'" data-dropdownhover="event-',d.$$escapeHtml(a.item.id),"-",d.$$escapeHtml(m.screenName),'-hovercard">',d.$$escapeHtml(m.displayName),"</a>",l!=k-1?l==a.item.likeGroup.authors.length-2?'<span class="js_list-of-likers-comma js_very-last hide"> and</span> ':'<span class="js_list-of-likers-comma '+(l+1>i?"hide":"")+'">,</span> ':"")}var n=a.item.likeGroup.authors.length;if(f.append(n-1>i?'<span class="js_list-of-likers">and <a href="#"><span class="js_liker-hidden-count">'+d.$$escapeHtml(n-1)+"</span> other"+(n>2?"s":"")+"</a></span>":""," recommended your ",a.item.likeGroup.post.isStarter?"post":"reply"," ",a.title?'<a href="'+d.$$escapeHtml(a.url)+'" class="event-title">'+d.$$filterNoAutoescape(a.title)+"</a>":""),a.compact){var o=window.kinja.truncateHtml(window.kinja.stripHtmlTags(a.compact,"<p><br><em><i><b><strong>"),500);f.append('<blockquote class="event-compact">',d.$$filterNoAutoescape(o),"</blockquote>")}return f.append('<div class="event-time"><span class="mrs" ',null!=(null==a.item.reply?null:a.item.reply.postid)?"data-postid="+d.$$escapeHtml(a.item.reply.postid):"",">"),a.eventIcon&&(g?(f.append('<span class="icon--svg u-downsized">'),(-1!=a.eventIcon.indexOf("bubble-round")||-1!=a.eventIcon.indexOf("bubble-double"))&&b.icons.essential.bubble(null,f,e),f.append("</span>")):f.append('<span class="icon-',d.$$escapeHtml(a.eventIcon),'"></span>')),a.iconfont&&(g?(f.append('<span class="icon--svg">'),-1!=a.iconfont.indexOf("icon-plus-circle")?b.icons.essential.add(null,f,e):-1!=a.iconfont.indexOf("icon-star")?b.icons.essential.star(null,f,e):-1!=a.iconfont.indexOf("icon-share")?b.icons.essential.externalLink(null,f,e):-1!=a.iconfont.indexOf("icon-image")&&b.icons.essential.image(null,f,e),f.append("</span>")):f.append('<span class="icon inline ',d.$$escapeHtml(a.iconfont),'"></span>')),f.append('</span><a href="',d.$$escapeHtml(a.url),'">',d.$$escapeHtml(a.time.Mddyyhmma),"</a></div></div></li>"),c?"":f.toString()}}),define("templates/tiger/page/notifications",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.page.notifications.front=function(a,c,e){var f=c||new d.StringBuilder;return f.append('<div class="post-list hfeed js_pagercontainer ',d.$$escapeHtml(a.filter?a.filter:""),'" data-starttime="',d.$$escapeHtml((null==a.pagination.next?null:a.pagination.next.startTime)?a.pagination.next.startTime:""),'" data-currtime="',d.$$escapeHtml((null==a.pagination.next?null:a.pagination.next.startTime)?a.pagination.next.startTime:""),'" data-startindex="',d.$$escapeHtml((null==a.pagination.next?null:a.pagination.next.startIndex)?a.pagination.next.startIndex:""),'" data-currindex="',d.$$escapeHtml((null==a.pagination.next?null:a.pagination.next.startIndex)?a.pagination.next.startIndex:""),'" data-paginationType="',d.$$escapeHtml((null==a.pagination.next?null:a.pagination.next.startIndex)?"index":"time"),'" data-blogid="',d.$$escapeHtml(a.blogId?a.blogId:""),'" data-filter="',d.$$escapeHtml(a.filter?a.filter:""),'">'),b.page.notifications.list(a,f,e),f.append("</div>"),b.page.notifications.pager(a,f,e),c?"":f.toString()},b.page.notifications.newFront=function(a,c,e){var f=c||new d.StringBuilder;return f.append('<div class="post-list hfeed js_pagercontainer ',d.$$escapeHtml(a.filter?a.filter:""),'" data-starttime="',d.$$escapeHtml((null==a.pagination.next?null:a.pagination.next.startTime)?a.pagination.next.startTime:""),'" data-currtime="',d.$$escapeHtml((null==a.pagination.next?null:a.pagination.next.startTime)?a.pagination.next.startTime:""),'" data-startindex="',d.$$escapeHtml((null==a.pagination.next?null:a.pagination.next.startIndex)?a.pagination.next.startIndex:""),'" data-currindex="',d.$$escapeHtml((null==a.pagination.next?null:a.pagination.next.startIndex)?a.pagination.next.startIndex:""),'" data-paginationType="',d.$$escapeHtml((null==a.pagination.next?null:a.pagination.next.startIndex)?"index":"time"),'" data-blogid="',d.$$escapeHtml(a.blogId?a.blogId:""),'" data-filter="',d.$$escapeHtml(a.filter?a.filter:""),'">'),b.page.notifications.list({posts:a.notifications,postsToday:a.notificationsToday,postsYesterday:a.notificationsYesterday,postsWayBack:a.notificationsWayBack},f,e),f.append("</div>"),b.page.notifications.pager(a,f,e),c?"":f.toString()},b.page.notifications.list=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),a.posts.length>0?b.page.notifications.postlist(a,f,e):f.append('<div id="editorplaceholder" class="editorplaceholder"></div><div class="post-wrapper"><article class="row post text-center proxima">You do not currently have any notifications. You\'ll be notified when other users recommend, share or reply to your Kinja posts, or follow you.</article></div>'),c?"":f.toString()},b.page.notifications.postlist=function(a,c,e){a=a||{};var f=c||new d.StringBuilder;if(f.append("	"),a.postsToday&&a.postsToday.length){f.append("<h4>Today</h4>");for(var g=a.postsToday,h=g.length,i=0;h>i;i++){var j=g[i];b.components.user.notifications.item({item:j},f,e)}}if(a.postsYesterday&&a.postsYesterday.length){f.append("<h4>Yesterday</h4>");for(var k=a.postsYesterday,l=k.length,m=0;l>m;m++){var n=k[m];b.components.user.notifications.item({item:n},f,e)}}if(a.postsWayBack&&a.postsWayBack.length)for(var o=a.postsWayBack,p=o.length,q=0;p>q;q++){var r=o[q];f.append("<h4>",d.$$escapeHtml(r.fullDate),"</h4>");for(var s=r.timeline,t=s.length,u=0;t>u;u++){var v=s[u];b.components.user.notifications.item({item:v},f,e)}}return c?"":f.toString()},b.page.notifications.pager=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");var g=e.features.svgicons;if(a.pagination.next){f.append('<div class="row load-more"><div class="column">');var h=new d.StringBuilder((null==a.pagination.next?null:a.pagination.next.startTime)?"?startTime="+d.$$escapeHtml(a.pagination.next.startTime):"/");h=h.toString(),f.append('<div class="text-center mbx"><a href="',d.$$escapeHtml(h),'"><div class="button small secondary',g?" icon--svg":"",'">Older notifications'),g?(f.append('<span class="icon--svg u-appended">'),b.icons.essential.chevronRight(null,f,e),f.append("</span>")):f.append('<span class="icon icon-chevron-right icon-append"></span>'),f.append("</div></a></div></div></div>")}return c?"":f.toString()},b.page.notifications.formattedTime=function(a,c,e){var f=c||new d.StringBuilder;return f.append('	<span class="show-on-hover published updated">',d.$$escapeHtml(a.time.MdyatHm),'</span><span class="hide-on-hover">'),b.messages.relativeTime({type:a.time.relative.type,amount:a.time.relative.amount,hmma:a.time.hmma,day:a.time.day,Mddyyhmma:a.time.Mddyyhmma},f,e),f.append("</span>"),c?"":f.toString()}}),define("app/notifdropdown/NotificationItem",["backbone.marionette","singleton/Feature","singleton/Utils","view/behaviors/googleAnalytics.behavior","templates/tiger/components/header/notifications","templates/tiger/components/post/meta/avatar-display","templates/tiger/components/post/meta/meta-components","templates/tiger/components/user/notifications","templates/tiger/messages","templates/tiger/page/notifications"],function(a,b,c,d){var e=a.ItemView.extend({template:tiger.components.header.notifications.globalNotificationEvent,tagName:"li",className:function(){var a,c="js_notification-item private-list-item cursor-default";return c+=this.model.get("seen")?" seen":" unseen",b.isOn("hide_pending_replies")&&(a=this.model.get("postData"),this.model.get("reply")&&this.model.get("postData")&&(c+=a.approved?" approved":" unapproved")),c},serializeData:function(){return{item:this.model.toJSON(),imgPath:c.getKinjaMeta().imgassets}},events:{click:"openNotification"},behaviors:function(){var a;return a={GoogleAnalyticsBehavior:{behaviorClass:d}}}},{types:{FOLLOW:"follow",REPLY:"reply",LIKEGROUP:"likeGroup",SHARE:"share",MESSAGE:"message"}});return e}),define("templates/tiger/components/spinner",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.spinner.bounce=function(a,b){var c=b||new d.StringBuilder;return c.append('	<span class="spinner bounce"><span class="one"></span><span class="two"></span><span class="three"></span></span>'),b?"":c.toString()}}),define("app/notifdropdown/NotificationList",["backbone.marionette","jquery","collection/Notifications","app/notifdropdown/NotificationItem","templates/tiger/components/header/notifications","templates/tiger/components/spinner"],function(a,b,c,d){var e,f,g;return e=a.ItemView.extend({template:tiger.components.header.notifications.notificationsSpinner}),f=a.ItemView.extend({template:tiger.components.header.notifications.notificationsEmpty}),g=a.CompositeView.extend({itemViewContainer:"ul.js_notification-list",onRender:function(){this.on("opened:notifications",function(){b("body").addClass("global-notifications-open")}),this.on("closed:notifications",function(){b("body").removeClass("global-notifications-open")}),this.$(".js_see-all-notifications").attr("href","http://kinja.com/dashboard/notifications")},itemView:d,collectionEvents:{sync:"swapEmptyView",reset:"resetEmptyView"},emptyView:e,swapEmptyView:function(){this.$itemViewContainer&&this.$itemViewContainer.length&&(this.closeEmptyView(),this.emptyView=f,this.checkEmpty())},resetEmptyView:function(){this.$itemViewContainer&&this.$itemViewContainer.length&&(this.closeEmptyView(),this.emptyView=e,this.checkEmpty())},template:tiger.components.header.notifications.globalNotificationsDropdown,triggers:{"opened.fndtn.dropdown":"opened:notifications","closed.fndtn.dropdown":"closed:notifications"}})}),define("app/notifdropdown/notificationCount.model",["config","jquery","underscore","backbone","singleton/CurrentUser","singleton/Feature","apiclient/notification"],function(a,b,c,d,e,f,g){var h=d.Model.extend({defaults:{notificationCount:0,inSync:!1},initialize:function(a,b){this.options=c.defaults({},this.options,b),this.options.polling&&(this.startPolling(),this.on("close",this.stopPolling.bind(this)))},startPolling:function(){this.pollTimer=window.setInterval(this.fetch.bind(this),this.options.pollingInterval)},stopPolling:function(){window.clearInterval(this.pollTimer)},sync:function(a,b,c){var d=e.get("token"),f=e.isLoggedIn();return f&&d&&-1===d.indexOf("dummy-")?g.getNotificationCount({userId:e.id},c):void(this.pollTimer&&this.stopPolling())},isNew:function(){return!this.get("inSync")},parse:function(a){return{notificationCount:parseInt(a.data,10)||0,inSync:!0}},markAsRead:function(){this.empty(),this.save()},empty:function(){this.set({notificationCount:0})},remove:function(){this.empty(),this.stopListening()}});return h}),define("app/notifdropdown/NativeNotifications",["jquery","underscore","backbone.marionette","singleton/CurrentUser","singleton/Feature","app/notifdropdown/NotificationItem"],function(a,b,c,d,e,f){var g;return g=c.Controller.extend({_supported:"Notification"in window,_initalChange:!0,_defaults:{closeTimeout:1e4},initialize:function(a){return this.notifications=a.notifications,this.options=b.defaults(this.options,this._defaults),this.seenUntil=new Date,a.notificationCount.on("change:notificationCount",this._onNotificationCountChange.bind(this)),this},_onNotificationCountChange:function(a,b){if(this._initalChange||!this._supported)return this._initalChange=!1,!1;var c=a.previous("notificationCount")<b;c&&("granted"===window.Notification.permission?this._fetchNotifications():"denied"!==window.Notification.permission&&window.Notification.requestPermission(this._fetchNotifications.bind(this)))},_fetchNotifications:function(){var a={reset:!1,data:{token:d.get("token"),markAsRead:!1,maxReturned:3}};this.notifications.fetch(a).then(function(){var a=this.notifications.reject(this._isShown.bind(this));b.chain(a).filter(this._supportedType.bind(this)).each(this._createNativeNotification.bind(this)),this.seenUntil=new Date}.bind(this))},_supportedType:function(a){return"REPLY"===a.get("type")},_createNativeNotification:function(a){var b,c,d,e;return d={model:a},c=new f(d),c.render(),e={body:this._getBodyText(c,a),icon:this._getImage(c,a)},b=new window.Notification(this._getTitleText(c,a),e),b.onclick=this._onNotificationClick.bind(this,c,a),b.onshow=this._onNotificationShow.bind(this),b},_onNotificationClick:function(a){var b=a.$el.find("a").first().attr("href");b&&window.open(b)},_onNotificationShow:function(a){window.setTimeout(function(){a.target.close()},this.options.closeTimeout)},_getTitleText:function(b,c){var d;switch(c.get("type")){case"REPLY":d=b.$el.find(".txt .name").text();break;default:d=""}return a.trim(d)},_getBodyText:function(b,c){var d;switch(c.get("type")){case"REPLY":d=b.$el.find(".txt .msg-excerpt").text();break;default:d=""}return a.trim(d)},_getImage:function(a){return a.$el.find("img").first().attr("src")},_isShown:function(a){return a.get("seen")||a.get("createTimeMillis")<this.seenUntil.getTime()}})}),define("app/notifdropdown/notifdropdown.app",["app/notifdropdown/NotificationButton","app/notifdropdown/NotificationList","app/notifdropdown/notificationCount.model","collection/Notifications","singleton/CurrentUser","singleton/EventDispatcher","singleton/Feature","app/MarionetteApp","app/notifdropdown/NativeNotifications","app/account/account.channel"],function(a,b,c,d,e,f,g,h,i,j){var k,l;return l={notifications:null,notificationCountModel:null,notificationDropdown:null,notificationOffcanvas:null,initialize:function(){var a=new d;this.notifications=a,this.notificationDropdown=new b({el:h.notificationDropdownRegion.el,collection:a,model:e}),this.notificationOffcanvas=new b({el:h.notificationOffcanvasRegion.el,collection:a,model:e}),this.initNotificationButton(),e.isLoggedIn()&&l.notificationOffcanvas.render(),this.notificationDropdown.on("opened:notifications",function(){e.isLoggedIn()&&(l.notificationDropdown.render(),a.fetch({reset:!0}))}),g.isOn("notifications_native")&&(this.nativeNotifications=new i({notifications:this.notifications,notificationCount:this.notificationCountModel})),h.notificationDropdownRegion.attachView(this.notificationDropdown)},initNotificationButton:function(){this.notificationCountModel=new c({},{polling:g.isOn("notification_polling"),pollingInterval:6e4}),e.on("authenticated",function(){e.isLoggedIn()&&this.notificationCountModel.fetch()},this),e.on("clearNotifications",function(){this.notificationCountModel.markAsRead()},this),e.isLoggedIn()&&this.notificationCountModel.fetch();var b=new a({el:h.notificationRegion.el,model:this.notificationCountModel});b.render(),this.notificationDropdown.on("opened:notifications",function(){g.isOn("notifications_native")&&"Notification"in window&&"denied"!==window.Notification.permission&&window.Notification.requestPermission(),this.notificationCountModel.empty()},this),h.notificationRegion.attachView(b)},remove:function(){f.off(null,null,this),e.off(null,null,this),j.off(null,null,this),this.notificationDropdown&&(this.notificationDropdown.off(null,null,this),this.notificationDropdown=null),this.notificationOffcanvas&&(this.notificationOffcanvas.off(null,null,this),this.notificationOffcanvas=null),this.notificationCountModel&&(this.notificationCountModel.remove(),this.notificationCountModel=null)}},k={initialize:function(){return l.initialize()},fetch:function(){l.notifications.fetch()},remove:function(){l.remove()}}}),define("templates/tiger/section/navbar",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.section.navbar=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");var g=((null==a.blog?null:a.blog.displayName)?a.blog.displayName:"",new d.StringBuilder("blg-logo"));g=g.toString();var h=(null==a.blog?null:a.blog.logo)?window.kinja.imageUrl(a.blog.logo.id,g,a.blog.logo.format):"",i=new d.StringBuilder("gawker"==(null==a.blog?null:a.blog.name)||"lifehacker"==(null==a.blog?null:a.blog.name)||"deadspin"==(null==a.blog?null:a.blog.name)||"kotaku"==(null==a.blog?null:a.blog.name)||"jezebel"==(null==a.blog?null:a.blog.name)||"io9"==(null==a.blog?null:a.blog.name)||"jalopnik"==(null==a.blog?null:a.blog.name)||"gizmodo"==(null==a.blog?null:a.blog.name)?" gmglogos":"");i=i.toString();var j=e.features.svgicons;f.append("<!-- ",a.md5?" md5! ":"",' --><aside class="left-off-canvas-menu show-for-medium-down proxima nav-dropdown main-menu">'),b.components.navpanels.leftPanel(a,f,e),f.append('</aside><aside class="right-off-canvas-menu show-for-medium-down proxima nav-dropdown">'),b.components.navpanels.rightPanel(null,f,e),f.append("</aside>",e.features.channels?'<aside id="js_channels" class="channels-off-canvas left-off-canvas-menu proxima"></aside>':"",'<a class="exit-off-canvas"></a><div class="navwrap--outer js-navwrap--outer"><nav class="js_global-nav-wrap js_top-nav global-nav notransition shown"><div class="global-nav__left global-nav__triggers">');var k=a.blogList&&a.blogList.length>1?!0:!1,l="dashboard"==a.pageType||"manageblog"==a.pageType?!0:!1;e.features.secondary_nav&&l&&k&&(f.append('<a class="',j?"icon--svg ":"",'js_show-dashboard-blogs show-dashboard-blogs show-for-medium-down">'),j?b.icons.essential.chevronBottom(null,f,e):f.append('<span class="icon icon-chevron-down"></span>'),f.append("</a>")),f.append('<a class="left-off-canvas-toggle hamburger-trigger ',e.features.secondary_nav&&l&&k?"js_hamburger-trigger hide":"",'" data-ga="[Kinja Menu, Menu Click, js_pageType]"><span class="icon-dustinburger"><span></span><span></span><span></span></span></a><a data-dropdown="global-blog" class="js_menu-button hamburger-trigger hamburger-trigger--desktop" data-ga="[Kinja Menu, Menu Click, js_pageType]"><span class="icon-dustinburger"><span></span><span></span><span></span></span></a><a href="#" id="global-search-trigger" class="',j?"icon--svg u-highlighted--hover ":"",'search-trigger" data-dropdown="global-search" data-ga="[Kinja Menu, Search Click, js_pageType]">'),j?(b.icons.essential.search(null,f,e),b.icons.essential.close(null,f,e)):f.append('<span class="icon icon-search-alt-thin"></span>'),f.append('</a></div><div class="global-nav__right global-nav__triggers js_right-user-bar"></div><div class="global-nav__center row"><div class="logo-wrapper large-6 columns large-offset-4">'),e.features.nav_titles?a.title?f.append(a.mobileTitle?'<h1 class="js_mobile-title global-nav--title show-for-medium-down">'+d.$$escapeHtml(a.mobileTitle)+'</h1><h1 class="global-nav--title hide-for-medium-down">'+d.$$escapeHtml(a.title)+"</h1>"+(l?'<h1 class="js_dashboard-mobile-title-blogs global-nav--title hide">'+d.$$escapeHtml(a.title)+"</h1>":""):'<h1 class="global-nav--title">'+d.$$escapeHtml(a.title)+"</h1>"):(f.append('<a href="//',d.$$escapeHtml((null==a.blog?null:a.blog.canonicalHost)?a.blog.canonicalHost:""),'" class="logo" title="',d.$$escapeHtml((null==a.blog?null:a.blog.displayName)?a.blog.displayName:""),'" data-ga="[Kinja Menu, Logo/Blog Title Click, js_pageType]">',""!=h?'<img src="'+d.$$escapeHtml(h)+'" alt="" />':d.$$escapeHtml((null==a.blog?null:a.blog.displayName)?a.blog.displayName:""),"</a>"),a.blog.id&&(f.append('<div class="follow-controls follow-controls--header js_follow-controls js_follow-blog-controls" data-blogid="',d.$$escapeHtml(a.blog.id),'"><a href="#" class="js_followblogforuser follow-controls__link',j?" u-highlighted":"",'" title="Follow',a.blog&&a.blog.displayName?" "+d.$$escapeHtml(a.blog.displayName):"",'" data-ga="[Kinja Menu, Follow Link Click, js_pageType]">'),e.features.svgicons?(f.append('<span class="icon--svg">'),b.icons.essential.add(null,f,e),f.append("</span>")):f.append('<span class="icon icon-plus-alt"></span>'),f.append('Follow</a><a href="#" class="js_unfollowblogforuser follow-controls__link hide',j?" u-highlighted":"",'" title="Unfollow',a.blog&&a.blog.displayName?" "+d.$$escapeHtml(a.blog.displayName):"",'" data-ga="[Kinja Menu, Unfollow Link Click, js_pageType]">'),e.features.svgicons?(f.append('<span class="icon--svg">'),b.icons.essential.checkmark(null,f,e),f.append("</span>")):f.append('<span class="icon icon-checkmark-alt"></span>'),f.append("Following</a></div>"))):f.append('<a href="//',d.$$escapeHtml((null==a.blog?null:a.blog.canonicalHost)?a.blog.canonicalHost:""),'" class="logo" title="',d.$$escapeHtml((null==a.blog?null:a.blog.displayName)?a.blog.displayName:""),'" data-ga="[Kinja Menu, Logo/Blog Title Click, js_pageType]">',""!=h?'<img src="'+d.$$escapeHtml(h)+'" alt="" />':d.$$escapeHtml((null==a.blog?null:a.blog.displayName)?a.blog.displayName:""),"</a>",a.blog.id?'<div class="follow-controls follow-controls--header js_follow-controls js_follow-blog-controls" data-blogid="'+d.$$escapeHtml(a.blog.id)+'"><a href="#" class="js_followblogforuser follow-controls__link" title="Follow'+(a.blog&&a.blog.displayName?" "+d.$$escapeHtml(a.blog.displayName):"")+'" data-ga="[Kinja Menu, Follow Link Click, js_pageType]"><span class="icon icon-plus-alt"></span>Follow</a><a href="#" class="js_unfollowblogforuser follow-controls__link hide" title="Unfollow'+(a.blog&&a.blog.displayName?" "+d.$$escapeHtml(a.blog.displayName):"")+'" data-ga="[Kinja Menu, Unfollow Link Click, js_pageType]"><span class="icon icon-checkmark-alt"></span>Following</a></div>':""),f.append("</div></div>");var m=new d.StringBuilder(a.blogGroup&&a.blogGroup.length?"dropdown-wide":"");return m=m.toString(),f.append('<div class="proxima f-dropdown content nav-dropdown main-menu hide-for-medium-down ',d.$$escapeHtml(m),'" id="global-blog" data-dropdown-content><div id="js_blogmenu--dropdown">'),b.components.blogdropdown.globalBlogDropdown(a,f,e),f.append('</div></div><div class="f-dropdown content nav-dropdown search-dropdown hide-for-medium-down" id="global-search" data-dropdown-content><form method="GET" action="/search" data-ga="[Search, Submit, js_pageType]"><div class="input-with-icon">'),e.features.svgicons?(f.append('<span class="icon--svg">'),b.icons.essential.search(null,f,e),f.append("</span>")):f.append('<span class="icon icon-search-alt-thin"></span>'),f.append('<input id="global-search-input" type="search" name="q" placeholder="Search ',d.$$escapeHtml((null==a.blog?null:a.blog.displayName)?a.blog.displayName:"Kinja"),'" autocomplete="off" /></div></form></div><div class="proxima f-dropdown nav-dropdown content notif-menu" id="js_notifications--dropdown" data-dropdown-content></div><div class="js_global-user scrollable-container noskimlinks noskimwords"><div class="proxima f-dropdown nav-dropdown content user-menu user-menu--mobile" id="js_usermenu--dropdown" data-dropdown-content></div></div></nav></div>'),c?"":f.toString()},b.section.navbarBlogTitle=function(a,b,c){var e=b||new d.StringBuilder;return e.append(c.features.superuser&&c.features.superuser_notif?'<div class="momjeans-overlay js_momjeans-overlay"><span class="icon icon-momjeans"></span></div>':"",'<a href="/" class="blog-title__logo site-logo js_blog-title__logo',a.isGmgBlog?" gmgLogos":"",a.showLogo?" no-fade-transition fade-in":"",'" title="',d.$$escapeHtml(a.blogDisplayName),'">',a.isGmgBlog?'<img class="blog-title__img logo-'+d.$$escapeHtml(a.blogName)+'" src="'+d.$$escapeHtml(a.imageAssetPath)+"logos/navbar/logo-"+d.$$escapeHtml(a.blogName)+'.png" alt="" />':""!=a.logoSrc?'<img class="blog-title__img" src="'+d.$$escapeHtml(a.logoSrc)+'" alt="" />':'<div class="blog-title__txt header-title proxima">'+d.$$escapeHtml(a.blogDisplayName)+"</div>",'</a><div class="search-button"><span class="icon icon-search js_search-button__open-icon search-button__open-icon"></span></div>'),b?"":e.toString()},b.section.navbarSearchBar=function(a,b,c){var e=b||new d.StringBuilder;return e.append("	",c.features.superuser&&c.features.superuser_notif?'<div class="momjeans-overlay js_momjeans-overlay"><span class="icon icon-momjeans"></span></div>':"",'<a href="/" class="blog-title__logo site-logo js_blog-title__logo',a.isGmgBlog?" gmgLogos":""," no-fade-transition",a.showLogo?" fade-in":"",'" title="',d.$$escapeHtml(a.blogDisplayName),'">',a.isGmgBlog?'<img class="blog-title__img logo-'+d.$$escapeHtml(a.blogName)+'" src="'+d.$$escapeHtml(a.imageAssetPath)+"logos/navbar/logo-"+d.$$escapeHtml(a.blogName)+'.png" alt="" />':""!=a.logoSrc?'<img class="blog-title__img" src="'+d.$$escapeHtml(a.logoSrc)+'" alt="" />':'<div class="blog-title__txt header-title proxima">'+d.$$escapeHtml(a.blogDisplayName)+"</div>",'</a><form method="GET" action="/search" class="search-bar__form js_search-bar__form" data-ga="[Search, Submit, js_pageType]"><span class="icon icon-search search-bar__icon"></span><input type="text" class="search-bar__field js_search-bar__field" name="q" placeholder="Search ',d.$$escapeHtml(a.blogDisplayName),'" autocomplete="off" /><div class="search-button"><span class="icon icon-x-small js_search-button__close-icon search-button__close-icon"></span></div></form><div class="search-button--placeholder"><span class="icon icon-search search-button__open-icon"></span></div>'),b?"":e.toString()},b.section.navbarRightUserBar=function(a,b,c){var e=b||new d.StringBuilder;return e.append("	",c.features.channels?'<span class="notification-trigger"><a class="show-for-medium-up js_channels-off-canvas-toggle left-off-canvas-toggle"><span class="notif-circle"><span class="icon"><svg class="channels-icon" width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><title>icon-hashmark</title><path d="M8.785 12h-2.97l-.552 3.16c-.097.553-.612.923-1.16.825-.543-.096-.907-.62-.81-1.174L3.785 12H.938C.42 12 0 11.556 0 11c0-.552.417-1 .938-1h3.197l.7-4H1.938C1.42 6 1 5.556 1 5c0-.552.417-1 .938-1h3.246L5.737.84c.097-.552.612-.922 1.16-.824.543.096.907.618.81 1.174L7.215 4h2.97l.552-3.16c.097-.552.612-.922 1.16-.824.543.096.907.618.81 1.174L12.215 4h2.847c.518 0 .938.444.938 1 0 .552-.417 1-.938 1h-3.197l-.7 4h2.897c.518 0 .938.444.938 1 0 .552-.417 1-.938 1h-3.246l-.553 3.16c-.097.553-.612.923-1.16.825-.543-.096-.907-.62-.81-1.174L8.785 12zm.35-2h-2.97l.7-4h2.97l-.7 4z" fill="#000" fill-rule="evenodd"/></svg></span></span></a></span>':"",'<span class="js_notif-wrapper notification-trigger"></span><div class="user-trigger" data-ga="[User Menu, Menu Click, js_pageType]"><a class="js_menu-button js_usermenu-button show-for-large-up" data-dropdown="js_usermenu--dropdown" title="User dropdown">',a.avatar?'<span class="js_avatar avatar" style="background-image: url('+d.$$escapeHtml(a.avatar.url)+')"></span>':"",'</a><a class="js_offcanvas-user right-off-canvas-toggle show-for-medium-down">',a.avatar?'<span class="js_avatar avatar" style="background-image: url('+d.$$escapeHtml(a.avatar.url)+')"></span>':"","</a></div>"),b?"":e.toString()},b.section.navbarRightLogin=function(a,b){var c=b||new d.StringBuilder;return c.append('	<a href="#" class="login-button button tiny inverse js_login-link" data-ga="[User Menu, Login/Signup Click, js_pageType]">Log in / Sign up</a>'),b?"":c.toString()}}),define("templates/tiger/icons/actions/usage",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.icons.actions.arrowBottomLeft=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-arrow-bottom-left"><use xlink:href="#iconset-arrow-bottom-left" /></svg>'),b?"":c.toString()},b.icons.actions.arrowBottomRight=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-arrow-bottom-right"><use xlink:href="#iconset-arrow-bottom-right" /></svg>'),b?"":c.toString()},b.icons.actions.arrowBottom=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-arrow-bottom"><use xlink:href="#iconset-arrow-bottom" /></svg>'),b?"":c.toString()},b.icons.actions.arrowLeft=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-arrow-left"><use xlink:href="#iconset-arrow-left" /></svg>'),b?"":c.toString()},b.icons.actions.arrowRight=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-arrow-right"><use xlink:href="#iconset-arrow-right" /></svg>'),b?"":c.toString()},b.icons.actions.arrowTop=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-arrow-top"><use xlink:href="#iconset-arrow-top" /></svg>'),b?"":c.toString()},b.icons.actions.arrowTopLeft=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-arrow-top-left"><use xlink:href="#iconset-arrow-top-left" /></svg>'),b?"":c.toString()},b.icons.actions.arrowTopRight=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-arrow-top-right"><use xlink:href="#iconset-arrow-top-right" /></svg>'),b?"":c.toString()},b.icons.actions.blogAdd=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-blog-add"><use xlink:href="#iconset-blog-add" /></svg>'),b?"":c.toString()},b.icons.actions.closeSmall=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-close-sm"><use xlink:href="#iconset-close-sm" /></svg>'),b?"":c.toString()},b.icons.actions.disabled=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-disabled"><use xlink:href="#iconset-disabled" /></svg>'),b?"":c.toString()},b.icons.actions.flag=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-flag"><use xlink:href="#iconset-flag" /></svg>'),b?"":c.toString()},b.icons.actions.fullscreen=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-fullscreen"><use xlink:href="#iconset-fullscreen" /></svg>'),b?"":c.toString()},b.icons.actions.gear=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-gear"><use xlink:href="#iconset-gear" /></svg>'),b?"":c.toString()},b.icons.actions.heart=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-heart"><use xlink:href="#iconset-heart" /></svg>'),b?"":c.toString()},b.icons.actions.information=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-information"><use xlink:href="#iconset-information" /></svg>'),b?"":c.toString()},b.icons.actions.login=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-login"><use xlink:href="#iconset-login" /></svg>'),b?"":c.toString()},b.icons.actions.logout=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-logout"><use xlink:href="#iconset-logout" /></svg>'),b?"":c.toString()},b.icons.actions.lightning=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-lightning"><use xlink:href="#iconset-lightning" /></svg>'),b?"":c.toString()},b.icons.actions.moveLeft=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-move-left"><use xlink:href="#iconset-move-left" /></svg>'),b?"":c.toString()},b.icons.actions.moveRight=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-move-right"><use xlink:href="#iconset-move-right" /></svg>'),b?"":c.toString()},b.icons.actions.moveTop=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-move-top"><use xlink:href="#iconset-move-top" /></svg>'),b?"":c.toString()
},b.icons.actions.moveBottom=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-move-bottom"><use xlink:href="#iconset-move-bottom" /></svg>'),b?"":c.toString()},b.icons.actions.userAdd=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-user-add"><use xlink:href="#iconset-user-add" /></svg>'),b?"":c.toString()},b.icons.actions.userRemove=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-user-remove"><use xlink:href="#iconset-user-remove" /></svg>'),b?"":c.toString()},b.icons.actions.writePaper=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-write-paper"><use xlink:href="#iconset-write-paper" /></svg>'),b?"":c.toString()},b.icons.actions.zoomOut=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-zoom-out"><use xlink:href="#iconset-zoom-out" /></svg>'),b?"":c.toString()},b.icons.actions.clock=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-clock"><use xlink:href="#iconset-clock" /></svg>'),b?"":c.toString()},b.icons.actions.write=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-write"><use xlink:href="#iconset-write" /></svg>'),b?"":c.toString()},b.icons.actions.share=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-share"><use xlink:href="#iconset-share" /></svg>'),b?"":c.toString()},b.icons.actions.quote=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-quote"><use xlink:href="#iconset-quote" /></svg>'),b?"":c.toString()}}),define("app/navigation/userButton.view",["backbone.marionette","singleton/Utils","view/behaviors/googleAnalytics.behavior","templates/tiger/components/header/notifications","templates/tiger/section/navbar","templates/tiger/icons/actions/usage"],function(a,b,c){var d=a.ItemView.extend({behaviors:{GoogleAnalyticsBehavior:{behaviorClass:c}},ui:{avatar:".js_avatar"},template:tiger.section.navbarRightUserBar,modelEvents:{authenticated:"render","change:avatar":"updateAvatar"},updateAvatar:function(){var a=this.model.get("avatar");this.ui.avatar.css("background-image","url("+b.imageUrl(a.id,"avt-small",a.format)+")")}});return d}),define("app/navigation/loginButton.view",["backbone.marionette","app/account/account.channel","templates/tiger/section/navbar"],function(a,b){var c=a.ItemView.extend({template:tiger.section.navbarRightLogin,events:{"click .js_login-link":"onLoginClick","click .js_signup-link":"onSignupClick"},onLoginClick:function(a){a.preventDefault(),b.trigger("loginRequired",{source:"loginButton"})},onSignupClick:function(a){a.preventDefault(),b.trigger("loginRequired",{source:"signupButton"})}});return c}),define("singleton/BlogInfo",["underscore","singleton/CurrentBlog"],function(a,b){var c={adEnabledSites:[{name:"Gizmodo",id:4},{name:"Gawker",id:7},{name:"io9",id:8},{name:"Kotaku",id:9},{name:"Deadspin",id:11},{name:"Jalopnik",id:12},{name:"Lifehacker",id:17},{name:"Jezebel",id:39},{name:"GizmodoES",id:19292},{name:"Guanabee",id:86551},{name:"studioatgawker",id:4541888},{name:"The fusion project",id:10698056},{name:"XperiaZ",id:471472023},{name:"BetterState",id:473241793},{name:"IBM",id:474911957},{name:"BusinessTravelersToolkit",id:476089313},{name:"SonyEntertainmentNetwork",id:476783795},{name:"WonderFilled",id:499874619},{name:"OreoWonderFilled",id:499964452},{name:"RandomHouseAudio",id:506884481},{name:"Gizmodo Live",id:509173099},{name:"RayDonovan",id:509473310},{name:"Kotaku Live Blog",id:510669784},{name:"Defamer",id:512288369},{name:"collaboratory",id:709976306},{name:"Doomsday Castle",id:813471273},{name:"fiestahero",id:1256311089},{name:"Metlife",id:1300181229},{name:"Porsche",id:1434801322},{name:"crashplan",id:1444734969},{name:"Quirky G.E",id:1460862244},{name:"Netflix",id:1463118792},{name:"3dprintingtoolkit",id:1467567363},{name:"goodtobebad",id:1467571985},{name:"Oliver Kovacs",id:1484116755},{name:"Over Rated",id:1521570730},{name:"biz product",id:1525133490},{name:"Playboy",id:1173588042,gptNetworkId:6487541,gptSiteName:"playboy.kinja"},{name:"Sploid",id:487662860}],gmgBlogs:["gawker","lifehacker","deadspin","kotaku","jezebel","io9","jalopnik","gizmodo"],currentBlogIsGmgBlog:function(){return a.find(this.gmgBlogs,function(a){return b.name===a})}};return c}),define("app/navigation/blogTitle.view",["underscore","backbone.marionette","singleton/CurrentBlog","singleton/EventDispatcher","singleton/BlogInfo","singleton/Feature","templates/tiger/section/navbar"],function(a,b,c,d,e,f){var g=b.ItemView.extend({template:tiger.section.navbarBlogTitle,tagName:"div",className:"blog-title",ui:{blogLogo:".js_blog-title__logo",searchIcon:".js_search-button__open-icon"},triggers:{"click @ui.searchIcon":"open.searchbar"},attributes:{href:"/",title:c.displayName||""},fadeIn:function(){this.ui.blogLogo.addClass("fade-in")},fadeOut:function(){this.ui.blogLogo.removeClass("fade-in")},serializeData:function(){return{blogName:(c||{}).name,blogDisplayName:c.displayName||"",isGmgBlog:e.currentBlogIsGmgBlog(),logoSrc:this.options.logoSrc||"",imageAssetPath:this.options.imageAssetPath,showLogo:this.options.showLogo}},onRender:function(){f.isOn("gns")&&this.ui.blogLogo.removeClass("no-fade-transition"),this.listenTo(d,"logoHidden.topbar",this.fadeIn),this.listenTo(d,"logoShown.topbar",this.fadeOut)}});return g}),define("app/navigation/searchBar.view",["jquery","underscore","backbone.marionette","singleton/CurrentBlog","singleton/BlogInfo","singleton/EventDispatcher","singleton/Feature","templates/tiger/section/navbar"],function(a,b,c,d,e,f,g){var h=c.ItemView.extend({template:tiger.section.navbarSearchBar,tagName:"div",className:"search-bar",ui:{searchForm:".js_search-bar__form",searchField:".js_search-bar__field",closeSearchIcon:".js_search-button__close-icon",blogLogo:".js_blog-title__logo"},events:{keyup:"onKeyup","click @ui.closeSearchIcon":"onCloseSearchButtonClick"},onCloseSearchButtonClick:function(){this.ui.closeSearchIcon.removeClass("fade-in"),this.ui.searchForm.removeClass("open")},onKeyup:function(a){27===a.keyCode&&this.onCloseSearchButtonClick()},fadeIn:function(){this.ui.blogLogo.addClass("fade-in")},fadeOut:function(){this.ui.blogLogo.removeClass("fade-in")},serializeData:function(){return{blogName:(d||{}).name,blogDisplayName:d.displayName||"",isGmgBlog:e.currentBlogIsGmgBlog(),logoSrc:this.options.logoSrc||"",imageAssetPath:this.options.imageAssetPath,showLogo:this.options.showLogo}},onRender:function(){this.ui.searchForm.on("transitionend webkitTransitionEnd oTransitionEnd",function(a){"width"===a.originalEvent.propertyName&&this.ui.searchForm.hasClass("open")?this.ui.closeSearchIcon.addClass("fade-in"):"width"===a.originalEvent.propertyName&&this.trigger("closed.searchbar")}.bind(this)),g.isOn("gns")&&(this.listenTo(f,"logoHidden.topbar",this.fadeIn),this.listenTo(f,"logoShown.topbar",this.fadeOut))},onDomRefresh:function(){this.ui.searchField.focus(),this.ui.searchForm.addClass("open")}});return h}),define("app/navigation/topbar.layout",["jquery","underscore","backbone.marionette","lib/foundation/foundation","lib/amd-wrapped/modernizr","app/notifdropdown/notifdropdown.app","app/navigation/userButton.view","app/navigation/loginButton.view","app/navigation/blogTitle.view","app/navigation/searchBar.view","module/ads/model/ads.slotModel","view/behaviors/googleAnalytics.behavior","singleton/EventDispatcher","singleton/CurrentUser","singleton/Feature","singleton/Utils","singleton/WindowController","module/ads/ads.events"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s="splash"===p.getKinjaMeta().pageType,t=c.Layout.extend({ui:{menuDropdown:"#global-blog",notifDropdown:"#global-notifications",notifDropdownButton:".js_notif",navIcon:".js_nav-icon",kinjaIcon:".js_kinja-icon",userDropdown:"#global-user",rightUserBar:".js_right-user-bar",globalSearchDropdown:"#global-search",globalSearchInput:"#global-search-input",globalSearchTrigger:"#global-search-trigger",dashboardBlogSelectorBtn:".js_show-dashboard-blogs",hamburgerBtn:".js_hamburger-trigger",mobileTitle:".js_mobile-title",dashboardMobileTitleBlogs:".js_dashboard-mobile-title-blogs"},regions:{userButtonRegion:".js_right-user-bar",blogTitleRegion:".js_blog-title-region"},behaviors:{GoogleAnalyticsBehavior:{behaviorClass:l}},events:{"opened.fndtn.dropdown @ui.menuDropdown":"onDropdownOpened","closed.fndtn.dropdown @ui.menuDropdown":"onDropdownClosed","opened.fndtn.dropdown @ui.userDropdown":"onDropdownOpened","closed.fndtn.dropdown @ui.userDropdown":"onDropdownClosed","tap .right-off-canvas-toggle":"fetchNotifications","opened.fndtn.dropdown @ui.globalSearchDropdown":"onGlobalSearchOpened","closed.fndtn.dropdown @ui.globalSearchDropdown":"onGlobalSearchClosed","click @ui.dashboardBlogSelectorBtn":"openBlogSelector"},modelEvents:{authenticated:"onModelAuthenticated"},onRender:function(){},initializeAutohide:function(){var b,c,d,e,f=window.kinja.meta.blogSales?window.kinja.meta.blogSales.adsEnabled:!1;b=function(){this.$el.addClass("fixed"),q.scrollAutohide(this.$el,{waypoint:a(".js_page")}),this.$el.removeClass("notransition")}.bind(this),c=function(){this.$el.removeClass("fixed"),q.unbindScrollAutohide()}.bind(this),d=function(){(a(".js_site-header").length||s)&&(this.showBlogLogo(),s||(this.setupScroll(),this.refreshBlogLogo())),o.isOn("splashy_ad")?(e=function(){0!==this.$el.offset().top?q.registerWaypoint(this.$el.parent(),0,function(a){"down"===a?b():c()}.bind(this)):b()}.bind(this),o.isOn("ad_module")?f?window.ads.events.onRender(k.zoneTypes.SPLASHYTOP,e):e():this.listenToOnce(r,"kinjaads.disabled kinjaads.SPLASHYTOP.displayed kinjaads.SPLASHYTOP.hide",e)):b()}.bind(this),o.isOn("gns")?this.model.onAuth.done(d):d()},mainLogoHidden:function(){var b=a(window),c=20,d=a(".js_site-header").offset().top-c,e=b.width()>799,f=b.scrollTop();return f>d&&e},setupScroll:function(){var c,d=a(window),e=20,f=a(".js_site-header").offset().top-e,g=function(){var a=d.scrollTop();m.trigger(a>f&&h?"logoHidden.topbar":"logoShown.topbar"),this.ui.navIcon.toggleClass("hide",a>f),this.ui.kinjaIcon.toggleClass("hide",f>a)}.bind(this),h=d.width()>799;c=b.throttle(g,100),d.on("scroll.topbar",c),this.listenTo(m,"orientation:change",function(){h=d.width()>799})},showUserButton:function(){var a=new g({model:n});this.userButtonRegion.show(a)},showLoginButton:function(){var a=new h;this.userButtonRegion.show(a)},showBlogLogo:function(){var b=this.blogTitleRegion.$el||a(this.blogTitleRegion.el),c=new i({logoSrc:b.data("logoSrc"),imageAssetPath:b.data("imageAssetPath"),showLogo:s?!1:this.mainLogoHidden()});c.on("open.searchbar",this.showSearchBar.bind(this)),this.blogTitleRegion.show(c),o.isOn("gns")||s||this.refreshBlogLogo()},refreshBlogLogo:function(){a(window).trigger("scroll")},showSearchBar:function(){var b=this.blogTitleRegion.$el||a(this.blogTitleRegion.el),c=new j({logoSrc:b.data("logoSrc"),imageAssetPath:b.data("imageAssetPath"),showLogo:s?!1:this.mainLogoHidden()});this.listenTo(c,"closed.searchbar",this.showBlogLogo),this.blogTitleRegion.show(c)},onModelAuthenticated:function(){this.model.isLoggedIn()?(this.showUserButton(),f.initialize()):(this.showLoginButton(),f.remove()),a(window.document).foundation()},onDropdownOpened:function(b){var c=b.target.id;a("[data-dropdown="+c+"]").addClass("active"),a("body").addClass(c+"-open")},onDropdownClosed:function(b){var c=b.target.id;a("[data-dropdown="+c+"]").removeClass("active"),a("body").removeClass(c+"-open")},manualCloseDropdown:function(){d.libs.dropdown.close(this.ui.menuDropdown)},fetchNotifications:function(){f.fetch()},onGlobalSearchOpened:function(){this.ui.globalSearchInput.focus(),this.ui.globalSearchTrigger.addClass("active")},onGlobalSearchClosed:function(){this.ui.globalSearchInput.blur(),this.ui.globalSearchTrigger.removeClass("active")},openBlogSelector:function(b){var c=this;b.stopPropagation(),a(".dashboard-blog-selector").height(a(document).height()),a(".dashboard-blog-selector").removeClass("hide"),this.ui.dashboardBlogSelectorBtn.addClass("hide"),this.ui.hamburgerBtn.removeClass("hide"),this.ui.mobileTitle.addClass("hide"),this.ui.dashboardMobileTitleBlogs.removeClass("hide"),a("body").on("click.hidemenu",function(){c.closeBlogSelector()})},closeBlogSelector:function(){this.ui.dashboardBlogSelectorBtn.removeClass("hide"),this.ui.hamburgerBtn.addClass("hide"),this.ui.mobileTitle.removeClass("hide"),this.ui.dashboardMobileTitleBlogs.addClass("hide"),a(".dashboard-blog-selector").addClass("hide"),a("body").off("click.hidemenu")}});return t}),define("templates/tiger/components/user/your-blogs",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.user.yourBlogsItem=function(a,b){var c=b||new d.StringBuilder;return c.append('	<a href="http://',d.$$escapeHtml(a.blogData.canonicalHost),'" class="hover-icon" data-ga="[User Menu, My Blogs Click - ',d.$$escapeHtml(a.blogData.displayName),']">',d.$$escapeHtml(a.blogData.displayName),"</a>"),b?"":c.toString()}}),define("app/navigation/blogItem.view",["backbone.marionette","templates/tiger/components/user/your-blogs"],function(a){var b=a.ItemView.extend({template:tiger.components.user.yourBlogsItem,tagName:"li",className:"js_ownblog",serializeData:function(){return{blogData:this.model.attributes}}});return b}),define("apiclient/promotion",["config","apiclient/apirequest","apiclient/gettoken"],function(a,b,c){var d,e;return e={getByBlog:a.api.core.url+"/blog/{{blogId}}/promoted/future",getByPost:a.api.core.url+"/promotion/post/{{postId}}",getByCurrentUserAndPost:a.api.core.url+"/promotion/blog/{{blogId}}/post/{{postId}}/future",add:a.api.core.url+"/promotion/add",update:a.api.core.url+"/promotion/{{promotionId}}"},d={getByBlog:b.getJson(c.append(e.getByBlog,c.fresh)),getByPost:b.getJson(c.append(e.getByPost,c.fresh)),getByCurrentUserAndPost:b.getJson(c.append(e.getByCurrentUserAndPost,c.fresh)),add:b.postJson(c.append(e.add,c.fresh)),update:b.postJson(c.append(e.update,c.fresh))}}),define("model/business.promotionModel",["backbone","apiclient/promotion"],function(a,b){var c=a.Model.extend({defaults:function(){var a=(new Date).getTime(),b=a+108e5;return{displayCap:c.UNLIMITED_DISPLAY_CAP_VALUE,byline:"",beginTimeMillis:a,endTimeMillis:b}},setDeleted:function(){this.set({beginTimeMillis:c.ARCHIVE_TIMESTAMP,endTimeMillis:c.ARCHIVE_TIMESTAMP})},parse:function(a){return a.data||a},sync:function(a,c,d){var e,f;switch(a){case"update":e=c.toJSON(),e.promotionId=e.id,f=b.update(e,d);break;case"create":e=c.toJSON(),f=b.add(e,d);break;default:throw new Error("Promotion.sync(): unsupported method in sync")}this.trigger("request",this,f,d)}},{ARCHIVE_TIMESTAMP:28136994e4,UNLIMITED_DISPLAY_CAP_VALUE:-1});return c}),define("collection/business.promotionCollection",["backbone","model/business.promotionModel","apiclient/promotion"],function(a,b,c){var d=a.Collection.extend({model:b,addNew:function(){this.add({postId:this.postId})},parse:function(a){return a&&a.data?a.data.items||[]:[]},sync:function(a,b,d){if("read"===a){if(d.blogId&&d.postId)return c.getByCurrentUserAndPost({blogId:d.blogId,postId:d.postId},d);if(d.blogId)return c.getByBlog({blogId:d.blogId},d);if(d.postId)return c.getByPost({postId:d.postId},d);throw new Error("PromotionCollection.sync(): missing parameter blogId or postId")}throw new Error("PromotionCollection.sync(): unsupported method")}});return d}),define("view/forms/BaseModalView",["jquery","backbone","underscore","backbone.marionette","app/MarionetteApp","singleton/EventDispatcher"],function(a,b,c,d,e,f){var g=d.ItemView.extend({viewConstructors:{},initializedViews:{},className:"reveal-modal",attributes:{"data-reveal":""},events:{"click .js_cancel":"onCloseClick","click .js_close":"onCloseClick","click .js_navigate":"onNavigateClick",cancel:"onCloseClick",close:"onModalDestroyed"},ui:{navigationElements:".js_navigate",subViews:".js_sub-view",formContainer:".js_form-container",defaultView:"[data-default]",activeLink:".js_navigate.active"},initialize:function(){var b=this;d.ItemView.prototype.initialize.call(b,arguments),b.viewConstructors=c.extend(b.viewConstructors,b.options.viewConstructors),a(document).on("close","[data-reveal]",function(){b.onModalDestroyed.bind(b)})},closeSubViews:function(){var a,b=this,c=b.initializedViews;for(a in c)c.hasOwnProperty(a)&&(c[a].close?c[a].close():c[a].remove(),delete c[a])},parseExtraOptions:function(a){var b,c,d={};return a&&a.attr("data-extra-options")&&(d=a.attr("data-extra-options").split(":"),b=d[0],c=d[1],d[b]=c),d},toggleView:function(b,d){d=d||{};var e,f=this,g=a(b),h=g.find("input, textarea"),i=g.attr("data-sub-view"),j=f.ui.navigationElements.filter('[data-sub-view="'+i+'"]'),k=f.parseExtraOptions(j),l=f.viewConstructors[i];l&&(f.initializedViews.hasOwnProperty(i)||(f.initializedViews[i]=new l(c.extend({el:g},d,k))),e=f.initializedViews[i],f.ui.activeLink.removeClass("active"),j.addClass("active"),f.ui.subViews.hide(),e.$el.show(),e.cancelErrors(),e.trigger("show"),f.bindUIElements()),h.length&&h[0].focus()},onCloseClick:function(a){a&&a.preventDefault&&a.preventDefault(),this.close()},onNavigateClick:function(b){b.preventDefault();var c=a(b.currentTarget),d=this.ui.formContainer.find('[data-sub-view="'+c.attr("data-sub-view")+'"]');this.toggleView(d)},onRender:function(){var a=this;a.ui.defaultView&&!this.options.ignoreDefault&&a.toggleView(a.ui.defaultView)},onBeforeRender:function(){this.templateVars&&!this.model&&(this.model=new b.Model(this.templateVars))},onModalDestroyed:function(){return this.closeSubViews(),f.off(null,null,this),!1},serializeData:function(){return this.templateVars?this.templateVars:d.ItemView.prototype.serializeData.call(this)},close:function(){var a=this.$el;a.hasClass("open")&&a.foundation("reveal","close"),this.remove()},remove:function(){var a=this;a.closeSubViews(),f.off(null,null,a),d.ItemView.prototype.close.call(a)}});return g}),define("templates/tiger/components/forms/modals/header",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.forms.modals.header=function(a,b){var c=b||new d.StringBuilder;return c.append("	<header><h3>",d.$$escapeHtml(a.name),a.disableClose?"":'<a class="js_cancel modal-close-x">&times;</a>',"</h3></header>"),b?"":c.toString()}}),define("templates/tiger/components/forms/modals/promote",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.forms.modals.promoteTable=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");var g=new d.StringBuilder('<form id="promote-form"><div class="modal-body"><div class="mtl mbs"><p class="text-small">Select a blog to promote this post:.</p></div><div><table class="proxima"><thead><tr>',a.promotions&&a.promotions[0]&&a.promotions[0].blog?"<th>Blog</th>":"<th>Post</th>","<th>Byline</th><th>Start</th><th>End</th><th>Views</th><th>Display Cap</th>",a.blogs?'<th colspan="2">Preview</th>':"<th>Preview</th><th>Delete on Save</th>","</tr></thead><tbody>");if(a.blogs){g.append('<tr class="js_promoteNewRow"><td><select id="promotion_blog_new"><option value="">Choose a blog:</option>');for(var h=a.blogs,i=h.length,j=0;i>j;j++){var k=h[j];g.append('<option value="',d.$$escapeHtml(k.id),'">',d.$$escapeHtml(k.name),"</option>")}g.append('</select></td><td class="promote-byline_new"><span class="js_promoteByline"><input type="text" name="byline" value="" id="byline_new" class="mbn" /></span></td><td class="promote-begin_new"><input type="text" name="begin" value="',d.$$escapeHtml(a.formattedBegin),'" id="beginning_new" class="mbn" /></td><td class="promote-end_new"><input type="text" name="end" value="',d.$$escapeHtml(a.formattedEnd),'" id="ending_new" class="mbn" /></td><td>&nbsp;</td><td class="promote-displaycap_new"><span class="js_promoteDisplayCap"><input type="text" name="displaycap" value="" id="displaycap_new" class="mbn" /></span></td><td><span class="text-small text-right mlm"><a href="/?promotedpostpreview=',d.$$escapeHtml(a.postId),'&token=" class="js_promotionPreviewLink" target="_preview" data-previewTarget="" >Preview</a></span></td><td><input type="hidden" name="post_id" value="',d.$$escapeHtml(a.postId),'" id="post_id_new" /></td></tr>')}g.append("<tr>",a.blogs&&a.promotions&&a.promotions[0]?'<td colspan="7">Existing Promotions:</td><td>Delete on Save</td>':"","</tr>");var l=a.promotions,m=l.length;if(m>0)for(var n=0;m>n;n++){var o=l[n];g.append('<tr class="js_promoteRow promotion_',d.$$escapeHtml(o.id),'"><td><input type="hidden" name="has_promotion" value="',d.$$escapeHtml(o.id),'" id="has_promotion" /><input type="hidden" name="post_id" value="',d.$$escapeHtml(o.postId),'" id="post_id_',d.$$escapeHtml(o.id),'" /><input type="hidden" name="blog_id" value="',d.$$escapeHtml(o.blogId),'" id="blog_id_',d.$$escapeHtml(o.id),'" />',o.blog?'<span class="bd user-name">'+d.$$escapeHtml(o.blog.name)+"</span>":'<span class="bd user-name">'+d.$$escapeHtml(o.headline)+"</span>",'</td><td class="promote-byline_',d.$$escapeHtml(o.id),'"><span class="js_promoteByline"><input type="text" name="byline" value="',d.$$escapeHtml(o.byline),'" id="byline_',d.$$escapeHtml(o.id),'" class="mbn" /></span></td><td class="promote-begin_',d.$$escapeHtml(o.id),'"><input type="text" name="begin" value="',d.$$escapeHtml(o.start),'" id="beginning_',d.$$escapeHtml(o.id),'" class="mbn" /></td><td class="promote-end_',d.$$escapeHtml(o.id),'"><input type="text" name="end" value="',d.$$escapeHtml(o.end),'" id="ending_',d.$$escapeHtml(o.id),'" class="mbn" /></td><td><span class="text-small" id="count-display_',d.$$escapeHtml(o.id),'">',d.$$escapeHtml(o.displayCountAsString),'</span></td><td class="promote-displaycap_',d.$$escapeHtml(o.id),'"><span class="js_promoteDisplayCap"><input type="text" name="displaycap" value="',d.$$escapeHtml(o.displayCapAsString),'" id="displaycap_',d.$$escapeHtml(o.id),'" class="mbn" /></span></td><td><span class="text-small text-right mlm"><a href="/?promotedpostpreview=',d.$$escapeHtml(o.id),""!=o.byline?"&promotedby="+d.$$escapeHtml(o.byline):"",'&token=" class="js_promotionPreviewLink" target="_preview" data-previewTarget="" >Preview</a></span></td><td><input type="checkbox" class="left" name="promotion_delete" value="',d.$$escapeHtml(o.id),'" id="promotion_delete_',d.$$escapeHtml(o.id),'"/></td></tr>')}else g.append('<tr><td colspan="8">No promotions found for this ',a.blogs?"post":"blog",".</td></tr>");return g.append('</tbody></table></div></div><div class="twelve columns mtl mbs promote-message"><p class="text-small text-center proxima success hide">Your promotion has been saved.</p><p class="text-small text-center proxima failure hide">Your promotion was not saved. Please try again.</p></div><footer class="phn"><a class="button js_cancel tiny left secondary">Close</a><a class="button js_promoteSubmit tiny right">Save</a></footer></form>'),b.components.forms.modals.modal.container({name:"Promote post",body:g.toString()},f,e),c?"":f.toString()},b.components.forms.modals.promoteTableNew=function(a,b){var c=b||new d.StringBuilder;return c.append('		<form id="promote-form"><div>',a.blogMode?"<p>Existing promotions for this blog:</p>":"<p>Existing promotions for this post. Click 'Add New' to add a new promotion.</p>",'<table class="proxima"><thead><tr>',a.blogMode?"<th>Post</th>":"<th>Blog</th>","<th>Byline</th><th>Start</th><th>End</th><th>Views</th><th>Display Cap</th>",a.blogMode?'<th colspan="2">Preview</th>':"<th>Preview</th><th>Remove / Delete</th>",'</tr></thead><tbody class="js_promotions"></tbody></table></div><div class="twelve columns mtl mbs promote-message"><p class="js_promotion-error text-small text-center proxima failure hide">Your promotions were not saved. Please check the rows marked in red and try again.</p></div><footer class="clearfix"><a class="button js_cancel tiny left secondary">Close</a><a class="button js_promote-submit tiny right">Save</a>',a.blogMode?"":'<a class="button add-new js_add-new tiny right">Add New</a>',"</footer></form>"),b?"":c.toString()},b.components.forms.modals.promotion=function(a,b){var c=b||new d.StringBuilder;if(c.append("	<td>"),!a.id||a.blog&&!a.blog.nonMembership){c.append('<select name="blog-id" id="promotion_blog_new"><option value="">Choose a blog:</option>');for(var e=a.blogList,f=e.length,g=0;f>g;g++){var h=e[g];c.append('<option value="',d.$$escapeHtml(h.id),'"',a.blog.name==h.name?" selected":"",">",d.$$escapeHtml(h.name),"</option>")}c.append("</select>")}else a.blog?c.append('<span class="bd user-name-game">',d.$$escapeHtml(a.blog.name),"</span>"):c.append('<span class="bd user-name">',d.$$escapeHtml(a.headline),"</span>");return c.append('</td><td><input type="text" name="byline" value="',d.$$escapeHtml(a.byline),'" id="byline_',d.$$escapeHtml(a.id),'" class="mbn" /></td><td><input type="text" name="begin" value="',d.$$escapeHtml(a.beginTime),'" id="beginning_',d.$$escapeHtml(a.id),'" class="mbn" /></td><td><input type="text" name="end" value="',d.$$escapeHtml(a.endTime),'" id="ending_',d.$$escapeHtml(a.id),'" class="mbn" /></td><td><span class="text-small" id="count-display_',d.$$escapeHtml(a.id),'">',d.$$escapeHtml(a.displayCountString),'</span></td><td><input type="text" name="displaycap" value="',d.$$escapeHtml(a.displayCapString),'" id="displaycap_',d.$$escapeHtml(a.id),'" class="mbn" /></td><td><span class="text-small text-right mlm"><a href="/?promotedpostpreview=',d.$$escapeHtml(a.id),""!=a.byline?"&promotedby="+d.$$escapeHtml(a.byline):"",'&token=" class="js_promotionPreviewLink" target="_preview" data-previewTarget="">Preview</a></span></td><td>',a.id&&a.blog?'<input type="checkbox" class="left" name="promotion_delete" value="'+d.$$escapeHtml(a.id)+'" id="promotion_delete_'+d.$$escapeHtml(a.id)+'"/>':'<a  href="#" class="js_remove no-decoration"><i class="icon icon-x-circle"></i></a>',"</td>"),b?"":c.toString()},b.components.forms.modals.noPromotions=function(a,c,e){var f=c||new d.StringBuilder;return f.append('	<td colspan="8">'),a.showSpinner?b.components.spinner.bounce(null,f,e):f.append("No promotions found."),f.append("</td>"),c?"":f.toString()}}),define("view/forms/PromoteTargetSelector",["jquery","underscore","backbone.marionette","view/forms/BaseModalView","singleton/CurrentUser","singleton/CurrentBlog","singleton/EventDispatcher","singleton/ModalManager","singleton/DateUtils","app/account/account.channel","templates/tiger/components/forms/modals/header","templates/tiger/components/forms/modals/modal","templates/tiger/components/forms/modals/promote"],function(a,b,c,d,e,f,g,h,i,j){var k=d.extend({id:"modal-promoteselector",className:"reveal-modal kinja-modal promote-subform large",events:b.extend(d.prototype.events,{"click .js_promoteSubmit":"promotePost","click .js_promoteDisplayCap":"selectDisplayCapText","blur .js_promoteDisplayCap":"checkDisplayCapText","keyup .js_promoteByline":"updatePreviewLinkOnBlur","change .js_promoteByline":"updatePreviewLinkOnBlur"}),ui:{promoteMessage:".promote-message"},forms:{},initialize:function(){this.$el.on("closed",a.proxy(this.remove,this))},str_UnlimitedDisplay:"Unlimited",int_UnlimitedDisplay:-1,displayCapToString:function(a){var b=a;return(isNaN(a)||0>a)&&(b=this.str_UnlimitedDisplay),b},displayCapToInt:function(a){var c,d=a;return void 0===a||a===this.str_UnlimitedDisplay?d=this.int_UnlimitedDisplay:(c=d.replace(/\s+/g,"").match(/-?\d+/g),null!==c&&(d=b.reduce(c,function(a,b){return a+b})),d=parseInt(d,10)),isNaN(d)&&(d=this.int_UnlimitedDisplay),d},selectDisplayCapText:function(b){var c=a(b.currentTarget).find('input[name="displaycap"]');c.focus(),c.select()},checkDisplayCapText:function(b){var c=a(b.currentTarget).find('input[name="displaycap"]'),d=this.displayCapToString(this.displayCapToInt(c.val()));c.val(d)},promotePost:function(c){c.stopPropagation(),c.preventDefault();var d=this,f=this.harvestFormData(d);return a(this.ui.promoteMessage).children().addClass("hide"),e.requireLogin("promoteform").done(function(){b.each(f,function(a){d.promote(a.blogId,a.postId,a.beginTimeMillis,a.endTimeMillis,a.id,a.displayCap,a.byline)})}),!1},harvestFormData:function(c){var d,e,f,g=[],h=this.$el.find(".js_promoteRow"),i=0;return b.each(h,function(b){d=a(b),e=d.find("#has_promotion").val(),g[i]=[],g[i].id=e,g[i].postId=d.find("#post_id_"+e).val(),g[i].blogId=d.find("#blog_id_"+e).val(),g[i].displayCap=c.displayCapToInt(d.find("#displaycap_"+e).val()),g[i].byline=d.find("#byline_"+e).val(),d.find("#promotion_delete_"+e).is(":checked")?(g[i].beginTimeMillis=28136994e4,g[i].endTimeMillis=28136994e4):(g[i].beginTimeMillis=new Date(d.find("#beginning_"+e).val()).getTime(),g[i].endTimeMillis=new Date(d.find("#ending_"+e).val()).getTime()),i+=1}),f=a(".js_promoteNewRow"),f.length>0&&""!==f.find("#promotion_blog_new").val()&&(g[i]=[],g[i].postId=f.find("#post_id_new").val(),g[i].blogId=f.find("#promotion_blog_new").val(),g[i].displayCap=c.displayCapToInt(f.find("#displaycap_new").val()),g[i].byline=f.find("#byline_new").val(),g[i].beginTimeMillis=new Date(f.find("#beginning_new").val()).getTime(),g[i].endTimeMillis=new Date(f.find("#ending_new").val()).getTime()),g},promote:function(b,c,d,f,h,i,k){e.isLoggedIn()||j.trigger("loginRequired",{source:"promoteform"}),h=void 0!==h?h:0,h=parseInt(h,10);var l="",m={blogId:parseInt(b,10),postId:parseInt(c,10),beginTimeMillis:d,endTimeMillis:f,displayCap:i,byline:k},n=this;"number"==typeof h&&h>0?(l="/apiproxy/promotion/"+h+"?token="+e.get("token"),m.promotionId=h):l="/apiproxy/promotion/add?token="+e.get("token"),a.ajax({url:l,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(m),success:function(a){void 0!==a.meta&&200===a.meta.status?(g.trigger("successbox:display",{message:tiger.messages.settingsSaved()}),n.close()):this.error()},error:function(){a(n.ui.promoteMessage).find(".failure").removeClass("hide")}})},render:function(d,g){var j,k,l,m,n=!!d,o=!!g,p=this,q=[],r=[],s=e.get("membership").length,t=0,u=tiger.components.forms.modals.promoteTable;return n?a.ajax({url:"/apiproxy/blog/"+f.id+"/promoted/future",type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",success:function(d){p.el.id="modal-promotedList",m=a("#modal-promotedList"),m.html(),d.data&&d.data.items&&d.data.items.length>0&&b.each(d.data.items,function(a){k=a.promotions[0],k.headline=a.headline,k.start=i.getMDYYYYHHMM(new Date(k.beginTimeMillis)),k.end=i.getMDYYYYHHMM(new Date(k.endTimeMillis)),k.displayCapAsString=p.displayCapToString(k.displayCap),k.displayCountAsString=k.displayCap===p.int_UnlimitedDisplay?k.displayCount:k.displayCount+" of "+k.displayCap,k.postId=a.id,r.push(k)}),a("body").append(p.$el.html(c.Renderer.render(u,{promotions:r}))),m=m.length<1?a("#modal-promotedList"):m,h.create(m).open()}}):o?(j=this.model.id,a.ajax({url:"/apiproxy/promotion/post/"+j,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",success:function(d){p.el.id="modal-promotedList",m=a("#modal-promotedList"),m.html(),d.data&&d.data.items&&d.data.items.length>0&&b.each(d.data.items,function(a){a.start=i.getMDYYYYHHMM(new Date(a.beginTimeMillis)),a.end=i.getMDYYYYHHMM(new Date(a.endTimeMillis)),a.displayCapAsString=p.displayCapToString(a.displayCap),a.displayCountAsString=a.displayCap===p.int_UnlimitedDisplay?a.displayCount:a.displayCount+" of "+a.displayCap,r.push(a)}),a("body").append(p.$el.html(c.Renderer.render(u,{promotions:r,readOnly:!0}))),m=m.length<1?a("#modal-promotedList"):m,h.create(m).open()}})):e.get("membership").length>0&&(j=this.model.id,e.get("membership").map(function(a){var b={id:a.get("blogId"),name:a.get("blog").displayName,canonicalHost:a.get("blog").canonicalHost};q.push(b)}),b.each(q,function(d){a.ajax({url:"/apiproxy/promotion/blog/"+d.id+"/post/"+j+"/future",type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",success:function(a){a.data&&a.data.items&&a.data.items.length>0&&b.each(a.data.items,function(a){a.blog=d,a.start=i.getMDYYYYHHMM(new Date(a.beginTimeMillis)),a.end=i.getMDYYYYHHMM(new Date(a.endTimeMillis)),a.displayCapAsString=p.displayCapToString(a.displayCap),a.displayCountAsString=a.displayCap===p.int_UnlimitedDisplay?a.displayCount:a.displayCount+" of "+a.displayCap,a.postId=j,r.push(a)
}),t++,l=new Date,t===s&&p.$el.html(c.Renderer.render(u,{promotions:r,blogs:q,postId:j,formattedBegin:i.getMDYYYYHHMM(l),formattedEnd:i.getMDYYYYHHMM(new Date(l.getTime()+108e5))}))}})})),this},updatePreviewLinks:function(a,b){b.attr("href",b.attr("data-previewTargetLink")+"&promotedby="+a)},updatePreviewLinkOnBlur:function(b){var c=a(b.target),d=c.val(),e=c.attr("id").split("_");d&&2===e.length&&this.updatePreviewLinks(d,a("[data-previewTarget="+e[1]+"]"))}});return k}),define("view/business.promotionView",["underscore","backbone.marionette","singleton/Utils","singleton/DateUtils","singleton/CurrentUser","model/business.promotionModel","templates/tiger/components/forms/modals/promote"],function(a,b,c,d,e,f){var g=b.ItemView.extend({template:tiger.components.forms.modals.promotion,tagName:"tr",className:function(){var a="js_promoteRow promotion_";return a+(this.model.id||"new")},ui:{postIdField:'input[name="post-id"]',blogIdField:'select[name="blog-id"]',displayCapField:'input[name="displaycap"]',bylineField:'input[name="byline"]',beginTimeField:'input[name="begin"]',endTimeField:'input[name="end"]',removeButton:".js_remove",deleteField:'input[name="promotion_delete"]'},events:{"blur @ui.displayCapField":"onDisplayCapFieldBlur","focus @ui.displayCapField":"onDisplayCapFieldFocus","keyup @ui.bylineField":"onBylineFieldChange","change @ui.bylineField":"onBylineFieldChange","click @ui.removeButton":"onRemoveButtonClick"},modelEvents:{request:"onModelRequest",sync:"render",error:"onModelError"},displayCapString:function(a){return 0===a||a&&a!==f.UNLIMITED_DISPLAY_CAP_VALUE?a.toString():g.UNLIMITED_DISPLAY_TEXT},displayCapValue:function(a){return a&&a!==g.UNLIMITED_DISPLAY_TEXT?parseInt(a,10):f.UNLIMITED_DISPLAY_CAP_VALUE},onDisplayCapFieldBlur:function(){var a=this.displayCapString(this.ui.displayCapField.val());this.ui.displayCapField.val(a)},updatePreviewLinks:function(a,b){b.attr("href",b.attr("data-previewTargetLink")+"&promotedby="+a)},onDisplayCapFieldFocus:function(){var a=this.ui.displayCapField.val();a===g.UNLIMITED_DISPLAY_TEXT&&this.ui.displayCapField.val("")},onBylineFieldChange:function(){var a=this.ui.bylineField.val(),b=this.ui.bylineField.attr("id").split("_");a&&2===b.length&&this.updatePreviewLinks(a,this.$("[data-previewTarget="+b[1]+"]"))},syncWithModel:function(){this.ui.deleteField.is(":checked")?this.model.setDeleted():this.model.set({blogId:parseInt(this.ui.blogIdField.val(),10),displayCap:this.displayCapValue(this.ui.displayCapField.val()),byline:this.ui.bylineField.val(),beginTimeMillis:d.getTimeInMilliseconds(this.ui.beginTimeField.val()),endTimeMillis:d.getTimeInMilliseconds(this.ui.endTimeField.val())}),this.model.hasChanged()&&!this.model.hasChanged("blogId")?this.model.save():this.model.hasChanged()||this.model.trigger("sync")},_tdSafeRender:function(a,b){return a(b)},render:function(){var a,b,c;return this.isClosed=!1,this.triggerMethod("before:render",this),this.triggerMethod("item:before:render",this),b=this.serializeData(),b=this.mixinTemplateHelpers(b),a=this.getTemplate(),c=this._tdSafeRender(a,b),this.$el.html(c),this.bindUIElements(),this.triggerMethod("render",this),this.triggerMethod("item:rendered",this),this},serializeData:function(){var b=this.model.toJSON();return b.displayCapString=this.displayCapString(b.displayCap),b.displayCountString=this.model.get("displayCount")||"",b.beginTime=d.getMDYYYYHHMM(b.beginTimeMillis),b.endTime=d.getMDYYYYHHMM(b.endTimeMillis),this.model.collection.postId&&(b.blogList=this.model.collection.userBlogs,b.blog=a.findWhere(this.model.collection.userBlogs,{id:b.blogId})||{nonMembership:!0,name:"(Non-membership blog)"}),b},setErrorState:function(){this.$el.addClass("promotion-error")},resetErrorState:function(){this.$el.removeClass("promotion-error")},onModelRequest:function(){this.resetErrorState()},onModelError:function(){this.setErrorState()},onRemoveButtonClick:function(){this.model.destroy()}},{UNLIMITED_DISPLAY_TEXT:"Unlimited"});return g}),define("view/business.noPromotionsView",["backbone.marionette","templates/tiger/components/forms/modals/promote"],function(a){var b=a.ItemView.extend({template:tiger.components.forms.modals.noPromotions,tagName:"tr",render:function(){var a,b,c;return this.isClosed=!1,this.triggerMethod("before:render",this),this.triggerMethod("item:before:render",this),b=this.serializeData(),b=this.mixinTemplateHelpers(b),a=this.getTemplate(),c=a(b),this.$el.html(c),this.bindUIElements(),this.triggerMethod("render",this),this.triggerMethod("item:rendered",this),this},serializeData:function(){return{showSpinner:this.options.loading}}});return b}),define("view/forms/business.promotionModal",["jquery","underscore","backbone.marionette","singleton/EventDispatcher","app/modal/modal.controller","view/business.promotionView","view/business.noPromotionsView","templates/tiger/components/forms/modals/promote"],function(a,b,c,d,e,f,g){var h=c.CompositeView.extend({id:"promote-modal",className:"modal-body proxima",template:tiger.components.forms.modals.promoteTableNew,itemViewContainer:".js_promotions",itemView:f,_syncCount:-1,_error:!1,itemViewOptions:function(){return{loading:!this.collection.allLoaded}},emptyView:g,ui:{submitButton:".js_promote-submit",promoteMessage:".promote-message",addNewButton:".js_add-new",errorMessage:".js_promotion-error"},events:{"click @ui.submitButton":"onSubmitButtonClick","click @ui.addNewButton":"onAddNewButtonClick","click @ui.cancelNewButton":"onCancelNewButtonClick"},collectionEvents:{sync:"onSync",error:"onError",request:"onRequest"},serializeData:function(){return{blogMode:!this.collection.postId}},showErrorMessage:function(){this.ui.errorMessage.removeClass("hide")},hideErrorMessage:function(){this.ui.errorMessage.addClass("hide")},onSubmitButtonClick:function(){this._syncCount=this.collection.length,this._error=!1,this.children.each(function(a){a.syncWithModel()}.bind(this))},onAddNewButtonClick:function(){this.collection.addNew()},onRequest:function(){this.hideErrorMessage()},onSync:function(){this.collection.allLoaded&&this.isEmpty()&&this.collection.postId?this.collection.addNew():(this.closeEmptyView(),this.checkEmpty()),this._syncCount>0&&this._syncCount--,0!==this._syncCount||this._error||(e.close(),d.trigger("successbox:display",{message:tiger.messages.settingsSaved()}))},onError:function(){this._error=!0,this.showErrorMessage()}});return h}),define("app/post/posttools/controller/posttools.promote.controller",["jquery","underscore","singleton/CurrentBlog","singleton/CurrentUser","singleton/Utils","singleton/ModalManager","singleton/EventDispatcher","singleton/Feature","app/modal/modal.controller","model/business.promotionModel","collection/business.promotionCollection","view/forms/PromoteTargetSelector","view/forms/business.promotionModal"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n={_blogsForCurrentUser:function(){return d.get("membership").map(function(a){return{id:a.get("blogId"),name:a.get("blog").displayName,canonicalHost:a.get("blog").canonicalHost}})},_showPromoteModal:function(a,c){var d,e,f,g,h=new k,j=this._blogsForCurrentUser();e="userBlogs"===a?b.pluck(j,"id"):[a],f=e.length,g=function(){f--,0===f&&(h.allLoaded=!0,h.off("sync",g))},h.on("sync",g),h.on("change:blogId",function(a){var b=a.previous("blogId"),c=a.clone();c.setDeleted(),c.set("blogId",b,{silent:!0}),c.save(),a.unset("id"),a.save()}),d=new m({collection:h}),h.postId=c,h.userBlogs=j,i.create(d,{name:"promotion"}),b.each(e,function(a){h.fetch({blogId:a,postId:c,remove:!1})})},API:{promote:function(a){var b=new l({model:a}),c=function(){f.create(b.render().$el).bind("close",e).open()},e=function(){null!==b&&(b.off("remove",null),b=null)};d.requireLogin("promotemodal").done(function(){c()})},promotionsForBlog:function(a){n._showPromoteModal(a||c.id,null)},promotionsForPost:function(a){n._showPromoteModal(null,a||e.getKinjaMeta().post.id)},promotionsForCurrentUserAndPost:function(a){n._showPromoteModal("userBlogs",a||e.getKinjaMeta().post.id)}}};return n.API}),define("view/Spinner",["jquery","view/BaseView","templates/tiger/components/spinner","templates/tiger/messages"],function(a,b){var c=b.extend({visible:!0,fullscreen:!1,tagName:"div",className:"spinner-wrapper",initialize:function(a){this.visible=void 0===a.initiallyVisible?!0:a.initiallyVisible,this.fullscreen=void 0===a.fullscreen?!1:a.fullscreen,this.render()},render:function(){var b;return this.visible&&(b=this.fullscreen?this.soyToHtml(tiger.messages.postSave,{showMessage:!1}):this.soyToHtml(tiger.components.spinner.bounce,{})),this.$el.html(b),this.fullscreen?a(this.el).find(".animate").addClass("in"):a(this.el).addClass("with-margin"),this}});return c}),define("gawkerlib/analytics/analytics_config_prod",[],function(){var a={rootUrl:"http://kinja.com/api/analytics/",rootUrlWoProtocol:"//kinja.com/api/analytics/"};return a}),!function(){function a(a){this.message=a}var b="undefined"!=typeof exports?exports:this,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.prototype=new Error,a.prototype.name="InvalidCharacterError",b.btoa||(b.btoa=function(b){for(var d,e,f=String(b),g=0,h=c,i="";f.charAt(0|g)||(h="=",g%1);i+=h.charAt(63&d>>8-g%1*8)){if(e=f.charCodeAt(g+=.75),e>255)throw new a("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");d=d<<8|e}return i}),b.atob||(b.atob=function(b){var d=String(b).replace(/=+$/,"");if(d.length%4==1)throw new a("'atob' failed: The string to be decoded is not correctly encoded.");for(var e,f,g=0,h=0,i="";f=d.charAt(h++);~f&&(e=g%4?64*e+f:f,g++%4)?i+=String.fromCharCode(255&e>>(-2*g&6)):0)f=c.indexOf(f);return i})}(),define("lib/base64.min",function(){}),define("module/KinjaAnalytics",["jquery","gawkerlib/analytics/analytics_config_prod","singleton/Feature","lib/base64.min"],function(a,b,c){var d={session:{},context:{},setContext:function(a,b,c){this.context.blogId=a,this.context.contextType=b,this.context.id=c},createPayload:function(a,b,c,d,e,f,g,h){var i={blogId:a,eventType:b,targetType:c,targetId:d,contextType:e,contextId:f,eventAttributes:g,eventAttributesExtended:h};return i},pushEvent:function(a,b,c,d,e){var f=this.createPayload(this.context.blogId?String(this.context.blogId):null,a,b,c?String(c):null,this.context.contextType,this.context.id?String(this.context.id):null,d,e);this.writeEvent(f)},setSession:function(a){return"string"==typeof a.agid&&"string"==typeof a.asid&&a.ping?(this.session.globalId=a.agid,this.session.sessionId=a.asid,this.session.ping=a.ping,!0):!1},getEventMeta:function(){var a={context:this.context,session:this.session};return a},writeEvent:function(d){var e=btoa(JSON.stringify(d)),f=c.isOn("linkswoprotocol")?b.rootUrlWoProtocol:b.rootUrl,g=Math.floor(1e3*Math.random()+1),h=f+"t/event.js?e="+e+"&cb="+g,i=this;a.ajax(h,{type:"GET",success:function(a){i.setSession(a.data)},crossDomain:!0,dataType:"jsonp"})}};return d}),define("templates/tiger/components/user/profile-menu",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.user.globalProfileMenuContent=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");var g=e.features.svgicons;return f.append('<ul class="user-links"><li class="display-name"><span class="js_username username">',d.$$escapeHtml(a.displayName),'</span></li><li class="hover-icon"><a href="//kinja.com/',d.$$escapeHtml(a.screenName),'"',g?' class="icon--svg"':"",' data-ga="[User Menu, Your profile click, js_pageType]">'),g?b.icons.places.user(null,f,e):f.append('<span class="icon oversized icon-user -alt icon-prepend"></span>'),f.append('Your profile</a></li><li class="hover-icon"><a href="#" class="js_compose-post-button readonly-hide',g?" icon--svg":"",'" data-ga="[User Menu, Compose Post Click, js_pageType]">'),g?b.icons.actions.write(null,f,e):f.append('<span class="icon oversized icon-pencil-alt icon-prepend"></span>'),f.append('Compose post</a></li><li class="hover-icon"><a href="//kinja.com/settings" class="js_settings-link readonly-hide',g?" icon--svg":"",'" data-ga="[User Menu, Account Settings Click, js_pageType]">'),g?b.icons.actions.gear(null,f,e):f.append('<span class="icon oversized icon-gear icon-prepend"></span>'),f.append('Account Settings</a></li><li class="hover-icon"><a href="//kinja.com/dashboard"',g?' class="icon--svg"':"",' data-ga="[User Menu, Private View Click, js_pageType]">'),g?b.icons.places.lock(null,f,e):f.append('<span class="icon oversized icon-lock icon-prepend"></span>'),f.append('Dashboard</a></li><li class="hover-icon"><a href="//kinja.com/manage" data-ga="[User Menu, New Manage Blog Click, js_pageType]"',g?' class="icon--svg"':"",">"),g?b.icons.places.settings(null,f,e):f.append('<span class="icon oversized icon-users icon-prepend"></span>'),f.append("Manage blogs</a></li>"),e.features.superuser&&("frontpage"==a.pageType||"permalink"==a.pageType)&&(f.append('<li class="js_manageblog hover-icon hide"><a href="#" class="js_manageblog-link hover-icon readonly-hide',g?" icon--svg":"",'" data-ga="[User Menu, Manage Blog Click, js_pageType]">'),g?b.icons.places.lock(null,f,e):f.append('<span class="icon oversized icon-gear icon-prepend"></span>'),f.append("Superuser Settings</a></li>")),f.append('<li class="js_salestools hover-icon hide"><a href="#" class="js_salestools-link hover-icon readonly-hide',g?" icon--svg":"",'" data-ga="[User Menu, Business Tool Click, js_pageType]">'),g?b.icons.essential.bubble(null,f,e):f.append('<i class="icon oversized icon-bubble-right icon-prepend"></i>'),f.append("Biz Tools",a.blogName?" for "+d.$$escapeHtml(a.blogName):"",'</a></li><li class="js_promotions hover-icon hide"><a href="#" class="js_promotions-link hover-icon readonly-hide',g?" icon--svg":"",'" data-ga="[User Menu, Promotions Click, js_pageType]">'),g?b.icons.essential.starCircle(null,f,e):f.append('<i class="icon oversized icon-star-circle icon-prepend"></i>'),f.append('Active Promotions</a></li><li class="js_superuser-tools hover-icon hide"><a href="#" class="js_createblog-link hover-icon readonly-hide',g?" icon--svg":"",'" data-ga="[User Menu, Create Blog Click, js_pageType]">'),g?b.icons.actions.blogAdd(null,f,e):f.append('<span class="icon icon-document-add oversized icon-prepend"></span>'),f.append("Create blog</a></li>"),e.features.superuser?(f.append('<li class="js_superuser-tools hide"><a href="?superuser=off" class="hover-icon',g?" icon--svg":"",'" data-ga="[User Menu, Hide Mom Jeans Click, js_pageType]">'),g?b.icons.essential.star(null,f,e):f.append('<span class="icon oversized icon-star icon-prepend"></span>'),f.append("Hide Mom Jeans</a></li>")):(f.append('<li class="js_superuser-tools hide"><a href="?superuser" class="hover-icon',g?" icon--svg":"",'" data-ga="[User Menu, Show Mom Jeans Click, js_pageType]">'),g?b.icons.essential.star(null,f,e):f.append('<span class="icon oversized icon-star icon-prepend"></span>'),f.append("Show Mom Jeans</a></li>")),f.append('<li class="hover-icon"><a href="#" class="js_logout-link',g?" icon--svg":"",'" data-ga="[User Menu, Logout Click, js_pageType]">'),g?b.icons.actions.logout(null,f,e):f.append('<span class="icon oversized icon-x-small icon-prepend"></span>'),f.append('Logout</a></li></ul><div class="divider"></div><ul class="title-ownblogs"><li class="title">My blogs</li></ul><ul class="js_myblogs myblogs"></ul>'),c?"":f.toString()}}),define("templates/tiger/icons/places/usage",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.icons.places.avatar=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-avatar"><use xlink:href="#iconset-avatar" /></svg>'),b?"":c.toString()},b.icons.places.blog=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-blog"><use xlink:href="#iconset-blog" /></svg>'),b?"":c.toString()},b.icons.places.hashmark=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-hashmark"><use xlink:href="#iconset-hashmark" /></svg>'),b?"":c.toString()},b.icons.places.home=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-home"><use xlink:href="#iconset-home" /></svg>'),b?"":c.toString()},b.icons.places.lock=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-lock"><use xlink:href="#iconset-lock" /></svg>'),b?"":c.toString()},b.icons.places.mail=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-mail"><use xlink:href="#iconset-mail" /></svg>'),b?"":c.toString()},b.icons.places.momjeans=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-momjeans"><use xlink:href="#iconset-momjeans" /></svg>'),b?"":c.toString()},b.icons.places.settings=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-settings"><use xlink:href="#iconset-settings" /></svg>'),b?"":c.toString()},b.icons.places.user=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-user"><use xlink:href="#iconset-user" /></svg>'),b?"":c.toString()}}),define("app/navigation/userMenu.view",["jquery","underscore","backbone","backbone.marionette","app/navigation/blogItem.view","app/post/posttools/controller/posttools.promote.controller","view/Spinner","singleton/Feature","singleton/CurrentBlog","singleton/Utils","singleton/ModalManager","module/KinjaAnalytics","view/behaviors/googleAnalytics.behavior","templates/tiger/components/user/profile-menu","templates/tiger/icons/actions/usage","templates/tiger/icons/places/usage","templates/tiger/messages"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){h.isOn("svgicons")&&(require(["module/PlacesIconModule"],function(){}),require(["module/ActionsIconModule"],function(){}));var n=d.CompositeView.extend({events:{"click .js_logout-link":"onLogoutClick","click .js_createblog-link":"onCreateBlogClick","click .js_manageblog-link":"onManageBlogClick","click .js_salestools-link":"onSalesClick","click .js_promotions-link":"onPromotionsClick","click .js_channels-link":"onChannelsClick"},modelEvents:{authenticated:"render"},ui:{composeButton:".js_compose-post-button",superuserButtons:".js_superuser-tools",salesButtons:".js_salestools",blogButtons:".js_manageblog",promotionsButton:".js_promotions"},collection:new c.Collection,itemView:e,itemViewContainer:".js_myblogs",template:tiger.components.user.globalProfileMenuContent,behaviors:function(){return this.options.offcanvas?{GoogleAnalyticsBehavior:{behaviorClass:m}}:{}},initialize:function(){this.listenTo(this.model.get("membership"),"add",this.render),this.listenTo(this.model,"change:screenName change:displayName",this.render)},onRender:function(){if(this.model.isLoggedIn()){var c,d=this.model.get("displayName"),e=this.model.get("screenName"),f=this.model.get("defaultBlogId"),g=h.isOn("editor_own_page_test")?window.location.search:"",k=b.any(["OWNER","AUTHOR","ADMIN"],function(a){return this.model.hasRole(a,i.id)}.bind(this));d&&a(".js_username").text(d),g+=k?("?"===g[0]?"&":"?")+"blogid="+i.id:"",this.ui.composeButton.attr("href","//"+j.getKinjaHost()+"/write"+g),this.model.isSuperuser()?this.ui.superuserButtons.removeClass("hide"):this.ui.superuserButtons.remove(),this.model.isSalesperson()||this.model.isSuperuser()&&h.isOn("superuser")?this.ui.salesButtons.removeClass("hide"):this.ui.salesButtons.remove(),(this.model.isSalesperson()||this.model.isSuperuser()&&h.isOn("superuser")||i.isGmgBlog&&this.model.hasRole("ADMIN",i.id))&&this.ui.promotionsButton.removeClass("hide"),this.model.hasRole("ADMIN",i.id)||this.model.isSuperuser()&&i.id?this.ui.blogButtons.removeClass("hide"):this.model.isSuperuser()?this.ui.blogButtons.remove():a(".js_manageblog-link ").hide(),c=b.sortBy(this.model.getBlogs(),function(a){return a.id===f&&a.name!==e&&(a.name=e,a.canonicalHost=e+".kinja.com"),(a.id===f?"0":"1")+a.name}),this.collection.reset(c)}j.dropdownSentinel()},serializeData:function(){return{blogName:i.displayName,screenName:this.model.get("screenName"),pageType:j.kinjaMeta.pageType}},onLogoutClick:function(b){var c=j.getKinjaMeta().pageType;b.preventDefault(),a(".off-canvas-wrap").removeClass("move-left"),this.$el.removeClass("open"),this.model.logout(),("dashboard"===c||"manageblog"===c)&&(window.location.pathname.indexOf("notifications")>-1?l.setContext(null,"NOTIFICATIONS"):l.setContext(null,"DASHBOARD"),l.pushEvent("LOGOUT"))},onCreateBlogClick:function(a){a.preventDefault(),require(["module/BlogSettingsModule"],function(a){a.controller.showCreateBlog()})},onManageBlogClick:function(a){a.preventDefault(),require(["module/BlogSettingsModule"],function(a){a.controller.showManageBlog()})},onSalesClick:function(a){a.preventDefault(),require(["module/BusinessModule"],function(a){a.controller.showBusinessTools()})},onPromotionsClick:function(a){a.preventDefault(),h.isOn("dfpnative")?window.location.href="http://"+j.getKinjaHost()+"/dfp/promotions":h.isOn("marionette_promotions")?f.promotionsForBlog(i.id):require(["module/PromoteModalModule"],function(a){var b=new a;b.render(!0)})},onChannelsClick:function(b){b.preventDefault(),a(".js_channels-off-canvas-toggle").click()}});return n}),define("templates/tiger/components/blogdropdown",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.blogdropdown.globalBlogDropdown=function(a,c,e){var f=c||new d.StringBuilder;if("search"!=a.pageType&&(f.append('<div class="search show-for-medium-down">'),b.components.forms.search.simpleSearch(a,f,e),f.append("</div>")),f.append('<div class="divider show-for-medium-down"></div><div class="js_login-links show-for-medium-down"></div>'),a.blog&&""!=a.blog&&b.components.blogdropdown.blogfollowbutton(a,f,e),a.blogGroup&&a.blogGroup.length){f.append('<ul class="related-blog-list"><li class="title">Related blogs</li>');for(var g=a.blogGroup,h=g.length,i=0;h>i;i++){var j=g[i];f.append('<li><a href="http://',d.$$escapeHtml(j.canonicalHost),'" data-ga="[Kinja Menu, Related Blog Click, ',d.$$escapeHtml(j.name),']">'),j.avatar?f.append('<img src="',d.$$escapeHtml(window.kinja.imageUrl(j.avatar.id,"avt-small",j.avatar.format)),'" width="16" height="16" class="icon icon-prepend" />'):e.features.svgicons?(f.append('<span class="icon--svg u-prepended">'),b.icons.essential.siteDefault(null,f,e),f.append("</span>")):f.append('<span class="icon icon-sprite site-icon site-icon-default icon-prepend"></span>'),f.append(d.$$escapeHtml(j.displayName),"</a></li>")}f.append("</ul>")}return f.append('<ul class="gmg-blog-list"><li class="title">Blogs you may like</li>'),b.components.globalBlogLinks(null,f,e),f.append("</ul>"),c?"":f.toString()},b.components.blogdropdown.blogfollowbutton=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");var g=e.features.follow_plus,h=e.features.svgicons;return f.append('<ul class="show-for-medium-down"><li class="add js_follow-controls js_follow-blog-controls follow-controls--blog-menu" data-blogid="',d.$$escapeHtml(a.blog.id),'"><a href="#" class="js_followblogforuser proxima',h?" u-highlighted--hoverinverted":"",'">'),h?(f.append('<span class="icon--svg">'),b.icons.essential.add(null,f,e),f.append("</span>")):f.append(g?'<span class="follow-controls__icon-wrapper">':"",'<span class="icon icon-plus-alt"></span>',g?"</span>":""),f.append("<span>Follow ",d.$$escapeHtml((null==a.blog?null:a.blog.displayName)?a.blog.displayName:""),'</span></a><a href="#" class="js_unfollowblogforuser proxima hide',h?" u-highlighted--hoverinverted":"",'">'),e.features.svgicons?(f.append('<span class="icon--svg">'),b.icons.essential.checkmark(null,f,e),f.append("</span>")):f.append(g?'<span class="follow-controls__icon-wrapper">':"",'<span class="icon icon-checkmark-alt"></span>',g?"</span>":""),f.append("<span>Following</span></a></li></ul>"),c?"":f.toString()}}),define("templates/tiger/components/forms/search",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.forms.search.simpleSearch=function(a,c,e){var f=c||new d.StringBuilder;return f.append('	<form method="GET" class="search search-simple" ',a.formId?'id="'+d.$$escapeHtml(a.formId)+'" name="'+d.$$escapeHtml(a.formId)+'" ':"","action=\"/search\" onsubmit=\"window.ga('send', 'event', 'Search', 'Submit', '",d.$$escapeHtml(a.pageType),'\');"><div class="input-with-icon">'),e.features.svgicons?(f.append('<span class="icon--svg">'),b.icons.essential.search(null,f,e),f.append("</span>")):f.append('<span class="icon icon-search-alt-thin"></span>'),f.append('<input type="text" placeholder="Search ',d.$$escapeHtml((null==a.blog?null:a.blog.displayName)?a.blog.displayName:"Kinja"),'" name="q"',a.query?' value="'+d.$$escapeHtml(a.query)+'"':"",' class="mbn" autocomplete="off" data-focus-on-display/></div></form>'),c?"":f.toString()},b.components.forms.search.advancedSearch=function(a,c,e){var f=c||new d.StringBuilder;return f.append('	<form method="GET"',a.formClasses?'class="'+d.$$escapeHtml(a.formClasses)+' search" ':' class="search"',a.formId?' id="'+d.$$escapeHtml(a.formId)+'" name="'+d.$$escapeHtml(a.formId)+'" ':"",a.action?' action="'+d.$$escapeHtml(a.action)+'"':"","onsubmit=\"window.ga('send', 'event', 'Search', 'Submit', '",d.$$escapeHtml(a.pageType),'\');"><div class="input-with-icon mbx mtm">'),e.features.svgicons?(f.append('<span class="icon--svg">'),b.icons.essential.search(null,f,e),f.append("</span>")):f.append('<span class="icon icon-search"></span>'),f.append('<input type="text" placeholder="Search ',d.$$escapeHtml((null==a.blog?null:a.blog.displayName)?a.blog.displayName:"Kinja"),'" name="q"',a.query?' value="'+d.$$escapeHtml(a.query)+'"':"",' class="man" autocomplete="off" data-focus-on-display/></div></form>'),c?"":f.toString()}}),define("templates/tiger/components/bloglinks",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.globalBlogLinks=function(a,b){var c=b||new d.StringBuilder;return c.append('	<li><a href="http://deadspin.com" data-ga="[Kinja Menu, Blogs You May Like Click, Deadspin]"><span class="icon icon-prepend icon-sprite site-icon site-icon-deadspin"></span>Deadspin</a></li><li><a href="http://gawker.com" data-ga="[Kinja Menu, Blogs You May Like Click, Gawker]"><span class="icon icon-prepend icon-sprite site-icon site-icon-gawker"></span>Gawker</a></li><li><a href="http://gizmodo.com" data-ga="[Kinja Menu, Blogs You May Like Click, Gizmodo]"><span class="icon icon-prepend icon-sprite site-icon site-icon-gizmodo"></span>Gizmodo</a></li><li><a href="http://io9.com" data-ga="[Kinja Menu, Blogs You May Like Click, io9]"><span class="icon icon-prepend icon-sprite site-icon site-icon-io9"></span>io9</a></li><li><a href="http://jalopnik.com" data-ga="[Kinja Menu, Blogs You May Like Click, Jalopnik]"><span class="icon icon-prepend icon-sprite site-icon site-icon-jalopnik"></span>Jalopnik</a></li><li><a href="http://jezebel.com" data-ga="[Kinja Menu, Blogs You May Like Click, Jezebel]"><span class="icon icon-prepend icon-sprite site-icon site-icon-jezebel"></span>Jezebel</a></li><li><a href="http://kotaku.com" data-ga="[Kinja Menu, Blogs You May Like Click, Kotaku]"><span class="icon icon-prepend icon-sprite site-icon site-icon-kotaku"></span>Kotaku</a></li><li><a href="http://lifehacker.com" data-ga="[Kinja Menu, Blogs You May Like Click, Lifehacker]"><span class="icon icon-prepend icon-sprite site-icon site-icon-lifehacker"></span>Lifehacker</a></li><li><a href="http://sploid.gizmodo.com/" data-ga="[Kinja Menu, Blogs You May Like Click, Sploid]"><span class="icon icon-prepend icon-sprite site-icon site-icon-sploid"></span>Sploid</a></li>'),b?"":c.toString()}}),define("app/navigation/blogMenu.layout",["backbone.marionette","app/navigation/loginButton.view","view/behaviors/googleAnalytics.behavior","templates/tiger/components/blogdropdown","templates/tiger/components/forms/search","templates/tiger/components/bloglinks"],function(a,b,c){var d=a.Layout.extend({template:tiger.components.blogdropdown.globalBlogDropdown,regions:{loginRegion:".js_login-links"},behaviors:function(){return this.options.offcanvas?{GoogleAnalyticsBehavior:{behaviorClass:c}}:{}},modelEvents:{authenticated:"onModelAuthenticated"},renderLoginView:function(){this.loginRegion.show(new b)},onRender:function(){this.renderLoginView()},onModelAuthenticated:function(){this.model.isLoggedIn()?this.loginRegion.reset():this.renderLoginView()}});return d}),define("app/navigation/secondaryNav.view",["jquery","backbone","backbone.marionette"],function(a,b,c){var d=b.Model.extend({defaults:{open:!1}}),e=c.Layout.extend({model:new d,modelEvents:{"change:open":"listEventHandler"},initialize:function(){var a,b;this.animation=this.options.animation,this.animation&&this.$el.addClass("animated-secondary-nav"),a=new f({el:".js_toggle-secondary-nav",model:this.model}),b=new g({el:".js_secondary-nav-wrapper",model:this.model})},listEventHandler:function(){var b=this;this.model.get("open")?a("body").on("click.hidemenu",function(){b.model.set("open",!1)}):a("body").off("click.hidemenu")}}),f=c.ItemView.extend({events:{click:"openSecondaryNav"},initialize:function(){var b=this.$el.parents(".js_secondary-nav-btn-wrapper");a(".js_global-nav-wrap").on("autohide.pushdown.show",function(){b.addClass("shown")}).on("autohide.pushdown.hide",function(){b.removeClass("shown")})},openSecondaryNav:function(a){a.stopPropagation(),this.model.set("open",!0)}}),g=c.ItemView.extend({modelEvents:{"change:open":"toggleOpen"},toggleOpen:function(){this.model.get("open")&&(this.$el.height(a(document).height()),a(window).scrollTop(0)),this.$el.toggleClass("hide",!this.model.get("open"))}});return e}),define("app/post/mixins/post.successMessage",["jquery","singleton/Renderer","singleton/EventDispatcher"],function(a,b,c){var d={_displaySuccessMessage:function(a,d){c.trigger("successbox:display",{message:b.renderTemplate(a,d||{})})},_displayChannelMessage:function(a,d){c.trigger("successbox:display",{message:b.renderTemplate(a,d||{}),timeout:5e3})}};return d}),define("templates/tiger/components/channels",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.channels.layout=function(a,b){var c=b||new d.StringBuilder;return c.append('	<div class="js_my-channels-region"></div><div class="channels--box"><h4>Popular amoung my friends</h4><ul class="channel-list"><li><a href="javascript:void(0)" class="channel-list--item channel-list--item__name">north-by-nothwest</a><span class="channels-list--item__rightwrapper"><span class="channel-list--item channel-list--item__value">15k</span><span class="channel-list--button"><svg class="channel-list--button-icon" width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>icon-plus-full</title><path d="M10 20c5.523 0 10-4.477 10-10S15.523 0 10 0 0 4.477 0 10s4.477 10 10 10zm1-12.993C11 6.45 10.552 6 10 6c-.556 0-1 .45-1 1.007V9H7.007C6.45 9 6 9.448 6 10c0 .556.45 1 1.007 1H9v1.993C9 13.55 9.448 14 10 14c.556 0 1-.45 1-1.007V11h1.993C13.55 11 14 10.552 14 10c0-.556-.45-1-1.007-1H11V7.007z" fill="#007DF2" fill-rule="evenodd"/></svg></span></span></li><li><a href="javascript:void(0)" class="channel-list--item channel-list--item__name">the-tonight-show</a><span class="channels-list--item__rightwrapper"><span class="channel-list--item channel-list--item__value">26k</span><span class="channel-list--button"><svg class="channel-list--button-icon" width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>icon-plus-full</title><path d="M10 20c5.523 0 10-4.477 10-10S15.523 0 10 0 0 4.477 0 10s4.477 10 10 10zm1-12.993C11 6.45 10.552 6 10 6c-.556 0-1 .45-1 1.007V9H7.007C6.45 9 6 9.448 6 10c0 .556.45 1 1.007 1H9v1.993C9 13.55 9.448 14 10 14c.556 0 1-.45 1-1.007V11h1.993C13.55 11 14 10.552 14 10c0-.556-.45-1-1.007-1H11V7.007z" fill="#007DF2" fill-rule="evenodd"/></svg></span></span></li><li><a href="javascript:void(0)" class="channel-list--item channel-list--item__name">vladimir-putin</a><span class="channels-list--item__rightwrapper"><span class="channel-list--item channel-list--item__value">545</span><span class="channel-list--button"><svg class="channel-list--button-icon" width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>icon-plus-full</title><path d="M10 20c5.523 0 10-4.477 10-10S15.523 0 10 0 0 4.477 0 10s4.477 10 10 10zm1-12.993C11 6.45 10.552 6 10 6c-.556 0-1 .45-1 1.007V9H7.007C6.45 9 6 9.448 6 10c0 .556.45 1 1.007 1H9v1.993C9 13.55 9.448 14 10 14c.556 0 1-.45 1-1.007V11h1.993C13.55 11 14 10.552 14 10c0-.556-.45-1-1.007-1H11V7.007z" fill="#007DF2" fill-rule="evenodd"/></svg></span></span></li></ul></div>'),b?"":c.toString()
},b.components.channels.channelBox=function(a,b){var c=b||new d.StringBuilder;return c.append("	<h4>",d.$$escapeHtml(a.title),'</h4><ul class="channel-list"></ul>'),b?"":c.toString()},b.components.channels.channelListItem=function(a,b){var c=b||new d.StringBuilder;return c.append('	<a href="http://kinja.com/channel/',d.$$escapeHtml(a.name),'?channels=on" class="channel-list--item channel-list--item__name">',d.$$escapeHtml(a.name),'</a><span class="channels-list--item__rightwrapper"><span class="channel-list--item channel-list--item__value">',d.$$escapeHtml(a.value),'</span><span class="js_channel-list-leave channel-list--button"><svg class="channel-list--button-icon" width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>icon-minus-empty</title><path d="M10 20c5.523 0 10-4.477 10-10S15.523 0 10 0 0 4.477 0 10s4.477 10 10 10zM7.007 9C6.45 9 6 9.448 6 10c0 .556.45 1 1.007 1h5.986C13.55 11 14 10.552 14 10c0-.556-.45-1-1.007-1H7.007zM10 18c4.418 0 8-3.582 8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8z" fill="#007DF2" fill-rule="evenodd"/></svg></span></span><a class="js_channel-list-join button right channel-list--button channel-list--button__join hide">join</a>'),b?"":c.toString()},b.components.channels.channelMessage=function(a,b){var c=b||new d.StringBuilder;return c.append('	<span style="display:inline-block; line-height:14px!important"><strong>Wooot!</strong><br>You have joined the channel <a class="js_open-channels" href="#">#',d.$$escapeHtml(a.channelName),"</a>!</span>"),b?"":c.toString()}}),define("app/channels/channels.layout",["jquery","underscore","backbone","backbone.marionette","app/MarionetteApp","singleton/CurrentUser","app/post/mixins/post.successMessage","templates/tiger/components/channels"],function(a,b,c,d,e,f,g){var h=c.Collection.extend({sync:function(b,c,d){switch(b){case"read":var e={url:"http://kinja.com/api/profile/session/views/cookie?name=Channels",type:"GET",dataType:"jsonp",jsonp:"jsonp",timeout:6e4,contentType:"application/jsonp; charset=utf-8"};a.ajax(e).done(function(a){d.success(JSON.parse(a.data))})}},save:function(){var b={url:"http://kinja.com/api/profile/session/views/cookie?name=Channels&opt="+JSON.stringify(this.models),type:"POST",dataType:"jsonp",jsonp:"jsonp",timeout:6e4,contentType:"application/jsonp; charset=utf-8"};a.ajax(b)}}),i=d.Layout.extend({className:"hide",template:tiger.components.channels.layout,initialize:function(){this.collection=new h,e.vent.listenTo(e.vent,"add:channel",b.bind(this.joinChannel,this))},regions:{myChannelsRegion:".js_my-channels-region",frinedChannelsRegion:".js_friends-channels-region"},onRender:function(){this.collection.fetch();var a=new k({collection:this.collection});this.$el.removeClass("hide"),this.myChannelsRegion.show(a)},joinChannel:function(a){var b=this.collection.filter(function(b){return b.get("name")===a.channelName});return 0!==b.length?!0:(this.collection.add({name:a.channelName,value:Math.floor(100*Math.random())}),this.collection.save(),void this.addChannel(a.channelName))},addChannel:function(a){window.setTimeout(function(){g._displayChannelMessage(tiger.components.channels.channelMessage,{channelName:a})},1e3)}}),j=d.ItemView.extend({tagName:"li",template:tiger.components.channels.channelListItem,ui:{leaveChannel:".js_channel-list-leave"},events:{"click @ui.leaveChannel":"onRemoveChannel"},onRemoveChannel:function(){var a=this.model.collection;this.model.destroy(),a.save()}}),k=d.CompositeView.extend({className:"channels--box",template:tiger.components.channels.channelBox,itemViewContainer:".channel-list",itemView:j,serializeData:function(){return{title:"My channels"}}});return i}),define("templates/tiger/section/header/success-box",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.section.header.successBox=function(a,b){var c=b||new d.StringBuilder;return c.append('	<div class="proxima success-box js_success_box" style="display: none">',a.dismissable?'<a href="#" class="js_close close icon icon-black icon-x"></a>':"",'<span class="msg">',d.$$filterNoAutoescape(a.message),"</span></div>"),b?"":c.toString()},b.section.header.moreWarnings=function(a,b){var c=b||new d.StringBuilder;return c.append('	<div class="proxima success-box js_additional-warnings"><a href="#">',d.$$escapeHtml(a.count)," more warnings</a></div>"),b?"":c.toString()}}),define("view/SuccessBox",["jquery","view/BaseView","templates/tiger/section/header/success-box"],function(a,b){var c=b.extend({events:{"click .js_close":"close","click .js_open-channels":"openChannels"},initialize:function(b){this.options=a.extend({message:"",dismissable:!0,url:null,permanent:!1,hidden:!1,timeout:2500},b)},render:function(){var b=this.options,c=this.soyToHtml(tiger.section.header.successBox,{message:this.getHtml(b.message),dismissable:b.dismissable});a("#js_success-box-container").append(c),this.setElement(a(".js_success_box:last")),this.options.hidden||this.$el.fadeIn(300),b.warningBox&&this.$el.addClass("warning-box"),window.setTimeout(a.proxy(function(){this.options.permanent||this.close()},this),b.timeout),null!==this.options.url&&this.$el.on("click",a.proxy(function(){return window.location=this.options.url,!1},this)).addClass("linked")},close:function(b){b&&b.preventDefault&&b.preventDefault(),this.$el.slideUp("fast",a.proxy(this.remove,this))},attachMoreWarningsBox:function(b){var c=this.soyToHtml(tiger.section.header.moreWarnings,{count:b});a("#js_success-box-container").append(c),a("#js_success-box-container .js_additional-warnings a").click(function(b){b.preventDefault(),a(this).parent().hide(),a(".js_success_box").show()})},openChannels:function(b){a(".js_channels-off-canvas-toggle").click(),b.preventDefault()}});return c}),define("templates/tiger/section/sidebar",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.section.sidebar.sidebarModule=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.section.sidebar.leftrailContained(a,f,e),c?"":f.toString()},b.section.sidebar.featuredImage=function(a,b){var c=b||new d.StringBuilder;if(c.append("	"),null==a.post.sharingMainImage?null:a.post.sharingMainImage.id){var e=new d.StringBuilder("k-medium");e=e.toString(),c.append('<div class="featured-image mbl"><a href="',d.$$escapeHtml(a.post.permalink),'" title="',d.$$escapeHtml(a.post.headline),"\" onclick=\"window.ga('send', 'event', 'Featured story click', 'click', 'The first popular story\\'s image');\"><img src=\"",d.$$escapeHtml(window.kinja.imageUrl(a.post.sharingMainImage.id,e,a.post.sharingMainImage.frozenFormat)),'" alt="',d.$$escapeHtml(a.post.headline),'" /></a></div>')}return b?"":c.toString()},b.section.sidebar.popularBox=function(a,c,e){a=a||{};var f=c||new d.StringBuilder;f.append('	<div class="popular-box show-for-xlarge-up js_popular-box"><div class="strapline proxima text-upper text-micro"><span class="strapline-bg pln text-strong">Trending on Related Blogs</span></div>');for(var g=a.popularPosts,h=g.length,i=0;h>i;i++){var j=g[i];if(5>i){var k=j.permalink;f.append('<h6 class="headline" data-blog-display-name="',d.$$escapeHtml(j.blogname),'"><a href="',d.$$escapeHtml(k),"\" onclick=\"window.ga('send', 'event', 'Trending module click', 'click', 'Trending module click, position ",d.$$escapeHtml(i+1),"');\">",j.shortHeadline?d.$$filterNoAutoescape(j.shortHeadline):j.starter&&!j.headline?j.starter.headline?d.$$filterNoAutoescape(j.starter.headline):d.$$truncate(d.$$escapeHtml(j.starter.plaintext),70,!0):d.$$truncate(d.$$escapeHtml(j.plaintext),70,!0),'</a><span class="view-count">'),b.messages.hrNumber({value:j.people},f,e),f.append(" people reading on ",d.$$escapeHtml(j.blogname),"</span></h6>")}}return f.append("</div>"),c?"":f.toString()},b.section.sidebar.leftrailTrending=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");var g=3;f.append('<div class="strapline proxima text-upper text-micro strapline--leftrail"><span class="strapline-bg">Trending on Kinja</span></div><div class="js_related-module ',d.$$escapeHtml(0==a.posts.length?" js_sidebar-empty":""),'"><ol class="leftrail-list leftrail-list--trending js_leftrail-list">');for(var h=a.posts,i=h.length,j=0;i>j;j++){var k=h[j],l=k.image;g>j&&b.section.sidebar.leftrailTrendingItem({index:j+1,headline:k.headline,permalink:k.permalink,imageUrl:l?window.kinja.imageUrl(l.id,"k-medium",l.frozenFormat):"",blogHost:k.defaultBlogHost,blogName:k.defaultBlogName,moduleType:"trending"},f,e)}return f.append("</ol></div>"),c?"":f.toString()},b.section.sidebar.leftrailTrendingItem=function(a,b){var c=b||new d.StringBuilder;c.append("	");var e=73,f=1==a.index&&a.imageUrl,g=new d.StringBuilder("Trending module click, position ",d.$$escapeHtml(a.index),", js_pageType");return g=g.toString(),c.append('<li class="row leftrail-item leftrail-item--',d.$$escapeHtml(a.moduleType),' js_leftrail-item"><div class="large-1 columns"><div class="leftrail-marker">',d.$$escapeHtml(a.index),".</div></div>",f?'<div class="large-5 columns"><a href="'+d.$$escapeHtml(a.permalink)+'" data-ga="['+d.$$escapeHtml(g)+']"><img class="leftrail-image" src="'+d.$$escapeHtml(a.imageUrl)+'" alt="'+d.$$escapeHtml(a.headline)+'" /></a></div>':"",'<div class="large-',f?"6":"11",' columns"><h6 class="headline"><a href="',d.$$escapeHtml(a.permalink),'" data-ga="[',d.$$escapeHtml(g),']">',d.$$filterNoAutoescape(window.kinja.truncateHtml(a.headline,e)),'</a></h6><div class="byline proxima text-small"> <a href="//',d.$$escapeHtml(a.blogHost),'" class="text-light byline__source">on ',d.$$escapeHtml(a.blogName),"</a></div></div></li>"),b?"":c.toString()},b.section.sidebar.leftrailPopular=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");var g=3,h=new d.StringBuilder(a.recommendedByDisplayName&&a.recommendedByScreenName?d.$$escapeHtml(a.recommendedByScreenName):a.recommendedByDisplayName&&a.popularPosts.length?d.$$escapeHtml(a.popularPosts[0].authorScreenName):"");h=h.toString();var i=h&&a.recommendedByDisplayName;f.append('<div class="strapline proxima text-upper text-micro strapline--leftrail"><span class="strapline-bg">',i?'Written by <a href="//kinja.com/'+d.$$escapeHtml(h)+'">'+d.$$escapeHtml(a.recommendedByDisplayName)+"</a>":a.blogDisplayName?"Popular on "+d.$$escapeHtml(a.blogDisplayName):"Popular stories",'</span></div><div class="js_related-module ',d.$$escapeHtml(0==a.popularPosts.length?" js_sidebar-empty":""),'"><ol class="leftrail-list leftrail-list--popular js_leftrail-list">');for(var j=a.popularPosts,k=j.length,l=0;k>l;l++){var m=j[l],n=m.image,o=new d.StringBuilder(d.$$escapeHtml(window.kinja.stripHtmlTags(m.authorName,"")));o=o.toString(),g>l&&b.section.sidebar.leftrailPopularItem({index:l+1,headline:m.headline,imageUrl:n?window.kinja.imageUrl(n.id,"KinjaCenteredMedium",n.frozenFormat):"",permalink:m.permalink,authorDisplayName:o,isCurrentPost:a.permalinkPost?a.permalinkPost.permalink==m.permalink:!1,moduleType:"popular",isRecommended:i,authorScreenName:m.authorScreenName},f,e)}return f.append("</ol></div>"),c?"":f.toString()},b.section.sidebar.leftrailPopularItem=function(a,b){var c=b||new d.StringBuilder;c.append("	");var e=73,f=new d.StringBuilder("Popular stories click, position ",d.$$escapeHtml(a.index),", js_pageType");return f=f.toString(),c.append('<li class="row leftrail-item leftrail-item--',d.$$escapeHtml(a.moduleType)," js_leftrail-item",a.isCurrentPost?" highlighted":"",a.isRecommended?" recommended":"",'">',a.imageUrl?'<div class="row"><div class="large-12 columns leftrail-image-wrap"><a href="'+d.$$escapeHtml(a.permalink)+'" data-ga="['+d.$$escapeHtml(f)+']"><img class="leftrail-image" src="'+d.$$escapeHtml(a.imageUrl)+'" alt="'+d.$$escapeHtml(a.headline)+'" /></a></div></div>':"",'<div class="row"><div class="large-12 columns"><h6 class="headline"><a href="',d.$$escapeHtml(a.permalink),'" data-ga="[',d.$$escapeHtml(f),']">',d.$$filterNoAutoescape(window.kinja.truncateHtml(a.headline,e)),"</a></h6>",a.isRecommended?"":'<div class="byline proxima text-small"><span class="text-light byline__source">posted by</span>'+(a.authorScreenName?' <span><a href="//kinja.com/'+d.$$escapeHtml(a.authorScreenName)+'" class="text-strong">'+d.$$filterNoAutoescape(a.authorDisplayName)+"</a></span>":' <span class="text-light">'+d.$$filterNoAutoescape(a.authorDisplayName)+"</span>")+"</div>","</div></div></li>"),b?"":c.toString()},b.section.sidebar.leftrailContained=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");var g=a.trendingStories.length&&a.adsEnabled&&!e.features.leftrail_notrending,h=a.popularStories.length;return f.append('<div class="sidebar-content js_sidebar-container js_sidebar">'),g&&(f.append('<section id="js_leftrailmodule--trending" class="leftrailmodule js_leftrailmodule leftrailmodule--trending">'),b.section.sidebar.leftrailTrending({posts:a.trendingStories,permalinkPost:a.permalinkPost},f,e),f.append("</section>"),b.section.sidebar.containedAdContainer({preload:!0},f,e)),h&&(f.append('<section id="js_leftrailmodule--popular" class="leftrailmodule js_leftrailmodule leftrailmodule--popular',g?" invisible":"",'">'),b.section.sidebar.leftrailPopular({popularPosts:a.popularStories,permalinkPost:a.permalinkPost,blogDisplayName:a.blogDisplayName,recommendedByScreenName:a.recommendedByScreenName,recommendedByDisplayName:a.recommendedByDisplayName},f,e),f.append("</section>"),g||b.section.sidebar.containedAdContainer({preload:!0},f,e)),f.append("</div>"),c?"":f.toString()},b.section.sidebar.containedAdContainer=function(a,c,e){a=a||{};var f=c||new d.StringBuilder;return f.append("	<section",a.preload?' id="js_leftrailmodule--preloadedad"':"",' class="js_contained-ad-container contained-ad-container leftrailmodule js_leftrailmodule invisible"><div class="contained-ad-wrapper js_contained-ad-wrapper notransform">'),b.components.ad.leftRail(null,f,e),f.append("</div></section>"),c?"":f.toString()},b.section.sidebar.containedAdContents=function(a,c,e){a=a||{};var f=c||new d.StringBuilder;return f.append('	<div class="contained-ad-wrapper js_contained-ad-wrapper">'),a.isEmpty||b.components.ad.leftRail(null,f,e),f.append("</div>"),c?"":f.toString()}}),define("templates/tiger/components/ad/ads",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.ad.zoneSimple=function(a,b){var c=b||new d.StringBuilder;c.append("	");var e="MOBILE"==a.type,f=Math.floor(89999999*Math.random())+1e7;return c.append('<div class="ad-unit js_ad-unit',e?" hide-contents":""," ad-",d.$$escapeHtml(a.cssClass)," js_ad-",d.$$escapeHtml(a.cssClass),'"><div id="ad-container-',d.$$escapeHtml(f),'" class="ad-container js_ad-container" data-zone-type="',d.$$escapeHtml(a.type),'"',a.forcedAdZone?' data-forced-ad-zone="'+d.$$escapeHtml(a.forcedAdZone)+'"':"",a.postId?' data-post-id="'+d.$$escapeHtml(a.postId)+'"':"","></div></div>"),b?"":c.toString()},b.components.ad.tracker=function(a,c,e){a=a||{};var f=c||new d.StringBuilder;return f.append("	"),b.components.ad.zoneSimple({type:"TRACKER",cssClass:"tracker",forcedAdZone:null!=a.postAdZone?a.postAdZone:null,postId:null!=a.postId?a.postId:null},f,e),c?"":f.toString()},b.components.ad.topBanner=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.components.ad.zoneSimple({type:"TOP_BANNER",cssClass:"top-banner"},f,e),c?"":f.toString()},b.components.ad.billboard=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.components.ad.zoneSimple({type:"BILLBOARD",cssClass:"billboard"},f,e),c?"":f.toString()},b.components.ad.leftRail=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.components.ad.zoneSimple({type:"LEFT_RAIL",cssClass:"left-rail"},f,e),c?"":f.toString()},b.components.ad.mobile=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.components.ad.zoneSimple({type:"MOBILE",cssClass:"mobile"},f,e),c?"":f.toString()},b.components.ad.adhesion=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.components.ad.zoneSimple({type:"ADHESION",cssClass:"adhesion"},f,e),c?"":f.toString()},b.components.ad.preroll=function(a,b){var c=b||new d.StringBuilder;return c.append('	<div id="foreplay" class="reveal-modal js_foreplay foreplay proxima noskimlinks noskimwords" data-reveal><div id="jwPlayerVideo"></div><a href="#" class="close js_foreplay-close">You can skip this ad in 5 seconds.</a></div>'),b?"":c.toString()},b.components.ad.promotion=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");var g=new d.StringBuilder(a.mobile?"PROMOTION_MOBILE":"PROMOTION");return g=g.toString(),b.components.ad.zoneSimple({type:g,cssClass:"promotion"},f,e),c?"":f.toString()},b.components.ad.splashyTop=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.components.ad.zoneSimple({type:"SPLASHYTOP",cssClass:"splashy-top"},f,e),c?"":f.toString()},b.components.ad.splashyBottom=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.components.ad.zoneSimple({type:"SPLASHYBOTTOM",cssClass:"splashy-bottom"},f,e),c?"":f.toString()}}),define("lib/jquery.stickem",["jquery","singleton/Feature","singleton/WindowController"],function(a){var b=a(window),c=a(".js_global-nav-wrap"),d=c.innerHeight(),e=(d+window.parseInt(c.css("top"),10),c.find(".f-dropdown")),f="down",g=b.scrollTop();b.on("scroll.stickem.global",function(){var a=b.scrollTop();f="down",g>a&&(f="up"),g=a});var h=function(b,c){this.elem=b,this.$elem=a(b),this.options=c,this.metadata=this.$elem.data("stickem-options"),this.$win=a(window)};h.prototype={defaults:{item:".stickem",container:".stickem-container",stickClass:"stickit",stickPushdownClass:"pushdown",endStickClass:"stickit-end",offset:0,start:0,onStick:null,onUnstick:null},init:function(){var b=this;return b.config=a.extend({},b.defaults,b.options,b.metadata),b.setWindowHeight(),b.getItems(),b.bindEvents(),b},bindEvents:function(){var b=this;b.$win.on("scroll.stickem",a.proxy(b.handleScroll,b)),b.$win.on("resize.stickem",a.proxy(b.handleResize,b))},destroy:function(){var a=this;a.$win.off("scroll.stickem"),a.$win.off("resize.stickem")},getItem:function(b,c){var d=this,e=a(c),f={_stickemSelf:d,$elem:e,elemHeight:e.height(),$container:e.parents(d.config.container),isStuck:!1};d.windowHeight>f.elemHeight?(f.containerHeight=f.$container.outerHeight(),f.containerInner={border:{bottom:parseInt(f.$container.css("border-bottom"),10)||0,top:parseInt(f.$container.css("border-top"),10)||0},padding:{bottom:parseInt(f.$container.css("padding-bottom"),10)||0,top:parseInt(f.$container.css("padding-top"),10)||0}},f.containerStart=f.$container.offset().top-d.config.offset+d.config.start+f.containerInner.padding.top+f.containerInner.border.top,f.containerInnerHeight=f.$container.height(),f.scrollFinish=f.containerStart-d.config.start+(f.containerInnerHeight-f.elemHeight),f.containerInnerHeight>f.elemHeight&&d.items.push(f)):f.$elem.removeClass(d.config.stickClass+" "+d.config.endStickClass)},getItems:function(){var b=this;b.items=[],b.$elem.find(b.config.item).each(a.proxy(b.getItem,b))},handleResize:function(){var a=this;a.getItems(),a.setWindowHeight()},handleScroll:function(){var a=this;if(a.items.length>0)for(var b=a.$win.scrollTop(),c=0,d=a.items.length;d>c;c++){var g=a.items[c];if(g.isStuck&&(b<g.containerStart||b>g.scrollFinish)||b>g.scrollFinish){g.$elem.removeClass(a.config.stickClass).removeClass(a.config.stickPushdownClass),b>g.scrollFinish&&g.$elem.addClass(a.config.endStickClass);var h=g.isStuck;g.isStuck=!1,h&&a.config.onUnstick&&a.config.onUnstick(g,f)}else g.isStuck===!1&&b>g.containerStart&&b<g.scrollFinish&&(e.hasClass("open")&&g.$elem.addClass(a.config.stickPushdownClass),g.$elem.removeClass(a.config.endStickClass).addClass(a.config.stickClass),g.isStuck=!0,a.config.onStick&&a.config.onStick(g,f))}},setWindowHeight:function(){var a=this;a.windowHeight=a.$win.height()-a.config.offset}},h.defaults=h.prototype.defaults,a.fn.stickem=function(a){return this.destroy=function(){this.each(function(){new h(this,a).destroy()})},this.each(function(){new h(this,a).init()})}}),define("app/leftrail/leftrailContainedItem.view",["jquery","underscore","backbone.marionette","lib/amd-wrapped/modernizr","singleton/EventDispatcher","singleton/WindowController","singleton/Feature","module/ads/ads.events","templates/tiger/section/sidebar","templates/tiger/components/ad/ads","lib/jquery.stickem"],function(a,b,c,d,e,f,g,h){var i,j=a(window);return i=c.ItemView.extend({template:tiger.section.sidebar.containedAdContents,ui:{containedAd:".js_contained-ad-wrapper",adContainer:".js_ad-container",adUnit:".js_ad-unit"},tagName:"section",className:"js_contained-ad-container contained-ad-container leftrailmodule js_leftrailmodule invisible notransform",serializeData:function(){return{isEmpty:this.options.isEmpty||!1}},onRender:function(){var a,b=this.$el.outerHeight(!0);this.listenTo(this,"dom:appended",function(){a=this.$el.offset().top-j.scrollTop(),f.isPartiallyVisible(this.$el)?this.onVisible():this.$el.waypoint(this.$el.offset().top+b/2>=j.scrollTop()?{handler:function(a){"down"===a&&(this.onVisible(),this.$el.waypoint("destroy"))}.bind(this),offset:"100%"}:{handler:function(a){"up"===a&&(this.onVisible(),this.$el.waypoint("destroy"))}.bind(this),offset:-this.$el.outerHeight()})})},onVisible:function(){var a=this.ui.adContainer,b=a.attr("id");!b||a.hasClass("initialized")?this.reveal():(this.listenTo(h,"kinjaads."+b+".displayed",function(a){this.reveal(a.zone)}),h.trigger("ads.dynamicad.load",a,"LEFT_RAIL_DYNAMIC"))},resize:function(){this.$el.addClass("short")},resizeAd:function(){this.ui.containedAd.length&&this.ui.containedAd.addClass("short")},reveal:function(a){this.ui.adContainer.length&&(this.ui.adUnit.height()<i.adHeights.LARGE&&this.resizeAd(a),d.touch||this.preparePushdownSticky()),this.$el.removeClass("invisible")},preparePushdownSticky:function(){this.$el.stickem({container:this.$el,item:".js_contained-ad-wrapper",stickClass:"waypoint--fixed js_ah-pushdown",onStick:function(a,b){a.$elem.removeClass("notransform"),"down"===b&&a.$elem.removeClass("frombottom")},endStickClass:"waypoint--unfixed",onUnstick:function(a,b){a.$elem.addClass("notransform"),f.translateElement(a.$elem),"up"===b&&a.$elem.addClass("frombottom")}.bind(this),offset:i.stickemOffset})}},{adHeights:{SMALL:250,LARGE:600},stickemOffset:20})}),define("app/leftrail/leftrailContainedList.view",["jquery","underscore","backbone.marionette","lib/amd-wrapped/modernizr","view/behaviors/googleAnalytics.behavior","app/leftrail/leftrailContainedItem.view","module/ads/model/ads.slotModel","module/ads/ads.events","singleton/CurrentBlog","singleton/WindowController","singleton/Feature","lib/waypoints"],function(a,b,c,d,e,f,g,h,i,j,k){var l,m=a(".js_page"),n=a(".js_sidebar-actual-container"),o=a(window).height(),p=a("#js_leftrailmodule--preloadedad").outerHeight(!0);return l=c.CollectionView.extend({_isNextEmpty:!1,behaviors:{GoogleAnalyticsBehavior:{behaviorClass:e}},ui:{leftrailmodules:".js_leftrailmodule",preloadedAd:"#js_leftrailmodule--preloadedad"},itemView:f,render:function(){var b,c,d,e=a('.js_ad-container[data-zone-type="LEFT_RAIL"]'),f=e.attr("id"),i=g.zoneTypes,l=a.Deferred(),m=a.Deferred(),n=window.kinja.meta.blogSales?window.kinja.meta.blogSales.adsEnabled:!1;this.isClosed=!1,this.bindUIElements(),j.isMediumDown()||e.length&&(e.hasClass("js_slot-hidden")||e.hasClass("js_slot-inactive"))?this.bindChildren(!1):e.length&&e.hasClass("js_slot-displayed")?this.bindChildren(!0):k.isOn("splashy_ad")?a.when(l,m).done(function(a){this.bindChildren(a)}.bind(this)):a.when(l).done(function(a){this.bindChildren(a)}.bind(this)),b=["kinjaads.disabled","kinjaads."+f+".hide","ads."+i.LEFT_RAIL+".inactive"].join(" "),c="kinjaads."+f+".displayed",this.listenToOnce(h,b,function(){l.resolve(!1)}).listenToOnce(h,c,function(){l.resolve(!0)}),k.isOn("ad_module")&&(n?(d=["kinjaads.disabled","kinjaads."+i.SPLASHYTOP+".hide","ads."+i.SPLASHYTOP+".inactive","kinjaads."+i.SPLASHYTOP+".displayed"].join(" "),this.listenToOnce(h,d,function(){m.resolve()}),window.ads.events.onRender(g.zoneTypes.SPLASHYTOP,function(){m.resolve()})):m.resolve())},bindChildren:function(a){var b,c=this,d=this._isLongPage();c.ui.leftrailmodules.each(function(){return b=new f({el:this}),b.bindUIElements(),b.$el.hasClass("contained-ad-container")&&(d||b.resize(),!a)?void b.remove():(b.delegateEvents(),c.addChildViewEventForwarding(b),c.children.add(b),b.onRender(),void b.trigger("dom:appended"))}),d&&!j.isMediumDown()&&a&&this.bindNewAdWaypoint()},addNewModule:function(){var a,b=this.getItemView();a=this._isNextEmpty?new b({isEmpty:!0}):new b,this._isNextEmpty=!this._isNextEmpty,a.render(),this.$el.append(a.$el),a.trigger("dom:appended")},bindNewAdWaypoint:function(){this.$el.waypoint({handler:function(a){"down"===a&&(this.$el.waypoint("destroy"),this.getRemainingHeight()>2*p&&(this.addNewModule(),this.bindNewAdWaypoint()))}.bind(this),offset:o-this.$el.outerHeight()+250})},getRemainingHeight:function(){return m.outerHeight(!0)-this.$el.outerHeight(!0)},_isLongPage:function(){return m.outerHeight(!0)>n.outerHeight(!0)}})}),define("model/blog.settings",["jquery","underscore","config","backbone","singleton/Utils","singleton/Feature","singleton/CurrentUser","singleton/CurrentBlog","apiclient/profile"],function(a,b,c,d,e,f,g,h,i){var j=d.Model.extend({defaults:function(){var a=e.getKinjaMeta().blogOwner&&e.getKinjaMeta().blogOwner.defaultBlogId===h.id;return{superuser:g.isSuperuser()&&f.isOn("superuser"),isPersonalBlog:a,displayName:h.displayName,description:h.description,timezone:h.timezone,status:h.status,groupBlog:h.groupBlog,logo:h.logo,avatar:h.avatar,noindex:h.noindex}},validAssets:["avatar","logo"],getInfoAttributes:function(){return{blogId:this.get("blogId"),displayName:this.get("displayName"),description:this.get("description"),timezone:this.get("timezone"),status:this.get("status"),noindex:this.get("noindex")}},getAssetAttributes:function(a){if(b(this.validAssets).contains(a)){var c={};return c[a]=this.get(a),c}throw new Error('BlogSettingsModel.getAssetAttributes: assetName "'+a+'" is invalid. Expecting one of the following strings: '+this.validAssets.join(", ")+".")},sync:function(a,b,c){var d;switch(a){case"update":case"create":return d=c.asset?b.getAssetAttributes(c.asset):b.getInfoAttributes(),d.id=h.id,i.updateBlog(d,c)}}});return j}),define("view/footer.view",["jquery","underscore","backbone.marionette","view/behaviors/googleAnalytics.behavior"],function(a,b,c,d){var e=c.ItemView.extend({behaviors:{GoogleAnalyticsBehavior:{behaviorClass:d}},onRender:function(){var c,d=a(window),e=d.height();c=b.throttle(function(){d.scrollTop()+e>this.$el.offset().top&&(window.ga("send","event","Footer","scroll","complete",{nonInteraction:1}),d.off("scroll.footer"))}.bind(this),1e3),d.on("scroll.footer",c)}});return e}),define("templates/tiger/icons/essential/definitions",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.icons.essential.definitions=function(a,b){var c=b||new d.StringBuilder;return c.append('<svg id="svggroup--essential" class="hide"><symbol id="iconset-search" viewBox="0 0 19 19"><path d="M11.5 12C9.015 12 7 9.985 7 7.5S9.015 3 11.5 3 16 5.015 16 7.5 13.985 12 11.5 12zm-4.205-1l-5.152 5.15c-.194.194-.188.514 0 .703.196.195.51.196.704.002L8 11.705c-.305-.274-.417-.338-.705-.705zm4.205 2c3.038 0 5.5-2.462 5.5-5.5S14.538 2 11.5 2 6 4.462 6 7.5 8.462 13 11.5 13z" /></symbol><symbol id="iconset-add" viewBox="0 0 19 19"><path d="M10 3.494C10 3.226 9.776 3 9.5 3c-.268 0-.5.22-.5.494V9H3.494C3.226 9 3 9.224 3 9.5c0 .268.22.5.494.5H9v5.506c0 .268.224.494.5.494.268 0 .5-.22.5-.494V10h5.506c.268 0 .494-.224.494-.5 0-.268-.22-.5-.494-.5H10V3.494z" /></symbol><symbol id="iconset-site-default" viewBox="0 0 19 19"><path d="M9.5 18c4.694 0 8.5-3.806 8.5-8.5S14.194 1 9.5 1 1 4.806 1 9.5 4.806 18 9.5 18zm0 1C4.253 19 0 14.747 0 9.5S4.253 0 9.5 0 19 4.253 19 9.5 14.747 19 9.5 19z"/><path d="M9.5 18c2.34 0 4.5-3.733 4.5-8.5C14 4.733 11.84 1 9.5 1S5 4.733 5 9.5C5 14.267 7.16 18 9.5 18zm0 1C6.462 19 4 14.747 4 9.5S6.462 0 9.5 0 15 4.253 15 9.5 12.538 19 9.5 19z" id="Shape"/><path d="M2.07 4.363c2.007 1.05 4.685 1.642 7.533 1.642 2.845 0 5.52-.592 7.528-1.638l-.46-.887c-1.86.968-4.376 1.525-7.067 1.525-2.694 0-5.213-.558-7.072-1.528l-.46.886zm.46 11.165C4.39 14.558 6.91 14 9.604 14c2.69 0 5.208.557 7.066 1.525l.46-.887C15.124 13.592 12.45 13 9.604 13c-2.848 0-5.526.594-7.534 1.642l.46.886z"/><path d="M9 9H.1v1H9v8.9h1V10h8.9V9H10V.1H9V9z"/></symbol><symbol id="iconset-zoom-in" viewBox="0 0 19 19"><path d="M10 5.494c0-.268.224-.494.5-.494.268 0 .5.22.5.494V8h2.506c.268 0 .494.224.494.5 0 .268-.22.5-.494.5H11v2.506c0 .268-.224.494-.5.494-.268 0-.5-.22-.5-.494V9H7.494C7.226 9 7 8.776 7 8.5c0-.268.22-.5.494-.5H10V5.494zM10.5 14C7.462 14 5 11.538 5 8.5S7.462 3 10.5 3 16 5.462 16 8.5 13.538 14 10.5 14zm-4.877-1.36l-3.48 3.51c-.194.194-.188.514 0 .703.196.195.51.196.704.002l3.48-3.51c-.304-.275-.416-.34-.704-.706zM10.5 15c3.59 0 6.5-2.91 6.5-6.5S14.09 2 10.5 2 4 4.91 4 8.5 6.91 15 10.5 15z" /></symbol><symbol id="iconset-star" viewBox="0 0 19 19"><path d="M7.925 8.014l-4.987.122 3.987 3.115-1.52 5L9.5 13.21l4.063 3.04-1.488-5 4.034-3.114-5.032-.122L9.5 3.22 7.925 8.013zM9.5 1c.157 0 .315.103.354.27L11.8 7.03l5.804.144c.177 0 .314.124.373.29.06.165 0 .35-.137.454l-4.623 3.697 1.653 5.846c.06.165 0 .35-.138.454-.08.062-.157.083-.236.083-.08 0-.157-.04-.217-.083l-4.78-3.47-4.78 3.47c-.06.062-.137.083-.216.083-.08 0-.157-.02-.236-.083-.118-.103-.177-.29-.138-.454l1.653-5.846L1.16 7.92c-.137-.103-.196-.29-.137-.455.06-.165.216-.29.373-.29L7.2 7.033 9.125 1.27c.06-.167.217-.27.374-.27z" /></symbol><symbol id="iconset-star-circle" viewBox="0 0 19 19"><path d="M9.5 3.7c.102 0 .204.067.23.174l1.26 3.73 3.753.092c.115 0 .204.08.242.187.038.107 0 .228-.09.295l-2.99 2.392 1.07 3.783c.038.106 0 .227-.09.294-.05.04-.1.053-.152.053-.05 0-.102-.027-.14-.053L9.5 12.4l-3.093 2.247c-.038.04-.09.053-.14.053-.05 0-.1-.013-.152-.053-.077-.067-.115-.188-.09-.294l1.07-3.783-2.99-2.392c-.09-.067-.128-.188-.09-.295.038-.106.14-.187.242-.187l3.754-.093 1.248-3.73c.038-.106.14-.173.242-.173zm0 14.3c4.694 0 8.5-3.806 8.5-8.5S14.194 1 9.5 1 1 4.806 1 9.5 4.806 18 9.5 18z" /></symbol><symbol id="iconset-chevron-right" viewBox="0 0 19 19"><path d="M6.154 3.154c.2-.2.538-.208.74-.005l5.956 5.955c.107.107.157.252.15.395.007.143-.043.288-.15.395L6.895 15.85c-.203.204-.54.196-.74-.004-.206-.205-.205-.54-.005-.74L11.754 9.5 6.15 3.895c-.2-.2-.2-.536.004-.74z" fill="#000"/></symbol><symbol id="iconset-flame" viewBox="0 0 19 19"><path d="M6.212 4.292c.02.384.314.64.576.68.09.016.172-.002.288-.1l-.215.18.015-.01C5.48 6.247 4 9.606 4 11.508 4 14.352 6.65 17 9.5 17s5.5-2.647 5.5-5.49c0-1.864-.67-3.227-2.14-4.957-1.297-1.523-1.5-3.172-.994-4.776-.04.128.135-.416.154-.49-.018.07-.023.16.103.39.107.197.335.325.54.323.046 0 .014.01-.06.05-.268.144-.647.447-1.057.842-1.022.985-2.413 3.714-2.56 5.982l-.01.134-.042.126c-.51 1.487-2.145 1.04-2.712-.26-.43-.988-.466-2.52-.046-4.55l.036-.032zm.997 4.435c.27.367.68.367.778.082.202-3.117 2.183-5.982 2.864-6.638.844-.814 1.843-1.534 2.15-.972.077.143-.052.465-.182.877-.29.918-.446 2.364.8 3.828C14.79 7.28 16 8.985 16 11.51 16 14.905 12.902 18 9.5 18S3 14.906 3 11.51C3 9.363 4.572 5.71 6.22 4.284l.214-.18c.253-.21.873-.156.775.174-.908 3.026 0 4.447 0 4.447z" /></symbol><symbol id="iconset-logo-kinja" viewBox="0 0 19 19"><path d="M2.898 9.293c.746.24 1.423.978 1.734 1.495.31.517 2.246 3.78 2.905 4.916.726 1.253 1.743 1.294 2.308 1.294h4.125s-3.023-5.378-3.943-6.846c-.622-.994-1.452-1.11-2.374-1.11H2.1C2.093 9.042 3 8.065 5 8c2-.065 5.284.006 6.64 0 1.354-.006 2.046-.727 2.33-1.195.284-.468 2.03-3.8 2.03-3.8s-7.207-.01-9.008-.004c-1.21.005-1.734.646-2.197 1.41l-2.792 4.6c-.01.016.007.07.017.097 0 0 .35.018.878.186z" /></symbol><symbol id="iconset-bubble" viewBox="0 0 19 19"><path d="M9.5 0C4.253 0 0 3.646 0 8.143c0 2.8 1.65 5.27 4.16 6.735 0 .02-.004.03-.004.05 0 1.217-.795 2.527-1.144 3.214-.027.075-.043.157-.043.243 0 .34.24.615.537.615.055 0 .153-.017.15-.01 1.857-.347 3.605-2.295 4.01-2.86.594.1 1.205.156 1.833.156 5.246 0 9.5-3.646 9.5-8.143C19 3.646 14.746 0 9.5 0zM7.78 15.09c-.06-.01-.118-.015-.176-.015-.186 0-.368.05-.532.146-.152.09-.29.215-.4.374-.258.37-1.288 1.268-2.156 1.875.235-.637.75-1.4.76-2.135.005-.046.007-.092.007-.13 0-.535-.254-1.023-.658-1.266-2.235-1.344-3.57-3.506-3.57-5.784 0-3.915 3.788-7.1 8.445-7.1 4.655 0 8.444 3.185 8.444 7.1 0 3.916-3.788 7.1-8.444 7.1-.553 0-1.155-.068-1.72-.166z" /></symbol><symbol id="iconset-checkmark" viewBox="0 0 19 19"><path d="M2.787 10.222c-.188-.185-.483-.182-.66.005-.173.182-.17.488.017.672l4.06 3.95c.18.145.486.254.8-.013l9.85-9.988c.19-.193.193-.512.02-.702-.18-.195-.48-.198-.67-.005l-9.628 9.764-3.79-3.685z" opacity=".9" /></symbol><symbol id="iconset-close" viewBox="0 0 19 19"><path d="M3.034 2.173c-.23-.23-.618-.232-.856.005-.23.23-.24.622-.005.856L8.64 9.5l-6.467 6.466c-.23.23-.232.618.005.856.23.23.622.24.856.005L9.5 10.36l6.466 6.467c.23.23.618.232.856-.005.23-.23.24-.622.005-.856L10.36 9.5l6.467-6.466c.23-.23.232-.618-.005-.856-.23-.23-.622-.24-.856-.005L9.5 8.64 3.034 2.172z" /></symbol><symbol id="iconset-facebook" viewBox="0 0 19 19"><path d="M8.003 18l-.006-8H5l.006-3h2.997V4.995C8.003 2.408 9.457 1 11.808 1c1.126 0 1.91.082 2.192.12v2.877h-1.447c-1.278 0-1.526.597-1.526 1.472V7h2.866l-.403 3h-2.47l.007 8H8.003z" /></symbol><symbol id="iconset-twitter" viewBox="0 0 19 19"><path d="M12.77 2c-1.926 0-3.488 1.695-3.488 3.787 0 .296.03.585.09.863-2.898-.158-5.468-1.666-7.19-3.957-.3.56-.47 1.21-.47 1.904 0 1.314.615 2.473 1.55 3.152-.57-.02-1.11-.19-1.58-.475v.048c0 1.835 1.203 3.365 2.8 3.713-.294.086-.602.133-.92.133-.225 0-.444-.025-.656-.07.443 1.505 1.73 2.6 3.258 2.63-1.194 1.016-2.698 1.622-4.332 1.622-.282 0-.56-.018-.832-.053C2.543 16.372 4.377 17 6.346 17c6.416 0 9.924-5.77 9.924-10.774 0-.164-.004-.328-.01-.49.68-.534 1.272-1.2 1.74-1.96-.625.3-1.298.504-2.003.596.72-.47 1.273-1.21 1.533-2.095-.674.434-1.42.75-2.214.92C14.68 2.46 13.773 2 12.77 2" /></symbol><symbol id="iconset-googleplus" viewBox="0 0 19 19"><path d="M11.102 14.196c0 .97-.42 1.848-1.257 2.63-.42.376-.958.658-1.616.845-.6.22-1.303.33-2.11.33-1.468 0-2.695-.282-3.683-.845C1.48 16.56 1 15.81 1 14.9c0-.657.21-1.25.63-1.784.448-.626 1.046-1.095 1.795-1.41.688-.343 1.526-.515 2.514-.515.028 0 .83-.16.862-.16-.48-.407-.683-.606-.683-1.107 0-.376.044-.706.223-.987H5.85c-1.108 0-1.992-.61-2.74-1.36-.718-.753-1.077-1.66-1.077-2.725 0-1.032.45-1.924 1.347-2.676C4.247 1.392 5.28 1 6.478 1h4.984l-1.123.845H8.766c.51.25.913.642 1.213 1.174.3.626.45 1.237.45 1.83 0 1.097-.495 2.02-1.483 2.772-.39.313-.658.58-.808.798-.12.157-.18.407-.18.75 0 .346.463.894 1.39 1.645.6.44 1.05.924 1.348 1.456.27.502.404 1.144.404 1.926zM8.646 4.7c-.15-.75-.48-1.37-.99-1.86-.512-.517-1.112-.776-1.803-.776-.63-.025-1.126.194-1.486.66-.39.49-.54 1.124-.45 1.9.15.774.495 1.42 1.035 1.937.54.543 1.126.815 1.757.815.69 0 1.215-.258 1.576-.775.39-.517.51-1.15.36-1.9zm.16 11.383c.578-.405.866-.916.866-1.536 0-1.808-2.883-2.178-3.2-2.178-.922 0-1.744.2-2.464.606-.72.43-1.08.928-1.08 1.5 0 .57.316 1.07.95 1.5.606.428 1.355.643 2.25.643 1.18 0 2.074-.18 2.68-.537zM16 3V1h-2v2h-2v2h2v2h2V5h2V3h-2z"/></symbol><symbol id="iconset-external-link" viewBox="0 0 19 19"><path d="M3.006 18C1.898 18 1 17.103 1 15.994V6.006C1 4.898 1.897 4 3.006 4H7.5c.276 0 .5.224.5.5s-.224.5-.5.5H3.006C2.45 5 2 5.45 2 6.006v9.988C2 16.55 2.45 17 3.006 17h9.988C13.55 17 14 16.55 14 15.994V10.5c0-.276.224-.5.5-.5s.5.224.5.5v5.494C15 17.102 14.103 18 12.994 18H3.006zM10.51 2c-.282 0-.51-.232-.51-.5 0-.276.228-.5.51-.5h6.98c.51 0 .51.5.51.51v6.98c0 .282-.232.51-.5.51-.276 0-.5-.228-.5-.51V2.75l-8.095 8.1c-.206.204-.548.197-.75-.004-.207-.207-.205-.545-.002-.748L16.247 2H10.51z" /></symbol><symbol id="iconset-link" viewBox="0 0 19 19"><path d="M9.2 14.13l-2.17 2.146c-1.012 1.01-2.568.846-3.24.088l-1.163-1.362c-1.002-.987-.63-2.597 0-3.263 1.02-1.08 3.928-3.885 3.928-3.885 1.012-1.036 2.385-1.103 3.473 0s1.03 1.06 1.03 1.06c.28.282.683.232.89 0 .206-.232.17-.614-.11-.896L10.83 7.03c-1.39-1.432-3.533-1.376-4.896 0l-3.912 3.985c-1.363 1.34-1.363 3.597 0 4.973l.978.987C3.664 17.647 4.537 18 5.48 18c.943 0 1.817-.353 2.48-1.023l1.957-1.975c.28-.282.28-.59 0-.87-.28-.283-.716 0-.716 0zm.6-9.26l2.17-2.146c1.012-1.01 2.568-.846 3.24-.088l1.163 1.362c1.002.987.63 2.597 0 3.263-1.02 1.08-3.928 3.885-3.928 3.885-1.012 1.036-2.385 1.103-3.473 0s-1.03-1.06-1.03-1.06c-.28-.282-.683-.232-.89 0-.206.232-.17.614.11.896l1.007.988c1.39 1.432 3.533 1.376 4.896 0l3.912-3.985c1.363-1.34 1.363-3.597 0-4.973L16 2.023C15.336 1.353 14.463 1 13.52 1c-.943 0-1.817.353-2.48 1.023L9.082 3.998c-.28.282-.28.59 0 .87.28.283.716 0 .716 0z" /></symbol><symbol id="iconset-image" viewBox="0 0 19 19"><path d="M3 17c-2 0-2-1.736-2-1.992V3.992C1 2.892 1.89 2 3 2h13c1.105 0 2 .893 2 1.992v11.016c0 1.1-.89 1.992-2 1.992H3zm8.922-4.762l-2.085 2.534c-.22.27-.645.232-.817-.07L6.068 9.506l-3.628 6.3c.162.113.348.194.56.194h12.388l-3.466-3.762zM17 3.992C17 3.446 16.552 3 16 3H3c-.556 0-1 .443-1 .992v10.593l3.64-6.323c.19-.332.673-.33.863.003l3.025 5.323 1.988-2.417c.192-.232.546-.24.75-.02l4.293 4.66c.26-.18.44-.463.44-.802V3.992zM12.5 10C11.12 10 10 8.88 10 7.5S11.12 5 12.5 5 15 6.12 15 7.5 13.88 10 12.5 10zM11 7.5c0 .828.672 1.5 1.5 1.5S14 8.328 14 7.5 13.328 6 12.5 6 11 6.672 11 7.5z" /></symbol><symbol id="iconset-burner" viewBox="0 0 19 19"><path d="M15.07 11.837c-.417.175-.91.28-1.477.28-.287 0-.63-.044-1.013-.126-.366-.078-.758-.19-1.162-.325-.302-.1-1.295-.508-1.392-.543-.168-.06-.34-.097-.52-.097-.185 0-.355.038-.522.096-.098.035-1.1.444-1.402.545-.404.136-.796.247-1.162.326-.384.083-.726.127-1.013.127-.568 0-1.06-.105-1.476-.28-.24-.1-.59-.355-.695-.46-.183-.18-.367-.392-.54-.636-.402-.57-.673-1.22-.755-1.937l-.007.137C2.227 7.622 3.087 6.883 4.1 6.883c1.623 0 3.064.308 4.953 1.283 0 0 .282.146.437.146.152-.002.457-.146.457-.146 1.89-.975 3.33-1.283 4.954-1.283 1.013 0 1.873.74 2.167 2.057l-.007-.137c-.082.718-.353 1.366-.756 1.938-.172.245-.356.457-.54.637-.105.105-.455.36-.695.46zm2.024-.61c.48-.684.807-1.463.906-2.33l-.007-.137C17.613 7.053 16.386 6 14.9 6c-1.775 0-3.373.34-5.41 1.393C7.473 6.34 5.875 6 4.1 6 2.613 6 1.387 7.053 1.006 8.76L1 8.897c.1.867.425 1.646.906 2.33.352.498.706.846.955 1.036.123.1.355.24.684.38.533.223 1.156.357 1.863.357.367 0 .777-.052 1.226-.15.405-.086.832-.207 1.27-.354.32-.108.63-.223.916-.34.17-.068.636-.248.685-.248.048 0 .504.18.676.25.287.115.596.23.918.338.437.147.864.268 1.27.355.448.098.858.15 1.225.15.707 0 1.33-.134 1.863-.357.33-.14.56-.28.692-.388.24-.182.594-.53.946-1.03zM6.478 8.622c-.163-.077-.334-.133-.51-.17-.566-.118-1.147-.037-1.707.164-.224.08-.397.164-.502.223l-.258.146.033.28c.073.623.48 1.266 1.293 1.502.37.11.822.117 1.348.05.326-.044.67-.115 1.02-.206.203-.053.396-.11.574-.167.108-.034.187-.062.233-.078l.785-.285-.668-.477c-.073-.052-.21-.145-.414-.273-.335-.21-.735-.444-1.2-.696l-.025-.013zm.26 1.19s-.475.1-.695.13c-.398.05-.722.046-.933-.017-.39-.114-.51-.485-.51-.485s.806-.2 1.16-.125c.103.02.978.497.978.497zm5.76-1.177c-.466.252-.866.485-1.2.696-.204.128-.342.22-.415.273l-.668.477.784.285c.045.016.124.044.232.078.178.057.37.114.575.167.35.09.693.162 1.02.205.525.068.978.06 1.35-.05.81-.235 1.218-.88 1.29-1.502l.032-.28-.258-.145c-.105-.06-.278-.142-.503-.223-.56-.2-1.142-.282-1.707-.164-.177.037-.348.093-.51.17l-.025.013zm.74.68c.356-.075 1.16.125 1.16.125s-.118.372-.505.485c-.214.064-.538.07-.936.017-.28-.036-.68-.152-.68-.152s.86-.454.962-.475z" /></symbol></svg>'),b?"":c.toString()
}}),define("templates/tiger/icons/essential/usage",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.icons.essential.search=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-search"><use xlink:href="#iconset-search" /></svg>'),b?"":c.toString()},b.icons.essential.add=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-add"><use xlink:href="#iconset-add" /></svg>'),b?"":c.toString()},b.icons.essential.siteDefault=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-site-default"><use xlink:href="#iconset-site-default" /></svg>'),b?"":c.toString()},b.icons.essential.zoomIn=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-zoom-in"><use xlink:href="#iconset-zoom-in" /></svg>'),b?"":c.toString()},b.icons.essential.star=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-star"><use xlink:href="#iconset-star" /></svg>'),b?"":c.toString()},b.icons.essential.starCircle=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-star-circle"><use xlink:href="#iconset-star-circle" /></svg>'),b?"":c.toString()},b.icons.essential.chevronRight=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-chevron chevron--right"><use xlink:href="#iconset-chevron-right" /></svg>'),b?"":c.toString()},b.icons.essential.chevronBottom=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-chevron chevron--bottom"><use xlink:href="#iconset-chevron-right" /></svg>'),b?"":c.toString()},b.icons.essential.chevronLeft=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-chevron chevron--left"><use xlink:href="#iconset-chevron-right" /></svg>'),b?"":c.toString()},b.icons.essential.chevronTop=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-chevron chevron--top"><use xlink:href="#iconset-chevron-right" /></svg>'),b?"":c.toString()},b.icons.essential.flame=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-flame"><use xlink:href="#iconset-flame" /></svg>'),b?"":c.toString()},b.icons.essential.kinja=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-logo-kinja"><use xlink:href="#iconset-logo-kinja" /></svg>'),b?"":c.toString()},b.icons.essential.bubble=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-bubble"><use xlink:href="#iconset-bubble" /></svg>'),b?"":c.toString()},b.icons.essential.checkmark=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-checkmark"><use xlink:href="#iconset-checkmark" /></svg>'),b?"":c.toString()},b.icons.essential.close=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-close"><use xlink:href="#iconset-close" /></svg>'),b?"":c.toString()},b.icons.essential.facebook=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-facebook"><use xlink:href="#iconset-facebook" /></svg>'),b?"":c.toString()},b.icons.essential.twitter=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-twitter"><use xlink:href="#iconset-twitter" /></svg>'),b?"":c.toString()},b.icons.essential.googleplus=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-googleplus"><use xlink:href="#iconset-googleplus" /></svg>'),b?"":c.toString()},b.icons.essential.externalLink=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-external-link"><use xlink:href="#iconset-external-link" /></svg>'),b?"":c.toString()},b.icons.essential.burner=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-burner"><use xlink:href="#iconset-burner" /></svg>'),b?"":c.toString()},b.icons.essential.link=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-link"><use xlink:href="#iconset-link" /></svg>'),b?"":c.toString()},b.icons.essential.image=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-image"><use xlink:href="#iconset-image" /></svg>'),b?"":c.toString()}}),define("module/EssentialIconModule",["jquery","templates/tiger/icons/essential/definitions","templates/tiger/icons/essential/usage"],function(a){var b=a("#svggroup--essential");b&&b.length||a("#js_svg-definitions").append(a.trim(tiger.icons.essential.definitions()))}),define("model/Feature",["underscore","backbone","jquery","singleton/CurrentUser","apiclient/feature"],function(a,b,c,d,e){var f=b.Model.extend({defaults:{sticky:!0},sync:function(a,b,c){var d={};switch(a){case"create":return d=b.set({enabled:!0}).toJSON(),e.createFeature(d,c);case"update":if(b.changedAttributes())return d=b.changedAttributes(),d.modelId=b.id,e.updateFeature(d,c);window.alert("No feature settings were changed.");break;case"read":case"delete":case"enable":case"disable":return e[a+"Feature"]({modelId:b.id},c);case"segment":return e.getSegmentFeature()}},parse:function(a){var b;return b=a.meta&&a.meta.success===!0?a.data:a},validate:function(b){var c=a.extend(a.clone(this.attributes),b||{}),d=c.defaultValue||"",e=c.values||"";if(!c.name)return"Name not specified";if(!c.id||this.attributes.name!==c.name){if(!c.name.match(/^[a-z]/))return"Name must start with a lowecase letter";if(!c.name.match(/^[a-z0-9_]+$/))return"Name can only use the following: a-z 0-9 _"}return!e||e.length<2?"No values":c.abTesting!==!1||"%"===d.substr(d.length-1)||d&&-1!==e.indexOf(d)?void 0:"Invalid default value"},toggle:function(){var a=this,b=a.get("enabled")?"disable":"enable";a.sync(b,a,{success:function(b){return a.set({enabled:!a.get("enabled")})?void a.trigger("sync",a,b):!1}})}});return f}),define("collection/Feature",["jquery","underscore","backbone","model/Feature","singleton/CurrentUser","singleton/CurrentBlog","apiclient/feature"],function(a,b,c,d,e,f,g){var h=c.Collection.extend({model:d,sync:function(a,b,c){var d={};return f.canonicalHost&&(d.blog=f.canonicalHost),c.withAuthor&&(d.withAuthor=!0),c.compact&&(d.compact=!0),"read"===a?this.blogId?g.getBlogFeatures({blogId:this.blogId},c):g.getAjaxFeatures(d,c):void 0},blacklist:{476822046:"off"},getBetaFeatures:function(){return new h(this.filter(function(a){return"BETA"===a.get("type")}))},parse:function(a){return a.data},getDirtyModels:function(){var a=this.models.filter(function(a){return a.get("isDirty")}),b=this.blacklist;return a.map(function(a){var c=parseInt(a.get("id"),10);return b.hasOwnProperty(c)&&a.set("value",b[c]),a.get("id")+"="+a.get("value")}).join("&")}});return h}),define("singleton/FeatureThrottling",["config","jquery","backbone","underscore","lib/amd-wrapped/modernizr","singleton/Feature","singleton/CurrentUser","singleton/Utils","model/Feature","collection/Feature","apiclient/feature","gawkerlib/jquery.parseParams"],function(a,b,c,d,e,f,g,h,i,j,k){var l="_",m="kinja_feature_segment",n="kinja_feature_measurement_2507",o=c.Model.extend({initialize:function(){f.isOn("throttle")&&(g.onLogin.done(b.proxy(function(){b.removeCookie(m,{path:"/"}),this.checkFeatures()},this)),this.checkFeatures(),"off"!==f.value("throttle_measuring")&&this.measureThrottledFeature(f.value("throttle_measuring")))},checkFeatures:function(){var a=d.map(d.filter(b("body")[0].className.split(" "),function(a){return 0===a.indexOf("mf_")}),function(a){return a.substr(3)});b.when(this.getFeatureSegment(),this.getFeatures()).done(b.proxy(function(c,e){var g=this.lookupFeaturesToChange(c,e,a),h=d.map(d.extend({},g.reloading,g.silent),function(a,b){return b+"="+a});h.length>0&&(b.removeCookie(n,{path:"/"}),f.isOn("throttle_instant")?(f.syncCookies(h.join("&")),d.keys(g.reloading).length>0&&document.location.reload()):b(window).on("beforeunload",function(){f.syncCookies(h.join("&"),!0)}))},this))},measureThrottledFeature:function(a){var c=f.value(a),d=a+"="+c;b.cookie(n)||void 0===c||(k.sendPerHourFeatureTick({featureName:a,featureValue:c}),b.cookie(n,d,{path:"/",expires:1/24}))},getFeatureSegment:function(){var a=b.cookie(m),c=b.Deferred();return a?c.resolve(parseInt(a,10)):g.onAuth.done(function(){var a=new i;a.sync("segment",a,{success:function(a){a.meta&&a.meta.success&&a.meta.success===!0&&c.resolve(a.data)}})}),c},getFeatures:function(){var a,c=b.Deferred(),d=new j,f="kinja_feature_collection",g=!0,i=parseInt(h.getKinjaMeta().featuresLastUpdate,10),k=e.localstorage;return d.on("sync",function(){c.resolve(d),k&&(a={featuresLastUpdate:i,features:d.invoke("pick",["name","abTesting","possibleValues","source","defaultValue","blogValue"])},window.localStorage.setItem(f,JSON.stringify(a)))}),k&&(a=JSON.parse(window.localStorage.getItem(f)),a&&parseInt(a.featuresLastUpdate,10)===i&&(c.resolve(new j(a.features)),g=!1)),g=!0,g===!0&&d.fetch({compact:!0,disableToken:!0}),c},lookupFeaturesToChange:function(a,b,c){var e=a/100,g={reloading:{},silent:{}};return c=c||[],b.each(function(a){var b,h=0;d.contains(c,a.get("name"))||(a.get("abTesting")===!0?(b=d.last(d.filter(a.get("possibleValues"),function(a){var b=e>h;return h+=a.percentage,b})),f.value(a.get("name"))!==b.name&&(g.reloading[a.get("name")]=b.name)):"user"===a.get("source")&&(f.value(a.get("name"))!==a.get("defaultValue")&&f.value(a.get("name"))!==a.get("blogValue")?g.reloading[a.get("name")]=l:g.silent[a.get("name")]=l))}),g}});return new o}),define("lib/amd-wrapped/jquery.scrollTo",["jquery"],function(a){function b(a){return"object"==typeof a?a:{top:a,left:a}}var c=a.scrollTo=function(b,c,d){a(window).scrollTo(b,c,d)};c.defaults={axis:"xy",duration:parseFloat(a.fn.jquery)>=1.3?0:1,limit:!0},c.window=function(){return a(window)._scrollable()},a.fn._scrollable=function(){return this.map(function(){var b=this,c=!b.nodeName||-1!=a.inArray(b.nodeName.toLowerCase(),["iframe","#document","html","body"]);if(!c)return b;var d=(b.contentWindow||b).document||b.ownerDocument||b;return/webkit/i.test(navigator.userAgent)||"BackCompat"==d.compatMode?d.body:d.documentElement})},a.fn.scrollTo=function(d,e,f){return"object"==typeof e&&(f=e,e=0),"function"==typeof f&&(f={onAfter:f}),"max"==d&&(d=9e9),f=a.extend({},c.defaults,f),e=e||f.duration,f.queue=f.queue&&f.axis.length>1,f.queue&&(e/=2),f.offset=b(f.offset),f.over=b(f.over),this._scrollable().each(function(){function g(a){j.animate(l,e,f.easing,a&&function(){a.call(this,d,f)})}if(null!=d){var h,i=this,j=a(i),k=d,l={},m=j.is("html,body");switch(typeof k){case"number":case"string":if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(k)){k=b(k);break}if(k=a(k,this),!k.length)return;case"object":(k.is||k.style)&&(h=(k=a(k)).offset())}a.each(f.axis.split(""),function(a,b){var d="x"==b?"Left":"Top",e=d.toLowerCase(),n="scroll"+d,o=i[n],p=c.max(i,b);if(h)l[n]=h[e]+(m?0:o-j.offset()[e]),f.margin&&(l[n]-=parseInt(k.css("margin"+d))||0,l[n]-=parseInt(k.css("border"+d+"Width"))||0),l[n]+=f.offset[e]||0,f.over[e]&&(l[n]+=k["x"==b?"width":"height"]()*f.over[e]);else{var q=k[e];l[n]=q.slice&&"%"==q.slice(-1)?parseFloat(q)/100*p:q}f.limit&&/^\d+$/.test(l[n])&&(l[n]=l[n]<=0?0:Math.min(l[n],p)),!a&&f.queue&&(o!=l[n]&&g(f.onAfterFirst),delete l[n])}),g(f.onAfter)}}).end()},c.max=function(b,c){var d="x"==c?"Width":"Height",e="scroll"+d;if(!a(b).is("html,body"))return b[e]-a(b)[d.toLowerCase()]();var f="client"+d,g=b.ownerDocument.documentElement,h=b.ownerDocument.body;return Math.max(g[e],h[e])-Math.min(g[f],h[f])}}),define("lib/amd-wrapped/jquery.lightbox-0.5",["jquery"],function(a){a.fn.lightBox=function(b){function c(){return d(this,s),!1}function d(c,d){var g=a(c).siblings("span").find("img");if(a("embed, object, select").css({visibility:"hidden"}),e(),b.imageArray.length=0,b.activeImage=0,1==d.length)b.imageArray.push(new Array(g.attr("data-original-src"),c.getAttribute("title")));else for(var h=0;h<d.length;h++){var i=d.eq(h).siblings("span").find("img");b.imageArray.push(new Array(i.attr("data-original-src"),d[h].getAttribute("title")))}for(;b.imageArray[b.activeImage][0]!=g.attr("data-original-src");)b.activeImage++;f()}function e(){a("body").append('<div id="jquery-overlay"></div><div id="jquery-lightbox"><div id="lightbox-container-image-data-box"><div id="lightbox-container-image-data"><div id="lightbox-image-details"><span id="lightbox-image-details-caption"></span><span id="lightbox-image-details-currentNumber" class="proxima"></span></div><div id="lightbox-secNav"><a href="#" id="lightbox-secNav-btnClose"><span class="icon icon-white icon-x-alt"></span></a></div></div></div><div id="lightbox-container-image-box"><div id="lightbox-container-image"><img id="lightbox-image"><a href="#" id="lightbox-nav-btnPrev"></a><a href="#" id="lightbox-nav-btnNext"></a></div></div></div>');var c=p();a("#jquery-overlay").css({backgroundColor:b.overlayBgColor,opacity:b.overlayOpacity,width:c[0],height:c[1]}).fadeIn();var d=q();a("#jquery-lightbox").css({top:d[1]+c[3]/10,left:d[0]}).show(),a("#jquery-overlay,#jquery-lightbox").click(function(){o()}),a("#lightbox-loading-link,#lightbox-secNav-btnClose").click(function(){return o(),!1}),a(window).resize(function(){var b=p();a("#jquery-overlay").css({width:b[0],height:b[1]});var c=q();a("#jquery-lightbox").css({top:c[1]+b[3]/10,left:c[0]})})}function f(){b.fixedNavigation?a("#lightbox-image,#lightbox-container-image-data-box,#lightbox-image-details-currentNumber").hide():a("#lightbox-image,#lightbox-nav,#lightbox-nav-btnPrev,#lightbox-nav-btnNext,#lightbox-container-image-data-box,#lightbox-image-details-currentNumber").hide();var c=new Image;c.onload=function(){a("#lightbox-image").attr("src",b.imageArray[b.activeImage][0]),g(c.width,c.height),c.onload=function(){}},c.src=b.imageArray[b.activeImage][0],b.activeImage>-1}function g(c,d){a("#lightbox-container-image-box").hide();var e=a("#lightbox-container-image-box").width(),f=a("#lightbox-container-image-box").height(),g=c+2*b.containerBorderSize,i=d+2*b.containerBorderSize,j=e-g,k=f-i;a("#lightbox-container-image-box").css({width:g,height:i}),h(),0==j&&0==k&&r(a.browser.msie?250:100),a("#lightbox-container-image-data-box").css({width:c+20})}function h(){a("#lightbox-image").fadeIn(function(){i(),j(),a("#lightbox-container-image-box").show()}),n()}function i(){a("#lightbox-container-image-data-box").slideDown("fast"),a("#lightbox-image-details-caption").hide(),b.imageArray[b.activeImage][1]&&a("#lightbox-image-details-caption").html(b.imageArray[b.activeImage][1]).show(),b.imageArray.length>1}function j(){0!=b.activeImage?b.fixedNavigation?a("#lightbox-nav-btnPrev").unbind().html('<span class="button-box"><span class="icon icon-white icon-chevron-left"></span></span>').bind("click",function(){return b.activeImage=b.activeImage-1,f(),!1}):a("#lightbox-nav-btnPrev").unbind().hover(function(){a(this).html('<span class="button-box"><span class="icon icon-white icon-chevron-left"></span></span>')},function(){a(this).html("")}).show().bind("click",function(){return b.activeImage=b.activeImage-1,f(),!1}):a("#lightbox-nav-btnPrev").html(""),b.activeImage!=b.imageArray.length-1?b.fixedNavigation?a("#lightbox-nav-btnNext").unbind().html('<span class="button-box"><span class="icon icon-white icon-chevron-right"></span></span>').bind("click",function(){return b.activeImage=b.activeImage+1,f(),!1}):a("#lightbox-nav-btnNext").unbind().hover(function(){a(this).html('<span class="button-box"><span class="icon icon-white icon-chevron-right"></span></span>')},function(){a(this).html("")}).show().bind("click",function(){return b.activeImage=b.activeImage+1,f(),!1}):(a("#lightbox-nav-btnNext").unbind(),a("#lightbox-nav-btnNext").html("")),k()}function k(){a(document).keydown(function(a){m(a)})}function l(){a(document).unbind()}function m(a){null==a?(keycode=event.keyCode,escapeKey=27):(keycode=a.keyCode,escapeKey=a.DOM_VK_ESCAPE||27),key=String.fromCharCode(keycode).toLowerCase(),(key==b.keyToClose||"x"==key||keycode==escapeKey)&&o(),(key==b.keyToPrev||37==keycode)&&0!=b.activeImage&&(b.activeImage=b.activeImage-1,f(),l()),(key==b.keyToNext||39==keycode)&&b.activeImage!=b.imageArray.length-1&&(b.activeImage=b.activeImage+1,f(),l())}function n(){b.imageArray.length-1>b.activeImage&&(objNext=new Image,objNext.src=b.imageArray[b.activeImage+1][0]),b.activeImage>0&&(objPrev=new Image,objPrev.src=b.imageArray[b.activeImage-1][0])}function o(){a("#jquery-lightbox").remove(),a("#jquery-overlay").fadeOut(function(){a("#jquery-overlay").remove()}),a("embed, object, select").css({visibility:"visible"})}function p(){var a,b;window.innerHeight&&window.scrollMaxY?(a=window.innerWidth+window.scrollMaxX,b=window.innerHeight+window.scrollMaxY):document.body.scrollHeight>document.body.offsetHeight?(a=document.body.scrollWidth,b=document.body.scrollHeight):(a=document.body.offsetWidth,b=document.body.offsetHeight);var c,d;return self.innerHeight?(c=document.documentElement.clientWidth?document.documentElement.clientWidth:self.innerWidth,d=self.innerHeight):document.documentElement&&document.documentElement.clientHeight?(c=document.documentElement.clientWidth,d=document.documentElement.clientHeight):document.body&&(c=document.body.clientWidth,d=document.body.clientHeight),pageHeight=d>b?d:b,pageWidth=c>a?a:c,arrayPageSize=new Array(pageWidth,pageHeight,c,d),arrayPageSize}function q(){var a,b;return self.pageYOffset?(b=self.pageYOffset,a=self.pageXOffset):document.documentElement&&document.documentElement.scrollTop?(b=document.documentElement.scrollTop,a=document.documentElement.scrollLeft):document.body&&(b=document.body.scrollTop,a=document.body.scrollLeft),arrayPageScroll=new Array(a,b),arrayPageScroll}function r(a){var b=new Date;c=null;do var c=new Date;while(a>c-b)}b=a.extend({overlayBgColor:"#000",overlayOpacity:.85,fixedNavigation:!1,containerBorderSize:10,containerResizeSpeed:400,txtImage:"Image",txtOf:" / ",keyToClose:"c",keyToPrev:"p",keyToNext:"n",imageArray:[],activeImage:0},b);var s=this;return this.unbind("click").click(c)}}),define("lib/ios-orientationchange-fix",["jquery"],function(a){return function(b){function c(){var b,c="";a(document).find("input[placeholder]").each(function(){b=a(this),c=b.attr("placeholder"),b.removeAttr("placeholder").attr("placeholder",c)})}function d(){m.setAttribute("content",p),q=!0}function e(){m.setAttribute("content",o),q=!1}function f(a){l=a.accelerationIncludingGravity,i=Math.abs(l.x),j=Math.abs(l.y),k=Math.abs(l.z),b.orientation&&180!==b.orientation||!(i>7||(k>6&&8>j||8>k&&j>6)&&i>5)?q||d():q&&e()}b.addEventListener&&b.addEventListener("orientationchange",c,!1);var g=navigator.userAgent;if(/iPhone|iPad|iPod/.test(navigator.platform)&&/OS [1-5]_[0-9_]* like Mac OS X/i.test(g)&&g.indexOf("AppleWebKit")>-1){var h=b.document;if(h.querySelector){var i,j,k,l,m=h.querySelector("meta[name=viewport]"),n=m&&m.getAttribute("content"),o=n+",maximum-scale=1",p=n+",maximum-scale=10",q=!0;m&&(b.addEventListener("orientationchange",d,!1),b.addEventListener("devicemotion",f,!1))}}}(window),{}}),define("templates/tiger/section/header/js-iemessage",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.section.header.js_iemessage=function(a,b){a=a||{};var c=b||new d.StringBuilder;return c.append('	<div data-alert class="alert-box info js_ie-message-inner"><a href="#" class="close">&times;</a>Please <a href="http://help.gawker.com/customer/portal/articles/1329926-is-my-browser-supported-">update your browser</a> for a better experience on ',d.$$escapeHtml((null==a.blog?null:a.blog.displayName)?a.blog.displayName:"kinja.com"),".</div>"),b?"":c.toString()}}),define("module/BaseApp",["jquery","underscore","lib/amd-wrapped/modernizr","module/Main","view/BaseView","singleton/CurrentUser","singleton/CurrentBlog","singleton/EventDispatcher","singleton/Feature","singleton/Utils","singleton/Twitter","app/navigation/topbar.layout","app/navigation/userMenu.view","app/navigation/blogMenu.layout","app/navigation/secondaryNav.view","app/channels/channels.layout","view/SuccessBox","app/MarionetteApp","app/leftrail/leftrailContainedList.view","model/blog.settings","view/footer.view","app/account/account.channel","module/KinjaAnalytics","module/EssentialIconModule","singleton/FeatureThrottling","lib/jquery.cookie","lib/amd-wrapped/jquery.scrollTo","lib/amd-wrapped/jquery.lightbox-0.5","lib/ios-orientationchange-fix","templates/tiger/section/header/js-iemessage","templates/tiger/icons/essential/usage"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){var x,y,z=a(".js-navwrap--outer");return x=function(a){require(["module/LoginModule"],function(b){a(b.controller)})},y=e.extend({successBox:null,el:a("body"),$offcanvas:a("#js_off-canvas-wrap"),$offcanvasNotif:a("#js_off-canvas-wrap .js_notif-tab, #js_notifications--offcanvas"),$offcanvasUser:a("#js_off-canvas-wrap .js_username-tab, #js_usermenu--offcanvas"),$offcanvasButton:a("#js_off-canvas-wrap .js_offcanvas-notif"),$secondaryNavBtn:a(".js_secondary-nav-btn-wrapper"),events:{"tap .js_offcanvas-user,.js_offcanvas-notif":"onOffcanvasClick"},initialize:function(){i.isOn("remove_approuter")&&d.start(),i.isOn("fastclick")&&require(["lib/fastclick"],function(a){a.attach(document.body)}),"resettoken"===this.getPageType()||"gettoken"===this.getPageType()?this.resetToken():(this.initApp(),i.isOn("nosocialscripts")||this.loadSocialScripts(),"admin"!==j.getKinjaMeta().pageType&&this.initSubViews())},start:function(){},initApp:function(){var b=function(b){var c=a.cookie("kinja_features");!b.isSuperUser()||c&&-1!==c.indexOf("all_on=")||(a.cookie.raw=!0,c&&""!==c?a.cookie("kinja_features",c+"|all_on=on"):a.cookie("kinja_features","all_on=on"),a.cookie.raw=void 0)};i.isOn("frontendtiming")&&window.markUserTime("currentuser_load"),f.load().done(function(){if(b(f),i.isOn("frontendtiming")){var a=f.isLoggedIn()?"currentuser_loaded_loggedin":"currentuser_loaded_loggedout";window.markUserTime(a)}}),f.on("authenticated",this.handleAuth,this),h.on("modal:incompleteRegistration:success",function(){window.ga("send","event","Sign up",f.get("authName"),g.displayName)},this),h.on("all",this.trigger,this),i.isOn("userstats")&&this.statsTracker(),i.isOn("analyticstracking")&&this.initAnalyticsTracking(),a("body").addClass("js_initialized "+(c.touch?"touch":"no-touch")),this.listenTo(v,"loginRequired",this.onLoginRequired).listenTo(v,"loginCancelled",this.onLoginCancelled).listenTo(f,"incompleteRegistration",this.onIncompleteRegistration)},initSubViews:function(){var b,c=a(r.notificationDropdownRegion.el).length>0,d=a(".js_site-footer");this.initLeftrailContained(),i.isOn("channels")&&this.initChannels(),c&&(this.initTopbar(),this.initOffcanvas()),i.isOn("maintenance_mode")&&this.showMaintenanceMessage(),this.setupSuccessBox(),a("html").hasClass("lt-ie9")&&this.displayIEBox(),d.length&&(b=new u({el:d}),b.bindUIElements(),b.delegateEvents(),b.onRender()),i.isOn("featurepanel")&&require(["module/FeaturePanelModule"],function(a){a.start()})},displayIEBox:function(){var b,c=0,d=a(".js_ie-message");d.length>0&&!this.isGoogleBot()&&(c=parseInt(a.cookie("iebox_seen_count")||0,10),"1"!==a.cookie("iebox_seen")&&5e3>c&&(b=a(this.soyToHtml(tiger.section.header.js_iemessage)).removeClass("hide"),d.removeClass("hide").append(b).find("a.close").on("click",function(){return d.remove(),a.cookie("iebox_seen","1",{expires:7300,path:"/"}),!1}),a.cookie("iebox_seen_count",c+1,{expires:7300,path:"/"})))},isGoogleBot:function(){return window.navigator.userAgent.toLowerCase().indexOf("googlebot")>0},displayWarningMessage:function(b,c){if(0===b.length||"1"===a.cookie(c))return!1;var d=function(){return b.addClass("hide"),a.cookie(c,"1",{expires:30,path:"/"}),!1};b.removeClass("hide").find("a.close").on("click",d)},showMaintenanceMessage:function(){var b=a(".js_maintenance");b.length>0&&b.removeClass("hide")},setupSuccessBox:function(){h.on("successbox:display",function(a){null!==this.successBox&&this.successBox.close(),this.successBox=new q(a),this.successBox.render()},this),h.on("successbox:close",function(){null!==this.successBox&&this.successBox.close()},this)},initLeftrailContained:function(){var a;a=new s({el:".js_sidebar"}),a.render()},initTopbar:function(){var a,b,c,d,e=j.pageTypes,g=[e.editor,e.usersettings,e.splash,e.dashboard,e.manageblog,e.leaderboard,e.performancestats],h=-1!==g.indexOf(j.getKinjaMeta().pageType);a=new l({el:".js_global-nav-wrap",model:f}),a.bindUIElements(),a.onRender(),h||/iemobile/.test(window.navigator.userAgent.toLowerCase())||a.initializeAutohide(),b=new m({model:f}),r.userDropdownRegion.show(b),c=new n({el:"#js_blogmenu--dropdown",model:f}),c.bindUIElements(),c.onRender(),this.$secondaryNavBtn.length>0&&i.isOn("secondary_nav")&&(h||this.$secondaryNavBtn.addClass("transition shown"),d=new o({el:"body",animation:!h}))},initOffcanvas:function(){var b,c;a(document).on("open.fndtn.offcanvas","[data-offcanvas]",function(){var b=0;i.isOn("splashy_ad")&&(b=z.offset().top),a(window).scrollTop(b)}),b=new m({model:f,offcanvas:!0}),r.userOffcanvasRegion.show(b),c=new n({el:"#js_blogmenu--offcanvas",model:f,offcanvas:!0}),c.bindUIElements(),c.onRender()},onOffcanvasClick:function(b){return a(b.currentTarget).hasClass("js_notif")?(this.$offcanvasUser.removeClass("active"),this.$offcanvasNotif.addClass("active"),f.clearNotifications(),this.$offcanvasButton.removeClass("has-notification"),i.isOn("notifications_native")&&"Notification"in window&&"denied"!==window.Notification.permission&&window.Notification.requestPermission()):(this.$offcanvasNotif.removeClass("active"),this.$offcanvasUser.addClass("active")),!0},initChannels:function(){var a=new p({});r.channelsRegion.show(a)},handleAuth:function(){f.isLoggedIn()&&f.isSuperUser()&&i.isOn("superuser")&&i.isOn("superuser_notif")&&a(".js_top-nav-wrap").addClass("momjeans-notifier"),a("body").toggleClass("loggedin",f.isLoggedIn())},resetToken:function(){var a=f.get("token");return a&&0===a.indexOf("dummy-")?window.location.href=window.location.protocol+"//"+window.location.host:(f.clearTokenCookie(),f.token().done(function(){window.setTimeout(function(){window.location.reload()},1e3)}).fail(function(){window.location.href="/"})),!1},loadSocialScripts:function(){a(".twitter-tweet").length&&k.loadTweets()},statsTracker:function(){var b="__k_iut",c=a(".js_stats"),d=c.data("trackurl"),e=!1;(!a.cookie(b)||a.cookie(b)<(new Date).getTime()-2592e6)&&(e=!0,a.cookie(b,(new Date).getTime(),{path:"/",expires:365})),c.data("unique",e),d&&(e&&(d+="&unique=true"),c.append('<img src="'+d+'" style="display: none;">'))},initAnalyticsTracking:function(){f.on("logoutReset",function(){w.pushEvent("LOGOUT",null,null,null)}),h.on("modal:login:closed",function(a){w.pushEvent("LOGIN","AUTHENTICATION",f.get("authName"),{uiElement:a.source||"default"})}),h.on("modal:incompleteRegistration:success",function(a){w.pushEvent("REGISTER","AUTHENTICATION",f.get("authName"),{uiElement:a.source||"default"})}),h.on("analytics:postSaved",function(a){"PUBLISHED"===a.data.status&&a.data.isStarter===!0&&w.pushEvent("PUBLISH_STARTER","POST",a.data.id,null)}),h.on("analytics:replySaved",function(a){"PUBLISHED"===a.data.status&&a.data.isStarter===!1&&w.pushEvent("PUBLISH_REPLY","POST",a.data.id,null)})},onLoginRequired:function(a){x(function(b){var c=a?a.source:"default";b.showOptions(c),window.ga("send","event","Authentication flow","Prompt login","source: "+c)})},onLoginCancelled:function(a){w.pushEvent("LOGIN","CANCELLED","closeModal",{uiElement:a.source||"default"})},onIncompleteRegistration:function(){x(function(a){a.showIncompleteRegistration()})}})}),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define("lib/needly",b):a.Needly=b()}(this,function(){function a(a,b,c){this.resolve=function(){return a.resolve(b,{args:c})}}function b(){var b=this,i={};return this.registerClass=function(a,b,d){return i[a]={type:c,item:b,args:d},b},this.registerSingleton=function(a,b){return i[a]={type:e,item:b},b},this.registerFactory=function(a,b,c,e){return i[a]={type:d,item:b,args:c,context:e},b},this.registerMany=function(a){for(var b in a)if(a.hasOwnProperty(b)){var f=a[b],g=f.type,h="BadConfiguration:";if(!f||!f.dependency)throw new Error(h+b+".dependency");if(g!==e&&g!==c&&g!==d)throw new Error(h+b+".type");i[b]={item:f.dependency,type:f.type,args:f.type!==e?f.args:null,context:f.type===d?f.context:null}}},this.unregister=function(a){delete i[a]},this.unregisterAll=function(){i={}},this.property=function(b,c){return new a(this,b,c)},this.args=function(){var a=arguments.length-1,c=f.call(arguments,0,a),d=arguments[a];return function(){for(var e=[],g=f.call(arguments),h=Math.max(a,g.length),i=0;h>i;i++){var j,k=c[i];if(k)if("string"==typeof k)k=g[i]||b.resolve(k);else{if(k!==new Object(k))throw new Error("BadArgument: Expected string or object. Received: "+k);j=k,k=g[i]||{};for(var l in j)!k.hasOwnProperty(l)&&j.hasOwnProperty(l)&&(k[l]=b.resolve(j[l]))}else k=g[i];e.push(k)}return d.apply(d,e)}},this.resolveAll=function(b){for(var c in b){var d=b[c];d&&d instanceof a&&(b[c]=d.resolve())}return b},this.autoResolve=function(a,c){c=c||"initialize";var d=a.prototype[c];a.prototype[c]=function(){b.resolveAll(this),d&&d.apply(this,arguments)}},this.resolve=function(a,b){var f,j=b||{},k=i[a];if(k)switch(f=h(k.args,j.args),k.type){case e:return k.item;case d:return this.resolveAll(k.item.apply(j.context||k.context||this,f));case c:return this.resolveAll(g(k.item,f))}else{var l="DependencyNotFound:"+a;console&&console.warn&&console.warn(l),j.error&&j.error(l)}},this}var c="class",d="factory",e="singleton",f=Array.prototype.slice,g=function(a,b){function c(){return a.apply(this,b)}return c.prototype=a.prototype,new c},h=function(a,b){return(a||[]).concat(b||[])};return{Container:b}}),define("templates/tiger/components/liveblog",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.liveblog.branch=function(a,c,e){var f=c||new d.StringBuilder;f.append('	<div class="js_expanded replybranch js_replybranch" data-id="',d.$$escapeHtml(a.branch.reply.id),'">');for(var g=a.branch.children,h=g.length,i=0;h>i;i++){var j=g[i];b.components.liveblog.post({post:j},f,e)}return b.components.liveblog.footer(null,f,e),f.append("</div>"),c?"":f.toString()},b.components.liveblog.footer=function(a,b){var c=b||new d.StringBuilder;return c.append('	<footer class="reply-footer-bar"><a href="#" class="js_collapse-branch">Collapse conversation</a></footer>'),b?"":c.toString()}}),define("templates/tiger/components/liveblog/post",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.liveblog.post=function(a,b,c){var e=b||new d.StringBuilder;e.append('	<article class="js_reply reply liveblog-item js_liveblog-item" data-timestamp="',d.$$escapeHtml(a.post.publishTimeMillis),'" data-id="',d.$$escapeHtml(a.post.id),'"><header><div class="meta-container without-dropdown"><div class="meta-avatar"><div class="floated-container img-30 mbm"><span class="avatar">');var f=new d.StringBuilder("avt-small");return f=f.toString(),e.append(a.post.author.avatar?'<img src="'+d.$$escapeHtml(window.kinja.imageUrl(a.post.author.avatar.id,f))+'" />':'<span class="avatar-default"></span>','</span><div class="txt"><span class="display-name author vcard"><span class="fn">',d.$$escapeHtml(a.post.author.displayName),"</span>",null!=a.post.parentAuthorId&&a.post.replyMeta&&a.post.replyMeta.parentAuthor?'<span class="reply-author replyto-author"><span class="icon icon-arrow-small-right text-light"></span>'+((null==a.post.replyMeta?null:a.post.replyMeta.showParentByline)&&""!=(null==a.post.replyMeta?null:a.post.replyMeta.parentByline)?d.$$filterNoAutoescape(a.post.replyMeta.parentByline):d.$$escapeHtml(a.post.replyMeta.parentAuthor.displayName))+"</span>":"",'</span><div class="second-line"><span class="publish-time"><a href="',d.$$escapeHtml(a.post.permalink),'">',d.$$escapeHtml(a.post.publishTime.hmma),'</a></span></div></div></div></div></div></header><div class="reply-content post-content whitelisted-links">',d.$$filterNoAutoescape(a.post.display),'</div><div class="reply-tools">',c.features.liveblog_disable_replies?"":'<a href="#" class="js_expand-branch reply-count" data-id="'+d.$$escapeHtml(a.post.id)+'" title="Show replies"><span class="icon icon-bubble-round oversized js_bubble-icon"></span></a><a href="#" class="js_reply-to-selected-post reply-link readonly-hide" data-id="'+d.$$escapeHtml(a.post.id)+"\" title=\"Reply\" onclick=\"window.ga('send', 'event', 'Group Chats', 'click', 'Reply button click');\">Reply</a>",'</div><div class="reply-border"></div></article>'),b?"":e.toString()
}}),define("view/ExpandedBranchView",["jquery","view/BaseView","singleton/EventDispatcher","templates/tiger/components/liveblog","templates/tiger/components/liveblog/post"],function(a,b,c){var d=b.extend({events:{"click .js_collapse-branch":"remove"},render:function(){var a,b={branch:this.model.toJSON(),pageType:this.getPageType()},d=tiger.components.liveblog.branch,e=this.soyToHtml(d,b);return this.$el.html(e),a=this.$el.find(".js_replybranch"),c.trigger("update.postlist.reply",{el:a}),this.$el.slideDown(100),this},remove:function(){return this.$el.slideUp(100).promise().done(a.proxy(function(){this.trigger("removed"),b.prototype.remove.call(this)},this)),!1}});return d}),define("model/post/Post",["config","jquery","backbone","underscore","singleton/CurrentUser","singleton/Feature","singleton/Utils","apiclient/gettoken"],function(a,b,c,d,e,f,g,h){var i=b("<div />"),j=function(a){var b,c=a.getHours(),d=a.getMinutes(),e=a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear();return 10>c&&(c="0"+c),10>d&&(d="0"+d),b=c+":"+d,{MdyHm:[e,b].join(" ")}},k={dateTimeFormat:/^\d{1,2}\/\d{1,2}\/\d{4} \d{1,2}:\d{2}$/,chompImgType:/img\.gawkerassets\.com\/img\/(\w+)\/[\w\-]+\./g},l=c.Model.extend({constructor:function(a){window.__postModelStorage=window.__postModelStorage||{};var b,d,e=window.__postModelStorage,f=void 0!==a&&void 0!==a.id&&void 0!==e,g={};if(f&&void 0!==e[a.id]){for(d in a)a.hasOwnProperty(d)&&null!==a[d]&&(g[d]=a[d]);return b=e[a.id],b.set(g),b}c.Model.prototype.constructor.apply(this,arguments),f&&(e[a.id]=this)},initialize:function(){k=b.extend(k,{mediaInPost:new RegExp("<("+this.mediaTags.join("|")+")","gim")})},storeInMemory:function(){var a=window.__postModelStorage||{},b=void 0!==this.id&&void 0!==a;return b&&void 0!==a[this.id]?a[this.id].set(this.attributes):a[this.id]=this,this},mediaTags:["img","embed","object","iframe","video","audio","canvas"],defaults:{promoteState:{},publishTime:j(new Date),blogs:new c.Collection,liked:!1},validationRules:{PUBLISHTIME_IS_REQUIRED:function(a){var b=!0;return"SCHEDULED"!==a.status||a.publishTimeMillis||(b=!1),b},POST_CONTENT_IS_REQUIRED:function(a){var c=!0,d=a.headline&&b.trim(i.html(a.headline)),e=a.original&&b.trim(i.html(a.original).text()),f=a.original&&(k.mediaInPost.test(a.original)||i.html(a.original).find("img").length),g=a.hasFile||a.files&&a.files.length;return d||e||f||g||(c=!1),c},POST_CONTENT_CANNOT_CONTAIN_BAD_CONTENT:function(a){var b=!0,c=["form"].join("");return i.html(a.original).find(c).length&&(b=!1),b}},savePipeline:b.Deferred().resolve(),publishTime:function(a){return j(a)},sync:function(a,c,e){var f,g,i,j,k,l;if("create"!==a&&(void 0===c.id||null===c.id))throw new Error("Post.sync(): Model undefined");switch(c.attributes.meta={},"undefined"!=typeof c.attributes.status&&(c.attributes.meta.status=c.attributes.status),"undefined"!=typeof c.attributes.allowReplies&&(c.attributes.meta.allowReplies=c.attributes.allowReplies),"undefined"!=typeof c.attributes.showByline&&(c.attributes.meta.showByline=c.attributes.showByline),"undefined"!=typeof c.attributes.byline&&(c.attributes.meta.byline=c.attributes.byline),"undefined"!=typeof c.attributes.properties&&(c.attributes.meta.properties=c.attributes.properties),a){case"create":f="POST",g=c.has("parentId")&&""!==c.get("parentId")?"/ajax/post/"+c.get("parentId")+"/jsonReplyWithApproval":"/ajax/post/jsonAdd",i=JSON.stringify(c);break;case"read":f="GET",g=void 0!==e.preview&&e.preview===!0?"/ajax/post/preview/"+c.id:void 0!==e.showcase&&e.showcase===!0?"/ajax/post/showcase/"+c.id:"/ajax/post/"+c.id;break;case"update":f="POST",g="/ajax/post/"+c.id+"/jsonUpdate",i=JSON.stringify(c);break;case"delete":f="POST",g="/ajax/post/"+c.id+"/delete"}return j={type:f,dataType:"json",contentType:"application/json",url:g,data:i||null},k=b.Deferred(),l=k.promise(),h.secure().done(function(a){j.url=j.url+"?token="+a,b.ajax(d.extend(j,e)).done(k.resolve).fail(k.reject)}),l},parse:function(a){if(void 0===a)throw new Error("Post.parse(): no response to parse");var b={};return b=a.data?a.data:a,void 0!==b.id&&null!==b.id&&(b.id=parseInt(b.id,10)),b.images&&b.images.length&&(b.images=[]),b},toFormData:function(){var a=["id","headline","original","tags","publishTimeMillis","publishTimeZone","status","blogId","defaultBlogId","annotation.annotationType","annotation.imageUrl","annotation.imageChompId","annotation.imageWidth","annotation.imageHeight","annotation.x","annotation.y","annotation.annotationText","annotation.annotationTextHash","allowReplies","sponsored","showByline","byline","salesAvatar","salesAvatarMap","share","properties","shareBlogId","sharedPostId","images","parentId","adZone"],b=["status","allowReplies","showByline","byline","properties"],c=function(a){var c=a[0],e=a[1];return-1!==d.indexOf(b,c)&&(c="meta."+c),[c,e]},e=d.pick(this.toJSON(),d.union(a,d.map(b,function(a){return"meta."+a}))),f=d.object(d.pairs(e).map(c));return f},getUrl:function(){return void 0!==this.get("permalink")?this.get("permalink"):"/"+this.id},getActionState:function(){var a=b.Deferred();return this.has("actionState")?a.resolve():this.getPostInfo().done(function(){a.resolve()}),a.promise()},getPostInfo:function(c){var d,f=this,g=parseInt(this.id,10);if(!e.isLoggedIn())throw new Error("Post.getPostInfo(): user not logged in");return c=c||{},c.success=c.success||function(){},d=[a.api.core.url,"/post/",g,"/actionstatus?token=",e.get("token")].join(""),b.ajax({type:"GET",dataType:"jsonp",jsonp:"jsonp",url:d,success:function(a){200===a.meta.status&&(f.setActionState(a.data),c.success.call(f))}})},isPublished:function(){return"PUBLISHED"===this.get("status")},setAction:function(b,c,d){var e,f={};if(!b||"repost"!==b&&"dismiss"!==b&&"actionreset"!==b)throw new Error("Post:setAction(): Invalid post action: "+b);if(!c)throw new Error("Post:setAction(): Invalid blogId: "+c);return e="repost"===b?a.api.core.url+"/post/"+this.id+"/"+b+"/"+c:"/ajax/post/"+this.id+"/"+b+"/"+c,"repost"===b&&d.publishTimeMillis&&(f.repostTime=d.publishTimeMillis),this.setLikeOrAction(d,b,e,f)},setLikeOrAction:function(a,c,d,f){var g,i,j,k;return a=a||{},f=f||{},a.success=a.success||function(){},a.error=a.error||function(){},e.isLoggedIn()||a.error.call(this,{reason:"user"}),i=b.Deferred(),j=i.promise(),k=this,h.fresh().done(function(e){f.token=e,g="repost"===c?{url:d+"?"+b.param(f),type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:"{}"}:{url:d+"?"+b.param(f),type:"POST"},b.ajax(g).done(function(b){void 0!==b.meta?"repost"===c||"dismiss"===c||"actionreset"===c?(k.setActionState(b.data),a.success.call(k,{response:b.data})):(k.setLikeState(b.data),a.success.call(k,{response:b.data})):a.error.call(k,{reason:"action error"}),i.resolve()}).fail(function(b){a.error.call(this,b.responseJSON,b.status,b.statusText),i.reject(b.responseJSON,b.status,b.statusText)})}),j},setActionState:function(a){var b={};d.each(a,function(a){b[a.blogId]=a.relation.toLowerCase()},this),this.set({actionState:b})},setLike:function(a,b){var c,e=["like","unlike"];if(!a||!d.contains(e,a))throw new Error("Post:setLike(): Invalid post action: "+a);return"like"===a&&(a+="AndApprove"),c="likeAndApprove"!==a?["/api/core/post",this.id,a].join("/"):["/ajax/post",this.id,a].join("/"),this.setLikeOrAction(b,a,c)},setLikeState:function(a){var b=a||{},c=b.like||b;this.set(void 0!==c.objectId&&c.objectId===this.get("id")?{liked:!0}:{liked:!1})},prepareAnnotations:function(){if(this.has("annotation")){var a=this.get("annotation"),c=b().text(a.annotationText),d=170;void 0===a.annotationShortText&&c.length>d&&(a.annotationShortText=g.cut(c,d))}return this},parseFromDom:function(a){var b=JSON.parse(decodeURIComponent(a.data("model")));return new l(b)},replaceImagesWithOriginal:function(){var a=this.get("display");return this.set("display",a.replace(k.chompImgType,"img.gawkerassets.com/img/$1/original.")),this},validate:function(){var a=[],b=this.toJSON();return b.mode&&d.each(this.validationRules,function(c,d){c(b)||a.push({error:"CLIENT_VALIDATION_ERROR",reason:d})},this),a.length?a:!1},getShareOptionsForUser:function(a){var c=b.Deferred(),e=[],f=[],g=[],h=a.get("defaultBlogId"),i=!1;return this.getActionState().done(b.proxy(function(){d.each(this.get("actionState"),function(a,b){"repost"===a&&e.push(parseInt(b,10))}),i=-1!==d.indexOf(e,h)?!0:!1,a.get("membership").each(function(a){a.get("blogId")===h||"ENABLED"!==a.get("blog").status&&"SPAM"!==a.get("blog").status||(-1!==d.indexOf(e,a.get("blog").id)?g.push({name:a.get("blog").displayName,id:a.get("blog").id}):f.push({name:a.get("blog").displayName,id:a.get("blog").id}))},this),c.resolve({repostedTo:e,repostedToPersonal:i,personalBlogId:h,blogsUndo:g,blogsRepost:f})},this)),c.promise()}});return l}),define("collection/BaseCollection",["backbone"],function(a){var b=a.Collection.extend({constructor:function(b,c){c=c||{},c.url&&(this.url=c.url),a.Collection.prototype.constructor.apply(this,arguments)}});return b}),define("collection/Post",["jquery","underscore","collection/BaseCollection","model/post/Post","singleton/Feature","singleton/CurrentUser"],function(a,b,c,d,e,f){var g=c.extend({model:d,options:{},pagination:{},listMeta:{},initialize:function(a,d){c.prototype.initialize.call(this,a,d),this.options=b.extend({},this.options,d||{})},fetch:function(b){b=b||{};var d=a.Deferred(),g=a.Deferred();return e.isOn("superuser")?f.onAuth.done(function(){b.data=b.data||{},b.data.token=f.get("token"),d.resolve()}):d.resolve(),d.done(a.proxy(function(){c.prototype.fetch.call(this,b).done(g.resolve)},this)),g},sync:function(c,d,e){var f,g;switch(c){case"read":f="GET",g=b.result(this,"url");break;case"update":case"create":case"delete":throw new Error("PostCollection.sync(): unsupported method in sync")}return a.ajax(b.extend({type:f,dataType:"json",url:g},e))},parse:function(a){if(void 0===a||void 0===a.data||void 0===a.data.items||a.meta.success===!1)return[];if(this.pagination=a.data.pagination||{},b.isEmpty(this.pagination)&&a.data.hasOwnProperty("items")){var c,d=a.data.items;d.length&&d[0].hasOwnProperty("children")&&(c=d[0].children,this.pagination=c.pagination||this.pagination||{})}return void 0!==a.data.directReplyCount&&(this.listMeta.directReplyCount=a.data.directReplyCount),void 0!==a.contributors&&(this.listMeta.contributors=a.contributors),void 0!==a.data.meta&&(this.listMeta=b.extend({},this.listMeta,a.data.meta)),a.data.items}});return g}),define("model/post/Branch",["backbone","model/post/Post","collection/Post"],function(a,b,c){var d=a.Model.extend({defaults:{reply:new b,children:new c,branch:new c,branchType:"normal"},parse:function(a){var d;return a.isStarterAuthorBranch===!0&&(d="authorParticipated"),{id:a.reply.id,reply:new b(a.reply).prepareAnnotations(),children:new c(a.children.items),branch:new c(a.branch.items),branchType:d}},toJSON:function(){return{reply:this.get("reply").toJSON(),children:this.get("children").toJSON(),branch:this.get("branch").toJSON(),branchType:this.get("branchType")}}});return d}),define("templates/tiger/components/post/meta/meta-avatar-url",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.post.meta.metaAvatarUrl=function(a,c,e){var f=c||new d.StringBuilder;return f.append('	<div class="meta-container without-dropdown"><div class="meta-avatar"><div class="floated-container img-30"><div class="avatar">'),b.components.post.meta.avatarDisplay({avatar:a.avatarUrl},f,e),f.append('</div><div class="txt"><span class="display-name"><span class="js_user-display-name">'),a.displayName?f.append(d.$$escapeHtml(a.displayName)):b.components.post.meta.replyCallout(null,f,e),f.append("</span>",a.parentAuthorDisplayName?'<span class="replyto-author"><span class="icon icon-arrow-small-right text-light"></span><span class="js_author-display-name">'+d.$$escapeHtml(a.parentAuthorDisplayName)+"</span></span>":"",'</span></div><div class="second-line">Now</div></div></div></div>'),c?"":f.toString()},b.components.post.meta.replyCallout=function(a,b){var c=b||new d.StringBuilder;return c.append("You"),b?"":c.toString()}}),define("module/groupchats/view/OpenReplyForms",["jquery","underscore","backbone.marionette","singleton/Feature","singleton/Twitter","view/Spinner","singleton/Utils","templates/tiger/components/post/meta/avatar-display","templates/tiger/components/post/meta/meta-avatar-url"],function(a,b,c,d,e,f,g){var h={replyform:null,triggeredReply:!1,initReplyForms:function(){this.events=b.extend({"click .js_reply-to-selected-post":"replyToSelected","click .js_edit-reply":"editReply"},this.events),this.delegateEvents()},handleStarterInsert:function(){this.unhandleStarterInserts();var a=this.services.resolve("eventDispatcher");a.on("reply:openstarterform",this.insertNewStarter,this)},unhandleStarterInserts:function(){var a=this.services.resolve("eventDispatcher");a.off("reply:openstarterform",this.insertNewStarter,this)},_addCommentRegion:function(a,b){var d=a.commentRegion,e=d?d.currentView:!1;return(!e||e.confirmRemove())&&(d&&(d.reset(),d.off()),d=new c.Region({el:b}),a.addRegions({commentRegion:d})),d},_requireEditor:function(a){g.requireModuleWithCss("module/MarionetteEditor","editor",function(){require(["app/editor/editor.app","app/MarionetteApp"],a)})},replyToSelected:function(b){var c,d=this,e=a(b.currentTarget).closest(".js_reply"),f=parseInt(e.data("id"),10),g=this.services.resolve("PostModel",{args:{id:f}});return b.stopPropagation(),c=a('<div class"js_reply-form-container"></div>').insertAfter(e),this._requireEditor(function(a,b){var f=d._addCommentRegion(b,c);f.once("editor:post:save",function(a,b){e.trigger("approval",{approvedReplyIDs:b}),d.trigger("reply:insert",{$el:"",model:a})}),a.createComment(g)}),!1},insertNewStarter:function(b){var c,e=this,f=this.model,g=this.$el.find(".js_toggle-pending"),h=b.view;return this._requireEditor(function(b,i){c=d.isOn("hide_pending_replies")&&g.length?a("<div />").insertAfter(g):h.$el.find(".js_reply-form-container").length?h.$el.find(".js_reply-form-container"):a(".js_reply-form-container");var j=e._addCommentRegion(i,c);j.once("editor:post:save",function(a){e.trigger("reply:insert",{$el:"",model:a})}),b.createComment(f)}),!1},replyToPost:function(a){return this.closeEditorForm()?(this.closeReplyForm(a),!1):!1},editReply:function(b){var c,d=a(b.currentTarget).closest(".js_reply"),e=this;return c=a('<div class"js_reply-form-container"></div>').insertAfter(d),this._requireEditor(function(b,f){var g=e._addCommentRegion(f,c);g.once("editor:post:save",function(b){var c=a("#reply_"+b.id);c.find(".reply-content").html(b.display)}),b.editComment(d.data("id"))}),!1},createSpinner:function(b,c){return void 0===c&&(c="editor"),new f({fullscreen:b,initiallyVisible:1===a("head>meta[id="+c+"-css-url]").length})},closeReplyForm:function(){var a=this.replyform;if(a&&this.triggeredReply){if(!a.confirmRemove())return!1;a.remove()}},closeEditorForm:function(){var c=a("body").data("post-form");if(void 0!==c&&b.isFunction(c.confirmRemove)){if(!c.confirmRemove())return!1;c.remove(!0)}return!0},getFormAncestor:function(){return this.$elements.branchList}};return h}),define("templates/tiger/components/liveblog/post-list",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.liveblog.postList=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");for(var g=a.posts,h=g.length,i=0;h>i;i++){var j=g[i];f.append('<section id="liveblogpost-',d.$$escapeHtml(j.id),'" class="js_reply-branch branch">'),b.components.liveblog.post({post:j},f,e),f.append("</section>")}return c?"":f.toString()}}),define("app/LiveblogApplet",["jquery","underscore","lib/needly","view/BaseView","view/ExpandedBranchView","model/post/Branch","model/post/Post","collection/Post","singleton/EventDispatcher","singleton/Utils","singleton/Feature","singleton/CurrentUser","module/groupchats/view/OpenReplyForms","lib/amd-wrapped/jquery.scrollTo","lib/waypoints","templates/tiger/components/liveblog/post","templates/tiger/components/liveblog/post-list"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=d.extend(b.extend({},m,{pollInterval:10,pollTries:0,maxPollTries:1080,pollTimeout:null,remainingTimerInterval:null,remainingTimer:0,maximumPostsDisplayed:30,totalPostCount:null,has300Ad:!1,appRevision:null,events:{"click .js_expand-branch, .reply-content:not(.js_expanded .reply-content, .js_open-branch .reply-content)":"loadPermalink","click .js_pager":"loadMore"},initialize:function(){this.render(),this.fetchPosts(),this.getPostCount(),this.$elements={replyFormContainer:a(".post-wrapper article")},this.services=new c.Container,this.services.registerMany({currentUser:{type:"singleton",dependency:l},PostModel:{type:"class",dependency:g},eventDispatcher:{type:"singleton",dependency:i},feature:{type:"singleton",dependency:k},utils:{type:"singleton",dependency:j}}),this.initReplyForms(),this.handleStarterInsert(),i.on("reply:insert",this.insertReply,this)},render:function(){return this.$el.find(".js_top-message").html("Loading posts"),this},fetchPosts:function(){var b=new h([],{url:"/ajax/post/"+this.model.id+"/replies/live"});b.fetch({data:{maxReturned:this.maximumPostsDisplayed},success:a.proxy(this.handleUpdate,this),error:a.proxy(this._pollErrorHandler,this)})},fetchThread:function(b){var c=new h([],{url:"/ajax/post/"+b+"/replies/flat",model:f}),d={reset:!0,success:a.proxy(function(a){a.first().get("children").length>0&&this.displayThread(a)},this)};c.fetch(d)},updatePosts:function(){var b=new h([],{url:"/ajax/post/"+this.model.id+"/replies/live"});b.fetch({data:{maxReturned:5,newerThan:this.getFirstDisplayedTimestamp()},success:a.proxy(this.handleUpdate,this),error:a.proxy(this._pollErrorHandler,this)})},loadPermalink:function(b){if(j.clickedOnLink(b))return!0;if(k.isOn("liveblog_disable_replies"))return b.preventDefault(),!1;var c=a(b.currentTarget),d=c.parents(".js_reply-branch");return 0===d.find(".js_expanded").length&&this.fetchThread(c.parents(".js_liveblog-item").data("id")),!1},loadMore:function(){this.hidePager();var b=new h([],{url:"/ajax/post/"+this.model.id+"/replies/live"});return b.fetch({data:{maxReturned:this.maximumPostsDisplayed,olderThan:this.getLastDisplayedTimestamp()},success:a.proxy(this.handlePaging,this),error:a.proxy(this._pollErrorHandler,this)}),!1},insertReply:function(){window.setTimeout(a.proxy(this.updatePosts,this),500)},handleUpdate:function(b,c){if(b.length>0){var d,e=tiger.components.liveblog.postList,f=this.soyToHtml(e,{posts:b.toJSON()});this.$el.find(".js_postlist-shadow").html(f),d=this.$el.find(".js_postlist-shadow").children().hide().detach(),this.$el.find(".js_postlist").prepend(d),0===this.pollTries?d.fadeIn(50):(this.totalPostCount=this.totalPostCount+b.length,this.updatePostCount(),d.slideDown(300,a.proxy(function(){},this))),0===this.pollTries&&void 0!==c.data&&void 0!==c.data.pagination&&null!==c.data.pagination.next&&this.showPager()}0===this.pollTries?this.appRevision=c.data.appRevision:void 0!==c.data.appRevision&&this.appRevision!==c.data.appRevision&&window.location.reload(),this.pollTries=this.pollTries+1,void 0!==c.data.pollIntervalMillis&&(this.pollInterval=c.data.pollIntervalMillis/1e3),this.pollTries<this.maxPollTries?this.startNextPoll():this.displayPollMaxTries()},handlePaging:function(b,c){var d,e=tiger.components.liveblog.postList,f=this.soyToHtml(e,{posts:b.toJSON()});this.$el.find(".js_postlist-shadow").html(f),d=this.$el.find(".js_postlist-shadow").children().hide().detach(),this.$el.find(".js_postlist").append(d),d.slideDown(100,a.proxy(function(){void 0!==c.data&&void 0!==c.data.pagination&&null!==c.data.pagination.next&&this.showPager()},this))},displayThread:function(b){var c=a('<div class="js_open-branch open-branch" />'),d=new e({el:c,model:b.first()}),f=this.$el.find("#liveblogpost-"+b.first().get("reply").id);f.addClass("open"),f.find(">article").addClass("anchor"),c.addClass("toggled-replies"),d.on("removed",function(){f.removeClass("open"),f.find(">article").removeClass("anchor"),c.removeClass("toggled-replies")}),f.length>0?f.append(c):this.$el.find(".js_liveblog-permalink").append(c),d.render()},_pollErrorHandler:function(){this.pollInterval=2*this.pollInterval,this.pollInterval<120?this.startNextPoll():this.displayPollError()},startNextPoll:function(){this.stopPolling(),this.pollTimeout=window.setTimeout(a.proxy(this.updatePosts,this),1e3*this.pollInterval),this.remainingTimer=this.pollInterval,this.remainingTimerInterval=window.setInterval(a.proxy(this.displayNextPollTime,this),1e3)},stopPolling:function(){window.clearTimeout(this.pollTimeout),window.clearInterval(this.remainingTimerInterval)},getFirstDisplayedTimestamp:function(){return parseInt(this.$el.find(".js_postlist .js_liveblog-item:first").data("timestamp"),10)||0},getLastDisplayedTimestamp:function(){return parseInt(this.$el.find(".js_postlist .js_liveblog-item:last").data("timestamp"),10)||0},displayPollEnded:function(){},displayPollError:function(){},displayPollMaxTries:function(){this.stopPolling(),this.$el.find(".js_top-message").html("Automatic polling disabled, 3 hour timeout reached")},displayNextPollTime:function(){this.remainingTimer=this.remainingTimer-1,this.$el.find(".js_top-message").html("Next poll in "+this.remainingTimer+" seconds"),this.remainingTimer<=0&&window.clearInterval(this.remainingTimerInterval)},showPager:function(){var b=this.$el.find(".js_pager");b.removeClass("hide").waypoint("destroy"),b.waypoint(a.proxy(function(){b.waypoint("destroy"),this.loadMore()},this),{offset:"100%"})},hidePager:function(){this.$el.find(".js_pager").addClass("hide").waypoint("destroy")},getPostCount:function(){var b=new h([],{url:"/ajax/post/"+this.model.id+"/replies",model:f}),c={maxReturned:0,maxChildren:0,approvedChildrenOnly:!0,approvedStartersOnly:!0,startIndex:0},d=this,e=function(a){a.listMeta.directReplyCount.approved>0&&(d.totalPostCount=a.listMeta.directReplyCount.approved,d.updatePostCount())};b.fetch({data:c,success:a.proxy(e,this)})},updatePostCount:function(){var b=this.$el.find(".js_discussion-numbers"),c=this.$el.find(".js_post-updates");b.hasClass("hide")?(c.text(this.totalPostCount),b.removeClass("hide")):c.fadeOut(150,a.proxy(function(){c.text(this.totalPostCount).fadeIn(200)},this))},add300Ad:function(c){var d=a.parseParams(),e=180;void 0!==d.adupdate&&b.isNaN(parseInt(d.adupdate,10))===!1&&(e=parseInt(d.adupdate,10)),(c===!0||this.has300Ad===!1)&&(c===!0&&this.$el.find(".js_300-container .content-ad").remove(),this.has300Ad=!0,this.render300Ad(),window.setTimeout(a.proxy(function(){this.add300Ad(!0)},this),1e3*e))},render300Ad:function(){return!1}}));return n}),define("app/mixins/HighlightBox",["jquery","singleton/EventDispatcher"],function(a,b){var c={insertHighlightBox:function(c,d,e,f){var g=c===!1?d:a(c.target),h=Math.round(c===!1?g.width()*e/100:c.pageX-g.offset().left),i=Math.round(c===!1?g.height()*f/100:c.pageY-g.offset().top),j=g.width()-50,k=50,l=g.height()-50,m=50,n=Math.round((h>j?j-50:k>h?0:h-50)+g.offset().left),o=Math.round((i>l?l-50:m>i?0:i-50)+g.offset().top),p=c!==!1?" create-annotation":"",q='<div class="annotationHighlightBox'+p+'" style="top:'+o+"px; left:"+n+'px;"></div>';return c===!1?b.on("imageAnnotationsClose",function(){a(".annotationHighlightBox").remove()},this):b.on("removeReplyForm",function(){a(".annotationHighlightBox").remove()},this),a(".annotationHighlightBox").remove(),a("body").prepend(q),{top:o,left:n}}};return c}),define("app/mixins/AnnotatableParent",[],function(){var a={getAnnotatableParent:function(a){var b;return a.attr("data-textannotation-id")?a:(b=a.parents("data-textannotation-id"),b.length?b:a)}};return a}),define("apiclient/annotation",["config","singleton/Feature","apiclient/apirequest"],function(a,b,c){var d,e="items(id,imageChompId,annotationTextHash,annotationType,x,y,reply(approved,permalink,excerptWithAssets,display,author(avatar(id,format),defaultBlogId,displayName),blogs))";return d={getAnnotations:b.isOn("reduced_annotations")?c.getJson(a.api.core.url+"/annotation/starter/{{starterId}}",{filterDismissed:!0,include:e}):c.getJson(a.api.core.url+"/annotation/starter/{{starterId}}",{filterDismissed:!0})}}),define("templates/tiger/components/annotation",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.annotation.newSingleAnnotation=function(a,c,e){var f=c||new d.StringBuilder;return f.append('<span class="js_annotation-footnote annotation-footnote" data-annotation-id="',d.$$escapeHtml(a.reply.id),'"',null!=a.x&&null!=a.y?' data-annotation-x="'+d.$$escapeHtml(a.x)+'" data-annotation-y="'+d.$$escapeHtml(a.y)+'" data-image-chompid="'+d.$$escapeHtml(a.imageChompId)+'" data-annotation-type="image"':' data-annotation-type="text" ',' ><a href="',d.$$escapeHtml(a.reply.permalink),'" class="js_annotation-footnote-link annotation-footnote-link proxima">P</a>'),b.components.annotation.annotationInset(a,f,e),f.append("</span>"),c?"":f.toString()},b.components.annotation.annotationInset=function(a,c,e){var f=c||new d.StringBuilder,g=e.features.hide_pending_replies&&a.reply&&!(null==a.reply?null:a.reply.approved);f.append('<div class="annotation-inset-under js_annotation-inset-',d.$$escapeHtml(a.id),' hide" data-annotation-id="',d.$$escapeHtml(a.id),'"><div class="hide-annotation right cursor-pointer" id="annotation_',d.$$escapeHtml(a.id),'"><span class="icon icon-x-small"></span></div><div class="annotation-content">'),g&&!(null==a.reply?null:a.reply.newpost)?(b.components.groupchats.unapprovedAnnotationWarning(null,f,e),f.append('<div class="js_annotation-content hide">')):f.append('<div class="js_annotation-content">'),f.append(d.$$filterNoAutoescape(a.reply.excerptWithAssets),'<footer class="row proxima"><div class="medium-8 columns"><span class="floated-container img-30"><span class="avatar">');var h=new d.StringBuilder("avt-large");h=h.toString(),f.append('<span class="img-border mbn mrm"><img src="',d.$$escapeHtml(window.kinja.imageUrl(a.reply.author.avatar.id,h,a.reply.author.avatar.format)),'" class="avatar" alt="" /></span></span><span class="txt blogname proxima text-upper text-strong text-light txt-30">');for(var i=new d.StringBuilder,j=a.reply.blogs,k=j.length,l=0;k>l;l++){var m=j[l];i.append(m.id==a.reply.author.defaultBlogId?'<a class="text-light" href="http://'+d.$$escapeHtml(m.canonicalHost)+'" target="_self">'+d.$$escapeHtml(a.reply.author.displayName)+"</a>":"")}return i=i.toString(),f.append(i?d.$$filterNoAutoescape(i):d.$$escapeHtml(a.reply.author.displayName),'</span></span></div><div class="medium-4 columns medium-text-right text-center txt-30"><a class="text-light text-small view-discussion" href="',d.$$escapeHtml(a.reply.permalink),'">View discussion&nbsp;&gt;&gt;</a></div></footer></div></div></div>'),c?"":f.toString()}}),define("app/AnnotationApplet",["jquery","underscore","lib/needly","view/BaseView","model/post/Post","singleton/EventDispatcher","singleton/Utils","singleton/Feature","app/mixins/HighlightBox","app/mixins/AnnotatableParent","module/groupchats/view/OpenReplyForms","apiclient/annotation","templates/tiger/components/annotation"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=a(window),n=640,o=d.extend(b.extend({},i,j,k,{annotationsFootnotesMax:5,_annotationTypeImage:"image",annotationApiResult:null,events:{"click .js_annotation-footnote-link":"toggleAnnotation","click .hide-annotation":"hideAllAnnotations","click .ellipsis":"expandFootnotes","click .js_text-annotate":"annotateHandler","click .js_annotatable-image":"annotateHandler","click .js_pending-reply-switch":"showPending"},initialize:a.noop,startApp:function(){this.isMobile=m.width()<=n,this.allowReplies=this.model.get("allowReplies")&&!a("body").hasClass("read-only"),(!this.isMobile||h.isOn("mobileannotation"))&&(this.model.get("liveBlog")||(a(".post-content").addClass("new-annotation"),!this.allowReplies||this.isMobile?this.enableImageAnnotations(!0):this.enableImageAnnotations(),this.model&&this.model.get("isStarter")===!0&&(this.model.on("AnnotationCreated",function(a){this.addNewAnnotation(a)},this),this.annotationApiResult=l.getAnnotations({starterId:this.model.get("starterId")}).then(function(a){return a.items}),this.getAnnotationReplies({type:"starter",discussions:!0})),this.model.on("annotation:remove",this.removeAnnotation.bind(this)),f.on("annotation:fromReplies",this.getAnnotationReplies.bind(this))))},getAnnotationReplies:function(a){this.annotationApiResult.done(function(c){var d;d="permalink"===a.type?b.filter(c,function(b){return b.replyId===a.replyId}):a.discussions?b.filter(c,function(a){return a.reply.approved}):c,this.renderAnnotations(d)}.bind(this))},renderAnnotations:function(c){var d,e=this,f=c,g=b.where(f,{annotationType:this._annotationTypeImage.toUpperCase()});this.$(".annotation-footnote-wrapper").empty(),g.length&&(d=b(g).filter(function(a){return a.reply}),b(d).each(function(b){var c=b.imageChompId,d=a('[data-chomp-id="'+c+'"]').parents(".has-image");0===d.children(".annotation-footnote-wrapper").length&&d.append('<span class="annotation-footnote-wrapper clearfix"></span>'),d.children(".annotation-footnote-wrapper").append(e.renderAnnotationTemplate(b))})),this.updateFotenoteNumbers(),this.addEllipsis()},renderAnnotationTemplate:function(a){var b=this.soyToHtml(tiger.components.annotation.newSingleAnnotation,a);return b},addEllipsis:function(){var c=this,d=a(".annotation-footnote-wrapper");b.each(d,function(d){var e=a(d),f=e.find(".annotation-footnote"),g=f.length;b.each(f,function(b,d){d>c.annotationsFootnotesMax-1&&d!==g-1&&a(b).addClass("ellipsable hide")}),g>c.annotationsFootnotesMax+1&&0===e.find(".ellipsis").length&&f.last().before('<span class="ellipsis">...</span>')})},updateFotenoteNumbers:function(){var c=a(".js_annotation-footnote-link");a(c).length&&b.each(c,function(b,c){a(b).html(c+1)})},expandFootnotes:function(b){var c=a(b.target);c.siblings(".ellipsable").removeClass("hide"),c.remove()},toggleAnnotation:function(b){var c=a(b.target),d=c.parents(".annotation-footnote");b.preventDefault(),d.hasClass("selected")?this.hideAllAnnotations():this.openAnnotation(b,d)},openAnnotation:function(b,c){var d,e,f=this;this.hideAllAnnotations(),c.addClass("selected").find(".annotation-inset-under").removeClass("hide"),c.data("annotation-type")===this._annotationTypeImage&&(d=c.data("image-chompid"),e=a('[data-chomp-id="'+d+'"]'),this.insertHighlightBox(!1,e,c.data("annotation-x"),c.data("annotation-y"))),m.on("keyup.hideAnnotations",function(a){(void 0!==a.keyCode&&27===a.keyCode||void 0!==a.which&&27===a.which)&&f.hideAllAnnotations()}),m.on("click.hideAnnotations",function(b){0===a(b.target).parents(".annotation-footnote-wrapper").length&&f.hideAllAnnotations()})},hideAllAnnotations:function(b){b&&b.stopPropagation(),a(".annotation-footnote").removeClass("selected"),a(".annotation-inset-under").addClass("hide"),this.closeReplyForm(),a(".annotationHighlightBox").length&&a(".annotationHighlightBox:not(.create-annotation)").remove(),m.off("keyup.hideAnnotations"),m.off("click.hideAnnotations")},enableImageAnnotations:function(c){var d,e=a('article:not(reframe-post) img[data-chomp-id][src!=""]'),f=[];if(e.length){for(d=0,e;d<e.length;d+=1)f.push(a(e[d]).data("chomp-id"));b.each(b.unique(f),function(b){var d=a("[data-chomp-id="+b+"]").first();c||d.closest("a").length||d.addClass("js_annotatable-image cursor-crosshair")})}},annotateHandler:function(b){var d,i,j,k,l,n,o,p,q,r,s,t,u,v=this,w=a(b.target).hasClass("js_annotatable-image")?"image":"text",x=a(b.currentTarget);return this.hideAllAnnotations(),"image"===w&&(j=x.offset(),k=x.width(),l=x.height(),n=x.attr("width"),o=x.attr("height"),p=x.data("asset-url"),q=x.data("chomp-id"),r=b.pageX-j.left,s=b.pageY-j.top,t=Math.round(r/k*100),u=Math.round(s/l*100),d=function(a){a.$el.find(".reply-annotation").remove(),a.$el.find("input.js_annotationType").val("IMAGE"),a.$el.find("input.js_imageUrl").val(p),a.$el.find("input.js_imageChompId").val(q),a.$el.find("input.js_imageWidth").val(n?n:k),a.$el.find("input.js_imageHeight").val(o?o:l),a.$el.find("input.js_x").val(t),a.$el.find("input.js_y").val(u)
}),i=function(d){v.closeReplyForm(),v.services=new c.Container,v.services.registerMany({PostModel:{type:"class",dependency:e},eventDispatcher:{type:"singleton",dependency:f},feature:{type:"singleton",dependency:h},utils:{type:"singleton",dependency:g}}),v._requireEditor(function(c,e){var f=v._addCommentRegion(e,a('<div class="js_replyform "/>').css({position:"absolute",top:0}).prependTo("body"));f.once("editor:post:save",function(a){v.addNewAnnotation({model:a})}),c.annotatePost(d,b,w)})},w===v._annotationTypeImage&&i(this.model),m.on("keyup.hideAnnotations",function(a){(void 0!==a.keyCode&&27===a.keyCode||void 0!==a.which&&27===a.which)&&v.hideAllAnnotations()}),m.on("click.hideAnnotations",function(b){0===a(b.target).parents(".replyform").length&&v.hideAllAnnotations()}),!1},addNewAnnotation:function(c){b.defaults(c.model,{get:function(a){return this[a]}});var d,e,f,g=c.model,h=g.get("imageChompId"),i=g.get("annotationType").toLowerCase(),j={id:g.id,x:g.get("x")?g.get("x"):null,y:g.get("y")?g.get("y"):null,imageChompId:h,reply:{permalink:g.get("permalink"),excerptWithAssets:g.get(g.get("excerptWithAssets")?"excerptWithAssets":"display"),author:g.get("author"),blogs:g.get("blogs"),id:g.id,newpost:!0}};i.toLowerCase()===this._annotationTypeImage&&(d=a('[data-chomp-id="'+h+'"]'),f=d.parents(".has-image"),e=f.find(".annotation-footnote-wrapper"),e.length?e.append(this.renderAnnotationTemplate(j)):(f.append('<span class="annotation-footnote-wrapper clearfix"></span>'),f.find(".annotation-footnote-wrapper").append(this.renderAnnotationTemplate(j))),this.insertHighlightBox(!1,d,g.get("x"),g.get("y"))),a('[data-annotation-id="'+g.get("id")+'"]').removeClass("hide").parents(".js_annotation-footnote").addClass("selected"),this.updateFotenoteNumbers(),this.addEllipsis()},removeAnnotation:function(b){a('[data-annotation-id="'+b+'"]').remove(),this.updateFotenoteNumbers(),this.addEllipsis()},showPending:function(b){b.preventDefault();var c=a(b.target).parents(".annotation-content");c.find(".js_toggle-pending").addClass("hide"),c.find(".js_annotation-content").removeClass("hide")}}));return o}),define("singleton/util/hostname",[],function(){function a(a){return a.replace(/^www\./,"")}function b(a){var b=a.lastIndexOf(".");return-1===b?a:a.substring(0,b)}function c(c){return a(b(c))===b(d)}var d;return d=a(window.location.host),{removeWWW:a,sameHost:c}}),define("singleton/util/externalLinks",["singleton/util/hostname"],function(a){return{openInNewTabs:function(b){b.find("a").each(function(b,c){a.sameHost(c.hostname)||c.setAttribute("target","_blank")})}}}),define("templates/tiger/components/post/inset/referenced-messages",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.post.inset.messages.relatedfromandmore=function(a,b){var c=b||new d.StringBuilder;return c.append("	Related from ",d.$$escapeHtml(a.domain)," and more..."),b?"":c.toString()},b.components.post.inset.messages.relatedfrom=function(a,b){var c=b||new d.StringBuilder;return c.append("	Related from ",d.$$escapeHtml(a.domain)),b?"":c.toString()}}),define("singleton/PostInsetTools",["underscore","jquery","singleton/Renderer","singleton/Utils","singleton/Feature","singleton/util/hostname","singleton/util/externalLinks","templates/tiger/components/post/inset/referenced-messages"],function(a,b,c,d,e,f,g){function h(){this.insetsToShow=1}var i;return h.prototype={render:function(a){var b;b=a.find(".js_inset"),g.openInNewTabs(b),this.markExternalInsets(b),this.setInsetsHeight(b),this.hideEmptyThumbnails(a),this.initEvents(a)},initEvents:function(a){a.find(".js_next_inset").off("click.inset").on("click.inset",b.proxy(function(a){this._changeInset(a,"next")},this)),a.find(".js_previous_inset").off("click.inset").on("click.inset",b.proxy(function(a){this._changeInset(a,"prev")},this))},_changeInset:function(c,d){var e,f,g,h,i,j,k,l,m=b(c.target).closest(".referenced-wide"),n=m.find(".referenced-item:not(.hide)");return e=function(a){var c=b.Deferred();return a.fadeIn(200,function(){b(this).removeClass("hide"),c.resolve()}),c.promise()},f=function(a){var c=b.Deferred();return a.fadeOut(200,function(){b(this).addClass("hide"),c.resolve()}),c.promise()},g=a.bind(function(){i=n.last().nextAll(".referenced-item:lt("+this.insetsToShow+")"),j=n.slice(0,i.length),m.find(".js_previous_inset").removeClass("hide"),n.nextAll(".referenced-item").length<=this.insetsToShow&&m.find(".js_next_inset").addClass("hide")},this),h=a.bind(function(){i=n.first().prevAll(".referenced-item:lt("+this.insetsToShow+")"),j=n.slice(-1*i.length),m.find(".js_next_inset").removeClass("hide"),n.prevAll(".referenced-item").length<=this.insetsToShow&&m.find(".js_previous_inset").addClass("hide")},this),"next"===d?g():h(),i.length>0&&j.length>0&&(k=e(i),l=f(j),b.when.call(b,k,l).then(a.bind(function(){this.setCarouselHeight(i,m.find(".js_next_inset"),m.find(".js_previous_inset"))},this))),!1},setInsetsHeight:function(c){c.find(".js_next_inset").each(a.bind(function(a,c){var d=b(c),e=d.parents(".js_inset").find(".referenced-item").first();this.setCarouselHeight(e,d)},this))},setCarouselHeight:function(a,b,c){function d(a,b){a&&a.find("a").css({height:b,"line-height":b+"px"})}var e,f,g;e=a.find(".referenced-item-image").innerHeight(),f=a.find(".headline").innerHeight()+a.find(".referenced-item-excerpt").innerHeight(),g=Math.max(e,f,25),d(b,g),d(c,g)},hideEmptyThumbnails:function(a){var c=a.find(".referenced-item img");c.each(function(a,c){function d(){c.naturalHeight&&c.naturalWidth||f.addClass("hide")}var e=b(c),f=e.parents(".referenced-item-image");c.complete?d():e.load(d)})},markExternalInsets:function(c){function e(a,b){var c,d,e,g,h=a.find('a:not(".js_skip-inset")').get(0);h&&(f.sameHost(h.hostname)||(c=b[b.push(f.removeWWW(h.hostname))-1],d=a.find(".js_readmore"),e=d.find(".js_external-text").text(),e&&(g='<span class="hostname">'+c.split(".").join(".&#x200b;")+"</span>",d.html(e+" "+g))))}c.each(a.bind(function(c,f){var g,h=b(f),i=[];h.find(".referenced-item").each(function(a,c){e(b(c),i)}),i.length&&(g=a.uniq(i).length>1?tiger.components.post.inset.messages.relatedfromandmore:tiger.components.post.inset.messages.relatedfrom,g=this.soyToHtml(g,{domain:d.getMainDomain(i[0])}),h.find(".js_referenced-label").html(g))},this))},soyToHtml:function(a,b,e){var f=d.getRenderableData(b,e);return c.renderTemplate(a,f.data,f.injected)}},i||(i=new h)}),define("gawkerlib/lightboxer",["jquery","underscore","view/BaseView","singleton/Utils","singleton/Feature","lib/amd-wrapped/jquery.lightbox-0.5","templates/tiger/icons/essential/usage"],function(a,b,c,d,e){function f(c){var f=c.find(".lightBoxWrapper .img-border img"),g=c.find(".lightBox");b.each(f,function(b){var c=a(b);c.attr("data-original-src",d.imageUrl(c.data("chomp-id"),"original",c.data("format")))}),e.isOn("svgicons")&&g.find(".icon-search-plus").replaceWith(a.trim(tiger.icons.essential.zoomIn())),g.removeClass("hide").lightBox()}return f}),define("app/post/common/post.layout",["jquery","underscore","backbone.marionette","singleton/CurrentUser"],function(a,b,c,d){var e=c.Layout.extend(b.extend({regions:{post:".post"},ui:{likeButton:".js_like",likeIcon:".js_like_icon",recommendedIcon:".js_recommend-icon",likeCountPlaceholder:".js_like_count",replyButton:".js_reply-to-post",metaContainer:".meta-container"},triggers:{"click @ui.likeButton":"posttools:like","click @ui.replyButton":"posttools:reply"},events:{approval:"_removePendingStyling"},modelEvents:{"change:liked":"_updateLikeIconClasses","posttools:post:likeCount:updated":"_updateLikeCount"},initialize:function(){this.listenTo(d,"authenticated",this._updateLikeIconClasses),this.listenTo(d,"logoutReset",this._removeLikeIconClass),d.onAuth.done(function(){this.bindUIElements(),d.isLoggedIn()?this._updateLikeIconClasses():this._removeLikeIconClass()}.bind(this))},togglePostToolsVisibility:function(a){this.ui.metaContainer.toggleClass("without-dropdown",a)},_removePendingStyling:function(a,c){var d=this.$el.closest(".js_branch-list");b.each(c.approvedReplyIDs,function(a){d.find("#reply_"+a).removeClass("unapproved")})},_updateLikeIconClasses:function(){this.ui.likeIcon.toggleClass("active",this.model.get("liked")),this.ui.recommendedIcon.toggleClass("active",this.model.get("liked"))},_removeLikeIconClass:function(){this.ui.likeIcon.removeClass("active"),this.ui.recommendedIcon.removeClass("active")},_updateLikeCount:function(){var a=parseInt(this.ui.likeButton.data("likecount"),10)||0,b=a>0;a=this.model.get("liked")?a+1:b?a-1:0,this.ui.likeButton.data("likecount",a),this.ui.likeCountPlaceholder.text(a||"")}}));return e}),define("app/post/mixins/post.confirmationPrompt",["jquery","singleton/Renderer"],function(a,b){var c={_confirmationPrompt:function(c,d){return window.confirm(a(b.renderTemplate(c,d||{})).text())}};return c}),define("app/post/mixins/post.userPermissionsHelper",["singleton/Feature","singleton/CurrentUser","singleton/CurrentBlog"],function(a,b,c){return{canEditPost:function(c){var d=15,e=function(a){var b=new Date(a+60*d*1e3),c=new Date;return b>c},f=b.isLoggedIn(),g=b.id===c.get("authorId"),h=b.hasRole("OWNER",c.get("defaultBlogId")),i=b.hasRole("ADMIN",c.get("defaultBlogId")),j=c.has("parentId"),k=f&&(g||h||i)&&!j,l=f&&j&&g&&e(c.get("publishTimeMillis"));return b.isSuperuser()&&a.isOn("superuser")||k||l},canDeletePost:function(a){var c=b.isLoggedIn(),d=b.id===a.get("authorId"),e=b.hasRole("OWNER",a.get("defaultBlogId")),f=a.has("parentId");return c&&(d||e)&&!f},canInviteToPostManually:function(c){return a.isOn("invitetoken")&&c.get("authorId")===b.id},canPromote:function(){return b.hasPermission("SALES")||b.isSuperuser()&&a.isOn("superuser")||b.hasGMGRole("ADMIN")},canDismissPost:function(d){var e=b.hasRole("ADMIN",c.id)||b.hasRole("ADMIN",d.get("defaultBlogId")),f=b.id===d.get("authorId"),g=b.id===d.get("parentAuthorId"),h=d.has("parentId");return h&&(b.isSuperuser()&&a.isOn("superuser")||!f&&(e||g))},canUnshareRepostedPost:function(){return b.hasRole("ADMIN",c.id)},canBlock:function(a){return this.userIsOwner(a)||this.userIsAdmin(a)||this.userIsSuper()},canSharePost:function(){return b.isLoggedIn()},userIsAuthor:function(a){return b.hasRole("AUTHOR",a.get("defaultBlogId"))&&b.id!==a.get("authorId")},userIsOwner:function(a){return b.hasRole("OWNER",a.get("defaultBlogId"))&&b.id!==a.get("authorId")},userIsAdmin:function(a){return b.hasRole("ADMIN",a.get("defaultBlogId"))&&b.id!==a.get("authorId")},userIsSuper:function(){return b.isSuperuser()&&a.isOn("superuser")}}}),define("app/post/mixins/post.userPermissions",["underscore","app/post/mixins/post.userPermissionsHelper"],function(a,b){var c=["canEditPost","canDeletePost","canInviteToPostManually","canPromote","canDismissPost","canUnshareRepostedPost","canBlock","canSharePost","userIsAuthor","userIsOwner","userIsAdmin","userIsSuper"];return a.reduce(c,function(c,d){return c[d]=a.wrap(b[d],function(a){return a.call(this,this.model)}),c},{})}),define("app/post/common/post.menuitemview",["backbone.marionette"],function(a){var b=a.ItemView.extend({_show:function(){this.$el.removeClass("hide")},_hide:function(){this.$el.addClass("hide")},_isDisabled:function(){return!1},_canShow:function(){throw new Error("method _canShow not implemented!")},onRender:function(){this._canShow()?(this._show(),this._isDisabled()?this.$el.addClass("disabled"):this.$el.removeClass("disabled")):this._hide()}});return b}),define("app/post/posttools/view/posttools.menuitemview",["underscore","backbone.marionette","app/post/mixins/post.userPermissions","app/post/mixins/post.confirmationPrompt","app/post/common/post.menuitemview"],function(a,b,c,d,e){var f=e.extend(a.extend({},c,d,{_canShow:function(){var b=this,c=function(a){return b[a]};return a.chain(this.permissions).map(c).invoke("call",this).all().value()},render:function(){return this.isClosed=!1,this.triggerMethod("before:render",this),this.triggerMethod("item:before:render",this),this.bindUIElements(),this.triggerMethod("render",this),this.triggerMethod("item:rendered",this),this}}));return f}),define("app/post/posttools/view/posttools.editview",["app/post/posttools/view/posttools.menuitemview","singleton/Feature","singleton/Utils"],function(a,b,c){var d=a.extend({permissions:["canEditPost"],onRender:function(){var d=b.isOn("editor_own_page_test")?window.location.search:"",e=this.$el.find("a");a.prototype.onRender.call(this,arguments),e.attr("href","//"+c.getKinjaHost()+"/write/"+this.model.id+d)}});return d}),define("app/post/posttools/view/posttools.editreplyview",["app/post/posttools/view/posttools.menuitemview"],function(a){var b=a.extend({permissions:["canEditPost"]});return b}),define("app/post/posttools/view/posttools.deleteview",["app/post/posttools/view/posttools.menuitemview"],function(a){var b=a.extend({permissions:["canDeletePost"],triggers:{click:"posttools:delete"}});return b}),define("apiclient/invite",["config","apiclient/apirequest","apiclient/gettoken"],function(a,b,c){return{addInvite:b.postJson(c.append(a.api.core.url+"/invite")),requestInviteToken:b.postJson(c.append(a.api.core.url+"/invite/create?postId={{postId}}")),approveInvitedCommenter:b.postJson(a.api.core.url+"/invite/approve")}}),define("templates/tiger/components/invites/modals",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.invites.modals.inviteToPostManually=function(a,b){var c=b||new d.StringBuilder;return c.append('	<form class="invite-to-post-form js_invite-to-post-form"><div class="row"><div class="columns"><input type="url" class="mbn js_invite-manually-field" value="',d.$$escapeHtml(a.permalink),"?invite=",d.$$escapeHtml(a.inviteUid),'" autofocus /></div></div></form>'),b?"":c.toString()}}),define("view/forms/invite/InviteToPostManuallyModalView",["jquery","backbone","underscore","backbone.marionette","singleton/CurrentUser","singleton/EventDispatcher","templates/tiger/components/invites/modals"],function(a,b,c,d,e,f){var g=d.ItemView.extend({id:"modal-invite-to-post-manually",template:tiger.components.invites.modals.inviteToPostManually,ui:{inviteToPostManuallyField:"#js_invite-to-post-manually-field"},initialize:function(){f.on("modal:login:close",this.close,this)}});return g}),define("app/invites/behaviors/invites.token.posttools",["jquery","underscore","backbone","backbone.marionette","singleton/CurrentUser","apiclient/invite","app/modal/modal.controller","view/forms/invite/InviteToPostManuallyModalView"],function(a,b,c,d,e,f,g,h){var i=d.Behavior.extend({events:{click:"onInviteModalToPostManuallyOpen"},onInviteModalToPostManuallyOpen:function(a){a.preventDefault(),f.requestInviteToken({postId:this.view.model.id}).done(function(a){var b=g.instantiate(h,{templateData:{permalink:this.view.model.get("permalink"),inviteUid:a.inviteUid}});g.create(b,{name:"invite",className:"reveal-modal kinja-modal small proxima"})}.bind(this))}});return i}),define("app/post/posttools/view/posttools.invitemanuallyview",["app/post/posttools/view/posttools.menuitemview","app/invites/behaviors/invites.token.posttools"],function(a,b){var c=a.extend({permissions:["canInviteToPostManually"],behaviors:{InvitesTokenPostTools:{behaviorClass:b}}});return c}),define("app/post/posttools/view/posttools.dismissview",["jquery","app/post/posttools/view/posttools.menuitemview","singleton/CurrentUser","singleton/Utils"],function(a,b,c,d){var e=b.extend({permissions:["canDismissPost"],ui:{dismissButton:"a.dismiss",undismissButton:"a.undismiss"},triggers:{"click @ui.dismissButton":"posttools:dismiss","click @ui.undismissButton":"posttools:undismiss"},modelEvents:{"change:actionState":"_finishRender"},_finishRender:function(){this._setDismissState(),b.prototype.onRender.call(this)},_setDismissState:function(){var a=this.model.get("actionState"),b=this.model.get("defaultBlogId");a=a?a[b]:"","dismiss"===a?(this.$el.removeClass(".js_dismiss").addClass("js_undismiss"),this.ui.dismissButton.addClass("hide"),this.ui.undismissButton.removeClass("hide")):(this.$el.removeClass(".js_undismiss").addClass("js_dismiss"),this.ui.undismissButton.addClass("hide"),this.ui.dismissButton.removeClass("hide"))},onRender:function(){var a,b,e=this;"permalink"===d.getKinjaMeta().pageType?(a=parseInt(d.getKinjaMeta().postId||0,10),b=parseInt(d.getKinjaMeta().starterId||0,10),a!==b&&a===this.model.id?c.onAuth.always(function(){c.isLoggedIn()?e.triggerMethod("posttools:getDismissState",{model:e.model}):e._finishRender()}):this._finishRender()):this._finishRender()}});return e}),define("app/post/posttools/view/posttools.promoteview",["app/post/posttools/view/posttools.menuitemview","singleton/Utils"],function(a,b){var c=a.extend({permissions:["canPromote"],triggers:{click:"posttools:promote"},onPosttoolsOpened:function(){var a=this.model&&parseInt(b.getKinjaMeta().postId,10)===this.model.get("sharedPostId");a&&this.$el.addClass("hide")}});return c}),define("app/post/posttools/view/posttools.blockview",["jquery","underscore","backbone.marionette","app/post/posttools/view/posttools.menuitemview","app/post/posttools/posttools.controller","singleton/CurrentUser"],function(a,b,c,d,e,f){var g=d.extend({permissions:["canBlock"],events:{click:"_blockBlog"},modelEvents:{"posttools:checkedBlockability":"_setDisabledState","posttools:blockStatusUpdated":"_finishRender"},collectionEvents:{"posttools:block posttools:unblock sync":"_checkBlockStatus"},_checkBlockStatus:function(){this.triggerMethod("posttools:checkBlockStatus",{model:this.model,collection:this.collection})},_blockBlog:function(a){a.preventDefault(),this.triggerMethod("posttools:block",{model:this.model,collection:this.collection,targetBlogName:this._getTargetBlogName()}),this.$el.siblings(".js_unfollowforblog").addClass("hide"),this.$el.siblings(".js_followforblog").removeClass("hide"),this.$el.siblings(".js_unfollowforuser").addClass("hide"),this.$el.siblings(".js_followforuser").removeClass("hide")},_correctBlockText:function(a){var b=this.$el.find("span"),c=b.text(),d=a?"Unblock":"Block";d=c.replace(/Unblock|Block/,d),b.text(d)},_setDisabledState:function(a){this.$el.toggleClass("disabled",!a)},_finishRender:function(a){this._correctBlockText(a),d.prototype.onRender.call(this)},_getTargetBlogName:function(){return this.$el.data("targetblogname")},onPosttoolsOpened:function(){var a=this;f.onAuth.always(function(){a.triggerMethod("posttools:checkBlockability",{model:a.model})})},onRender:function(){var a=this;f.onAuth.always(function(){a._canShow()?a._checkBlockStatus():a._hide()})}});return g}),define("app/post/posttools/view/posttools.hideview",["app/post/posttools/view/posttools.menuitemview"],function(a){var b=a.extend({permissions:["userIsSuper"],triggers:{click:"posttools:hide"}});return b}),define("app/post/posttools/view/posttools.kinjashareview",["app/post/posttools/view/posttools.menuitemview","singleton/Utils"],function(a,b){var c=a.extend({permissions:[],triggers:{click:"posttools:kinjaShare"},onPosttoolsOpened:function(){var a=this.model&&parseInt(b.getKinjaMeta().postId,10)===this.model.get("sharedPostId");a&&this.$el.addClass("hide")}});return c}),define("app/post/posttools/view/posttools.kinjaunshareview",["app/post/posttools/view/posttools.menuitemview"],function(a){var b=a.extend({permissions:["canSharePost","canUnshareRepostedPost"],triggers:{click:"posttools:undorepost"}});return b}),define("app/post/posttools/view/posttools.externalshareview",["jquery","app/post/posttools/view/posttools.menuitemview"],function(a,b){var c=b.extend({permissions:[],ui:{sharePostButton:".js_share-post-item"},triggers:{"click @ui.sharePostButton":"posttools:externalShare"},onRender:function(){var b=function(b){return a("<div/>").html(b).text()},c=function(a){return a?a.replace(/&#(\d+);/g,function(a,b){return String.fromCharCode(b)}):""},d=this.model.get("headline")||this.model.get("first100Characters")||this.model.get("compact"),e=this.ui.sharePostButton.attr("href");this.ui.sharePostButton.attr("href",e.replace("POST_TITLE",encodeURIComponent(b(c(d)))))}});return c}),define("templates/tiger/components/post/button/repost-block",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.post.button.repostBlock=function(a,b){a=a||{};var c=b||new d.StringBuilder;if(c.append("	",1==a.repostedToPersonal?'<li><a href="#" class="js_undorepost pvs" data-blogid="'+d.$$escapeHtml(a.personalBlogId)+'"><span class="txt">Undo repost to Personal blog</span></a></li>':""),a.blogsUndo)for(var e=a.blogsUndo,f=e.length,g=0;f>g;g++){var h=e[g];c.append('<li><a href="#" class="js_undorepost pvs" data-blogid="',d.$$escapeHtml(h.id),'"><span class="txt">Undo repost to ',d.$$escapeHtml(h.name),"</span></a></li>")}if(c.append('<li class="js_repostheader repostheader ptm"><span class="icon icon-share mrs"></span><span class="txt text-upper">Share to:</span></li>',!a.personalBlogId||a.kinjaShare||a.repostedToPersonal?"":'<li><a href="#" class="js_repost pvs" data-blogid="'+d.$$escapeHtml(a.personalBlogId)+'"><span class="txt">Personal blog</span></a></li>',a.kinjaShare?'<li><a href="#" class="js_kinja-share pvs"><span class="txt">Kinja</span></a></li>':""),a.blogsRepost)for(var i=a.blogsRepost,j=i.length,k=0;j>k;k++){var l=i[k];c.append('<li><a href="#" class="js_repost pvs" data-blogid="',d.$$escapeHtml(l.id),'"><span class="txt">',d.$$escapeHtml(l.name),"</span></a></li>")}return b?"":c.toString()},b.components.post.button.repostBlockWrapped=function(a,c,e){var f=c||new d.StringBuilder;return f.append('	<li class="repostblock js_repostblock"><ul>'),b.components.post.button.repostBlock(a,f,e),f.append("</ul></li>"),c?"":f.toString()},b.components.post.button.repostBlockMarionette=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	<ul>"),b.components.post.button.repostBlock(a,f,e),f.append("</ul>"),c?"":f.toString()}}),define("app/post/posttools/view/posttools.repostview",["jquery","underscore","backbone.marionette","app/post/posttools/view/posttools.menuitemview","app/post/posttools/posttools.controller","singleton/CurrentUser","singleton/Feature","singleton/Utils","templates/tiger/components/post/button/repost-block"],function(a,b,c,d,e,f,g,h){var i=d.extend({permissions:["canSharePost"],template:tiger.components.post.button.repostBlockMarionette,events:{"click .js_repost":"repostPost","click .js_undorepost":"undoRepost"},modelEvents:{"change:actionState":"render"},serializeData:function(){var a,c,d,e=[],h=[],i=[];return b.each(this.model.get("actionState"),function(a,b){"repost"===a&&e.push(parseInt(b,10))}),a=f.get("defaultBlogId"),c=this.model.get("defaultBlogId"),f.get("membership").each(function(c){c.get("blogId")===a||"ENABLED"!==c.get("blog").status&&"SPAM"!==c.get("blog").status||(-1!==b.indexOf(e,c.get("blog").id)?i.push({name:c.get("blog").displayName,id:c.get("blog").id}):h.push({name:c.get("blog").displayName,id:c.get("blog").id}))},this),d={personalBlogId:a,repostedToPersonal:-1!==b.indexOf(e,a)?!0:!1,currentPostDefaultBlogId:c,kinjaShare:!1,blogsRepost:h,blogsUndo:i},g.isOn("replywithshare")&&(d.kinjaShare=!0),a!==c&&(d.personalBlogId=a),d},repostPost:function(b){b.preventDefault(),this.trigger("posttools:repost",this.model,a(b.currentTarget).data("blogid"))},undoRepost:function(a){a.preventDefault(),this.trigger("posttools:undorepost",{model:this.model})},_createReframeMarkup:function(a){var b="";this.$el.empty(),b=a.personalBlogId===a.currentPostDefaultBlogId&&f.get("membership").length<=1&&!g.isOn("replywithshare")?"":c.Renderer.render(tiger.components.post.button.repostBlockWrapped,a),this.$el.append(b),h.dropdownSentinel()},onPosttoolsOpened:function(){var a=this,b=function(){return f.isLoggedIn()?void a.model.getPostInfo({success:a.render.bind(a)}):!1},c=function(a){return{personalBlogId:a.personalBlogId,repostedToPersonal:a.repostedToPersonal,currentPostDefaultBlogId:a.currentPostDefaultBlogId,blogsRepost:a.blogsRepost,blogsUndo:a.blogsUndo,kinjaShare:!1}},d=function(){a.model.getShareOptionsForUser(f).pipe(c).done(a._createReframeMarkup.bind(a))},e=this.model&&parseInt(h.getKinjaMeta().postId,10)===this.model.get("sharedPostId");f.isLoggedIn()&&!this.model.has("actionState")?e?d():b():f.isLoggedIn()||f.onAuth.always(e?d:b)},render:function(){f.isLoggedIn()&&this.model.has("actionState")&&c.ItemView.prototype.render.call(this)},onRender:function(){d.prototype.onRender.call(this),h.dropdownSentinel()},_canShow:function(){var a=this.model.get("defaultBlogId"),b=f.get("defaultBlogId"),c=this.model.get("parentId"),e=this.model.get("sharedPostId");return c||e?b===a&&f.get("membership").length<=1&&!g.isOn("replywithshare")?!1:d.prototype._canShow.call(this):!1}});return i}),define("templates/tiger/components/groupchats/flagreason",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.groupchats.flagreason=function(a,b){var c=b||new d.StringBuilder;return c.append('	<div class="flag-reason-dropdown js_flag-reason"><form><label class="reason-head">Why are you flagging this?<a class="hover-icon help-link icon icon-question-circle" href="http://help.gawker.com/customer/portal/articles/1726140-what-is-flagging-?b_id=5895" target="_blank"></a></label><div class="row radio-cont"><div class="column small-12 js_error hide proxima"><small class="warningmessage">Please select a reason</small></div><div class="columns small-12"><label><input type="radio" name="reason" value="HARASSMENT">It\'s harassment</label></div></div><div class="row radio-cont"><div class="columns small-12"><label><input type="radio" name="reason" value="HATE_SPEECH">It\'s hate speech</label></div></div><div class="row radio-cont"><div class="columns small-12"><label><input type="radio" name="reason" value="SPAM">It\'s spam</label></div></div><div class="flag-reason-ctas"><a class="button secondary tiny cancel js_cancel">Cancel</a><a class="button primary tiny submit js_submit">Save</a></div></form></div>'),b?"":c.toString()}}),define("module/flagging/view/FlagReasonDropdown",["jquery","underscore","backbone.marionette","templates/tiger/components/groupchats/flagreason"],function(a,b,c){var d=c.ItemView.extend({template:tiger.components.groupchats.flagreason,events:{submit:"submit",click:"preventPropagation","click .js_cancel":"cancel","click .js_submit":"submit"},initialize:function(){},preventPropagation:function(a){a.stopPropagation()},cancel:function(){this.trigger("flagreason:cancel")},submit:function(a){a.preventDefault();var b=this.$('input[name="reason"]:checked').val();return b?this.trigger("flagreason:submit",this,b):this.$(".js_error").removeClass("hide"),!1}});return d}),define("templates/tiger/components/forms/modals/flagreason",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.forms.modals.flagreason=function(a,b){var c=b||new d.StringBuilder;return c.append('	<div class="show-for-medium-down flag-reason-mobile"><ul class="sticky-modal-options"><li class="js_reason-harassment" data-reason="HARASSMENT">It\'s harassment</li><li class="js_reason-hate-speech" data-reason="HATE_SPEECH">It\'s hate speech</li><li class="js_reason-spam" data-reason="SPAM">It\'s spam</li></ul><footer class="row"><div class="column small-12"><input type="button" class="button tiny secondary js_cancel" tabindex="5" value="Cancel" /></div></footer></div>'),b?"":c.toString()}}),define("module/flagging/view/FlagReasonModal",["jquery","underscore","backbone.marionette","templates/tiger/components/forms/modals/flagreason"],function(a,b,c){var d=c.ItemView.extend({template:tiger.components.forms.modals.flagreason,tagName:"form",events:{submit:"submit","click .js_cancel":"cancel","click .js_reason-harassment":"selectReason","click .js_reason-hate-speech":"selectReason","click .js_reason-spam":"selectReason"},cancel:function(){this.trigger("flagreason:cancel")},selectReason:function(b){var c=a(b.target).attr("data-reason");if(!c)throw new Error("Empty reason code for reason!");this.trigger("flagreason:submit",this,c)}});return d}),define("apiclient/flagging",["config","apiclient/apirequest","apiclient/gettoken"],function(a,b,c){var d={flagPost:function(b){return b.reason?a.api.core.url+"/post/{{postId}}/flag?reason={{reason}}":a.api.core.url+"/post/{{postId}}/flag"},unflagPost:function(b){return b.reason?a.api.core.url+"/post/{{postId}}/unflag?reason={{reason}}":a.api.core.url+"/post/{{postId}}/unflag"}};return{getPosts:b.getJson(c.append(a.api.core.url+"/post/{{starterId}}/flaggedposts")),getCount:b.getJson(c.append(a.api.core.url+"/post/{{starterId}}/flaggedcount")),flagPost:b.postJson(c.append(d.flagPost)),unflagPost:b.postJson(c.append(d.unflagPost)),getBlogCount:b.getJson(c.append(a.api.core.url+"/blog/{{blogId}}/flaggedcount")),resolveFlag:b.postJson(c.append(a.api.core.url+"/post/{{postId}}/resolve")),unresolveFlag:b.postJson(c.append(a.api.core.url+"/post/{{postId}}/unresolve"))}}),define("templates/tiger/components/groupchats/flagging-admin-link",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.groupchats.flaggingAdminLink=function(a,b){var c=b||new d.StringBuilder;return c.append("	<div class=\"flagging-admin-link proxima\"><a onClick=\"window.ga('send', 'event', 'On-Page Flagging', 'click', 'Click into moderation queue');\" href=\"/private/flagged\">Moderate Flagged Replies (",d.$$escapeHtml(a.flagCount),")</a></div>"),b?"":c.toString()}}),define("module/flagging/ReplyFlaggingModule",["jquery","underscore","backbone.marionette","singleton/Feature","singleton/CurrentUser","singleton/Utils","singleton/WindowController","module/flagging/view/FlagReasonDropdown","module/flagging/view/FlagReasonModal","app/modal/modal.controller","apiclient/flagging","templates/tiger/components/groupchats/flagging-admin-link"],function(a,b,c,d,e,f,g,h,i,j,k){var l={flaggedReplies:null,flaggedRepliesLoaded:a.Deferred(),flagCount:null,flagCountLoaded:a.Deferred(),tokenRenewed:!1,reasonDropdown:void 0,reasonModal:void 0,_loadFlaggedReplies:function(a){var b=this,c=function(c,d){b.flaggedReplies=[],d&&d.success===!0?(b.flaggedReplies=c.map(function(a){return a.postId}),b.flaggedRepliesLoaded.resolve()):d&&"InvalidSessionToken"===d.type&&l.tokenRenewed===!1?(l.tokenRenewed=!0,e.token().done(function(){l._loadFlaggedReplies(a)})):b.flaggedRepliesLoaded.reject()};k.getPosts({starterId:a}).done(c)},_loadFlagCount:function(a){var b=this,c=function(a,c){c&&c.success===!0&&(b.flagCount=Number(a)),b.flagCountLoaded.resolve()};k.getCount({starterId:a}).done(c)},_mergePostModelWithFlagInfo:function(a){var c=a.get("id");b.contains(this.flaggedReplies,c)&&a.set({allowReplies:!1,flagged:!0})},_postStatus:function(a){return 0!==a.parents(".all-threads").length?a.parents(".js_reply").hasClass("unapproved")?"Pending":"Approved":"Featured"},_flagPost:function(a,c,e){var f,g,h=c.get("flagged")===!0,i=c.get("id"),j=h?"Unflag":"Flag",m=l._postStatus(a);c.get("flaggingInProgress")===!0&&b.isUndefined(l.reasonDropdown)||(c.set({flaggingInProgress:!0}),g=d.isOn("extendedflag")&&!b.isUndefined(e)&&"Flag"===j?j+" - "+e.toLowerCase():j,window.ga("send","event","On-Page Flagging",g,"Reply status: "+m),f=h?k.unflagPost({postId:i,reason:e}):k.flagPost({postId:i,reason:e}),f.done(function(a,b){void 0!==b&&b.success===!0&&(c.set({flagged:!h,allowReplies:h,flaggingInProgress:!1}),this._syncFlaggedReplies(!h,i))}.bind(this)))},_syncFlaggedReplies:function(a,c){null!==l.flaggedReplies&&(a?l.flaggedReplies.push(c):l.flaggedReplies=b.reject(l.flaggedReplies,function(a){return a===c})),null!==l.flagCount&&(a?l.flagCount++:l.flagCount--)},_showDropdownReasonSelection:function(b,c){var d,e;l._hideReasonDropdown(),l.reasonDropdown=new h({$reply:b,model:c}),l.reasonDropdown.on("flagreason:submit",l._handlePostFlagFromDropdown),l.reasonDropdown.on("flagreason:cancel",l._hideReasonDropdown),l.reasonDropdown.render(),c.set({flaggingInProgress:!0}),l.reasonDropdown.$el.insertBefore(b.find(".reply-border")),d=l.reasonDropdown.$el,a(window).scrollTop()+window.innerHeight-d.height()<d.offset().top&&(e=d.offset().top-d.height(),a("body").scrollTo(e,{duration:"slow"}))
},_showModalReasonSelection:function(a,b){l.reasonModal=new i({$reply:a,model:b}),l.reasonModal.on("flagreason:cancel",function(){j.close()}),l.reasonModal.on("flagreason:submit",l._handlePostFlagFromModal),j.create(l.reasonModal,{name:"flagreason",className:"reveal-modal kinja-modal sticky-modal bottom full-width"})},_handlePostFlagFromDropdown:function(a,b){var c=a.model;a.$("a,input").addClass("disabled"),c.once("change:flagged",l._hideReasonDropdown),l._flagPost(a.options.$reply,c,b)},_handlePostFlagFromModal:function(a,b){var c=a.model;a.$("a,input").addClass("disabled"),c.once("change:flagged",function(){j.close()}),l._flagPost(a.options.$reply,c,b)},_hideReasonDropdown:function(){b.isUndefined(l.reasonDropdown)||(l.reasonDropdown.options.model.set({flaggingInProgress:!1}),l.reasonDropdown.remove(),l.reasonDropdown=void 0)},API:{flaggedRepliesLoaded:function(){return l.flaggedRepliesLoaded},flagCountLoaded:function(){return l.flagCountLoaded},flaggedReplies:function(){return l.flaggedReplies},flagCount:function(){return l.flagCount},openFlagView:function(a,b){e.requireLogin("flagPost").done(function(){g.isSmall()?l._showModalReasonSelection(a,b):l._showDropdownReasonSelection(a,b)})},unflag:function(a,b){e.requireLogin("unflagPost").done(function(){l._flagPost(a.view.$el,b)})},loadFlaggedReplies:function(a){e.onAuth.done(function(){e.isLoggedIn()&&(l._loadFlaggedReplies(a),d.isOn("groupchats_refactor")||l.API.loadFlagCount(a))})},loadFlagCount:function(a){e.onAuth.done(function(){var b=f.getKinjaMeta().blog.id;e.isLoggedIn()&&(e.isSuperuser()&&d.isOn("superuser")||e.hasRole("OWNER",b)||e.hasRole("ADMIN",b))?l._loadFlagCount(a):l.flagCountLoaded.reject()})},extendPostModel:function(a){l.flaggedRepliesLoaded.done(function(){l._mergePostModelWithFlagInfo(a)})},showAdminLink:function(a,b){l.flagCountLoaded.done(function(){if(l.flagCount<=0)return!0;var d={flagCount:l.flagCount},e=c.Renderer.render(tiger.components.groupchats.flaggingAdminLink,d);b?a.append(e):a.prepend(e)})}}};return window.__karma__&&(l.API.__testonly__=l),l.API}),define("app/post/posttools/view/posttools.flagview",["jquery","underscore","singleton/Feature","app/post/posttools/view/posttools.menuitemview","module/flagging/ReplyFlaggingModule"],function(a,b,c,d,e){var f=d.extend({modelEvents:{"change:flagged":"_flaggedChanged","change:flaggingInProgress":"_flaggedChanged"},permissions:[],events:{click:"_onFlagClicked"},_flaggedChanged:function(){this.render()},_canShow:function(){return this.model.get("flagged")!==!0},_isDisabled:function(){return this.model.get("flaggingInProgress")===!0},_onFlagClicked:function(a){a.preventDefault();var b=this.$el.parents(".js_reply");e.openFlagView(b,this.model)}});return f}),define("app/post/posttools/view/posttools.unflagview",["app/post/posttools/view/posttools.menuitemview"],function(a){var b=a.extend({modelEvents:{"change:flagged":"_flaggedChanged","change:flaggingInProgress":"_flaggedChanged"},permissions:[],triggers:{click:"posttools:unflag"},_flaggedChanged:function(){this.render()},_canShow:function(){return this.model.get("flagged")===!0},_isDisabled:function(){return this.model.get("flaggingInProgress")===!0}});return b}),define("app/post/posttools/view/reposttools.unscheduleview",["app/post/posttools/view/posttools.menuitemview"],function(a){return a.extend({permissions:["canSharePost"],triggers:{click:"reposttools:unschedule"}})}),define("app/post/posttools/posttools.menuview",["jquery","underscore","backbone","backbone.marionette","singleton/CurrentUser","singleton/CurrentBlog","singleton/Feature","singleton/EventDispatcher","singleton/Utils","app/post/mixins/post.userPermissions","app/post/posttools/view/posttools.editview","app/post/posttools/view/posttools.editreplyview","app/post/posttools/view/posttools.deleteview","app/post/posttools/view/posttools.invitemanuallyview","app/post/posttools/view/posttools.dismissview","app/post/posttools/view/posttools.promoteview","app/post/posttools/view/posttools.blockview","app/post/posttools/view/posttools.hideview","app/post/posttools/view/posttools.kinjashareview","app/post/posttools/view/posttools.kinjaunshareview","app/post/posttools/view/posttools.externalshareview","app/post/posttools/view/posttools.repostview","app/post/posttools/view/posttools.flagview","app/post/posttools/view/posttools.unflagview","app/post/posttools/view/reposttools.unscheduleview"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){var z=["profilepage","dashboard","manageblog"],A=d.ItemView.extend(b.extend({},j,{menuItemViewClasses:{".js_-post":k,".js_edit-post":k,".js_edit-reply":-1===b.indexOf(z,i.getKinjaMeta().pageType)?l:k,".js_delete-post":m,".js_invite-to-post-manually":n,".js_dismiss":o,".js_promote":p,".js_block":q,".js_hide-post":r,".js_kinja-share":s,".js_kinja-unshare":t,".js_external-share":u,".js_repostblock":v,".js_flag-post":w,".js_unflag-post":x,".js_unschedule-repost":y},triggers:{"opened .js_post-dropdown":"posttools:opened"},menuItemViews:[],permissions:["userIsSuper","canEditPost","canPromote","canDismissPost","canSharePost"],initialize:function(a){h.on("blog:block:success"+this.model.id,this.render,this),this.blockedBlogCollection=a.blockedBlogCollection},_instantiateMenuItemViewClasses:function(){var c=b.map(this.menuItemViewClasses,function(c,d){var e=this.$(d);return e.length?b.map(e,function(b){return new c({el:a(b),model:this.model,collection:".js_block"===d?this.blockedBlogCollection:void 0})},this):!1},this);return b.chain(c).flatten().compact().value()},_bindEvents:function(){e.onAuth.always(this._refreshMenu.bind(this)),e.on("authenticated",this._refreshMenu.bind(this))},_refreshMenu:function(){var a="permalink"===i.getKinjaMeta().pageType,b=this,c=function(){return b.$("li:not(.hide)").length};b._renderMenuItems(),b.trigger("posttools:menuview:togglehidden",!a&&!c())},_renderMenuItems:function(){this.menuItemViews.call("render")},_captureMenuItemEvents:function(){this.menuItemViews.call("on","all",this.trigger,this)},_adjustMenuHeight:function(){var b,c=this.$(".js_post-dropdown"),d=a(window.document).height(),e=this.$el.offset().top,f=d-e-c.height();0>f&&(b=d-e,c.height(b+"px"),c.addClass("scroll"))},onPosttoolsOpened:function(){this.menuItemViews.call("triggerMethod","posttools:opened"),this._adjustMenuHeight()},render:function(){var b,d,h="permalink"===i.getKinjaMeta().pageType;return this.menuItemViews.length||(b=this._instantiateMenuItemViewClasses(),this.menuItemViews=new c.ChildViewContainer(b),this._captureMenuItemEvents()),this._renderMenuItems(),this._bindEvents(),d=h&&this.model.get("liveBlog")===!0&&this.model.get("isStarter")===!0,d&&this.$(".js_reply-to-post").toggleClass("hide",!e.hasRole("AUTHOR",f.id)),g.isOn("replywithshare")&&a(".js_kinja-share-wrapper").removeClass("hide"),h&&this.trigger("posttools:menuview:togglehidden",!1),this}}));return A}),define("app/post/posttools/controller/posttools.dismiss.controller",["jquery"],function(a){var b={API:{dismiss:function(b){b.setAction("dismiss",b.get("defaultBlogId"),{success:a.proxy(function(){b.trigger("posttools:post:dismissed"),b.trigger("annotation:remove")},this),error:function(a){throw new Error("PostTools.dismissPost(): "+a.reason)}})},undismiss:function(b){b.setAction("actionreset",b.get("defaultBlogId"),{success:a.proxy(function(){b.trigger("posttools:post:undismissed")},this),error:function(a){throw new Error("PostTools.undismissPost(): "+a.reason)}})}}};return b.API}),define("app/post/posttools/controller/posttools.block.controller",["jquery","underscore","singleton/CurrentUser","collection/blog.subscribersCollection"],function(a,b,c,d){var e={_isBlockeeAMemberCache:{},blockedBlogIdsPromise:new a.Deferred,blockedIdsDataCache:[],_blogsBlockedHash:{},_postIsBlocked:function(a,b){return-1!==b.indexOf(a.get("authorBlogId"))},_blockBlog:function(a,b){var d,f=b.targetBlogId,g=b.confirmation,h=b.blockedBlogCollection,i=a.get("defaultBlogId"),j=b.targetBlogName,k=b.forceAction;"undefined"!=typeof k?(d=k,c.set("forceAction",k)):d=e._postIsBlocked(a,b.blockedBlogIds)?"unblock":"block",("boolean"==typeof g&&g||g({action:d,username:a.get("author").displayName,sitename:j}))&&c.setBlogAction(d,i,f,{success:function(b){var e,g=c.get("forceAction");b?"block"===d?(h.add({id:f}),h.trigger("posttools:block"),a.trigger("posttools:block")):(e=h.findWhere({id:f}),e&&h.remove(e),h.trigger("posttools:unblock"),a.trigger("posttools:unblock")):("block"===g||"unblock"===g)&&(h.trigger("posttools:"+g),a.trigger("posttools:"+g))},error:function(a){throw new Error("PostTools.blockBlog(): "+a.reason)}})},_blockedBlogsInitialized:function(b){var c;return e._blogsBlockedHash.hasOwnProperty(b)||(e._blogsBlockedHash[b]=e.API.getBlockedBlogCollection(b)),e._blogsBlockedHash[b].fetched?(c=a.Deferred(),c.resolve(e._blogsBlockedHash[b]),c):(e._blogsBlockedHash[b].fetched=!0,e._blogsBlockedHash[b].fetch())},API:{isBlockable:function(c,d,f,g){if(!d){try{throw new Error("blogId is undefined")}catch(h){require(["module/Raven"],function(Raven){Raven.captureException(h,{extra:{postModel:c.toJSON()}})})}return c.trigger("posttools:checkedBlockability",!1),!1}void 0!==e._isBlockeeAMemberCache[d]&&void 0!==f&&void 0!==e._isBlockeeAMemberCache[d][f]?c.trigger("posttools:checkedBlockability",e._isBlockeeAMemberCache[d][f]):a.ajax({url:"http://kinja.com/api/profile/blogmembership/views/byBlogs?ids="+d,dataType:"jsonp",jsonp:"jsonp",success:function(a){var h=!1;a.meta&&b.isArray(a.data)&&(h=!b.any(a.data,function(a){return a.authorId===g})),c.trigger("posttools:checkedBlockability",h),void 0===e._isBlockeeAMemberCache[d]&&(e._isBlockeeAMemberCache[d]={}),e._isBlockeeAMemberCache[d][f]=h},error:function(){c.trigger("posttools:checkedBlockability",!1)}})},block:function(b,c,d,f,g){var h,i=b.get("defaultBlogId"),j=b.get("authorBlogId");i!==j&&a.when(e._blockedBlogsInitialized(i)).then(function(){h={targetBlogId:j,blockedBlogIds:c.getIds(),blockedBlogCollection:c,confirmation:d,targetBlogName:f,forceAction:g},e._blockBlog(b,h)})},getBlockedBlogCollection:function(a){return e._blogsBlockedHash.hasOwnProperty(a)||(e._blogsBlockedHash[a]=new d([],{blogId:a,type:"blocked",withNames:!1})),e._blogsBlockedHash[a]},checkBlockStatus:function(b,c){var d=b.get("defaultBlogId");a.when(e._blockedBlogsInitialized(d)).then(function(){b.trigger("posttools:blockStatusUpdated",e._postIsBlocked(b,c.getIds()))})}}};return window.__karma__&&(e.API.__testonly__=e),e.API}),define("app/post/posttools/controller/posttools.like.controller",["jquery","underscore","singleton/CurrentUser","singleton/EventDispatcher","singleton/Feature","module/KinjaAnalytics","singleton/Utils","app/post/mixins/post.successMessage","templates/tiger/messages"],function(a,b,c,d,e,f,g,h){var i={};return i=b.extend(i,h,{_trackRecommendation:function(a){var b=a.get("isStarter")?"Post":"Comment";window.ga("send","event","Recommendation",b+" Recommended",a.get("permalink"))},_likePost:function(c,d){var f=c.get("liked")?"unlike":"like",g=c.setLike(f,{success:function(a){if("like"===f&&(i._trackRecommendation(c),i._displaySuccessMessage(tiger.messages.postRecommended),!c.get("isStarter")&&!c.get("approved"))){var g=b.pluck(a.response.approvalResult.approvedReplies,"postId"),h=d.model.get("id");e.isOn("groupchats_refactor")?-1!==b.indexOf(g,h)&&d.model.set({approved:!0}):d.$el.trigger("approval",{approvedReplyIDs:g})}},error:function(a){throw new Error("PostTools.likePost(): "+a.reason)}}),h=function(){c.trigger("posttools:post:likeCount:updated")};a.when(g).then(h)},API:{like:function(b,d){return a("body").hasClass("read-only")?!0:(c.requireLogin("likePost").done(function(){i._likePost(b,d)}),void(("dashboard"===g.getKinjaMeta().pageType||"manageblog"===g.getKinjaMeta().pageType)&&(f.setContext(null,"DASHBOARD"),f.pushEvent("STAR"))))}}}),i.API}),define("app/post/posttools/controller/posttools.hide.controller",["config","jquery","underscore","singleton/Feature","singleton/CurrentUser","model/post/Post"],function(a,b,c,d,e,f){var g={API:{hide:function(c,g){var h=c.get("id"),i=a.api.core.url+"/post/"+h+"/hide?token="+e.get("token"),j=null,k="/";e.isSuperuser()&&d.isOn("superuser")&&g()&&(c.has("parentId")&&(j=new f({id:c.get("parentId")}),k=j.has("permalink")?j.get("permalink"):"/"+j.id),b.ajax({url:i,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",success:function(a){void 0!==a.meta&&a.meta.success===!0&&window.setTimeout(function(){window.location.href=k},1e3)}}))}}};return g.API}),define("apiclient/repost",["config","apiclient/apirequest","apiclient/gettoken"],function(a,b,c){return{unschedule:b.postJson(c.append(a.api.core.url+"/blog/{{blogId}}/removeRepostJob/{{postId}}")),reschedule:b.postJson(c.append(a.api.core.url+"/blog/{{blogId}}/updateRepostJob/{{postId}}?repostTime={{repostTime}}"))}}),define("app/post/posttools/posttools.controller",["jquery","underscore","backbone.marionette","config","lib/needly","model/post/Post","singleton/CurrentUser","singleton/CurrentBlog","singleton/EventDispatcher","singleton/Feature","singleton/Utils","singleton/ModalManager","module/KinjaAnalytics","view/BaseView","app/post/common/post.layout","app/post/mixins/post.confirmationPrompt","app/post/posttools/posttools.menuview","app/post/posttools/controller/posttools.dismiss.controller","app/post/posttools/controller/posttools.block.controller","app/post/posttools/controller/posttools.like.controller","app/post/posttools/controller/posttools.promote.controller","app/post/posttools/controller/posttools.hide.controller","module/flagging/ReplyFlaggingModule","app/post/mixins/post.successMessage","view/forms/invite/InviteToPostManuallyModalView","view/forms/PromoteTargetSelector","module/groupchats/view/OpenReplyForms","app/modal/modal.controller","app/MarionetteApp","view/Spinner","apiclient/repost","templates/tiger/messages"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E){var F={};return F.services=new e.Container,F.services.registerMany({PostModel:{type:"class",dependency:f},eventDispatcher:{type:"singleton",dependency:i},feature:{type:"singleton",dependency:j},utils:{type:"singleton",dependency:k}}),F=b.extend(F,A,p,x,{_isBlockeeAMemberCache:{},_like:function(a){a.model.get("tags")&&j.isOn("channels")&&!a.model.get("liked")&&C.vent.trigger("add:channel",{channelName:a.model.get("tags")[0].urlName}),t.like(a.model,a.view)},_reply:function(a){return j.isOn("groupchats_refactor")?void require(["module/DiscussionModule"],function(a){a.replyToStarterPost()}):void i.trigger("reply:openstarterform",a)},_dismiss:function(a){F._confirmationPrompt(tiger.messages.confirmDismissPost)&&r.dismiss(a.model)},_undismiss:function(a){r.undismiss(a.model)},_getDismissState:function(a){a.model.getActionState()},_delete:function(a){var c,d=a.model,e=this,f="dashboard"===k.getKinjaMeta().pageType||"manageblog"===k.getKinjaMeta().pageType;F._confirmationPrompt(tiger.messages.areYouSureToDelPost)&&(d.on("destroy",function(){e._displaySuccessMessage(tiger.messages.postDeleted),c=function(){window.location=f?window.location.pathname:n.prototype.cachebuster.call(n.prototype,"/")},b.delay(c,2e3)}),d.destroy({wait:!0}))},_unscheduleRepost:function(a){var c=this,d=a.view.el.getAttribute("data-postid"),e=a.view.el.getAttribute("data-blogid"),f=function(){window.location="private"===k.getKinjaMeta().pageType?window.location.pathname:n.prototype.cachebuster.call(n.prototype,"/")},g=function(){c._displaySuccessMessage(tiger.messages.repostUnscheduled),b.delay(f,2e3)};F._confirmationPrompt(tiger.messages.areYouSureToUnschedRepost)&&E.unschedule({postId:d,blogId:e}).done(g)},_promote:function(a){var b=a.model.id,c=g.hasPermission("SALES")||g.isSuperUser(),d=window.location.port?"http://kinja.dev:9000":"http://kinja.com";c&&j.isOn("dfpnative")?window.location.href=d+"/dfp/promotions/"+b:j.isOn("marionette_promotions")?u.promotionsForCurrentUserAndPost(b):u.promote(a.model)},_isBlockable:function(a){var b=a.model,c=b.get("defaultBlogId"),d=b.get("targetBlogId"),e=b.get("author").id;return s.isBlockable(b,c,d,e)},_checkBlockStatus:function(a){s.checkBlockStatus(a.model,a.collection)},_postIsBlocked:function(a,b){return-1!==b.indexOf(a.get("authorBlogId"))},_block:function(a){var b=function(a){return F._confirmationPrompt(tiger.messages.confirmBlockBlog,a)};s.block(a.model,a.collection,b,a.targetBlogName)},_hide:function(a){var b=function(){return F._confirmationPrompt(tiger.messages.confirmHidePost)};v.hide(a.model,b)},_unflag:function(a){w.unflag(a,a.model)},_kinjaShare:function(b){var c,d=b.model,e=new D({fullscreen:!0});g.requireLogin("kinjaSharePost").done(function(){a("body").append(e.el),c=function(a){F.closeReplyForm.call(F),k.requireModuleWithCss("module/MarionetteEditor","editor",function(){require(["app/editor/editor.app"],function(b){b.sharePost(a),e.remove()})})}.bind(this),d.has("original")?c(d):d.fetch({success:c,preview:"PUBLISHED"!==d.get("status")}),("dashboard"===k.getKinjaMeta().pageType||"manageblog"===k.getKinjaMeta().pageType)&&(m.setContext(null,"DASHBOARD"),m.pushEvent("SHARE"))})},_externalShare:function(a){var c=a.view.$(".js_share-post-item"),d=c.attr("href"),e={twitter:"toolbar=0,status=0,width=480,height=360",facebook:"toolbar=0,status=0,width=480,height=360",tumblr:"toolbar=0,status=0,width=450,height=430"},f=b.intersection(c.attr("class").split(/\s+/),["twitter","facebook","tumblr"])[0];window.open(d,"share"+f,e[f]),("dashboard"===k.getKinjaMeta().pageType||"manageblog"===k.getKinjaMeta().pageType)&&(m.setContext(null,"DASHBOARD"),m.pushEvent("SHARE"))},_repost:function(a,b){var c="repost",d=this,e=g.get("membership").find(function(a){return a.get("blogId")===parseInt(b,10)});a.setAction(c,b,{success:function(){d._displaySuccessMessage(tiger.messages.postReposted,{blogName:e.get("blog").displayName,blogUrl:"http://"+e.get("blog").canonicalHost})},error:function(a){throw new Error("PostTools.repostPost(): "+a.reason)}})},_undoRepost:function(a){var b="actionreset",c=h.id,d=a.model,e=this;d.setAction(b,c,{success:function(){e._displaySuccessMessage(tiger.messages.repostRemoved)},error:function(a){throw new Error("PostTools.undoRepost(): "+a.reason)}})},_bindEvents:function(a,b){a.on("posttools:like",this._like.bind(this)),a.on("posttools:reply",this._reply.bind(this)),b.on("posttools:dismiss",this._dismiss.bind(this)),b.on("posttools:undismiss",this._undismiss.bind(this)),b.on("posttools:getDismissState",this._getDismissState.bind(this)),b.on("posttools:delete",this._delete.bind(this)),b.on("posttools:promote",this._promote.bind(this)),b.on("posttools:block",this._block.bind(this)),b.on("posttools:checkBlockability",this._isBlockable.bind(this)),b.on("posttools:checkBlockStatus",this._checkBlockStatus.bind(this)),b.on("posttools:hide",this._hide.bind(this)),b.on("posttools:unflag",this._unflag.bind(this)),b.on("posttools:kinjaShare",this._kinjaShare.bind(this)),b.on("posttools:externalShare",this._externalShare.bind(this)),b.on("posttools:repost",this._repost.bind(this)),b.on("posttools:undorepost",this._undoRepost.bind(this)),b.on("close",function(){g.off(null,null,b),i.off(null,null,b),b.model.off(null,null,b)}),b.on("posttools:menuview:togglehidden",function(b){a.togglePostToolsVisibility(b)}),b.on("reposttools:unschedule",this._unscheduleRepost.bind(this))},API:{startPostTools:function(a,b){var c="undefined"!=typeof b.get("defaultBlogId")?b.get("defaultBlogId"):k.getKinjaMeta().blog.id,d=new q({el:a.find(".js_post-dropdown-ct"),model:b,blockedBlogCollection:s.getBlockedBlogCollection(c)}),e=new o({el:a,model:b});e.post.attachView(d),e.bindUIElements(),F._bindEvents(e,d),i.on("posttools:close:"+b.get("id"),function(){d.close()}),g.on("authenticated",d.render,d),d.render()},closePostTools:function(a){i.trigger("posttools:close:"+a)},bindEvents:function(a,b){F._bindEvents(a,b)}}}),F.API}),define("view/PostView",["jquery","underscore","view/BaseView","singleton/PostInsetTools","singleton/Utils","singleton/EventDispatcher","singleton/Feature","singleton/CurrentUser","gawkerlib/jquery.foundation.dropdownhover","gawkerlib/lightboxer","app/post/posttools/posttools.controller","view/SuccessBox","templates/tiger/components/post/button/repost-block"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=a(window),n=c.extend({postTool:null,extraSidebarStickyAfter:1169,extraSidebarStuckClass:"stuck",extraSidebarOffsetTop:18,alternateTagTimeout:void 0,gawkerHosts:["jalopnik.com","es.gizmodo.com","cink.hu","io9.com","deadspin.com","kotaku.com","gizmodo.com","gawker.com","lifehacker.com","jezebel.com"],events:{"mouseenter .js_tag_primary":"showAlternateTags","mouseenter .headline":"clearAlternateTagTimeout","mouseleave .headline":"hideAlternateTags","click .js_annotation-expand":"expandAnnotation","click .js_videoThumbPlay":"loadHiddenVideo","click .lazy-gif.thawable":"thawImage"},initialize:function(){this.$(".item-content").on("click",a.proxy(this.navigateToArticle,this)),this.$(".js_read-more").on("click",function(){window.ga("send","event","Front page click","Front page click - read more")}),this.$(".js_publish_time a").on("click",function(){window.ga("send","event","Front page click","Front page click - read more timestamp")}),this.$stickyTriggerCt=a(".js_post-dropdown-ct-sticky"),this.$stickyLimitElement=a(".js_post-wrapper"),this.$stickyTriggerCt.length&&(this.$postMenuToggler=this.$stickyTriggerCt.find(".js_post-menu-toggler"),this.$stickyDropdown=a("#dropdown-"+this.model.id),window.setTimeout(a.proxy(this.initExtraSidebarSticky,this),1)),g.isOn("postlisttracking")&&a(".post-list").length&&(this.$(".read-more").on("click",a.proxy(this.gaTrackClick,this)),this.$("h1.entry-title a").on("click",a.proxy(this.gaTrackClick,this))),"undefined"!=typeof a.cookie("feature_updatedpromotest")&&this.$(".track-promo-links a").on("click",function(){window.ga("send","event","Promoted Post Event","link click")}),this.handleCustomIframes()},start:function(){return k.startPostTools(this.$el,this.model),this.listenTo(this.model,"posttools:post:dismissed",this.delegatedDismissHandler,this),this.listenTo(this.model,"posttools:post:undismissed",this.delegatedUndismissHandler,this),this.listenTo(this.model,"posttools:post:edit:success",this.delegatedEditHandler,this),"permalink"===e.getKinjaMeta().pageType&&j(this.$el),this.fixMarkup(),a.cookie("editor_warnings")&&this.showEditorWarnings(),this},showEditorWarnings:function(){var c,d,e=JSON.parse(a.cookie("editor_warnings")),f=/(http(s)?:\/\/[a-zA-Z0-9\-_]+\.[a-zA-Z]+(.)+)+/gi,h=e.length;e&&(a.removeCookie("editor_warnings"),b.each(e,function(a,b){c=a.message.match(f),d=a.message.replace(f,"");var e=new l({message:d+'<br/><a href="'+c+'" target="_blank">'+c+"</a>",permanent:!0,warningBox:!0,hidden:g.isOn("editor_warnings_collapsed")&&b>0});e.render(),g.isOn("editor_warnings_collapsed")&&0===b&&h>1&&e.attachMoreWarningsBox(h)}))},fixMarkup:function(){if("permalink"!==this.getPageType())return!1;var c=this;b.each(this.$el.find(".referenced ~ .content-ad"),function(b){var c=a(b);c.appendTo(c.prev())}),this.$el.find("blockquote .inset_placeholder").each(function(){a(this).closest("blockquote").before(this)}),d.render(this.$el),this.$el.find(".js_reel").each(function(){c.createReel(this)}),this.$el.find(".js_slider").each(function(){var b=a(this),d=b.attr("data-uri1"),e=b.attr("data-uri2"),f=b.attr("data-percent");c.renderSlider(b,d,e,f)})},loadHiddenVideo:function(b){return a(b.currentTarget).hide(),this.$el.find(".js_hiddenbythumbnail").removeClass("hide"),!1},renderSlider:function(b,c,d,f){function g(a,b){var c=b-a;return 6>c&&(c=6),c>630&&(c=630),c}function h(a,b,c,d){d&&(b.stop().animate({width:a},0),c.stop().animate({right:628-a},0))}var i,j=640*f*.01,k=e.imageUrl(c,"k-bigpic"),l=e.imageUrl(d,"k-bigpic"),m=a('<div id="sliderBottom" style="background-image: url('+l+');"></div>'),n=a('<div id="sliderTop" style="background-image: url('+k+');"></div>'),o=a('<div id="sliderArrows"></div>'),p=!1,q=b.offset().left;b.html('<div id="slider"></div>').append(m,n,o),i=b.find("#slider"),n.stop().animate({width:j},1e3),o.stop().animate({right:628-j},1e3),i.bind("mousedown touchstart",function(a){p=!0;var b=g(q,a.pageX);return h(b,n,o,p),i.bind("mousemove touchmove",function(a){var b=g(q,a.pageX);h(b,n,o,p)}),!1}).bind("mouseup touchend",function(){p=!1,i.stop()}).mouseleave(function(){p=!1,i.stop()})},remove:function(){k.closePostTools(this.model.get("id"))},showAlternateTags:function(){""!==this.$el.find(".js_tag_alternates").html()&&this.$el.find(".js_tag_alternates").fadeIn(100)},hideAlternateTags:function(){var a=this;this.alternateTagTimeout=window.setTimeout(function(){a.$el.find(".js_tag_alternates").fadeOut(100)},2e3)},clearAlternateTagTimeout:function(){window.clearTimeout(this.alternateTagTimeout)},render:function(){return this},delegatedDismissHandler:function(){var b=700;this.$el.parents(".post-wrapper").fadeOut({duration:b,queue:!1}).slideUp({duration:b,queue:!1,complete:function(){a(this).remove()}})},delegatedEditHandler:function(){return!1},createReel:function(b){var c,d,e=a(b),f=636,g=Math.round(f/(16/9)),h=[],i={},j=e.data("url"),k=e.data("cols"),l=e.data("rows"),m=a('<img class="greel" src="'+j+'A00.jpg" alt="" width="'+f+'" height="'+g+'" />');for(e.append(m),c=0;l>c;c++)for(d=0;k>d;d++)h.push(String.fromCharCode(c+65)+(10>d?"0":"")+d+".jpg");i={frames:k,path:j,images:h,cw:!0,revolution:{x:300,y:100},inversed:!0,suffix:"",wheelable:!1},1!==l&&(i.rows=l),require(["lib/amd-wrapped/jquery.reel"],function(){m.one("load",function(){a(this).reel(i)})})},expandAnnotation:function(){return this.$el.find(".js_annotation-short").remove(),this.$el.find(".js_annotation-long").removeClass("hide"),!1},truncatePostText:function(a,b){var c,d,f=b?"":"&hellip;",g=a||320;c=this.$el.find(".read-more").detach(),d=this.$el.find("p.first-text"),d.text().length>g&&d.html(e.cutHtml(d.html(),g,f)),d.append(c)},truncateWidePostText:function(a,b){this.$el.parent().hasClass("wide")&&this.truncatePostText(a,b)},navigateToArticle:function(b){if(2!==b.button){var c,d=a(b.target);if(!d.parents(".thumb-inset").length&&!d.closest(".js_post-menu-toggler").length&&!d.closest("a").attr("href")){if(c=this.model.getUrl(),g.isOn("postlisttracking")&&this.gaTrackClick(),window.ga("send","event","Homepage post click","Front page click","Front page click - post text"),1===b.button||b.ctrlKey||b.metaKey||"dashboard"===e.getKinjaMeta().pageType)return window.open(c,"_blank"),!1;window.location=c}}},initExtraSidebarSticky:function(){var c=function(){return m.width()>=this.extraSidebarStickyAfter},d=function(){this._measureSticky(),this.stickExtraSidebar(),m.on("scroll.extra.sidebar",a.proxy(this.stickExtraSidebar,this))},e=function(){c.call(this)?d.call(this):(this._resetSticky(),m.off("scroll.extra.sidebar",a.proxy(this.stickExtraSidebar,this)))},f=b.debounce(a.proxy(e,this),300);c.call(this)&&d.call(this),m.on("resize orientationchange",f)},stickExtraSidebar:function(a){a=a||{};var b,c,d=this.$stickyTriggerCt.data("initalOffset"),e=window.pageYOffset>=d.top-this.extraSidebarOffsetTop,f=this.$stickyTriggerCt.hasClass(this.extraSidebarStuckClass),g=!1;!this.$stickyLimitElement||this.stickyMax&&"resize"!==a.type||(b=this.$stickyLimitElement.height(),c=this.$stickyLimitElement.offset().top,this.stickyMax=b+c-60),g=this.stickyMax<=window.pageYOffset,!e||g||f?e&&!g||!f||this._resetSticky():(this.$stickyTriggerCt.width(this.$postMenuToggler.outerWidth()).css({top:this.extraSidebarOffsetTop,left:Math.round(d.left)}).addClass(this.extraSidebarStuckClass),this.$stickyDropdown.hasClass("open")&&i.open(this.$stickyDropdown,this.$postMenuToggler),this._adjustDropdownHeight())},_resetSticky:function(){this.$stickyTriggerCt.css({left:"",top:"",width:""}).removeClass(this.extraSidebarStuckClass),this.$stickyDropdown.hasClass("open")&&i.open(this.$stickyDropdown,this.$postMenuToggler)},_measureSticky:function(){this.$stickyTriggerCt.data("initalOffset")&&this._resetSticky(),this.$stickyTriggerCt.data("initalOffset",this.$postMenuToggler.offset())},_adjustDropdownHeight:function(){var b=this.$stickyDropdown,c=a(window).height();parseInt(b.height(),10)>c?(b.addClass("scroll"),b.css("height",c-60)):b.removeClass("scroll")},thawImage:function(b){b.preventDefault(),f.trigger("thawImage",{$el:a(b.target)})},gaTrackClick:function(){var c=b.indexOf(a(".post-list .js_post_item"),this.$el[0])+1;c>0&&16>c&&window.ga("send","event","Homepage post click","Homepage post click, position "+c)},handleCustomIframes:function(){var b=a("iframe.custom.aspect");b.each(function(){var b=a(this);b.data("aspectRatio",b.height()/b.width()).removeAttr("height").removeAttr("width")}),b.length&&a(window).resize(function(){b.each(function(){var b=a(this),c=b.parent().width();b.width(c).height(c*b.data("aspectRatio"))})}).resize()}});return n}),define("templates/tiger/components/post/button/undismissed-message",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.post.button.undismissedMessage=function(a,b){var c=b||new d.StringBuilder;return c.append('	<div class="js_undismissed-msg undismissed-msg popover-container active"><div class="popover popover-left nowrap"><div class="arrow"></div><div class="popover-content text-small pvs phm">Reply undismissed.</div></div></div>'),b?"":c.toString()}}),define("view/ReplyView",["jquery","underscore","lib/amd-wrapped/modernizr","view/PostView","templates/tiger/components/post/button/undismissed-message"],function(a,b,c,d){var e=d.extend({initialize:function(){d.prototype.initialize.call(this),this.model.on("change:flagged",this.onReplyFlagged,this),this.model.on("change:flaggingInProgress",this.onReplyFlagged,this),this.onReplyFlagged()},onReplyFlagged:function(){var a=this.$(".js_reply-tools"),b=this.$(".js_reply-flagged");this.model.get("flaggingInProgress")===!0?(a.css("visibility","hidden"),b.css("visibility","hidden")):(a.css("visibility",""),b.css("visibility",""),this.model.get("flagged")===!0?(a.addClass("hide"),b.removeClass("hide"),this.$el.addClass("flagged-reply")):(a.removeClass("hide"),b.addClass("hide"),this.$el.removeClass("flagged-reply")))},onReplyFlagging:function(){var a=this.$(".js_reply-tools"),b=this.$(".js_reply-flagged");this.model.get("flaggingInProgress")===!0?(a.addClass("hide"),b.removeClass("hide"),this.$el.addClass("flagged-reply")):(a.removeClass("hide"),b.addClass("hide"),this.$el.removeClass("flagged-reply"))},fixMarkup:function(){},delegatedDismissHandler:function(){var c,d,e,f,g=this.$el.is(".js_reply:first-of-type");g?(c=this.$el.parents(".js_permalink-branch, .js_branch"),this.doAfterTransition({$elements:c,classname:"disappearing",callback:function(){c.remove()}})):(d=this.$el.data("id"),e=b.map(this.getDismisseeIDs(d),function(a){return'[data-id="'+a+'"]'}).join(", "),f=a(e),this.doAfterTransition({$elements:f,classname:"disappearing",callback:function(){a(e).remove()}}))},delegatedUndismissHandler:function(){var b=this.$el.find(".js_undismissed-msg-place");b.append(this.soyToHtml(tiger.components.post.button.undismissedMessage,{})),window.setTimeout(a.proxy(function(){b.empty()},this),5e3)},getDismisseeIDs:function(c){function d(c){b.each(c,function(b){f.push(b),e=[],a('[data-parentid="'+b+'"]').each(function(b,c){e.push(a(c).data("id"))}),d(e)})}var e,f=[];return d([c]),f},doAfterTransition:function(a){c.csstransitions?(a.$elements.addClass(a.classname),a.$elements.one("transitionend",function(){a.$elements.removeClass(a.classname),a.callback()})):a.callback()}});return e}),define("model/Blog",["jquery","underscore","backbone","config","singleton/CurrentUser","singleton/Feature","apiclient/profile"],function(a,b,c,d,e,f,g){var h=c.Model.extend({featureCollection:null,validate:function(a){var b=[];return(""===a.canonicalHost||"undefined"===a.canonicalHost)&&b.push({key:"canonicalHost",message:"Invalid canonical Host"}),b.length>0?b:void 0},sync:function(a,b,c){var d,e;if("create"!==a&&(void 0===b.id||null===b.id))throw new Error("Blog.sync(): Model undefined");switch(a){case"read":return g.getBlog({blogId:b.id},c);
case"update":return d=b.toFormData(),g.updateBlog(d,c);case"create":return d=b.toJSON(),g.createBlog(d,c);case"setfeature":return e=this.featureCollection.getDirtyModels(),g.setBlogFeature({featuresUrlString:e,blogId:b.id},c)}},parse:function(a){var c;return c=a.meta&&null===a.meta.error?a.data:a,c.hosts=c.hosts?b.map(c.hosts,function(a){return void 0!==a.name?a.name:a}):[],c},toFormData:function(){var a=["id","canonicalHost","hosts","excludedTags","adsEnabled"];return b.pick(this.toJSON(),a)}});return h}),define("view/posttools/ApproveToolView",["jquery","underscore","config","view/BaseView","model/Blog","model/post/Post","singleton/CurrentUser","singleton/CurrentBlog"],function(a,b,c,d,e,f,g,h){var i,j;return i=function(a,c,d){return b.map(c,function(b){var c=d?'[data-sourceblogid="'+d+'"]':"";return"."+a+'[data-blogid="'+b+'"]'+c}).join(", ")},j=d.extend({events:{"click .js_followforblog":"followUserForBlog","click .js_unfollowforblog":"unfollowUserForBlog"},initialize:function(){var a=b.debounce(this.update,1e3);g.on("authenticated",a,this),this.on("update",a,this)},update:function(c){var d;return c=c||{},d=c.el||a("body"),g.onAuth.done(function(){this.removeControls(d);var c=function(b){return parseInt(a(b).data("blogid"),10)},e=d.find(".js_follow-controls"),f=b.without(b.unique(b.map(e,c)),void 0);g.isLoggedIn()&&this.updateBlogFollows(f,e)}.bind(this)),this},updateBlogFollows:function(a,c){var d=function(c){(g.hasRole("AUTHOR",c)||g.isSuperuser())&&h.getFollowedBlogIds().done(function(d){var e=b.intersection(d,a),f=b.difference(a,e);this.updateFollowState(e,"follow",c),this.updateFollowState(f,"unfollow",c)}.bind(this))};b.chain(c).union([h.id]).unique().compact().each(d,this)},followUserForBlog:function(a){return this.followReplyAction("blogfollow",a),!1},unfollowUserForBlog:function(a){return this.followReplyAction("unfollow",a),!1},followReplyAction:function(c,d){var e,i,j,k=a(d.currentTarget).closest(".js_follow-controls"),l=k.data("postid"),m=k.data("blogid");e=function(){var a=h.id;return m===g.get("defaultBlogId")?!1:void g.setBlogAction(c,a,m,{success:function(a){var d;i=new f({id:l}),"blogfollow"===c&&!i.get("isStarter")&&!i.get("approved")&&a.data&&a.data.approvedReplies&&(j=b.pluck(a.data.approvedReplies,"postId"),k.closest(".js_reply").trigger("approval",{approvedReplyIDs:j})),d="unfollow"===c?b.without(h.followedBlogIds,m):b.union(h.followedBlogIds,[m]),h.followedBlogIds=d,this.update()}.bind(this),error:function(a){throw new Error("PostTools.followBlog(): "+a.reason)}})}.bind(this),g.requireLogin("blogFollowTool").done(function(){e()})},updateFollowState:function(a,b,c){this.updateFollowControls(a,b,c)},updateFollowControls:function(b,c,d){var e=i("js_follow-controls",b,d);this.$(e).each(function(b,d){var e,f,h=a(d);e=parseInt(h.data("blogid"),10),f=g.get("defaultBlogId")===e,h.find(".js_followforblog").toggleClass("hide","follow"===c||f).end().find(".js_unfollowforblog").toggleClass("hide","unfollow"===c||f)})},removeControls:function(b){b=b||a("body"),b.find(".js_followforblog, .js_unfollowforblog").addClass("hide")}})}),define("view/posttools/BlogFollowToolView",["jquery","underscore","config","singleton/Feature","view/BaseView","model/Blog","model/post/Post","singleton/CurrentUser"],function(a,b,c,d,e,f,g,h){var i,j;return i=function(a,c){return b.map(c,function(b){return"."+a+'[data-blogid="'+b+'"]'}).join(", ")},j=e.extend({events:{"click .js_followblogforuser":"followBlogForUser","click .js_unfollowblogforuser":"unfollowBlogForUser"},initialize:function(){var a=b.debounce(this.update,1e3);h.on("authenticated",a,this),this.on("update",a,this)},update:function(b){var c;return b=b||{},c=b.el||a("body"),h.onAuth.done(a.proxy(function(){h.isLoggedIn()?(this.updateBlogFollows(h.get("followedBlogIds"),"follow"),this.hideOwnBlogs()):this.resetControls(c)},this)),this},updateBlogFollows:function(b,c){var d=i("js_follow-blog-controls",b);a(d).find(".js_followblogforuser").toggleClass("hide","follow"===c).end().find(".js_unfollowblogforuser").toggleClass("hide","unfollow"===c)},hideOwnBlogs:function(){var c=i("js_follow-blog-controls",b.pluck(h.getBlogs(),"id"));a(c).addClass("hide")},resetControls:function(a){a.find(".js_unfollowblogforuser").addClass("hide"),a.find(".js_followblogforuser").removeClass("hide")},followBlogForUser:function(a){return this.blogFollowAction(a),!1},unfollowBlogForUser:function(a){return this.blogUnfollowAction(a),!1},blogFollowAction:function(b){var c=a(b.currentTarget).closest(".js_follow-blog-controls"),d=parseInt(c.attr("data-blogid"),10);h.requireLogin("blogfollow").done(function(){return-1!==h.get("followedBlogIds").indexOf(d)?!1:void h.followBlog(d).done(function(){this.updateBlogFollows([d],"follow")}.bind(this))}.bind(this))},blogUnfollowAction:function(b){var c=a(b.currentTarget).closest(".js_follow-blog-controls"),d=parseInt(c.attr("data-blogid"),10);h.requireLogin("blogunfollow").done(function(){h.unfollowBlog(d).done(function(){this.updateBlogFollows([d],"unfollow")}.bind(this))}.bind(this))}})}),define("view/posttools/UserFollowToolView",["jquery","underscore","view/BaseView","singleton/CurrentUser"],function(a,b,c,d){var e,f;return e=function(a,c){return b.map(c,function(b){return"."+a+'[data-authorid="'+b+'"]'}).join(", ")},f=c.extend({events:{"click .js_followforuser":"followUserForUser","click .js_unfollowforuser":"unfollowUserForUser"},initialize:function(){var a=b.debounce(this.update,1e3);d.on("authenticated",a,this),this.on("update",a,this)},update:function(b){var c,e;return b=b||{},c=b.el||a("body"),d.onAuth.done(a.proxy(function(){this.resetControls(c),this.removeAvatarMarker(c),d.isLoggedIn()&&(e=d.get("followedAuthorIds"),this.toggleMarker(e,"follow"),this.updateUserFollows(e,"follow"))},this)),this},updateUserFollows:function(c,f){var g=e("js_user-follow-controls",b.without(c,d.id));a('.js_user-follow-controls[data-authorid="'+d.id+'"]').find(".js_followforuser, .js_unfollowforuser").addClass("hide"),a(g).find(".js_followforuser").toggleClass("hide","follow"===f).end().find(".js_unfollowforuser").toggleClass("hide","unfollow"===f)},followUserForUser:function(a){return this.userfollowAction(a),!1},unfollowUserForUser:function(a){return this.userunfollowAction(a),!1},userfollowAction:function(b){var c=a(b.currentTarget).closest(".js_user-follow-controls"),e=c.attr("data-authorid");d.requireLogin("userfollow").done(function(){d.followUser(e).done(function(){this.toggleMarker([e],"follow"),this.updateUserFollows([e],"follow")}.bind(this))}.bind(this))},userunfollowAction:function(b){var c=a(b.currentTarget).closest(".js_user-follow-controls"),e=c.attr("data-authorid");d.requireLogin("authorunfollow").done(function(){d.unfollowUser(e).done(function(){this.toggleMarker([e],"unfollow"),this.updateUserFollows([e],"unfollow")}.bind(this))}.bind(this))},toggleMarker:function(a,b){var c=e("js_author",a);this.$(c).toggleClass("followed","follow"===b)},resetControls:function(b){b=b||a("body"),b.find(".js_followforuser").removeClass("hide"),b.find(".js_unfollowforuser").addClass("hide")},removeAvatarMarker:function(b){b=b||a("body"),b.find(".js_author").removeClass("followed")}})}),define("apiclient/likestate",["config","apiclient/apirequest","apiclient/gettoken"],function(a,b,c){var d;return d={getForPosts:b.getJson(c.append(a.api.core.url+"/like/status"),{}),getForStarter:b.getJson(c.append(a.api.core.url+"/like/{{starterId}}"),{})}}),define("apiclient/post",["config","apiclient/apirequest","apiclient/gettoken","singleton/Feature"],function(a,b,c,d){var e,f=d.isOn("postsecuretoken")?a.api.mantle.url+"/post":"/ajax/post",g=d.isOn("editor_warnings_test")?"?dummyWarnings=true":"";return e={create:b.postJson(c.append(f+g,d.isOn("postsecuretoken")?c.secure:c.fresh)),read:b.getJson(c.append(f+"/preview/{{id}}"+g,d.isOn("postsecuretoken")?c.secure:c.fresh)),update:b.postJson(c.append(f+"/{{id}}/jsonUpdate"+g,d.isOn("postsecuretoken")?c.secure:c.fresh)),directUpdate:b.postJson(c.append(a.api.core.url+"/post/{{id}}/update"+g,d.isOn("postsecuretoken")?c.secure:c.fresh)),"delete":b.postJson(c.append(f+"/{{id}}/delete",d.isOn("postsecuretoken")?c.secure:c.fresh)),generatePostJson:function(a){return b.postJson(c.append(f+a+g,d.isOn("postsecuretoken")?c.secure:c.fresh))}}}),define("singleton/PostHelper",["config","jquery","underscore","singleton/CurrentUser","singleton/Utils","singleton/Feature","model/post/Post","apiclient/likestate","apiclient/post"],function(a,b,c,d,e,f,g,h,i){var j={parsePostModelDataFromDom:function(a){return JSON.parse(decodeURIComponent(a.data("model")))},parseFromDom:function(a){var d,e=[];return d=c.isUndefined(a)?b("body").find(".js_post_item, .js_reply, .js_event_item"):a.is(".js_post_item, .js_reply, .js_event_item")?a:a.find(".js_post_item, .js_reply, .js_event_item"),c.each(d,function(a){var c=b(a),d={};void 0!==c.data("model")?(d=this.parsePostModelDataFromDom(c),e.push({model:new g(d),node:c})):void 0!==c.data("id")&&e.push({model:new g({id:c.data("id")}),node:c})},this),e},likeStatusFor:function(a){var b=c.map(a,function(a){return a.model.id});d.onAuth.done(function(){return d.isLoggedIn()&&b?void h.getForPosts({id:b},{traditional:!0}).done(function(b){c.each(b,function(b){var d=b.objectId,e=c.find(a,function(a){return a.model.id===d});e&&e.model.setLikeState(b)})}):!1}.bind(this))},createLiveblogPost:function(a){a!==!0&&(a=!1);var b,c,d=e.getKinjaMeta().postId;if(void 0===d||null===d)throw new Error("No post id found, can't set liveblog property");if(b=e.getKinjaMeta().post,void 0===b||null===b)throw new Error("No post found, can't set liveblog property");if(c=b.defaultBlogId,void 0===c||null===c)throw new Error("No default blog id found, can't set liveblog property");i.directUpdate({id:d,liveBlog:a,defaultBlogId:c}).done(function(){window.console.log(a?"Enabled liveblog feature":"Disabled liveblog feature")})},positionReadMore:function(a){var b=c.map(a,function(a){return a.node});c(b).each(function(a){var b,c,d,e=a.find(".read-more .show-on-hover");e.length&&(b=a.find(".read-more").position().left,c=e.width(),d=e.parents(".columns").first().width(),b+c+10>=d&&a.find(".read-more .timestamp").css("display","block"))})},getContentType:function(a){return f.isOn("postmodelcleanup")?a.get("contentType"):a.get("images").length>0||a.get("videos").length>0?"Media":"Text only"}};return j}),define("app/mixins/PostViewLoader",["jquery","underscore","view/PostView","view/ReplyView","view/posttools/ApproveToolView","view/posttools/BlogFollowToolView","view/posttools/UserFollowToolView","singleton/PostHelper","singleton/Feature","module/flagging/ReplyFlaggingModule"],function(a,b,c,d,e,f,g,h,i,j){var k={followtool:null,initPostTools:function(c){var d=a("body");this.on("update.postlist.post",this.addPosts,this),this.on("update.postlist.reply",this.addReplies,this),this.userfollowtool=new g({el:d}),this.blogfollowtool=new f({el:d}),this.approvetool=new e({el:d}),this.on("update.follows",this.addFollowButtons,this),this.addPosts({el:a("body")}),i.isOn("groupchats_refactor")||b.isUndefined(c)||j.loadFlaggedReplies(c)},addPosts:function(a){this._startPostViews(a,c)},addReplies:function(c){i.isOn("groupchats_refactor")?this.addFollowButtons({el:c.el}):this._startPostViews(c,d),b.isFunction(a.fn.foundation)&&a(document).foundation()},addFollowButtons:function(a){this.userfollowtool.trigger("update",{el:a.el}),this.blogfollowtool.trigger("update",{el:a.el}),this.approvetool.trigger("update",{el:a.el})},_startPostViews:function(c,d){var e,f,g;c=c||{},f=c.el||a("body"),e=h.parseFromDom(f),b.each(e,function(a){j.extendPostModel(a.model);var b=new d({model:a.model,el:a.node});b.start(),c.callback&&c.callback.call(this,b)},this),e.length>0&&(h.likeStatusFor(e),h.positionReadMore(e),g=b.debounce(a.proxy(h.positionReadMore,this,e),300),a(window).on("resize orientationchange",g)),this.addFollowButtons({el:f})}};return k}),define("templates/tiger/components/post/button/promote-button",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.post.button.promoteButton=function(a,c,e){var f=c||new d.StringBuilder,g=a.assetId?a.assetId:"",h=e.features.svgicons;return f.append('<a href="#" class="recommend js_recommend ',d.$$escapeHtml(a.type),"-recommend js_",d.$$escapeHtml(a.type),"-recommend ",a.isActive?" active ":""," readonly-hide",h?" icon--svg":"",'" data-asset-source="',d.$$escapeHtml(a.assetSource),'" data-asset-id="',d.$$escapeHtml(g),'"',a.isRecommendable?'title="Recommend':"video"==a.type?'title="Recommend (WARNING: Minimum recommended front page video thumbnail size is 640×360. This video has a smaller thumbnail. Visual degradation may occur.)':'title="Recommend (WARNING: Minimum recommended front page image size is 640×360. This '+d.$$escapeHtml(a.type)+" is smaller. Visual degradation may occur.)",'">'),h?b.icons.essential.star(null,f,e):f.append('<span class="icon icon-star icon-white oversized"></span>'),f.append("</a>"),c?"":f.toString()}}),define("apiclient/recommendation",["config","apiclient/apirequest","apiclient/gettoken","templates/tiger/components/post/button/promote-button","templates/tiger/messages"],function(a,b,c){return{recommendPost:b.postJson(c.append(a.api.core.url+"/post/{{postId}}/recommendAsset")),unrecommendPost:b.postJson(c.append(a.api.core.url+"/post/{{postId}}/unrecommendAsset"))}}),define("app/mixins/PostAssetPromoter",["jquery","underscore","singleton/CurrentUser","singleton/EventDispatcher","singleton/Feature","singleton/Utils","view/BaseView","model/post/Post","apiclient/recommendation","templates/tiger/components/post/button/promote-button","templates/tiger/messages"],function(a,b,c,d,e,f,g,h,i){var j=g.extend({initialize:function(a){this.model=a.model,this.assets=this.filterAssets(this.model),this.renderUI()},filterAssets:function(a){var c=b.compact(b.map(a.get("images"),this.filterAndCreateImageObject,this)),d=b.compact(b.map(a.get("videos"),this.createVideoObject,this));return c.concat(d)},filterAndCreateImageObject:function(a){var c,d;return c=null!==a.id?a.id:"",d=c?this.findByChompId(c):this.$('[src="'+(null!==a.src?a.src:"")+'"]'),b.extend(a,{$el:d,type:"image"})},createVideoObject:function(a){var c=a.src.split("//")[1],d=this.findByChompId(c);return b.extend(a,{$el:d,type:"video"})},recommendAsset:function(a,c){var d=c?"image://"+String(c):a;return i.recommendPost({postId:this.model.get("id"),assetUri:d}).then(b.bind(this.updateAssetsData,this)).then(b.bind(this.renderUI,this))},unrecommendAsset:function(a,c){var d=c?"image://"+String(c):a;return i.unrecommendPost({postId:this.model.get("id"),assetUri:d}).then(b.bind(this.updateAssetsData,this)).then(b.bind(this.renderUI,this))},updateAssetsData:function(a){var b=new h(a);this.assets=this.filterAssets(b)},renderUI:function(){this.$(".js_post_item").find(".js_recommend").remove(),this.renderPromoteButtons(),this.bindPromoteEvents()},renderPromoteButtons:function(){b.each(this.assets,function(a){this.renderPromoteButton(a)},this)},renderPromoteButton:function(b){var c,d=tiger.components.post.button.promoteButton,e={isActive:b.recommended,type:b.type,assetId:void 0!==b.id?String(b.id):"",assetSource:b.src||b.uri,isRecommendable:this.calcRecommendability(b)},f=this.soyToHtml(d,e);switch(b.type){case"image":c=b.$el.closest(".img-border"),0===c.length&&(c=b.$el.closest(".columns"),a(f).addClass("marquee-recommend-btn"));break;case"video":c=b.$el.closest(".flex-video")}c.append(f)},calcRecommendability:function(a){var b=!1,c=f.getKinjaMeta();return b=a.thumbnails&&a.thumbnails.length?a.thumbnails[0].width>=c.imageSizes.KinjaExtraLarge.width:a.width>=c.imageSizes.KinjaExtraLarge.width},displayRecommendMessage:function(){d.trigger("successbox:display",{message:tiger.messages.assetRecommended})},displayUnrecommendMessage:function(){d.trigger("successbox:display",{message:tiger.messages.assetUnrecommended})},bindPromoteEvents:function(){this.$(".js_post-wrapper").off("click",".js_recommend"),this.$(".js_post-wrapper").on("click",".js_recommend",b.bind(this.recommendClickHandler,this))},recommendClickHandler:function(b){var c=a(b.currentTarget);return this.handleRecommendation(c.data("asset-source"),c.data("asset-id")),!1},handleRecommendation:function(c,d){var e=b.find(this.assets,function(a){return a.recommended===!0}),f=null,g=null,h=null;e&&(f=e.src||e.uri,g=e.id),f?(h=a.when(this.unrecommendAsset(f,g)),f===c?h.then(this.displayUnrecommendMessage):b.delay(a.proxy(function(){h.then(this.recommendAsset(c,d)),h.then(this.displayRecommendMessage)},this),600)):(h=a.when(this.recommendAsset(c,d)),h.then(this.displayRecommendMessage))},findByChompId:function(a){var b;return a.indexOf("#")>-1&&(a=a.split("#")[0]),b=this.$('[data-chomp-id="'+a+'"]'),0===b.length&&(b=this.$('[data-recommend-chomp-id="'+a+'"]')),b}});return{startAssetPromoter:function(a){if(a){var b,c=a.has("images")&&a.get("images").length>0,d=a.has("videos")&&a.get("videos").length>0;(c||d)&&(b=new j({model:a,el:this.el}))}}}}),define("model/post/ViewStatModel",["jquery","underscore","config","backbone","singleton/Feature"],function(a,b,c,d,e){var f=d.Model.extend({defaults:{postid:null},parse:function(a){var c={};return a.meta&&a.meta.error?c:b.find(a.data,function(a){return a.id===this.get("postid")},this)||c},sync:function(d,f,g){var h,i,j,k,l,m;if("create"!==d&&f.attributes&&(void 0===f.attributes.postid||null===f.attributes.postid))throw new Error("ViewStatModel.sync(): model undefined");switch(d){case"create":throw new Error("ViewStatModel.sync(): create not allowed");case"read":m=e.isOn("linkswoprotocol")?c.api.analytics.urlWoProtocol:c.api.analytics.url,h="GET",i=m+"/stats/post?id="+f.attributes.postid;break;case"update":throw new Error("ViewStatModel.sync(): update not allowed");case"delete":throw new Error("ViewStatModel.sync(): delete not allowed")}return k={type:h,dataType:"json",url:i,data:j||null},l=a.ajax(b.extend(k,g))}});return f}),define("templates/tiger/components/agegate",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.agegate.form=function(a,b){var c=b||new d.StringBuilder;return c.append('	<div class="age-gate-container"><div class="row"><div class="four columns centered"><form class="js_age-gate-form" action="#"><div class="proxima text-upper text-center mbx">Please confirm your birth date:</div><div class="row mvm"><div class="eleven columns centered"><div class="row"><div class="three mobile-one columns"><input type="text" size="2" maxlength="2" name="month" value="mm" class="js_month" /></div><div class="three mobile-one columns"><input type="text" size="2" maxlength="2" name="day" value="dd" class="js_day" /></div><div class="three mobile-one columns"><input type="text" size="4" maxlength="4" name="year" value="yyyy" class="js_year" /></div><div class="three mobile-one columns"><input class="button" type="submit" value="Submit" /></div></div><div class="row mtm js_date-invalid hide"><div class="twelve columns text-center proxima"><small class="error inline">Please enter a valid date</small></div></div></div></div></form></div></div></div>'),b?"":c.toString()},b.components.agegate.rejected=function(a,b){var c=b||new d.StringBuilder;return c.append('	<div class="age-gate-container"><div class="row"><div class="four columns centered text-center proxima strong"><h2>This content is restricted.</h2></div></div></div>'),b?"":c.toString()}}),define("view/items/AgeGate",["jquery","underscore","view/BaseView","singleton/Utils","templates/tiger/components/agegate"],function(a,b,c,d){var e=c.extend({postList:["479817984","1210675194"],year:null,month:null,day:null,events:{"submit .js_age-gate-form":"handleClick"},initialize:function(){var c,e,f=a.cookie("visitor_birthdate");"permalink"===this.getPageType()&&(c=d.getKinjaMeta().postId,b.indexOf(this.postList,c)>=0&&(null===f?this.render():(e=f.split("_"),this.validateAge(e[0],e[1],e[2])===!0?this.remove():this.rejected())))},render:function(){a("body").prepend(this.soyToHtml(tiger.components.agegate.form,{})),this.$el=a("body .age-gate-container"),this.$el.find(".js_month").focus()},rejected:function(){a("body .age-gate-container").remove(),a("body").prepend(this.soyToHtml(tiger.components.agegate.rejected,{}))},handleClick:function(){return this.validateForm()===!0?this.validateAge(this.year,this.month,this.day)===!0?this.remove():this.rejected():this.$el.find(".js_month").focus(),!1},validateForm:function(){var a=this,c=function(c,d,e){return a[c]=parseInt(a.$(".js_"+c).val(),10),b.isNaN(a[c])===!1&&a[c]>=d&&a[c]<=e},d=c("year",1900,2014)&&c("month",1,12)&&c("day",1,31);return this.$el.find(".js_date-invalid").toggleClass("hide",d),d},validateAge:function(b,c,d){return a.cookie("visitor_birthdate",b+"_"+c+"_"+d),moment(b+"-"+c+"-"+d).add("years",18)<moment()}});return e}),define("view/ImageLoader",["jquery","underscore","singleton/EventDispatcher","singleton/Feature","view/BaseView","lib/waypoints","lib/jquery.browser.mobile"],function(a,b,c,d,e){var f=a(document),g=a(window),h={initialLookaheadFactor:.8,lookaheadFactor:2.6,containerClass:"lazy-image"},i="loaded",j=e.extend({$allWrappers:a(),$allImages:a(),$watchedWrappers:a(),$watchedImages:a(),viewportHeight:0,scrollTop:0,initialize:function(d){this.options=b.defaults(d||{},h),b.bindAll(this,"loadIfVisible","handleScroll"),this.registerImages(this.$el),this.addScrollEvents(),a(window).resize(b.debounce(b.bind(this.setAbsoluteHeight,this),300)),c.on("rendered.postlist.reply",function(a){this.registerImages(a.el)}.bind(this))},registerImages:function(b){var c=this.options.containerClass,d=b.find("."+c),e=d.find("img");this.$allWrappers=this.$allWrappers.add(d),this.$allImages=this.$allImages.add(e),this.$watchedImages=this.$watchedImages.add(e),this.$watchedWrappers=this.$watchedWrappers.add(d),this.setAbsoluteHeight(),this.$allImages.each(function(b,d){var e=a(d);e.data("wrapper",e.closest("."+c))}),this.trigger("images:registered")},addScrollEvents:function(){var c=b.bind(function(){this.viewportHeight=a.waypoints("viewportHeight")},this);c(),g.resize(b.debounce(c,1e3)),g.scroll(b.throttle(b.partial(this.handleScroll,this.options.lookaheadFactor),500)),this.handleScroll(this.options.initialLookaheadFactor)},setAbsoluteHeight:function(){var b=this.$allImages;b.each(function(){var b,c=a(this),d=c.data("aspectRatio")||c.attr("width")/c.attr("height");c.data("aspectRatio")||c.data("aspectRatio",d),b=Math.round(c.prop("width")/d),b&&c.data("newHeight",b)}),b.each(function(){var b=a(this);b.css("max-height",b.data("newHeight"))})},loadImage:function(b){var c=a(b);c.data(i)||this.waitForPlaceholder(c)},reinitializeInterchange:b.once(function(){a(document).foundation("interchange")}),updateInterchange:b.throttle(function(){this.reinitializeInterchange(),a(document).foundation("interchange","reflow")},150),_loadImage:function(a){var c,d=a.data("src"),e=a.data("lazyInterchange");this.trigger("imageLoading",{$el:a}),c=b.bind(function(){a.off("load",c).addClass("lazy-loaded"),this.trigger("imageLoaded",{$el:a}),this.$watchedImages=this.$watchedImages.not(a),this.$watchedWrappers=this.$watchedWrappers.not(a.data("wrapper"))},this),a.load(c).data(i,!0),d?a.attr("src",d):e?(a.attr("data-interchange",e),this.updateInterchange()):a.load()},waitForPlaceholder:function(a){var c,d="await-placeholder",e=a.data("wrapper");e.hasClass("asset-loading")?a.data(d)||(a.data(d,!0),c=b.bind(function(){a.off("load",c),this._loadImage(a)},this),a.load(c)):this._loadImage(a)},loadIfVisible:function(b,c){var d=a(b);d.data(i)||d.is(":hidden")||!this.inViewPort(d,c)||this.loadImage(d)},inViewPort:function(b,c){var d=this.scrollTop,e=c||this.options.lookaheadFactor,f=this.viewportHeight,g=f*e,h=d+f+g,i=d-g,j=Math.round(a(b).offset().top),k=Math.round(j+a(b).outerHeight()),l=k>i,m=h>j;return l&&m},handleScroll:function(a){this.scrollTop=window.pageYOffset||f.scrollTop(),b.each(this.$watchedImages,function(b){this.loadIfVisible(b,a)},this)}});return j}),define("view/GifImageLoader",["jquery","underscore","singleton/EventDispatcher","singleton/Feature","view/ImageLoader","lib/jquery.browser.mobile"],function(a,b,c,d,e){var f,g={mobileGifs:!0,gifClass:"lazy-gif",thawableClass:"thawable",thawingClass:"thawing",thawedClass:"thawed"};return f=e.extend({initialize:function(a){b.extend(this.options,b.defaults(a||{},g)),this.addEvents(),this.on("images:registered",this.markImagesThawable),e.prototype.initialize.apply(this,arguments)},addEvents:function(){var b=this.options.gifClass,e=function(a){return a.data("wrapper").hasClass(b)};(d.isOn("webm")||!a.browser.mobile)&&(this.on("imageLoading",function(b){var c=b.$el,d=new Image,f=c.data("anim-src");e(c)&&a(d).attr("src",f)},this),this.on("imageLoaded",function(a){var b=a.$el;e(b)&&this.thawImage(b)},this)),c.on("thawImage",function(a){var b=a.$el;"IMG"!==b.prop("tagName")&&(b=b.find("img")),this.thawImage(b)},this)},markImagesThawable:function(){var b=this.options;a.browser.mobile&&b.mobileGifs&&this.$allWrappers.addClass(b.thawableClass)},thawImage:function(b){if(d.isOn("webm")){var c,e=a("<video>");c=b.data(e[0].canPlayType("video/webm")?"webm-src":"mp4-src"),e.attr({autoplay:!0,controls:a.browser.mobile,loop:!0,muted:!0,src:c,poster:b.attr("src"),"class":b.attr("class"),style:b.attr("style"),"data-chomp-id":b.data("chomp-id")}),e.data("wrapper",b.data("wrapper")),this.startLoadIndicator(e),b.replaceWith(e)}else{var f=b.data("animSrc")||b.data("assetUrl"),g=b.data("animInterchange");this.startLoadIndicator(b),f&&b.attr("src",f),g&&(b.attr("data-interchange",g),this.updateInterchange())}},startLoadIndicator:function(b){var c=a(b),e=c.data("wrapper"),f=this.options,g=function(){e.removeClass(f.thawingClass).addClass(f.thawedClass)};e.removeClass(f.thawableClass).addClass(f.thawingClass),c.load(g).error(g),d.isOn("webm")&&c.on("loadedmetadata",g)}})}),function(a){function b(a,b,k){var l=0,m=[0],o="",p=null,o=k||"UTF8";if("UTF8"!==o&&"UTF16"!==o)throw"encoding must be UTF8 or UTF16";if("HEX"===b){if(0!==a.length%2)throw"srcString of HEX type must be in byte increments";p=d(a),l=p.binLen,m=p.value}else if("TEXT"===b)p=c(a,o),l=p.binLen,m=p.value;else if("B64"===b)p=f(a),l=p.binLen,m=p.value;else{if("BYTES"!==b)throw"inputFormat must be HEX, TEXT, B64, or BYTES";p=e(a),l=p.binLen,m=p.value}this.getHash=function(a,b,c,d){var e,f=null,k=m.slice(),o=l;if(3===arguments.length?"number"!=typeof c&&(d=c,c=1):2===arguments.length&&(c=1),c!==parseInt(c,10)||1>c)throw"numRounds must a integer >= 1";switch(b){case"HEX":f=g;break;case"B64":f=h;break;case"BYTES":f=i;break;default:throw"format must be HEX, B64, or BYTES"}if("SHA-1"!==a)throw"Chosen SHA variant is not supported";for(e=0;c>e;e+=1)k=n(k,o),o=160;return f(k,j(d))},this.getHMAC=function(a,b,k,p,q){var r,s,t,u,v=[],w=[];switch(r=null,p){case"HEX":p=g;break;case"B64":p=h;break;case"BYTES":p=i;break;default:throw"outputFormat must be HEX, B64, or BYTES"}if("SHA-1"!==k)throw"Chosen SHA variant is not supported";if(s=64,u=160,"HEX"===b)r=d(a),t=r.binLen,r=r.value;else if("TEXT"===b)r=c(a,o),t=r.binLen,r=r.value;else if("B64"===b)r=f(a),t=r.binLen,r=r.value;else{if("BYTES"!==b)throw"inputFormat must be HEX, TEXT, B64, or BYTES";r=e(a),t=r.binLen,r=r.value}if(a=8*s,b=s/4-1,t/8>s){if("SHA-1"!==k)throw"Unexpected error in HMAC implementation";r=n(r,t),r[b]&=4294967040}else s>t/8&&(r[b]&=4294967040);for(s=0;b>=s;s+=1)v[s]=909522486^r[s],w[s]=1549556828^r[s];if("SHA-1"!==k)throw"Unexpected error in HMAC implementation";return k=n(w.concat(n(v.concat(m),a+l)),a+u),p(k,j(q))}}function c(a,b){var c,d,e=[],f=[],g=0;if("UTF8"===b)for(d=0;d<a.length;d+=1)for(c=a.charCodeAt(d),f=[],128>c?f.push(c):2048>c?(f.push(192|c>>>6),f.push(128|63&c)):55296>c||c>=57344?f.push(224|c>>>12,128|c>>>6&63,128|63&c):(d+=1,c=65536+((1023&c)<<10|1023&a.charCodeAt(d)),f.push(240|c>>>18,128|c>>>12&63,128|c>>>6&63,128|63&c)),c=0;c<f.length;c+=1)(g>>>2)+1>e.length&&e.push(0),e[g>>>2]|=f[c]<<24-g%4*8,g+=1;else if("UTF16"===b)for(d=0;d<a.length;d+=1)(g>>>2)+1>e.length&&e.push(0),e[g>>>2]|=a.charCodeAt(d)<<16-g%4*8,g+=2;return{value:e,binLen:8*g}}function d(a){var b,c,d=[],e=a.length;if(0!==e%2)throw"String of HEX type must be in byte increments";for(b=0;e>b;b+=2){if(c=parseInt(a.substr(b,2),16),isNaN(c))throw"String of HEX type contains invalid characters";d[b>>>3]|=c<<24-b%8*4}return{value:d,binLen:4*e}}function e(a){var b,c,d=[];for(c=0;c<a.length;c+=1)b=a.charCodeAt(c),(c>>>2)+1>d.length&&d.push(0),d[c>>>2]|=b<<24-c%4*8;return{value:d,binLen:8*a.length}}function f(a){var b,c,d,e,f,g=[],h=0;if(-1===a.search(/^[a-zA-Z0-9=+\/]+$/))throw"Invalid character in base-64 string";if(b=a.indexOf("="),a=a.replace(/\=/g,""),-1!==b&&b<a.length)throw"Invalid '=' found in base-64 string";for(c=0;c<a.length;c+=4){for(f=a.substr(c,4),d=e=0;d<f.length;d+=1)b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[d]),e|=b<<18-6*d;for(d=0;d<f.length-1;d+=1)g[h>>2]|=(e>>>16-8*d&255)<<24-h%4*8,h+=1}return{value:g,binLen:8*h}}function g(a,b){var c,d,e="",f=4*a.length;for(c=0;f>c;c+=1)d=a[c>>>2]>>>8*(3-c%4),e+="0123456789abcdef".charAt(d>>>4&15)+"0123456789abcdef".charAt(15&d);return b.outputUpper?e.toUpperCase():e}function h(a,b){var c,d,e,f="",g=4*a.length;for(c=0;g>c;c+=3)for(e=(a[c>>>2]>>>8*(3-c%4)&255)<<16|(a[c+1>>>2]>>>8*(3-(c+1)%4)&255)<<8|a[c+2>>>2]>>>8*(3-(c+2)%4)&255,d=0;4>d;d+=1)f=8*c+6*d<=32*a.length?f+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>6*(3-d)&63):f+b.b64Pad;return f}function i(a){var b,c,d="",e=4*a.length;for(b=0;e>b;b+=1)c=a[b>>>2]>>>8*(3-b%4)&255,d+=String.fromCharCode(c);return d}function j(a){var b={outputUpper:!1,b64Pad:"="};try{a.hasOwnProperty("outputUpper")&&(b.outputUpper=a.outputUpper),a.hasOwnProperty("b64Pad")&&(b.b64Pad=a.b64Pad)}catch(c){}if("boolean"!=typeof b.outputUpper)throw"Invalid outputUpper formatting option";if("string"!=typeof b.b64Pad)throw"Invalid b64Pad formatting option";return b}function k(a,b){return a<<b|a>>>32-b}function l(a,b){var c=(65535&a)+(65535&b);return((a>>>16)+(b>>>16)+(c>>>16)&65535)<<16|65535&c}function m(a,b,c,d,e){var f=(65535&a)+(65535&b)+(65535&c)+(65535&d)+(65535&e);return((a>>>16)+(b>>>16)+(c>>>16)+(d>>>16)+(e>>>16)+(f>>>16)&65535)<<16|65535&f}function n(a,b){var c,d,e,f,g,h,i,j,n,o=[],p=[1732584193,4023233417,2562383102,271733878,3285377520];for(a[b>>>5]|=128<<24-b%32,a[(b+65>>>9<<4)+15]=b,n=a.length,i=0;n>i;i+=16){for(c=p[0],d=p[1],e=p[2],f=p[3],g=p[4],j=0;80>j;j+=1)o[j]=16>j?a[j+i]:k(o[j-3]^o[j-8]^o[j-14]^o[j-16],1),h=20>j?m(k(c,5),d&e^~d&f,g,1518500249,o[j]):40>j?m(k(c,5),d^e^f,g,1859775393,o[j]):60>j?m(k(c,5),d&e^d&f^e&f,g,2400959708,o[j]):m(k(c,5),d^e^f,g,3395469782,o[j]),g=f,f=e,e=k(d,30),d=c,c=h;p[0]=l(c,p[0]),p[1]=l(d,p[1]),p[2]=l(e,p[2]),p[3]=l(f,p[3]),p[4]=l(g,p[4])}return p}"function"==typeof define&&define.amd?define("lib/sha1",[],function(){return b}):"undefined"!=typeof exports?"undefined"!=typeof module&&module.exports?module.exports=exports=b:exports=b:a.jsSHA=b}(this),define("gawkerlib/urlUtil",["underscore"],function(a){var b={toQueryString:function(b){var c=a.reduce(b,function(a,b,c){return a.push(c+"="+encodeURIComponent(b)),a},[]).join("&");return c.length>0&&(c="?"+c),c},fromQueryString:function(b){return a.reduce(b.replace("?","").split("&"),function(b,c){return c.length>0&&a.extend(b,a.object([a.map(c.split("="),decodeURIComponent)])),b},{})}};return b}),define("module/discussion/discussion.channel",["backbone","underscore"],function(a,b){return b.extend({},a.Events)}),define("view/sharingfooter.view",["jquery","underscore","backbone.marionette","singleton/WindowController","singleton/Feature","module/discussion/discussion.channel","app/post/posttools/controller/posttools.like.controller","jquery.tap"],function(a,b,c,d,e,f,g){var h=c.ItemView.extend({ui:{likeButton:".js_like",likeIcon:".js_like_icon",likeCountPlaceholder:".js_like_count",replyButton:".js_reply-to-post",replyCount:".js_reply-count",sharePostButton:".js_share-post-item"},modelEvents:{"change:liked":"_updateLikeIconClasses","posttools:post:likeCount:updated":"_updateLikeCount"},events:{"click a":function(a){a.preventDefault()
},"tap @ui.replyButton":"reply","tap @ui.likeButton":"like","tap @ui.sharePostButton":"externalShare","touchstart a":"onTouchStart","touchend a":"onTouchEnd"},onTouchStart:function(b){a(b.target).addClass("hovered")},onTouchEnd:function(b){window.setTimeout(function(){a(b.target).removeClass("hovered")},200)},reply:function(){var c=a(".replies-wrapper"),f=e.value("sharingfooter_speed")||1e3;return d.isPartiallyVisible(c)||b.throttle(a.scrollTo(a(c),{duration:f,easing:"easeInOutQuad"}),f),!1},_likeInProgress:!1,like:function(){return this._likeInProgress||(this._likeInProgress=!0,this.model.once("posttools:post:likeCount:updated",function(){this._likeInProgress=!1}.bind(this)),g.like(this.model)),!1},externalShare:function(c){var d=a(c.currentTarget),e=d.attr("href"),f={twitter:"toolbar=0,status=0,width=480,height=360,top="+(window.screen.height/2-180)+",left="+(window.screen.width/2-240),facebook:"toolbar=0,status=0,width=480,height=360,top="+(window.screen.height/2-180)+",left="+(window.screen.width/2-240)},g=b.intersection(d.attr("class").split(/\s+/),["twitter","facebook"])[0];return window.open(e,"share"+g,f[g]),d.addClass("used"),!1},initialize:function(){a.easing.easeInOutQuad=function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b+c:-d/2*(--b*(b-2)-1)+c};var b=function(b){return a("<div/>").html(b).text()},c=function(a){return a?a.replace(/&#(\d+);/g,function(a,b){return String.fromCharCode(b)}):""},d=this.model.get("headline")||this.model.get("first100Characters")||this.model.get("compact");this.$(this.ui.sharePostButton).each(function(e,f){var g=a(f),h=g.attr("href");g.attr("href",h.replace("POST_TITLE",encodeURIComponent(b(c(d)))))}),this.listenTo(f,"newComment",this.updateCommentCount)},updateCommentCount:function(){var a=this.$(this.ui.replyCount);a.html(parseInt(a.html(),10)+1)},_updateLikeIconClasses:function(){this.$(this.ui.likeIcon).toggleClass("active",this.model.get("liked"))},_updateLikeCount:function(){var b=parseInt(a(".js_like.button-recommend-post").data("likecount"),10)||0;this.$(this.ui.likeCountPlaceholder).text(b||"0")}});return h}),define("module/PostApp",["jquery","underscore","backbone","moment","lib/amd-wrapped/modernizr","singleton/Utils","singleton/CurrentUser","singleton/CurrentBlog","singleton/Feature","singleton/IframeResizer","module/BaseApp","module/KinjaAnalytics","app/MarionetteApp","app/LiveblogApplet","app/AnnotationApplet","app/mixins/PostViewLoader","app/mixins/PostAssetPromoter","model/post/Post","model/post/ViewStatModel","view/items/AgeGate","view/GifImageLoader","lib/sha1","gawkerlib/urlUtil","view/sharingfooter.view","lib/jquery.cookie","templates/tiger/components/post/meta/meta-components"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){var y,z=k.extend(b.extend({},p,q,{ageGate:null,starterPost:null,initApp:function(){k.prototype.initApp.call(this),this.starterPost=new r(i.isOn("postmodelcleanup")?f.getKinjaMeta().post:{id:parseInt(f.getKinjaMeta().starterId,10)}),this.initPostTools(this.starterPost.id),this.imageLoader=new u({el:document})},start:function(){this.starterPost.has("liveBlog")&&this.starterPost.get("liveBlog")===!0&&!i.isOn("disableliveblog")?this.startLiveblog():this.startDiscussionApplet(),this.startAnnotations(),i.isOn("nosocialscripts")||this.loadSocialScripts(),this.startAmazonStats(),this.startAmazonTextLinksWithSha(),this.insertViewstats(),(i.isOn("moatads_promoted")||i.isOn("moatads_headertag"))&&this.insertMoatAdScript(),(!i.isOn("no3rdparty")&&h.isGmgBlog&&i.isOn("taboola")||i.isOn("only_taboola"))&&this.addTaboola(),this.loadYoutubeAds(),this.ageGate=new t,g.onLoggedIn.done(b.bind(this.initAssetRecommendation,this)),i.isOn("analyticstracking")&&this.initPermalinkViewTracking(),j.start(),i.isOn("post_completion")&&this.trackPostCompletion();var c=a("#sharingfooter");i.isOn("sharingfooter")&&c.length>0&&(this.sharingfooter=new x({el:c,model:this.starterPost}))},startDiscussionApplet:function(){return this.shouldLoadReplies()&&require(["module/DiscussionModule"],function(a){m.discussionRegion.show(a)}),!1},startLiveblog:function(){var b;b=new n({model:this.starterPost,el:a(".js_liveblog")})},shouldLoadReplies:function(){return!(this.starterPost.get("allowReplies")===!1&&0===this.starterPost.get("replyCount"))},startAnnotations:function(){new o({model:this.starterPost,el:a("body")}).startApp()},startAmazonStats:function(){var b=this;g.onLoggedIn.done(a.proxy(function(){g.hasPermission("SALES")&&"on"===f.getParameterByName("amazonstats")&&require(["module/AmazonStats"],function(c){var d=a(".post-wrapper article.post"),e=new c({postId:b.starterPost.id});d.prepend(e.$el)})},this))},startAmazonTextLinks:function(){if(""===document.referrer)return!1;var c=b.filter(a(".post-content a"),function(b){return!!a(b).data("amazontag")}),d=document.referrer.match(/:\/\/([^/]+)\//);null!==d&&(d=d[1],b.each(c,function(b){var c=a(b).attr("href").replace("&ascsubtag=","&ascsubtag=[r|"+d);a(b).attr("href",c)}))},startAmazonTextLinksWithSha:function(){var c=function(a){var b=new v(a,"TEXT");return b.getHash("SHA-1","HEX")},d=function(a){var b=document.referrer;return""===b?a:"[r|"+b+a},e=function(a){return a.split("?")[0]},f=function(a){return w.fromQueryString(a.split("?")[1])},g=function(a){var b=f(a),c=b.ascsubtag;return b.rawdata=c,e(a)+w.toQueryString(b)},h=function(){return b.filter(a(".post-content a"),function(b){return!!a(b).data("amazontag")})},i=function(a){var b=f(a),c=b.rawdata;return c},j=function(a,b){var c=e(b),d=f(b),g=d.ascsubtag,h=a(g);return d.ascsubtag=h,c+w.toQueryString(d)},k=function(a){return j(d,a)},l=function(a){return j(c,a)},m=function(b){a(b).click(function(){var d=i(a(b).attr("href")),e=encodeURIComponent(d);a.ajax("/api/analytics/amazon/putSubtag?data="+e,{type:"GET",error:function(a){require(["module/Raven"],function(Raven){Raven.captureMessage("Analytics: Could not send subtag",{extra:{subtag:d,subtagSha:c(d),analyticsResponse:a.status,analyticsResponseStatusText:a.statusText,analyticsResponseText:a.responseText}})})}})})},n=function(b,c){var d=String(a(c).attr("href")),e=b(d);return a(c).attr("href",e),e},o=function(a){n(b.compose(l,g,k),a)};b.forEach(h(),function(a){o(a),m(a)})},loadYoutubeAds:function(){if(0===a(".youtubead").length)return!1;var b=function(){var b=a(this).data("width"),c=a(this).data("height"),d=a(this).data("id"),e="948d7212c89311e2892e0019b9f1584b",f="http://www.youtube.com/watch?v="+d,g="http://cdn.visiblemeasures.com/swf/as3/2013-B-75456d/bin/YouTubeEmbeddedPlayer.swf",h="http://cdn.visiblemeasures.com/ad_units/in_banner_video/expressInstall.swf",i={autohide:1,autoplay:0,fs:1,loop:1,vmcKey:e,video:d,chromeless:"1",link:encodeURIComponent(f)},j={allowscriptaccess:"always",allowfullscreen:"true"},k={};swfobject.embedSWF(g,"youtubead-"+d,b,c,"9.0.0",h,i,j,k)};require(["http://ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js"],function(){a(".youtubead").each(function(){b.call(this)})})},initUserTools:function(){var a,b=this.options.id;f.getKinjaMeta().post&&f.getKinjaMeta().post.id!==this.options.id&&(b=f.getKinjaMeta().post.id),a=new r({id:b})},trackPostCompletion:function(){var c=a(window),d=a(".post-bottom").offset().top,e=function(){var a=c.height(),b=a+c.scrollTop();b>d&&(window.ga("send","event","post completion","post completion",{nonInteraction:1}),c.off("scroll.postCompletion"))};c.on("scroll.postCompletion",b.throttle(e,1e3))},insertMoatAdScript:function(){if(!f.getKinjaMeta().post.sponsored)return!1;var b=['<script type="text/javascript">',"(function(){",'var a=document,b=a.createElement("script"),a=a.getElementsByTagName("script")[0];','b.type="text/javascript";b.async=!0;','b.src="http://js.moatads.com/gawkersppage4859385728/moatcontent.js";',"a.parentNode.insertBefore(b,a)","})();","</script>"];a("body").append(b.join(""))},initAssetRecommendation:function(){var a=new r(f.getKinjaMeta().post),b=g.hasRole("ADMIN",a.get("defaultBlogId")),c=g.isSuperuser()&&i.isOn("superuser");(b||c)&&this.startAssetPromoter(a)},insertViewstats:function(){var b=this,c=this.starterPost.get("id"),d=new r({id:c}),e=function(a){var c=b.soyToHtml(tiger.components.post.meta.postViewCount,{isBlip:d.get("isBlip"),isBillboardPost:d.get("isBillboardPost"),viewstats:a});b.$el.find(".view-count-container").html(c)};i.isOn("new_stats_day")?a.ajax("/api/analytics/kala/viewsForPost?id="+c).done(function(a){var b=function(a){return a.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")},c=a.data[0]||{},d=b(c.views||0),f=b(c.uniqueViews||0);c.nonUniqueFormatted=d,c.uniqueFormatted=f,e(c)}):a.ajax("/api/analytics/stats/post?id="+c).done(function(a){e(a.data[0])})},initPermalinkViewTracking:function(){var b=this.starterPost.get("id"),c=a(".js_stats").data("unique")||!1,d=a("#analytics-permalink-view").data(),e=d.authorId,f=(d.tagIds||"").toString().split(",");l.setContext(h.id,"PERMALINK",b),l.pushEvent("PERMALINK_VIEW","POST",b,{blogName:h.canonicalHost,unique:c,authorId:e.toString()},{tagIds:f})},loadSocialScripts:function(){a.getScript("//connect.facebook.net/en_US/sdk.js",function(){window.fbAsyncInit=function(){window.FB.init({appId:f.getKinjaMeta().blog&&f.getKinjaMeta().blog.fbAppId?f.getKinjaMeta().blog.fbAppId:"36368793975",version:"v2.0",status:!0,cookie:!0,xfbml:!0})}})},addTaboola:function(){window._taboola=[],window._taboola.push({article:"auto"}),a.getScript("http://cdn.taboola.com/libtrc/gawkermedia-network/loader.js");var b=this.starterPost.get("sponsored");window._taboola.push({mode:b?"organic-thumbnails-a":"thumbnails-a",container:"taboola-below-article-thumbnails",placement:"Below Article Thumbnails Organic",tracking:"utm_source=taboola",target_type:"mix"})}}));if(i.isOn("remove_approuter")){if(y=parseInt(f.getKinjaMeta().postId,10),"permalink"!==f.getKinjaMeta().pageType||isNaN(y))return!1;new z({id:y}).start()}return z});