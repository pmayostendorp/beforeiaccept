if("undefined"==typeof tiger)var tiger={};"undefined"==typeof tiger.components&&(tiger.components={}),"undefined"==typeof tiger.components.discussion&&(tiger.components.discussion={}),"undefined"==typeof tiger.components.forms&&(tiger.components.forms={}),"undefined"==typeof tiger.components.forms.modals&&(tiger.components.forms.modals={}),"undefined"==typeof tiger.components.groupchats&&(tiger.components.groupchats={}),"undefined"==typeof tiger.components.invites&&(tiger.components.invites={}),"undefined"==typeof tiger.components.invites.menuItems&&(tiger.components.invites.menuItems={}),"undefined"==typeof tiger.components.invites.modals&&(tiger.components.invites.modals={}),"undefined"==typeof tiger.components.post&&(tiger.components.post={}),"undefined"==typeof tiger.components.post.button&&(tiger.components.post.button={}),"undefined"==typeof tiger.components.post.meta&&(tiger.components.post.meta={}),"undefined"==typeof tiger.components.spinner&&(tiger.components.spinner={}),"undefined"==typeof tiger.icons&&(tiger.icons={}),"undefined"==typeof tiger.icons.essential&&(tiger.icons.essential={}),"undefined"==typeof tiger.messages&&(tiger.messages={}),define("model/post/Post",["config","jquery","backbone","underscore","singleton/CurrentUser","singleton/Feature","singleton/Utils","apiclient/gettoken"],function(a,b,c,d,e,f,g,h){var i=b("<div />"),j=function(a){var b,c=a.getHours(),d=a.getMinutes(),e=a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear();return 10>c&&(c="0"+c),10>d&&(d="0"+d),b=c+":"+d,{MdyHm:[e,b].join(" ")}},k={dateTimeFormat:/^\d{1,2}\/\d{1,2}\/\d{4} \d{1,2}:\d{2}$/,chompImgType:/img\.gawkerassets\.com\/img\/(\w+)\/[\w\-]+\./g},l=c.Model.extend({constructor:function(a){window.__postModelStorage=window.__postModelStorage||{};var b,d,e=window.__postModelStorage,f=void 0!==a&&void 0!==a.id&&void 0!==e,g={};if(f&&void 0!==e[a.id]){for(d in a)a.hasOwnProperty(d)&&null!==a[d]&&(g[d]=a[d]);return b=e[a.id],b.set(g),b}c.Model.prototype.constructor.apply(this,arguments),f&&(e[a.id]=this)},initialize:function(){k=b.extend(k,{mediaInPost:new RegExp("<("+this.mediaTags.join("|")+")","gim")})},storeInMemory:function(){var a=window.__postModelStorage||{},b=void 0!==this.id&&void 0!==a;return b&&void 0!==a[this.id]?a[this.id].set(this.attributes):a[this.id]=this,this},mediaTags:["img","embed","object","iframe","video","audio","canvas"],defaults:{promoteState:{},publishTime:j(new Date),blogs:new c.Collection,liked:!1},validationRules:{PUBLISHTIME_IS_REQUIRED:function(a){var b=!0;return"SCHEDULED"!==a.status||a.publishTimeMillis||(b=!1),b},POST_CONTENT_IS_REQUIRED:function(a){var c=!0,d=a.headline&&b.trim(i.html(a.headline)),e=a.original&&b.trim(i.html(a.original).text()),f=a.original&&(k.mediaInPost.test(a.original)||i.html(a.original).find("img").length),g=a.hasFile||a.files&&a.files.length;return d||e||f||g||(c=!1),c},POST_CONTENT_CANNOT_CONTAIN_BAD_CONTENT:function(a){var b=!0,c=["form"].join("");return i.html(a.original).find(c).length&&(b=!1),b}},savePipeline:b.Deferred().resolve(),publishTime:function(a){return j(a)},sync:function(a,c,e){var f,g,i,j,k,l;if("create"!==a&&(void 0===c.id||null===c.id))throw new Error("Post.sync(): Model undefined");switch(c.attributes.meta={},"undefined"!=typeof c.attributes.status&&(c.attributes.meta.status=c.attributes.status),"undefined"!=typeof c.attributes.allowReplies&&(c.attributes.meta.allowReplies=c.attributes.allowReplies),"undefined"!=typeof c.attributes.showByline&&(c.attributes.meta.showByline=c.attributes.showByline),"undefined"!=typeof c.attributes.byline&&(c.attributes.meta.byline=c.attributes.byline),"undefined"!=typeof c.attributes.properties&&(c.attributes.meta.properties=c.attributes.properties),a){case"create":f="POST",g=c.has("parentId")&&""!==c.get("parentId")?"/ajax/post/"+c.get("parentId")+"/jsonReplyWithApproval":"/ajax/post/jsonAdd",i=JSON.stringify(c);break;case"read":f="GET",g=void 0!==e.preview&&e.preview===!0?"/ajax/post/preview/"+c.id:void 0!==e.showcase&&e.showcase===!0?"/ajax/post/showcase/"+c.id:"/ajax/post/"+c.id;break;case"update":f="POST",g="/ajax/post/"+c.id+"/jsonUpdate",i=JSON.stringify(c);break;case"delete":f="POST",g="/ajax/post/"+c.id+"/delete"}return j={type:f,dataType:"json",contentType:"application/json",url:g,data:i||null},k=b.Deferred(),l=k.promise(),h.secure().done(function(a){j.url=j.url+"?token="+a,b.ajax(d.extend(j,e)).done(k.resolve).fail(k.reject)}),l},parse:function(a){if(void 0===a)throw new Error("Post.parse(): no response to parse");var b={};return b=a.data?a.data:a,void 0!==b.id&&null!==b.id&&(b.id=parseInt(b.id,10)),b.images&&b.images.length&&(b.images=[]),b},toFormData:function(){var a=["id","headline","original","tags","publishTimeMillis","publishTimeZone","status","blogId","defaultBlogId","annotation.annotationType","annotation.imageUrl","annotation.imageChompId","annotation.imageWidth","annotation.imageHeight","annotation.x","annotation.y","annotation.annotationText","annotation.annotationTextHash","allowReplies","sponsored","showByline","byline","salesAvatar","salesAvatarMap","share","properties","shareBlogId","sharedPostId","images","parentId","adZone"],b=["status","allowReplies","showByline","byline","properties"],c=function(a){var c=a[0],e=a[1];return-1!==d.indexOf(b,c)&&(c="meta."+c),[c,e]},e=d.pick(this.toJSON(),d.union(a,d.map(b,function(a){return"meta."+a}))),f=d.object(d.pairs(e).map(c));return f},getUrl:function(){return void 0!==this.get("permalink")?this.get("permalink"):"/"+this.id},getActionState:function(){var a=b.Deferred();return this.has("actionState")?a.resolve():this.getPostInfo().done(function(){a.resolve()}),a.promise()},getPostInfo:function(c){var d,f=this,g=parseInt(this.id,10);if(!e.isLoggedIn())throw new Error("Post.getPostInfo(): user not logged in");return c=c||{},c.success=c.success||function(){},d=[a.api.core.url,"/post/",g,"/actionstatus?token=",e.get("token")].join(""),b.ajax({type:"GET",dataType:"jsonp",jsonp:"jsonp",url:d,success:function(a){200===a.meta.status&&(f.setActionState(a.data),c.success.call(f))}})},isPublished:function(){return"PUBLISHED"===this.get("status")},setAction:function(b,c,d){var e,f={};if(!b||"repost"!==b&&"dismiss"!==b&&"actionreset"!==b)throw new Error("Post:setAction(): Invalid post action: "+b);if(!c)throw new Error("Post:setAction(): Invalid blogId: "+c);return e="repost"===b?a.api.core.url+"/post/"+this.id+"/"+b+"/"+c:"/ajax/post/"+this.id+"/"+b+"/"+c,"repost"===b&&d.publishTimeMillis&&(f.repostTime=d.publishTimeMillis),this.setLikeOrAction(d,b,e,f)},setLikeOrAction:function(a,c,d,f){var g,i,j,k;return a=a||{},f=f||{},a.success=a.success||function(){},a.error=a.error||function(){},e.isLoggedIn()||a.error.call(this,{reason:"user"}),i=b.Deferred(),j=i.promise(),k=this,h.fresh().done(function(e){f.token=e,g="repost"===c?{url:d+"?"+b.param(f),type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:"{}"}:{url:d+"?"+b.param(f),type:"POST"},b.ajax(g).done(function(b){void 0!==b.meta?"repost"===c||"dismiss"===c||"actionreset"===c?(k.setActionState(b.data),a.success.call(k,{response:b.data})):(k.setLikeState(b.data),a.success.call(k,{response:b.data})):a.error.call(k,{reason:"action error"}),i.resolve()}).fail(function(b){a.error.call(this,b.responseJSON,b.status,b.statusText),i.reject(b.responseJSON,b.status,b.statusText)})}),j},setActionState:function(a){var b={};d.each(a,function(a){b[a.blogId]=a.relation.toLowerCase()},this),this.set({actionState:b})},setLike:function(a,b){var c,e=["like","unlike"];if(!a||!d.contains(e,a))throw new Error("Post:setLike(): Invalid post action: "+a);return"like"===a&&(a+="AndApprove"),c="likeAndApprove"!==a?["/api/core/post",this.id,a].join("/"):["/ajax/post",this.id,a].join("/"),this.setLikeOrAction(b,a,c)},setLikeState:function(a){var b=a||{},c=b.like||b;this.set(void 0!==c.objectId&&c.objectId===this.get("id")?{liked:!0}:{liked:!1})},prepareAnnotations:function(){if(this.has("annotation")){var a=this.get("annotation"),c=b().text(a.annotationText),d=170;void 0===a.annotationShortText&&c.length>d&&(a.annotationShortText=g.cut(c,d))}return this},parseFromDom:function(a){var b=JSON.parse(decodeURIComponent(a.data("model")));return new l(b)},replaceImagesWithOriginal:function(){var a=this.get("display");return this.set("display",a.replace(k.chompImgType,"img.gawkerassets.com/img/$1/original.")),this},validate:function(){var a=[],b=this.toJSON();return b.mode&&d.each(this.validationRules,function(c,d){c(b)||a.push({error:"CLIENT_VALIDATION_ERROR",reason:d})},this),a.length?a:!1},getShareOptionsForUser:function(a){var c=b.Deferred(),e=[],f=[],g=[],h=a.get("defaultBlogId"),i=!1;return this.getActionState().done(b.proxy(function(){d.each(this.get("actionState"),function(a,b){"repost"===a&&e.push(parseInt(b,10))}),i=-1!==d.indexOf(e,h)?!0:!1,a.get("membership").each(function(a){a.get("blogId")===h||"ENABLED"!==a.get("blog").status&&"SPAM"!==a.get("blog").status||(-1!==d.indexOf(e,a.get("blog").id)?g.push({name:a.get("blog").displayName,id:a.get("blog").id}):f.push({name:a.get("blog").displayName,id:a.get("blog").id}))},this),c.resolve({repostedTo:e,repostedToPersonal:i,personalBlogId:h,blogsUndo:g,blogsRepost:f})},this)),c.promise()}});return l}),define("collection/PaginationCollection",["backbone"],function(a){var b=a.Collection.extend({_stepIndex:0,_stepSize:10,_doneStepping:!0,constructor:function(b,c){b=b||[],c=c||{},a.Collection.prototype.constructor.call(this,b,c)},_incrementStep:function(){this._stepIndex+=this._stepSize},_checkDone:function(a){var b=this.parse(a);return b&&b.length?!1:!0},getStepIndex:function(){return this._stepIndex},getStepSize:function(){return this._stepSize},hasMore:function(){return!this._doneStepping},disablePagination:function(){this._doneStepping=!0}});return b}),define("module/discussion/model/comment.model",["jquery","underscore","backbone","model/post/Post"],function(a,b,c,d){var e=d.extend({setLike:function(a,b){var c=d.prototype.setLike.call(this,a,b);return("like"===a||"unlike"===a)&&c.done(function(){this.trigger("discussion:comment:likestatechanged",this.get("id"),a)}.bind(this)),c},parse:function(a){return a=a||{},e.addDiscussionId(a,{commentModel:this})},constructor:function(a,b){c.Model.prototype.constructor.call(this,a,b),this.cid=a._discussionId},_commentCollection:null,getChildren:function(){if(!this._commentCollection){var a=require("module/discussion/model/comment.collection"),b=this.collection;this._commentCollection=new a([],{parent:this,approvedOnly:b.getApprovedOnly(),parentDepth:b.getDepth(),discussionType:b.getDiscussionType()})}return this._commentCollection}},{addDiscussionId:function(a,c){var d,e;return c.hasOwnProperty("discussionType")?d=c.discussionType:c.hasOwnProperty("commentModel")&&(e=c.commentModel,e.collection?d=e.collection.getDiscussionType():e._parent&&e._parent.collection&&(d=e._parent.collection.getDiscussionType())),b.extend(a,{_discussionId:d+"_"+a.id})}});return e}),define("templates/tiger/components/groupchats/flagreason",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.groupchats.flagreason=function(a,b){var c=b||new d.StringBuilder;return c.append('	<div class="flag-reason-dropdown js_flag-reason"><form><label class="reason-head">Why are you flagging this?<a class="hover-icon help-link icon icon-question-circle" href="http://help.gawker.com/customer/portal/articles/1726140-what-is-flagging-?b_id=5895" target="_blank"></a></label><div class="row radio-cont"><div class="column small-12 js_error hide proxima"><small class="warningmessage">Please select a reason</small></div><div class="columns small-12"><label><input type="radio" name="reason" value="HARASSMENT">It\'s harassment</label></div></div><div class="row radio-cont"><div class="columns small-12"><label><input type="radio" name="reason" value="HATE_SPEECH">It\'s hate speech</label></div></div><div class="row radio-cont"><div class="columns small-12"><label><input type="radio" name="reason" value="SPAM">It\'s spam</label></div></div><div class="flag-reason-ctas"><a class="button secondary tiny cancel js_cancel">Cancel</a><a class="button primary tiny submit js_submit">Save</a></div></form></div>'),b?"":c.toString()}}),define("module/flagging/view/FlagReasonDropdown",["jquery","underscore","backbone.marionette","templates/tiger/components/groupchats/flagreason"],function(a,b,c){var d=c.ItemView.extend({template:tiger.components.groupchats.flagreason,events:{submit:"submit",click:"preventPropagation","click .js_cancel":"cancel","click .js_submit":"submit"},initialize:function(){},preventPropagation:function(a){a.stopPropagation()},cancel:function(){this.trigger("flagreason:cancel")},submit:function(a){a.preventDefault();var b=this.$('input[name="reason"]:checked').val();return b?this.trigger("flagreason:submit",this,b):this.$(".js_error").removeClass("hide"),!1}});return d}),define("templates/tiger/components/forms/modals/flagreason",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.forms.modals.flagreason=function(a,b){var c=b||new d.StringBuilder;return c.append('	<div class="show-for-medium-down flag-reason-mobile"><ul class="sticky-modal-options"><li class="js_reason-harassment" data-reason="HARASSMENT">It\'s harassment</li><li class="js_reason-hate-speech" data-reason="HATE_SPEECH">It\'s hate speech</li><li class="js_reason-spam" data-reason="SPAM">It\'s spam</li></ul><footer class="row"><div class="column small-12"><input type="button" class="button tiny secondary js_cancel" tabindex="5" value="Cancel" /></div></footer></div>'),b?"":c.toString()}}),define("module/flagging/view/FlagReasonModal",["jquery","underscore","backbone.marionette","templates/tiger/components/forms/modals/flagreason"],function(a,b,c){var d=c.ItemView.extend({template:tiger.components.forms.modals.flagreason,tagName:"form",events:{submit:"submit","click .js_cancel":"cancel","click .js_reason-harassment":"selectReason","click .js_reason-hate-speech":"selectReason","click .js_reason-spam":"selectReason"},cancel:function(){this.trigger("flagreason:cancel")},selectReason:function(b){var c=a(b.target).attr("data-reason");if(!c)throw new Error("Empty reason code for reason!");this.trigger("flagreason:submit",this,c)}});return d}),define("apiclient/flagging",["config","apiclient/apirequest","apiclient/gettoken"],function(a,b,c){var d={flagPost:function(b){return b.reason?a.api.core.url+"/post/{{postId}}/flag?reason={{reason}}":a.api.core.url+"/post/{{postId}}/flag"},unflagPost:function(b){return b.reason?a.api.core.url+"/post/{{postId}}/unflag?reason={{reason}}":a.api.core.url+"/post/{{postId}}/unflag"}};return{getPosts:b.getJson(c.append(a.api.core.url+"/post/{{starterId}}/flaggedposts")),getCount:b.getJson(c.append(a.api.core.url+"/post/{{starterId}}/flaggedcount")),flagPost:b.postJson(c.append(d.flagPost)),unflagPost:b.postJson(c.append(d.unflagPost)),getBlogCount:b.getJson(c.append(a.api.core.url+"/blog/{{blogId}}/flaggedcount")),resolveFlag:b.postJson(c.append(a.api.core.url+"/post/{{postId}}/resolve")),unresolveFlag:b.postJson(c.append(a.api.core.url+"/post/{{postId}}/unresolve"))}}),define("templates/tiger/components/groupchats/flagging-admin-link",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.groupchats.flaggingAdminLink=function(a,b){var c=b||new d.StringBuilder;return c.append("	<div class=\"flagging-admin-link proxima\"><a onClick=\"window.ga('send', 'event', 'On-Page Flagging', 'click', 'Click into moderation queue');\" href=\"/private/flagged\">Moderate Flagged Replies (",d.$$escapeHtml(a.flagCount),")</a></div>"),b?"":c.toString()}}),define("module/flagging/ReplyFlaggingModule",["jquery","underscore","backbone.marionette","singleton/Feature","singleton/CurrentUser","singleton/Utils","singleton/WindowController","module/flagging/view/FlagReasonDropdown","module/flagging/view/FlagReasonModal","app/modal/modal.controller","apiclient/flagging","templates/tiger/components/groupchats/flagging-admin-link"],function(a,b,c,d,e,f,g,h,i,j,k){var l={flaggedReplies:null,flaggedRepliesLoaded:a.Deferred(),flagCount:null,flagCountLoaded:a.Deferred(),tokenRenewed:!1,reasonDropdown:void 0,reasonModal:void 0,_loadFlaggedReplies:function(a){var b=this,c=function(c,d){b.flaggedReplies=[],d&&d.success===!0?(b.flaggedReplies=c.map(function(a){return a.postId}),b.flaggedRepliesLoaded.resolve()):d&&"InvalidSessionToken"===d.type&&l.tokenRenewed===!1?(l.tokenRenewed=!0,e.token().done(function(){l._loadFlaggedReplies(a)})):b.flaggedRepliesLoaded.reject()};k.getPosts({starterId:a}).done(c)},_loadFlagCount:function(a){var b=this,c=function(a,c){c&&c.success===!0&&(b.flagCount=Number(a)),b.flagCountLoaded.resolve()};k.getCount({starterId:a}).done(c)},_mergePostModelWithFlagInfo:function(a){var c=a.get("id");b.contains(this.flaggedReplies,c)&&a.set({allowReplies:!1,flagged:!0})},_postStatus:function(a){return 0!==a.parents(".all-threads").length?a.parents(".js_reply").hasClass("unapproved")?"Pending":"Approved":"Featured"},_flagPost:function(a,c,e){var f,g,h=c.get("flagged")===!0,i=c.get("id"),j=h?"Unflag":"Flag",m=l._postStatus(a);c.get("flaggingInProgress")===!0&&b.isUndefined(l.reasonDropdown)||(c.set({flaggingInProgress:!0}),g=d.isOn("extendedflag")&&!b.isUndefined(e)&&"Flag"===j?j+" - "+e.toLowerCase():j,window.ga("send","event","On-Page Flagging",g,"Reply status: "+m),f=h?k.unflagPost({postId:i,reason:e}):k.flagPost({postId:i,reason:e}),f.done(function(a,b){void 0!==b&&b.success===!0&&(c.set({flagged:!h,allowReplies:h,flaggingInProgress:!1}),this._syncFlaggedReplies(!h,i))}.bind(this)))},_syncFlaggedReplies:function(a,c){null!==l.flaggedReplies&&(a?l.flaggedReplies.push(c):l.flaggedReplies=b.reject(l.flaggedReplies,function(a){return a===c})),null!==l.flagCount&&(a?l.flagCount++:l.flagCount--)},_showDropdownReasonSelection:function(b,c){var d,e;l._hideReasonDropdown(),l.reasonDropdown=new h({$reply:b,model:c}),l.reasonDropdown.on("flagreason:submit",l._handlePostFlagFromDropdown),l.reasonDropdown.on("flagreason:cancel",l._hideReasonDropdown),l.reasonDropdown.render(),c.set({flaggingInProgress:!0}),l.reasonDropdown.$el.insertBefore(b.find(".reply-border")),d=l.reasonDropdown.$el,a(window).scrollTop()+window.innerHeight-d.height()<d.offset().top&&(e=d.offset().top-d.height(),a("body").scrollTo(e,{duration:"slow"}))},_showModalReasonSelection:function(a,b){l.reasonModal=new i({$reply:a,model:b}),l.reasonModal.on("flagreason:cancel",function(){j.close()}),l.reasonModal.on("flagreason:submit",l._handlePostFlagFromModal),j.create(l.reasonModal,{name:"flagreason",className:"reveal-modal kinja-modal sticky-modal bottom full-width"})},_handlePostFlagFromDropdown:function(a,b){var c=a.model;a.$("a,input").addClass("disabled"),c.once("change:flagged",l._hideReasonDropdown),l._flagPost(a.options.$reply,c,b)},_handlePostFlagFromModal:function(a,b){var c=a.model;a.$("a,input").addClass("disabled"),c.once("change:flagged",function(){j.close()}),l._flagPost(a.options.$reply,c,b)},_hideReasonDropdown:function(){b.isUndefined(l.reasonDropdown)||(l.reasonDropdown.options.model.set({flaggingInProgress:!1}),l.reasonDropdown.remove(),l.reasonDropdown=void 0)},API:{flaggedRepliesLoaded:function(){return l.flaggedRepliesLoaded},flagCountLoaded:function(){return l.flagCountLoaded},flaggedReplies:function(){return l.flaggedReplies},flagCount:function(){return l.flagCount},openFlagView:function(a,b){e.requireLogin("flagPost").done(function(){g.isSmall()?l._showModalReasonSelection(a,b):l._showDropdownReasonSelection(a,b)})},unflag:function(a,b){e.requireLogin("unflagPost").done(function(){l._flagPost(a.view.$el,b)})},loadFlaggedReplies:function(a){e.onAuth.done(function(){e.isLoggedIn()&&(l._loadFlaggedReplies(a),d.isOn("groupchats_refactor")||l.API.loadFlagCount(a))})},loadFlagCount:function(a){e.onAuth.done(function(){var b=f.getKinjaMeta().blog.id;e.isLoggedIn()&&(e.isSuperuser()&&d.isOn("superuser")||e.hasRole("OWNER",b)||e.hasRole("ADMIN",b))?l._loadFlagCount(a):l.flagCountLoaded.reject()})},extendPostModel:function(a){l.flaggedRepliesLoaded.done(function(){l._mergePostModelWithFlagInfo(a)})},showAdminLink:function(a,b){l.flagCountLoaded.done(function(){if(l.flagCount<=0)return!0;var d={flagCount:l.flagCount},e=c.Renderer.render(tiger.components.groupchats.flaggingAdminLink,d);b?a.append(e):a.prepend(e)})}}};return window.__karma__&&(l.API.__testonly__=l),l.API}),define("apiclient/discussion",["underscore","config","apiclient/apirequest","apiclient/gettoken","singleton/Feature"],function(a,b,c,d,e){var f,g,h,i=b.api.core.url,j=e.isOn("superuser");return g={personalized:i+"/reply/{{postId}}/replies/qi/combined/userfilter/activity",nextPersonalized:i+"/reply/{{parentId}}/replies",all:i+"/reply/{{postId}}/replies",nextAll:i+"/reply/{{parentId}}/replies/flat",permalink:i+"/reply/{{postId}}/replies/qi/combined/userfilter/activity",nextPermalink:i+"/reply/{{parentId}}/replies"},h=a.mapObject(g,function(a){return j?d.append(a,d.fresh):a}),f={getPersonalizedReplies:c.getJson(h.personalized,{query:"",currentBlogId:0,refId:0,maxReturned:e.isOn("discovery_pagination")?25:20,bsMaxReturned:0,chunking:!0,leaves:!0,excludedThreads:0,includedAdmins:!0,maxFollowees:2,features:"with-liked-leafs%26webchatsbeta",webchatsbeta:"on",noFollow:!0}),getNextPersonalizedReplies:c.getJson(h.nextPersonalized,{currentBlogId:0,startIndex:0,startTime:0,maxReturned:e.isOn("discovery_pagination")?20:5,withLikeCounts:!1,webchatsbeta:"on",noFollow:!0}),getAllReplies:c.getJson(h.all,{currentBlogId:0,startIndex:0,maxReturned:(e.isOn("discovery_pagination"),10),withLikeCounts:!0,maxChildren:4,approvedChildrenOnly:!0,approvedStartersOnly:!0,webchatsbeta:"on",noFollow:!0}),getNextAllReplies:c.getJson(h.nextAll,{currentBlogId:0,startIndex:4,maxReturned:e.isOn("discovery_pagination")?20:100,order:"ASC",approvedChildrenOnly:!0,approvedStartersOnly:!0,webchatsbeta:"on",noFollow:!0}),getPermalinkReplies:c.getJson(h.permalink,{query:"",refId:0,currentBlogId:0,maxReturned:e.isOn("discovery_pagination")?25:1,bsMaxReturned:0,"with-direct-contributors":"off","with-liked-leafs":"on",chunking:!0,sort:"chrono",includedAuthors:!0,maxFollowees:2,removeDismissed:!1,leaves:!0,noFollow:!0,webchatsbeta:"on"}),getNextPermalinkReplies:c.getJson(h.nextPermalink,{currentBlogId:0,startIndex:0,startTime:0,maxReturned:e.isOn("discovery_pagination")?20:5,bsMaxReturned:0,noFollow:!0,withLikeCounts:!1,webchatsbeta:"on"})}}),define("apiclient/likestate",["config","apiclient/apirequest","apiclient/gettoken"],function(a,b,c){var d;return d={getForPosts:b.getJson(c.append(a.api.core.url+"/like/status"),{}),getForStarter:b.getJson(c.append(a.api.core.url+"/like/{{starterId}}"),{})}}),define("module/discussion/model/comment.collection",["jquery","underscore","collection/PaginationCollection","module/discussion/model/comment.model","module/flagging/ReplyFlaggingModule","singleton/CurrentBlog","singleton/CurrentUser","singleton/Utils","singleton/Feature","apiclient/discussion","apiclient/likestate"],function(a,b,c,d,e,f,g,h,i,j,k){var l=c.extend({_hasFirstFetched:!1,_stepIndex:0,_stepSize:100,_incrementStep:function(a){var b=this.getDiscussionType(),c=this.getDepth();b===l.discussionTypes.PERSONALIZED?this._stepIndex=1>c?a.data.pagination.next.refId:a.data.pagination.next.startIndex:b===l.discussionTypes.ALL&&(1>c?this._stepIndex=a.data.pagination.next.startIndex:this._stepIndex+=a.data.items[0].children.items.length)},_checkDone:function(a){var b;return this.getDiscussionType()!==l.discussionTypes.ALL?!(a.data.hasOwnProperty("pagination")&&a.data.pagination.hasOwnProperty("next")):this.getDepth()<1?!(a.data.hasOwnProperty("pagination")&&a.data.pagination.hasOwnProperty("next")):(b=this._stepindex+a.data.items[0].children.items.length,b<a.data.items[0].reply.replyCount?!1:!0)},_parent:null,_permalinkComment:null,_depth:0,_discussionType:"",_approvedOnly:!0,_approvedLength:0,model:d,initialize:function(a,b){this._discussionType=b.discussionType,b.hasOwnProperty("parent")&&(this._parent=b.parent),b.hasOwnProperty("permalinkComment")&&(this._permalinkComment=b.permalinkComment),b.hasOwnProperty("parentDepth")&&(this._depth=b.parentDepth+1),b.hasOwnProperty("approvedOnly")&&!b.approvedOnly&&(this._approvedOnly=!1),this._discussionType===l.discussionTypes.ALL&&this.getDepth()>0&&(this._stepIndex=4),this.listenTo(this,"sync",function(){this._hasFirstFetched=!0,this.loadLikedComments(),this.loadFlaggedComments()}),this.listenTo(this,"discussion:comment:likestatechanged",this.onCommentLikeStateChanged)},loadFlaggedCommentCount:function(){var a=this._parent.get("id");return e.flagCount()||e.loadFlagCount(a),e.flagCountLoaded()},loadFlaggedComments:function(){var a=this._parent.get("id"),c=function(a){b.each(a,function(a){this.setAttributesOnComment(this,a,{flagged:!0})},this)}.bind(this);e.flaggedRepliesLoaded().done(function(){c(e.flaggedReplies())}),e.flaggedReplies()||e.loadFlaggedReplies(a)},loadLikedComments:function(){var a=this._parent.get("id"),c=function(a){b.each(a,function(a){this.setAttributesOnComment(this,a,{liked:!0})},this)}.bind(this);g.onAuth.done(function(){g.isLoggedIn()&&this._parent.get("replyCount")>0&&(l.likedCommentIds?c(l.likedCommentIds):k.getForStarter({starterId:a},{traditional:!0}).done(function(a){var d=b.pluck(a,"objectId");l.likedCommentIds=d,c(d)}.bind(this)))}.bind(this))},onCommentLikeStateChanged:function(a,c){l.likedCommentIds&&("like"===c?l.likedCommentIds.push(a):l.likedCommentIds=b.reject(l.likedCommentIds,function(b){return b===a}))},setAttributesOnComment:function(a,c,d){b.each(a.models,function(a){c===a.get("id")?a.set(d):a._commentCollection&&a._commentCollection.models.length>0&&this.setAttributesOnComment(a._commentCollection,c,d)},this)},getFullListOfIds:function(a){var c=[];return b.each(a.models,function(a){c.push(a.get("id")),a._commentCollection&&a._commentCollection.models.length>0&&(c=c.concat(this.getFullListOfIds(a._commentCollection)))},this),c},sync:function(a,b,c){var d=this.getApprovedOnly(),e=this.getDiscussionType(),g=h.getKinjaMeta().postAuthorBlogName;return e===l.discussionTypes.PERSONALIZED?this._depth>0?j.getNextPersonalizedReplies({parentId:this._parent.get("id"),currentBlogId:f.id,startIndex:this.getStepIndex()},c):j.getPersonalizedReplies({query:g,postId:this._parent.get("id"),currentBlogId:f.id,refId:this.getStepIndex()},c):e===l.discussionTypes.ALL?this._depth>0?j.getNextAllReplies({parentId:this._parent.get("id"),currentBlogId:f.id,startIndex:this._stepIndex,maxReturned:this._stepSize,approvedChildrenOnly:d,approvedStartersOnly:d},c):j.getAllReplies({postId:this._parent.get("id"),currentBlogId:f.id,startIndex:this.getStepIndex(),approvedChildrenOnly:d,approvedStartersOnly:d},c):this.getDiscussionType()===l.discussionTypes.PERMALINK?this._depth>0?j.getNextPermalinkReplies({parentId:this._parent.get("id"),currentBlogId:f.id,startIndex:this.length},c):j.getPermalinkReplies({postId:this._parent.get("id"),refId:this._permalinkComment.get("id"),query:h.getKinjaMeta().postAuthorBlogName,currentBlogId:f.id},c):null},parse:function(a){var c,e,f=[],g=this.getDepth(),h=this.getDiscussionType(),i=l.discussionTypes;return e=function(a,c,e){var i;d.addDiscussionId(a,{discussionType:h}),1>g&&(a._surfaced=!0),b.each(c,function(a){d.addDiscussionId(a,{discussionType:h}),1>g&&(a._surfaced=!0)}),i=new d(a),i._commentCollection=new l(c,{parent:i,parentDepth:g,discussionType:h,approvedOnly:this.getApprovedOnly()}),e&&(a.replyCount>4?(i._commentCollection._doneStepping=!1,i._commentCollection._stepIndex=4,i._commentCollection&&i._commentCollection.length&&(i._commentCollection._stepIndex=i._commentCollection.length)):(i._commentCollection._doneStepping=!0,i._commentCollection._stepIndex=i._commentCollection.length)),f.push(i)},h===i.PERSONALIZED||h===i.PERMALINK?1>g?b.each(a.data.items,function(a){if(a.length){var c=b.countBy(a,"parentId");a=b.map(a,function(a){var b=a.id;return a.hasOwnProperty("qiMeta")&&(a.replyCount=a.qiMeta.directReplies.length),c.hasOwnProperty(b)&&(a.replyCount-=c[b]),a}),e.call(this,b.first(a),b.rest(a))}}.bind(this)):(c=b.pluck(this._parent.collection.models,"id"),b.each(a.data.items,function(a){-1===c.indexOf(a.reply.id)&&e.call(this,a.reply,a.children.items)}.bind(this))):h===i.ALL&&(1>g?b.each(a.data.items,function(a){e.call(this,a.reply,a.children.items,!0)}.bind(this)):f=b.map(a.data.items[0].children.items,function(a){return d.addDiscussionId(a,{discussionType:h})})),this._checkDone(a)?(this._doneStepping=!0,this.trigger("pagination:done")):(this._incrementStep(a),this._doneStepping=!1),f},getDiscussionType:function(){return this._discussionType},getDepth:function(){return this._depth},getSurfacedCommentLength:function(){return this.filter(function(a){return a.get("_surfaced")}).length},getApprovedOnly:function(){return this.getDiscussionType()===l.discussionTypes.PERSONALIZED?!a.cookie("KinjaNSFWCookie"):this._approvedOnly}},{discussionTypes:{PERSONALIZED:"QiReplyList",ALL:"ReplyList",PERMALINK:"PermalinkQiReplyList"},likedCommentIds:null});return l}),define("module/discussion/discussion.channel",["backbone","underscore"],function(a,b){return b.extend({},a.Events)}),define("app/post/common/post.layout",["jquery","underscore","backbone.marionette","singleton/CurrentUser"],function(a,b,c,d){var e=c.Layout.extend(b.extend({regions:{post:".post"},ui:{likeButton:".js_like",likeIcon:".js_like_icon",recommendedIcon:".js_recommend-icon",likeCountPlaceholder:".js_like_count",replyButton:".js_reply-to-post",metaContainer:".meta-container"},triggers:{"click @ui.likeButton":"posttools:like","click @ui.replyButton":"posttools:reply"},events:{approval:"_removePendingStyling"},modelEvents:{"change:liked":"_updateLikeIconClasses","posttools:post:likeCount:updated":"_updateLikeCount"},initialize:function(){this.listenTo(d,"authenticated",this._updateLikeIconClasses),this.listenTo(d,"logoutReset",this._removeLikeIconClass),d.onAuth.done(function(){this.bindUIElements(),d.isLoggedIn()?this._updateLikeIconClasses():this._removeLikeIconClass()}.bind(this))},togglePostToolsVisibility:function(a){this.ui.metaContainer.toggleClass("without-dropdown",a)},_removePendingStyling:function(a,c){var d=this.$el.closest(".js_branch-list");b.each(c.approvedReplyIDs,function(a){d.find("#reply_"+a).removeClass("unapproved")})},_updateLikeIconClasses:function(){this.ui.likeIcon.toggleClass("active",this.model.get("liked")),this.ui.recommendedIcon.toggleClass("active",this.model.get("liked"))},_removeLikeIconClass:function(){this.ui.likeIcon.removeClass("active"),this.ui.recommendedIcon.removeClass("active")},_updateLikeCount:function(){var a=parseInt(this.ui.likeButton.data("likecount"),10)||0,b=a>0;a=this.model.get("liked")?a+1:b?a-1:0,this.ui.likeButton.data("likecount",a),this.ui.likeCountPlaceholder.text(a||"")}}));return e}),define("app/post/mixins/post.userPermissionsHelper",["singleton/Feature","singleton/CurrentUser","singleton/CurrentBlog"],function(a,b,c){return{canEditPost:function(c){var d=15,e=function(a){var b=new Date(a+60*d*1e3),c=new Date;return b>c},f=b.isLoggedIn(),g=b.id===c.get("authorId"),h=b.hasRole("OWNER",c.get("defaultBlogId")),i=b.hasRole("ADMIN",c.get("defaultBlogId")),j=c.has("parentId"),k=f&&(g||h||i)&&!j,l=f&&j&&g&&e(c.get("publishTimeMillis"));return b.isSuperuser()&&a.isOn("superuser")||k||l},canDeletePost:function(a){var c=b.isLoggedIn(),d=b.id===a.get("authorId"),e=b.hasRole("OWNER",a.get("defaultBlogId")),f=a.has("parentId");return c&&(d||e)&&!f},canInviteToPostManually:function(c){return a.isOn("invitetoken")&&c.get("authorId")===b.id},canPromote:function(){return b.hasPermission("SALES")||b.isSuperuser()&&a.isOn("superuser")||b.hasGMGRole("ADMIN")},canDismissPost:function(d){var e=b.hasRole("ADMIN",c.id)||b.hasRole("ADMIN",d.get("defaultBlogId")),f=b.id===d.get("authorId"),g=b.id===d.get("parentAuthorId"),h=d.has("parentId");return h&&(b.isSuperuser()&&a.isOn("superuser")||!f&&(e||g))},canUnshareRepostedPost:function(){return b.hasRole("ADMIN",c.id)
},canBlock:function(a){return this.userIsOwner(a)||this.userIsAdmin(a)||this.userIsSuper()},canSharePost:function(){return b.isLoggedIn()},userIsAuthor:function(a){return b.hasRole("AUTHOR",a.get("defaultBlogId"))&&b.id!==a.get("authorId")},userIsOwner:function(a){return b.hasRole("OWNER",a.get("defaultBlogId"))&&b.id!==a.get("authorId")},userIsAdmin:function(a){return b.hasRole("ADMIN",a.get("defaultBlogId"))&&b.id!==a.get("authorId")},userIsSuper:function(){return b.isSuperuser()&&a.isOn("superuser")}}}),define("app/post/mixins/post.userPermissions",["underscore","app/post/mixins/post.userPermissionsHelper"],function(a,b){var c=["canEditPost","canDeletePost","canInviteToPostManually","canPromote","canDismissPost","canUnshareRepostedPost","canBlock","canSharePost","userIsAuthor","userIsOwner","userIsAdmin","userIsSuper"];return a.reduce(c,function(c,d){return c[d]=a.wrap(b[d],function(a){return a.call(this,this.model)}),c},{})}),define("app/post/mixins/post.confirmationPrompt",["jquery","singleton/Renderer"],function(a,b){var c={_confirmationPrompt:function(c,d){return window.confirm(a(b.renderTemplate(c,d||{})).text())}};return c}),define("app/post/common/post.menuitemview",["backbone.marionette"],function(a){var b=a.ItemView.extend({_show:function(){this.$el.removeClass("hide")},_hide:function(){this.$el.addClass("hide")},_isDisabled:function(){return!1},_canShow:function(){throw new Error("method _canShow not implemented!")},onRender:function(){this._canShow()?(this._show(),this._isDisabled()?this.$el.addClass("disabled"):this.$el.removeClass("disabled")):this._hide()}});return b}),define("app/post/posttools/view/posttools.menuitemview",["underscore","backbone.marionette","app/post/mixins/post.userPermissions","app/post/mixins/post.confirmationPrompt","app/post/common/post.menuitemview"],function(a,b,c,d,e){var f=e.extend(a.extend({},c,d,{_canShow:function(){var b=this,c=function(a){return b[a]};return a.chain(this.permissions).map(c).invoke("call",this).all().value()},render:function(){return this.isClosed=!1,this.triggerMethod("before:render",this),this.triggerMethod("item:before:render",this),this.bindUIElements(),this.triggerMethod("render",this),this.triggerMethod("item:rendered",this),this}}));return f}),define("app/post/posttools/view/posttools.editview",["app/post/posttools/view/posttools.menuitemview","singleton/Feature","singleton/Utils"],function(a,b,c){var d=a.extend({permissions:["canEditPost"],onRender:function(){var d=b.isOn("editor_own_page_test")?window.location.search:"",e=this.$el.find("a");a.prototype.onRender.call(this,arguments),e.attr("href","//"+c.getKinjaHost()+"/write/"+this.model.id+d)}});return d}),define("app/post/posttools/view/posttools.editreplyview",["app/post/posttools/view/posttools.menuitemview"],function(a){var b=a.extend({permissions:["canEditPost"]});return b}),define("app/post/posttools/view/posttools.deleteview",["app/post/posttools/view/posttools.menuitemview"],function(a){var b=a.extend({permissions:["canDeletePost"],triggers:{click:"posttools:delete"}});return b}),define("apiclient/invite",["config","apiclient/apirequest","apiclient/gettoken"],function(a,b,c){return{addInvite:b.postJson(c.append(a.api.core.url+"/invite")),requestInviteToken:b.postJson(c.append(a.api.core.url+"/invite/create?postId={{postId}}")),approveInvitedCommenter:b.postJson(a.api.core.url+"/invite/approve")}}),define("templates/tiger/components/invites/modals",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.invites.modals.inviteToPostManually=function(a,b){var c=b||new d.StringBuilder;return c.append('	<form class="invite-to-post-form js_invite-to-post-form"><div class="row"><div class="columns"><input type="url" class="mbn js_invite-manually-field" value="',d.$$escapeHtml(a.permalink),"?invite=",d.$$escapeHtml(a.inviteUid),'" autofocus /></div></div></form>'),b?"":c.toString()}}),define("view/forms/invite/InviteToPostManuallyModalView",["jquery","backbone","underscore","backbone.marionette","singleton/CurrentUser","singleton/EventDispatcher","templates/tiger/components/invites/modals"],function(a,b,c,d,e,f){var g=d.ItemView.extend({id:"modal-invite-to-post-manually",template:tiger.components.invites.modals.inviteToPostManually,ui:{inviteToPostManuallyField:"#js_invite-to-post-manually-field"},initialize:function(){f.on("modal:login:close",this.close,this)}});return g}),define("app/invites/behaviors/invites.token.posttools",["jquery","underscore","backbone","backbone.marionette","singleton/CurrentUser","apiclient/invite","app/modal/modal.controller","view/forms/invite/InviteToPostManuallyModalView"],function(a,b,c,d,e,f,g,h){var i=d.Behavior.extend({events:{click:"onInviteModalToPostManuallyOpen"},onInviteModalToPostManuallyOpen:function(a){a.preventDefault(),f.requestInviteToken({postId:this.view.model.id}).done(function(a){var b=g.instantiate(h,{templateData:{permalink:this.view.model.get("permalink"),inviteUid:a.inviteUid}});g.create(b,{name:"invite",className:"reveal-modal kinja-modal small proxima"})}.bind(this))}});return i}),define("app/post/posttools/view/posttools.invitemanuallyview",["app/post/posttools/view/posttools.menuitemview","app/invites/behaviors/invites.token.posttools"],function(a,b){var c=a.extend({permissions:["canInviteToPostManually"],behaviors:{InvitesTokenPostTools:{behaviorClass:b}}});return c}),define("app/post/posttools/view/posttools.dismissview",["jquery","app/post/posttools/view/posttools.menuitemview","singleton/CurrentUser","singleton/Utils"],function(a,b,c,d){var e=b.extend({permissions:["canDismissPost"],ui:{dismissButton:"a.dismiss",undismissButton:"a.undismiss"},triggers:{"click @ui.dismissButton":"posttools:dismiss","click @ui.undismissButton":"posttools:undismiss"},modelEvents:{"change:actionState":"_finishRender"},_finishRender:function(){this._setDismissState(),b.prototype.onRender.call(this)},_setDismissState:function(){var a=this.model.get("actionState"),b=this.model.get("defaultBlogId");a=a?a[b]:"","dismiss"===a?(this.$el.removeClass(".js_dismiss").addClass("js_undismiss"),this.ui.dismissButton.addClass("hide"),this.ui.undismissButton.removeClass("hide")):(this.$el.removeClass(".js_undismiss").addClass("js_dismiss"),this.ui.undismissButton.addClass("hide"),this.ui.dismissButton.removeClass("hide"))},onRender:function(){var a,b,e=this;"permalink"===d.getKinjaMeta().pageType?(a=parseInt(d.getKinjaMeta().postId||0,10),b=parseInt(d.getKinjaMeta().starterId||0,10),a!==b&&a===this.model.id?c.onAuth.always(function(){c.isLoggedIn()?e.triggerMethod("posttools:getDismissState",{model:e.model}):e._finishRender()}):this._finishRender()):this._finishRender()}});return e}),define("app/post/posttools/view/posttools.promoteview",["app/post/posttools/view/posttools.menuitemview","singleton/Utils"],function(a,b){var c=a.extend({permissions:["canPromote"],triggers:{click:"posttools:promote"},onPosttoolsOpened:function(){var a=this.model&&parseInt(b.getKinjaMeta().postId,10)===this.model.get("sharedPostId");a&&this.$el.addClass("hide")}});return c}),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define("lib/needly",b):a.Needly=b()}(this,function(){function a(a,b,c){this.resolve=function(){return a.resolve(b,{args:c})}}function b(){var b=this,i={};return this.registerClass=function(a,b,d){return i[a]={type:c,item:b,args:d},b},this.registerSingleton=function(a,b){return i[a]={type:e,item:b},b},this.registerFactory=function(a,b,c,e){return i[a]={type:d,item:b,args:c,context:e},b},this.registerMany=function(a){for(var b in a)if(a.hasOwnProperty(b)){var f=a[b],g=f.type,h="BadConfiguration:";if(!f||!f.dependency)throw new Error(h+b+".dependency");if(g!==e&&g!==c&&g!==d)throw new Error(h+b+".type");i[b]={item:f.dependency,type:f.type,args:f.type!==e?f.args:null,context:f.type===d?f.context:null}}},this.unregister=function(a){delete i[a]},this.unregisterAll=function(){i={}},this.property=function(b,c){return new a(this,b,c)},this.args=function(){var a=arguments.length-1,c=f.call(arguments,0,a),d=arguments[a];return function(){for(var e=[],g=f.call(arguments),h=Math.max(a,g.length),i=0;h>i;i++){var j,k=c[i];if(k)if("string"==typeof k)k=g[i]||b.resolve(k);else{if(k!==new Object(k))throw new Error("BadArgument: Expected string or object. Received: "+k);j=k,k=g[i]||{};for(var l in j)!k.hasOwnProperty(l)&&j.hasOwnProperty(l)&&(k[l]=b.resolve(j[l]))}else k=g[i];e.push(k)}return d.apply(d,e)}},this.resolveAll=function(b){for(var c in b){var d=b[c];d&&d instanceof a&&(b[c]=d.resolve())}return b},this.autoResolve=function(a,c){c=c||"initialize";var d=a.prototype[c];a.prototype[c]=function(){b.resolveAll(this),d&&d.apply(this,arguments)}},this.resolve=function(a,b){var f,j=b||{},k=i[a];if(k)switch(f=h(k.args,j.args),k.type){case e:return k.item;case d:return this.resolveAll(k.item.apply(j.context||k.context||this,f));case c:return this.resolveAll(g(k.item,f))}else{var l="DependencyNotFound:"+a;console&&console.warn&&console.warn(l),j.error&&j.error(l)}},this}var c="class",d="factory",e="singleton",f=Array.prototype.slice,g=function(a,b){function c(){return a.apply(this,b)}return c.prototype=a.prototype,new c},h=function(a,b){return(a||[]).concat(b||[])};return{Container:b}}),define("gawkerlib/analytics/analytics_config_prod",[],function(){var a={rootUrl:"http://kinja.com/api/analytics/",rootUrlWoProtocol:"//kinja.com/api/analytics/"};return a}),!function(){function a(a){this.message=a}var b="undefined"!=typeof exports?exports:this,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.prototype=new Error,a.prototype.name="InvalidCharacterError",b.btoa||(b.btoa=function(b){for(var d,e,f=String(b),g=0,h=c,i="";f.charAt(0|g)||(h="=",g%1);i+=h.charAt(63&d>>8-g%1*8)){if(e=f.charCodeAt(g+=.75),e>255)throw new a("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");d=d<<8|e}return i}),b.atob||(b.atob=function(b){var d=String(b).replace(/=+$/,"");if(d.length%4==1)throw new a("'atob' failed: The string to be decoded is not correctly encoded.");for(var e,f,g=0,h=0,i="";f=d.charAt(h++);~f&&(e=g%4?64*e+f:f,g++%4)?i+=String.fromCharCode(255&e>>(-2*g&6)):0)f=c.indexOf(f);return i})}(),define("lib/base64.min",function(){}),define("module/KinjaAnalytics",["jquery","gawkerlib/analytics/analytics_config_prod","singleton/Feature","lib/base64.min"],function(a,b,c){var d={session:{},context:{},setContext:function(a,b,c){this.context.blogId=a,this.context.contextType=b,this.context.id=c},createPayload:function(a,b,c,d,e,f,g,h){var i={blogId:a,eventType:b,targetType:c,targetId:d,contextType:e,contextId:f,eventAttributes:g,eventAttributesExtended:h};return i},pushEvent:function(a,b,c,d,e){var f=this.createPayload(this.context.blogId?String(this.context.blogId):null,a,b,c?String(c):null,this.context.contextType,this.context.id?String(this.context.id):null,d,e);this.writeEvent(f)},setSession:function(a){return"string"==typeof a.agid&&"string"==typeof a.asid&&a.ping?(this.session.globalId=a.agid,this.session.sessionId=a.asid,this.session.ping=a.ping,!0):!1},getEventMeta:function(){var a={context:this.context,session:this.session};return a},writeEvent:function(d){var e=btoa(JSON.stringify(d)),f=c.isOn("linkswoprotocol")?b.rootUrlWoProtocol:b.rootUrl,g=Math.floor(1e3*Math.random()+1),h=f+"t/event.js?e="+e+"&cb="+g,i=this;a.ajax(h,{type:"GET",success:function(a){i.setSession(a.data)},crossDomain:!0,dataType:"jsonp"})}};return d}),define("app/post/posttools/controller/posttools.dismiss.controller",["jquery"],function(a){var b={API:{dismiss:function(b){b.setAction("dismiss",b.get("defaultBlogId"),{success:a.proxy(function(){b.trigger("posttools:post:dismissed"),b.trigger("annotation:remove")},this),error:function(a){throw new Error("PostTools.dismissPost(): "+a.reason)}})},undismiss:function(b){b.setAction("actionreset",b.get("defaultBlogId"),{success:a.proxy(function(){b.trigger("posttools:post:undismissed")},this),error:function(a){throw new Error("PostTools.undismissPost(): "+a.reason)}})}}};return b.API}),define("app/post/posttools/controller/posttools.block.controller",["jquery","underscore","singleton/CurrentUser","collection/blog.subscribersCollection"],function(a,b,c,d){var e={_isBlockeeAMemberCache:{},blockedBlogIdsPromise:new a.Deferred,blockedIdsDataCache:[],_blogsBlockedHash:{},_postIsBlocked:function(a,b){return-1!==b.indexOf(a.get("authorBlogId"))},_blockBlog:function(a,b){var d,f=b.targetBlogId,g=b.confirmation,h=b.blockedBlogCollection,i=a.get("defaultBlogId"),j=b.targetBlogName,k=b.forceAction;"undefined"!=typeof k?(d=k,c.set("forceAction",k)):d=e._postIsBlocked(a,b.blockedBlogIds)?"unblock":"block",("boolean"==typeof g&&g||g({action:d,username:a.get("author").displayName,sitename:j}))&&c.setBlogAction(d,i,f,{success:function(b){var e,g=c.get("forceAction");b?"block"===d?(h.add({id:f}),h.trigger("posttools:block"),a.trigger("posttools:block")):(e=h.findWhere({id:f}),e&&h.remove(e),h.trigger("posttools:unblock"),a.trigger("posttools:unblock")):("block"===g||"unblock"===g)&&(h.trigger("posttools:"+g),a.trigger("posttools:"+g))},error:function(a){throw new Error("PostTools.blockBlog(): "+a.reason)}})},_blockedBlogsInitialized:function(b){var c;return e._blogsBlockedHash.hasOwnProperty(b)||(e._blogsBlockedHash[b]=e.API.getBlockedBlogCollection(b)),e._blogsBlockedHash[b].fetched?(c=a.Deferred(),c.resolve(e._blogsBlockedHash[b]),c):(e._blogsBlockedHash[b].fetched=!0,e._blogsBlockedHash[b].fetch())},API:{isBlockable:function(c,d,f,g){if(!d){try{throw new Error("blogId is undefined")}catch(h){require(["module/Raven"],function(Raven){Raven.captureException(h,{extra:{postModel:c.toJSON()}})})}return c.trigger("posttools:checkedBlockability",!1),!1}void 0!==e._isBlockeeAMemberCache[d]&&void 0!==f&&void 0!==e._isBlockeeAMemberCache[d][f]?c.trigger("posttools:checkedBlockability",e._isBlockeeAMemberCache[d][f]):a.ajax({url:"http://kinja.com/api/profile/blogmembership/views/byBlogs?ids="+d,dataType:"jsonp",jsonp:"jsonp",success:function(a){var h=!1;a.meta&&b.isArray(a.data)&&(h=!b.any(a.data,function(a){return a.authorId===g})),c.trigger("posttools:checkedBlockability",h),void 0===e._isBlockeeAMemberCache[d]&&(e._isBlockeeAMemberCache[d]={}),e._isBlockeeAMemberCache[d][f]=h},error:function(){c.trigger("posttools:checkedBlockability",!1)}})},block:function(b,c,d,f,g){var h,i=b.get("defaultBlogId"),j=b.get("authorBlogId");i!==j&&a.when(e._blockedBlogsInitialized(i)).then(function(){h={targetBlogId:j,blockedBlogIds:c.getIds(),blockedBlogCollection:c,confirmation:d,targetBlogName:f,forceAction:g},e._blockBlog(b,h)})},getBlockedBlogCollection:function(a){return e._blogsBlockedHash.hasOwnProperty(a)||(e._blogsBlockedHash[a]=new d([],{blogId:a,type:"blocked",withNames:!1})),e._blogsBlockedHash[a]},checkBlockStatus:function(b,c){var d=b.get("defaultBlogId");a.when(e._blockedBlogsInitialized(d)).then(function(){b.trigger("posttools:blockStatusUpdated",e._postIsBlocked(b,c.getIds()))})}}};return window.__karma__&&(e.API.__testonly__=e),e.API}),define("app/post/mixins/post.successMessage",["jquery","singleton/Renderer","singleton/EventDispatcher"],function(a,b,c){var d={_displaySuccessMessage:function(a,d){c.trigger("successbox:display",{message:b.renderTemplate(a,d||{})})},_displayChannelMessage:function(a,d){c.trigger("successbox:display",{message:b.renderTemplate(a,d||{}),timeout:5e3})}};return d}),define("templates/tiger/messages",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.messages.areYouSureToDelPost=function(a,b){var c=b||new d.StringBuilder;return c.append("	Are you sure you want to delete this post?"),b?"":c.toString()},b.messages.areYouSureToDisconnect=function(a,b){var c=b||new d.StringBuilder;return c.append("	Are you sure you want to disconnect this account?"),b?"":c.toString()},b.messages.confirmCloseEditor=function(a,b){var c=b||new d.StringBuilder;return c.append("	Closing the editor will discard any unsaved changes in this post. Is that OK?"),b?"":c.toString()},b.messages.confirmDiscardUnsavedChanges=function(a,b){var c=b||new d.StringBuilder;return c.append("	You have unsaved changes in this post."),b?"":c.toString()},b.messages.confirmHidePost=function(a,b){var c=b||new d.StringBuilder;return c.append("	Are you sure you want to hide this?"),b?"":c.toString()},b.messages.confirmDismissPost=function(a,b){var c=b||new d.StringBuilder;return c.append("	Are you sure you want to dismiss this reply?"),b?"":c.toString()},b.messages.postIsBeingSaved=function(a,b){var c=b||new d.StringBuilder;return c.append("	Your post is being saved, please be patient."),b?"":c.toString()},b.messages.confirmBlockBlog=function(a,b){var c=b||new d.StringBuilder;return c.append("block"==a.action?"Are you sure you want to block "+d.$$escapeHtml(a.username)+" on "+d.$$escapeHtml(a.sitename)+"?":"Are you sure you want to unblock "+d.$$escapeHtml(a.username)+" on "+d.$$escapeHtml(a.sitename)+"?"),b?"":c.toString()},b.messages.quickpostPublish=function(a,b){var c=b||new d.StringBuilder;return c.append("	Save as public"),b?"":c.toString()},b.messages.quickpostSave=function(a,b){var c=b||new d.StringBuilder;return c.append("	Save as private"),b?"":c.toString()},b.messages.quickpostDelete=function(a,b){var c=b||new d.StringBuilder;return c.append("	Delete Post"),b?"":c.toString()},b.messages.publish=function(a,b){var c=b||new d.StringBuilder;return c.append("	Publish"),b?"":c.toString()},b.messages.publishing=function(a,b){var c=b||new d.StringBuilder;return c.append("	Publishing…"),b?"":c.toString()},b.messages.save=function(a,b){var c=b||new d.StringBuilder;return c.append("	Save"),b?"":c.toString()},b.messages.saving=function(a,b){var c=b||new d.StringBuilder;return c.append("	Saving…"),b?"":c.toString()},b.messages.del=function(a,b){var c=b||new d.StringBuilder;return c.append("	Delete"),b?"":c.toString()},b.messages.deleting=function(a,b){var c=b||new d.StringBuilder;return c.append("	Deleting…"),b?"":c.toString()},b.messages.share=function(a,b){var c=b||new d.StringBuilder;return c.append("	Share"),b?"":c.toString()},b.messages.sharing=function(a,b){var c=b||new d.StringBuilder;return c.append("	Sharin"),b?"":c.toString()},b.messages.published=function(a,b){var c=b||new d.StringBuilder;return c.append("	Published"),b?"":c.toString()},b.messages.redirecting=function(a,b){var c=b||new d.StringBuilder;return c.append("	Redirecting…"),b?"":c.toString()},b.messages.manage=function(a,b){var c=b||new d.StringBuilder;return c.append("	Manage"),b?"":c.toString()},b.messages.postReposted=function(a,b){var c=b||new d.StringBuilder;return c.append("	Shared to ",d.$$escapeHtml(a.blogName),'. <a href="',d.$$escapeHtml(a.blogUrl),'">View &raquo;</a>'),b?"":c.toString()},b.messages.postScheduledRepost=function(a,b){var c=b||new d.StringBuilder;return c.append("	Your post has been scheduled to publish."),b?"":c.toString()},b.messages.repostRemoved=function(a,b){var c=b||new d.StringBuilder;return c.append("	Post successfully un-shared from this blog (it may take 1-2 minutes for it to stop displaying)"),b?"":c.toString()},b.messages.unsharePost=function(a,b){var c=b||new d.StringBuilder;return c.append("	Removed share"),b?"":c.toString()},b.messages.areYouSureToUnschedRepost=function(a,b){var c=b||new d.StringBuilder;return c.append("	Are you sure you want to unschedule this repost?"),b?"":c.toString()},b.messages.future=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"future"},f,e),c?"":f.toString()},b.messages.oneSecondAgo=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"seconds"},f,e),c?"":f.toString()},b.messages.someSecondsAgo=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"seconds",amount:a.seconds},f,e),c?"":f.toString()},b.messages.oneMinuteAgo=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"minute"},f,e),c?"":f.toString()},b.messages.someMinutesAgo=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"minutes",amount:a.minutes},f,e),c?"":f.toString()},b.messages.oneHourAgo=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"hours"},f,e),c?"":f.toString()},b.messages.someHoursAgo=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"hours",amount:a.hours},f,e),c?"":f.toString()},b.messages.oneDayAgo=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"days"},f,e),c?"":f.toString()},b.messages.someDaysAgo=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"days",amount:a.days},f,e),c?"":f.toString()},b.messages.oneMonthAgo=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"months"},f,e),c?"":f.toString()},b.messages.someMonthsAgo=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"months",amount:a.months},f,e),c?"":f.toString()},b.messages.oneYearAgo=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"years"},f,e),c?"":f.toString()},b.messages.someYearsAgo=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	"),b.messages.relativeTime({type:"years",amount:a.years},f,e),c?"":f.toString()},b.messages.relativeTime=function(a,b){a=a||{};var c=b||new d.StringBuilder;switch(c.append("	"),a.type){case"seconds":c.append(a.amount&&"1"!=a.amount?d.$$escapeHtml(a.amount)+" seconds ago":"1 second ago");break;case"hours":c.append(a.amount&&"1"!=a.amount?d.$$escapeHtml(a.amount)+" hours ago":"an hour ago");break;case"days":c.append(a.amount&&"1"!=a.amount?d.$$escapeHtml(a.amount)+" days ago":"yesterday");break;case"weeks":c.append(a.amount&&"1"!=a.amount?d.$$escapeHtml(a.amount)+" weeks ago":"a week ago");break;case"months":c.append(a.amount&&"1"!=a.amount?d.$$escapeHtml(a.amount)+" months ago":"a month ago");break;case"years":c.append(a.amount&&"1"!=a.amount?d.$$escapeHtml(a.amount)+" years ago":"1 year ago");break;case"future":c.append(d.$$escapeHtml(a.Mddyyhmma));break;case"minutes":c.append(a.amount&&"1"!=a.amount?'<span class="'+(a.timestamp?"minutedisplay-"+d.$$escapeHtml(a.timestamp):"")+'">'+d.$$escapeHtml(a.amount)+"</span> minutes ago":'<span class="'+(a.timestamp?"minutedisplay-"+d.$$escapeHtml(a.timestamp):"")+'">A</span> minute ago');break;case"today":c.append("Today ",d.$$escapeHtml(a.hmma));break;case"yesterday":c.append("Yesterday ",d.$$escapeHtml(a.hmma));break;case"pastweek":c.append(d.$$escapeHtml(a.day)," ",d.$$escapeHtml(a.hmma));break;case"greaterthanweek":c.append(d.$$escapeHtml(a.Mddyyhmma));break;default:c.append("Just now")}return b?"":c.toString()},b.messages.shortRelativeTime=function(a,b){var c=b||new d.StringBuilder;return c.append("	",a.timestamp.minutes?d.$$escapeHtml(a.timestamp.minutes)+"m":a.timestamp.hours?d.$$escapeHtml(a.timestamp.hours)+"h":a.timestamp.days?d.$$escapeHtml(a.timestamp.days)+"d":a.timestamp.weeks?d.$$escapeHtml(a.timestamp.weeks)+"w":a.timestamp.years?d.$$escapeHtml(a.timestamp.years)+"y":"now"),b?"":c.toString()},b.messages.postPublished=function(a,b){var c=b||new d.StringBuilder;return c.append("	Your post has been published."),b?"":c.toString()},b.messages.postSaved=function(a,b){var c=b||new d.StringBuilder;return c.append("	Your post has been saved."),b?"":c.toString()},b.messages.postSaveFailed=function(a,b){var c=b||new d.StringBuilder;return c.append("	Post save failed."),b?"":c.toString()},b.messages.postAlreadyExists=function(a,b){var c=b||new d.StringBuilder;return c.append("	Post was already reposted on this blog."),b?"":c.toString()},b.messages.postTooLong=function(a,b){var c=b||new d.StringBuilder;return c.append("	Your post is too long, please shorten it."),b?"":c.toString()},b.messages.tokenCallFailed=function(a,b){var c=b||new d.StringBuilder;return c.append('	Post failed to save. Please check your network connection and try again.<a class="icon icon-question-circle hover-icon icon-append help-link" href="http://help.gawker.com/customer/portal/articles/1794410-why-am-i-receiving-a-post-save-error-" target="_blank"></a>'),b?"":c.toString()},b.messages.tokenRefreshFailed=function(a,b){var c=b||new d.StringBuilder;return c.append('	Post failed to save. If you logged out of Kinja in another tab, please log in on that tab and try saving again.<a class="icon icon-question-circle hover-icon icon-append help-link" href="http://help.gawker.com/customer/portal/articles/1794410-why-am-i-receiving-a-post-save-error-" target="_blank"></a>'),b?"":c.toString()},b.messages.postSaveTimeout=function(a,b){var c=b||new d.StringBuilder;return c.append("	Post is taking very long to save. Please check your network connection and try again."),b?"":c.toString()},b.messages.postDeleted=function(a,b){var c=b||new d.StringBuilder;return c.append("	The post has been deleted successfully."),b?"":c.toString()},b.messages.repostUnscheduled=function(a,b){var c=b||new d.StringBuilder;return c.append("	The repost has been unscheduled successfully."),b?"":c.toString()},b.messages.postRecommended=function(a,b){var c=b||new d.StringBuilder;return c.append("	You recommended a post."),b?"":c.toString()},b.messages.replySubmitted=function(a,b){var c=b||new d.StringBuilder;return c.append("	Your reply has been submitted."),b?"":c.toString()},b.messages.settingsSaved=function(a,b){var c=b||new d.StringBuilder;return c.append("	Settings saved successfully."),b?"":c.toString()},b.messages.blogPropertySaved=function(a,b){var c=b||new d.StringBuilder;return c.append("	Blog property saved successfully."),b?"":c.toString()},b.messages.blogPropertyCreated=function(a,b){var c=b||new d.StringBuilder;return c.append("	Blog property created successfully."),b?"":c.toString()},b.messages.blogPropertyDeleted=function(a,b){var c=b||new d.StringBuilder;return c.append("	Blog property deleted successfully."),b?"":c.toString()},b.messages.ownerSet=function(a,b){var c=b||new d.StringBuilder;return c.append("	New owner has been set."),b?"":c.toString()},b.messages.cannotDisconnectLoginAccount=function(a,b){var c=b||new d.StringBuilder;return c.append("	You cannot disconnect your login account from Kinja. Please switch your login account, save, and try again."),b?"":c.toString()},b.messages.blogFollowed=function(a,b){var c=b||new d.StringBuilder;return c.append("	You are following ",d.$$escapeHtml(a.blogName),"."),b?"":c.toString()},b.messages.blogFollowFailed=function(a,b){var c=b||new d.StringBuilder;return c.append("	Failed to follow ",d.$$escapeHtml(a.blogName),". Please try again."),b?"":c.toString()},b.messages.blogUnfollowed=function(a,b){var c=b||new d.StringBuilder;return c.append("	You are no longer following ",d.$$escapeHtml(a.blogName),"."),b?"":c.toString()},b.messages.blogUnfollowFailed=function(a,b){var c=b||new d.StringBuilder;return c.append("	Failed to unfollow ",d.$$escapeHtml(a.blogName),". Please try again."),b?"":c.toString()},b.messages.replyCreate=function(a,b){var c=b||new d.StringBuilder;return c.append('<div class="twelve columns end mbx"><div class="reply-create media"><div class="img mrm"><span class="icon icon-bubble-right"></span></div><div class="bd proxima"><span class="msg text-small">No discussion yet. <a href="#" class="js_new-reply-to-post">Start a discussion.</a></span></div></div></div>'),b?"":c.toString()},b.messages.repliesDisabled=function(a,b){var c=b||new d.StringBuilder;return c.append('<div class="twelve columns end mbx"><div class="reply-create media"><div class="img mrm"><span class="icon icon-bubble-right"></span></div><div class="bd proxima"><span class="msg text-small text-light">This discussion is closed</span></div></div></div>'),b?"":c.toString()},b.messages.ajaxError=function(a,b){var c=b||new d.StringBuilder;return c.append("	Sorry, something went wrong.<br>Please try again."),b?"":c.toString()},b.messages.groupchatsRepliesDisabled=function(a,b){var c=b||new d.StringBuilder;return c.append("	This discussion is closed"),b?"":c.toString()},b.messages.unapprovedStartersMessage=function(a,b){var c=b||new d.StringBuilder;return c.append("	Help ",d.$$escapeHtml(a.blog),' identify the best submissions. <span class="icon icon-star inline"></span> compelling replies that ',d.$$escapeHtml(a.blog)," may have overlooked."),b?"":c.toString()},b.messages.moreFooStories=function(a,b){var c=b||new d.StringBuilder;return c.append("	More ",d.$$escapeHtml(a.tag)," stories"),b?"":c.toString()},b.messages.postToMyPersonalBlog=function(a,b){var c=b||new d.StringBuilder;return c.append("	My personal blog only"),b?"":c.toString()},b.messages.filenameContainsSemicolon=function(a,b){var c=b||new d.StringBuilder;return c.append("	The filename cannot contains semicolon"),b?"":c.toString()},b.messages.imageUploadError=function(a,b){var c=b||new d.StringBuilder;return c.append("	Image upload error."),b?"":c.toString()},b.messages.areYouSure=function(a,b){var c=b||new d.StringBuilder;return c.append("	Are you sure?"),b?"":c.toString()},b.messages.assetRecommended=function(a,b){var c=b||new d.StringBuilder;return c.append("	Media recommended."),b?"":c.toString()},b.messages.assetUnrecommended=function(a,b){var c=b||new d.StringBuilder;return c.append("	Removed media recommendation."),b?"":c.toString()},b.messages.linkToDiscussion=function(a,b){var c=b||new d.StringBuilder;return c.append('	<a href="',d.$$escapeHtml(a.url),'" class="proxima discussionpermalink" target="_blank">Link to discussion</a>'),b?"":c.toString()},b.messages.twitterAppUpdated=function(a,b){var c=b||new d.StringBuilder;return c.append('We are updating the Twitter application that you use to connect with Kinja. You will need to re-authorize your account beginning on Jan. 14.<br /><a href="http://product.kinja.com/re-authorizing-your-twitter-account-1493481797">More information here.</a>'),b?"":c.toString()},b.messages.amazonBestSellerReport=function(a,b){var c=b||new d.StringBuilder;return c.append("<p><small>If the blog list is omitted, all blogs will be taken into account. If the limit is set to 0, no limit is set.</small></p>"),b?"":c.toString()},b.messages.amazonTagReport=function(a,b){var c=b||new d.StringBuilder;return c.append("<p><small>Beware: If the checkbox above is unchecked, Amazon statistics and posts will both be filtered by the date picker. This means that earnings and orders for posts which were published earlier will <strong>not</strong> be shown here.</small></p>"),b?"":c.toString()},b.messages.hrNumber=function(a,b){var c=b||new d.StringBuilder;if(c.append("	"),a.value<1e3)c.append(d.$$escapeHtml(a.value));else{var e=Math.floor(a.value%1e3/100);c.append(d.$$escapeHtml(Math.floor(a.value/1e3)),e>0?"."+d.$$escapeHtml(e):"","k")}return b?"":c.toString()},b.messages.postSave=function(a,c,e){a=a||{};var f=c||new d.StringBuilder;return f.append('	<div class="js_post-save-loader loading-full animate"><div class="loading-message-box">',a.showMessage?'<p class="message">Saving...</p><p class="message-still">Still Saving...</p>':""),b.components.spinner.bounce(null,f,e),f.append("</div></div>"),c?"":f.toString()},b.messages.loginSuccess=function(a,b){var c=b||new d.StringBuilder;return c.append("	Login successful."),b?"":c.toString()},b.messages.notifications=function(a,b){var c=b||new d.StringBuilder;return c.append("	",d.$$escapeHtml(a.count)," notifications"),b?"":c.toString()},b.messages.undoDismissMsg=function(a,b){var c=b||new d.StringBuilder;return c.append("	You have successfully dismissed this reply."),b?"":c.toString()},b.messages.undoBlockMsg=function(a,b){var c=b||new d.StringBuilder;return c.append("	You have successfully dismissed this reply and blocked ",d.$$escapeHtml(a.userName)," from ",d.$$escapeHtml(a.blogName)),b?"":c.toString()},b.messages.undoResolveMsg=function(a,b){var c=b||new d.StringBuilder;
return c.append("	You have successfully resolved the flag on this reply."),b?"":c.toString()}}),define("app/post/posttools/controller/posttools.like.controller",["jquery","underscore","singleton/CurrentUser","singleton/EventDispatcher","singleton/Feature","module/KinjaAnalytics","singleton/Utils","app/post/mixins/post.successMessage","templates/tiger/messages"],function(a,b,c,d,e,f,g,h){var i={};return i=b.extend(i,h,{_trackRecommendation:function(a){var b=a.get("isStarter")?"Post":"Comment";window.ga("send","event","Recommendation",b+" Recommended",a.get("permalink"))},_likePost:function(c,d){var f=c.get("liked")?"unlike":"like",g=c.setLike(f,{success:function(a){if("like"===f&&(i._trackRecommendation(c),i._displaySuccessMessage(tiger.messages.postRecommended),!c.get("isStarter")&&!c.get("approved"))){var g=b.pluck(a.response.approvalResult.approvedReplies,"postId"),h=d.model.get("id");e.isOn("groupchats_refactor")?-1!==b.indexOf(g,h)&&d.model.set({approved:!0}):d.$el.trigger("approval",{approvedReplyIDs:g})}},error:function(a){throw new Error("PostTools.likePost(): "+a.reason)}}),h=function(){c.trigger("posttools:post:likeCount:updated")};a.when(g).then(h)},API:{like:function(b,d){return a("body").hasClass("read-only")?!0:(c.requireLogin("likePost").done(function(){i._likePost(b,d)}),void(("dashboard"===g.getKinjaMeta().pageType||"manageblog"===g.getKinjaMeta().pageType)&&(f.setContext(null,"DASHBOARD"),f.pushEvent("STAR"))))}}}),i.API}),define("apiclient/promotion",["config","apiclient/apirequest","apiclient/gettoken"],function(a,b,c){var d,e;return e={getByBlog:a.api.core.url+"/blog/{{blogId}}/promoted/future",getByPost:a.api.core.url+"/promotion/post/{{postId}}",getByCurrentUserAndPost:a.api.core.url+"/promotion/blog/{{blogId}}/post/{{postId}}/future",add:a.api.core.url+"/promotion/add",update:a.api.core.url+"/promotion/{{promotionId}}"},d={getByBlog:b.getJson(c.append(e.getByBlog,c.fresh)),getByPost:b.getJson(c.append(e.getByPost,c.fresh)),getByCurrentUserAndPost:b.getJson(c.append(e.getByCurrentUserAndPost,c.fresh)),add:b.postJson(c.append(e.add,c.fresh)),update:b.postJson(c.append(e.update,c.fresh))}}),define("model/business.promotionModel",["backbone","apiclient/promotion"],function(a,b){var c=a.Model.extend({defaults:function(){var a=(new Date).getTime(),b=a+108e5;return{displayCap:c.UNLIMITED_DISPLAY_CAP_VALUE,byline:"",beginTimeMillis:a,endTimeMillis:b}},setDeleted:function(){this.set({beginTimeMillis:c.ARCHIVE_TIMESTAMP,endTimeMillis:c.ARCHIVE_TIMESTAMP})},parse:function(a){return a.data||a},sync:function(a,c,d){var e,f;switch(a){case"update":e=c.toJSON(),e.promotionId=e.id,f=b.update(e,d);break;case"create":e=c.toJSON(),f=b.add(e,d);break;default:throw new Error("Promotion.sync(): unsupported method in sync")}this.trigger("request",this,f,d)}},{ARCHIVE_TIMESTAMP:28136994e4,UNLIMITED_DISPLAY_CAP_VALUE:-1});return c}),define("collection/business.promotionCollection",["backbone","model/business.promotionModel","apiclient/promotion"],function(a,b,c){var d=a.Collection.extend({model:b,addNew:function(){this.add({postId:this.postId})},parse:function(a){return a&&a.data?a.data.items||[]:[]},sync:function(a,b,d){if("read"===a){if(d.blogId&&d.postId)return c.getByCurrentUserAndPost({blogId:d.blogId,postId:d.postId},d);if(d.blogId)return c.getByBlog({blogId:d.blogId},d);if(d.postId)return c.getByPost({postId:d.postId},d);throw new Error("PromotionCollection.sync(): missing parameter blogId or postId")}throw new Error("PromotionCollection.sync(): unsupported method")}});return d}),define("view/forms/BaseModalView",["jquery","backbone","underscore","backbone.marionette","app/MarionetteApp","singleton/EventDispatcher"],function(a,b,c,d,e,f){var g=d.ItemView.extend({viewConstructors:{},initializedViews:{},className:"reveal-modal",attributes:{"data-reveal":""},events:{"click .js_cancel":"onCloseClick","click .js_close":"onCloseClick","click .js_navigate":"onNavigateClick",cancel:"onCloseClick",close:"onModalDestroyed"},ui:{navigationElements:".js_navigate",subViews:".js_sub-view",formContainer:".js_form-container",defaultView:"[data-default]",activeLink:".js_navigate.active"},initialize:function(){var b=this;d.ItemView.prototype.initialize.call(b,arguments),b.viewConstructors=c.extend(b.viewConstructors,b.options.viewConstructors),a(document).on("close","[data-reveal]",function(){b.onModalDestroyed.bind(b)})},closeSubViews:function(){var a,b=this,c=b.initializedViews;for(a in c)c.hasOwnProperty(a)&&(c[a].close?c[a].close():c[a].remove(),delete c[a])},parseExtraOptions:function(a){var b,c,d={};return a&&a.attr("data-extra-options")&&(d=a.attr("data-extra-options").split(":"),b=d[0],c=d[1],d[b]=c),d},toggleView:function(b,d){d=d||{};var e,f=this,g=a(b),h=g.find("input, textarea"),i=g.attr("data-sub-view"),j=f.ui.navigationElements.filter('[data-sub-view="'+i+'"]'),k=f.parseExtraOptions(j),l=f.viewConstructors[i];l&&(f.initializedViews.hasOwnProperty(i)||(f.initializedViews[i]=new l(c.extend({el:g},d,k))),e=f.initializedViews[i],f.ui.activeLink.removeClass("active"),j.addClass("active"),f.ui.subViews.hide(),e.$el.show(),e.cancelErrors(),e.trigger("show"),f.bindUIElements()),h.length&&h[0].focus()},onCloseClick:function(a){a&&a.preventDefault&&a.preventDefault(),this.close()},onNavigateClick:function(b){b.preventDefault();var c=a(b.currentTarget),d=this.ui.formContainer.find('[data-sub-view="'+c.attr("data-sub-view")+'"]');this.toggleView(d)},onRender:function(){var a=this;a.ui.defaultView&&!this.options.ignoreDefault&&a.toggleView(a.ui.defaultView)},onBeforeRender:function(){this.templateVars&&!this.model&&(this.model=new b.Model(this.templateVars))},onModalDestroyed:function(){return this.closeSubViews(),f.off(null,null,this),!1},serializeData:function(){return this.templateVars?this.templateVars:d.ItemView.prototype.serializeData.call(this)},close:function(){var a=this.$el;a.hasClass("open")&&a.foundation("reveal","close"),this.remove()},remove:function(){var a=this;a.closeSubViews(),f.off(null,null,a),d.ItemView.prototype.close.call(a)}});return g}),define("singleton/DateUtils",["singleton/Renderer","moment","templates/tiger/messages"],function(a,b){var c={getRelativeTime:function(b){var c=Math.round(((new Date).getTime()-parseInt(b,10))/1e3),d=Math.round(c/60),e=Math.round(c/3600),f=Math.round(c/86400),g=Math.round(c/2592e3),h=Math.round(c/31536e3),i=a.renderTemplate,j="";return j=60>c?1===c?i(tiger.messages.oneSecondAgo):i(tiger.messages.someSecondsAgo,{seconds:c}):60>d?1===d?i(tiger.messages.oneMinuteAgo):i(tiger.messages.someMinutesAgo,{minutes:d}):24>e?1===e?i(tiger.messages.oneHourAgo):i(tiger.messages.someHoursAgo,{hours:e}):30>f?1===f?i(tiger.messages.oneDayAgo):i(tiger.messages.someDaysAgo,{days:f}):12>g?1===g?i(tiger.messages.oneMonthAgo):i(tiger.messages.someMonthsAgo,{months:g}):1===h?i(tiger.messages.oneYearAgo):i(tiger.messages.someYearsAgo,{years:h}),j.textContent.replace(/^\s+|\s+$/g,"")},getMDYYYYHHMM:function(a){return b(a).format("M/D/YYYY H:mm")},getMDYYYY:function(a){return b(a).format("M/D/YYYY")},getDateTimeLocalString:function(a){return b(a).format("YYYY-MM-DDTHH:mm:ss")},getTimeInMilliseconds:function(a){return new Date(a).getTime()}};return c}),define("templates/tiger/components/forms/modals/header",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.forms.modals.header=function(a,b){var c=b||new d.StringBuilder;return c.append("	<header><h3>",d.$$escapeHtml(a.name),a.disableClose?"":'<a class="js_cancel modal-close-x">&times;</a>',"</h3></header>"),b?"":c.toString()}}),define("templates/tiger/components/forms/modals/promote",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.forms.modals.promoteTable=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");var g=new d.StringBuilder('<form id="promote-form"><div class="modal-body"><div class="mtl mbs"><p class="text-small">Select a blog to promote this post:.</p></div><div><table class="proxima"><thead><tr>',a.promotions&&a.promotions[0]&&a.promotions[0].blog?"<th>Blog</th>":"<th>Post</th>","<th>Byline</th><th>Start</th><th>End</th><th>Views</th><th>Display Cap</th>",a.blogs?'<th colspan="2">Preview</th>':"<th>Preview</th><th>Delete on Save</th>","</tr></thead><tbody>");if(a.blogs){g.append('<tr class="js_promoteNewRow"><td><select id="promotion_blog_new"><option value="">Choose a blog:</option>');for(var h=a.blogs,i=h.length,j=0;i>j;j++){var k=h[j];g.append('<option value="',d.$$escapeHtml(k.id),'">',d.$$escapeHtml(k.name),"</option>")}g.append('</select></td><td class="promote-byline_new"><span class="js_promoteByline"><input type="text" name="byline" value="" id="byline_new" class="mbn" /></span></td><td class="promote-begin_new"><input type="text" name="begin" value="',d.$$escapeHtml(a.formattedBegin),'" id="beginning_new" class="mbn" /></td><td class="promote-end_new"><input type="text" name="end" value="',d.$$escapeHtml(a.formattedEnd),'" id="ending_new" class="mbn" /></td><td>&nbsp;</td><td class="promote-displaycap_new"><span class="js_promoteDisplayCap"><input type="text" name="displaycap" value="" id="displaycap_new" class="mbn" /></span></td><td><span class="text-small text-right mlm"><a href="/?promotedpostpreview=',d.$$escapeHtml(a.postId),'&token=" class="js_promotionPreviewLink" target="_preview" data-previewTarget="" >Preview</a></span></td><td><input type="hidden" name="post_id" value="',d.$$escapeHtml(a.postId),'" id="post_id_new" /></td></tr>')}g.append("<tr>",a.blogs&&a.promotions&&a.promotions[0]?'<td colspan="7">Existing Promotions:</td><td>Delete on Save</td>':"","</tr>");var l=a.promotions,m=l.length;if(m>0)for(var n=0;m>n;n++){var o=l[n];g.append('<tr class="js_promoteRow promotion_',d.$$escapeHtml(o.id),'"><td><input type="hidden" name="has_promotion" value="',d.$$escapeHtml(o.id),'" id="has_promotion" /><input type="hidden" name="post_id" value="',d.$$escapeHtml(o.postId),'" id="post_id_',d.$$escapeHtml(o.id),'" /><input type="hidden" name="blog_id" value="',d.$$escapeHtml(o.blogId),'" id="blog_id_',d.$$escapeHtml(o.id),'" />',o.blog?'<span class="bd user-name">'+d.$$escapeHtml(o.blog.name)+"</span>":'<span class="bd user-name">'+d.$$escapeHtml(o.headline)+"</span>",'</td><td class="promote-byline_',d.$$escapeHtml(o.id),'"><span class="js_promoteByline"><input type="text" name="byline" value="',d.$$escapeHtml(o.byline),'" id="byline_',d.$$escapeHtml(o.id),'" class="mbn" /></span></td><td class="promote-begin_',d.$$escapeHtml(o.id),'"><input type="text" name="begin" value="',d.$$escapeHtml(o.start),'" id="beginning_',d.$$escapeHtml(o.id),'" class="mbn" /></td><td class="promote-end_',d.$$escapeHtml(o.id),'"><input type="text" name="end" value="',d.$$escapeHtml(o.end),'" id="ending_',d.$$escapeHtml(o.id),'" class="mbn" /></td><td><span class="text-small" id="count-display_',d.$$escapeHtml(o.id),'">',d.$$escapeHtml(o.displayCountAsString),'</span></td><td class="promote-displaycap_',d.$$escapeHtml(o.id),'"><span class="js_promoteDisplayCap"><input type="text" name="displaycap" value="',d.$$escapeHtml(o.displayCapAsString),'" id="displaycap_',d.$$escapeHtml(o.id),'" class="mbn" /></span></td><td><span class="text-small text-right mlm"><a href="/?promotedpostpreview=',d.$$escapeHtml(o.id),""!=o.byline?"&promotedby="+d.$$escapeHtml(o.byline):"",'&token=" class="js_promotionPreviewLink" target="_preview" data-previewTarget="" >Preview</a></span></td><td><input type="checkbox" class="left" name="promotion_delete" value="',d.$$escapeHtml(o.id),'" id="promotion_delete_',d.$$escapeHtml(o.id),'"/></td></tr>')}else g.append('<tr><td colspan="8">No promotions found for this ',a.blogs?"post":"blog",".</td></tr>");return g.append('</tbody></table></div></div><div class="twelve columns mtl mbs promote-message"><p class="text-small text-center proxima success hide">Your promotion has been saved.</p><p class="text-small text-center proxima failure hide">Your promotion was not saved. Please try again.</p></div><footer class="phn"><a class="button js_cancel tiny left secondary">Close</a><a class="button js_promoteSubmit tiny right">Save</a></footer></form>'),b.components.forms.modals.modal.container({name:"Promote post",body:g.toString()},f,e),c?"":f.toString()},b.components.forms.modals.promoteTableNew=function(a,b){var c=b||new d.StringBuilder;return c.append('		<form id="promote-form"><div>',a.blogMode?"<p>Existing promotions for this blog:</p>":"<p>Existing promotions for this post. Click 'Add New' to add a new promotion.</p>",'<table class="proxima"><thead><tr>',a.blogMode?"<th>Post</th>":"<th>Blog</th>","<th>Byline</th><th>Start</th><th>End</th><th>Views</th><th>Display Cap</th>",a.blogMode?'<th colspan="2">Preview</th>':"<th>Preview</th><th>Remove / Delete</th>",'</tr></thead><tbody class="js_promotions"></tbody></table></div><div class="twelve columns mtl mbs promote-message"><p class="js_promotion-error text-small text-center proxima failure hide">Your promotions were not saved. Please check the rows marked in red and try again.</p></div><footer class="clearfix"><a class="button js_cancel tiny left secondary">Close</a><a class="button js_promote-submit tiny right">Save</a>',a.blogMode?"":'<a class="button add-new js_add-new tiny right">Add New</a>',"</footer></form>"),b?"":c.toString()},b.components.forms.modals.promotion=function(a,b){var c=b||new d.StringBuilder;if(c.append("	<td>"),!a.id||a.blog&&!a.blog.nonMembership){c.append('<select name="blog-id" id="promotion_blog_new"><option value="">Choose a blog:</option>');for(var e=a.blogList,f=e.length,g=0;f>g;g++){var h=e[g];c.append('<option value="',d.$$escapeHtml(h.id),'"',a.blog.name==h.name?" selected":"",">",d.$$escapeHtml(h.name),"</option>")}c.append("</select>")}else a.blog?c.append('<span class="bd user-name-game">',d.$$escapeHtml(a.blog.name),"</span>"):c.append('<span class="bd user-name">',d.$$escapeHtml(a.headline),"</span>");return c.append('</td><td><input type="text" name="byline" value="',d.$$escapeHtml(a.byline),'" id="byline_',d.$$escapeHtml(a.id),'" class="mbn" /></td><td><input type="text" name="begin" value="',d.$$escapeHtml(a.beginTime),'" id="beginning_',d.$$escapeHtml(a.id),'" class="mbn" /></td><td><input type="text" name="end" value="',d.$$escapeHtml(a.endTime),'" id="ending_',d.$$escapeHtml(a.id),'" class="mbn" /></td><td><span class="text-small" id="count-display_',d.$$escapeHtml(a.id),'">',d.$$escapeHtml(a.displayCountString),'</span></td><td><input type="text" name="displaycap" value="',d.$$escapeHtml(a.displayCapString),'" id="displaycap_',d.$$escapeHtml(a.id),'" class="mbn" /></td><td><span class="text-small text-right mlm"><a href="/?promotedpostpreview=',d.$$escapeHtml(a.id),""!=a.byline?"&promotedby="+d.$$escapeHtml(a.byline):"",'&token=" class="js_promotionPreviewLink" target="_preview" data-previewTarget="">Preview</a></span></td><td>',a.id&&a.blog?'<input type="checkbox" class="left" name="promotion_delete" value="'+d.$$escapeHtml(a.id)+'" id="promotion_delete_'+d.$$escapeHtml(a.id)+'"/>':'<a  href="#" class="js_remove no-decoration"><i class="icon icon-x-circle"></i></a>',"</td>"),b?"":c.toString()},b.components.forms.modals.noPromotions=function(a,c,e){var f=c||new d.StringBuilder;return f.append('	<td colspan="8">'),a.showSpinner?b.components.spinner.bounce(null,f,e):f.append("No promotions found."),f.append("</td>"),c?"":f.toString()}}),define("view/forms/PromoteTargetSelector",["jquery","underscore","backbone.marionette","view/forms/BaseModalView","singleton/CurrentUser","singleton/CurrentBlog","singleton/EventDispatcher","singleton/ModalManager","singleton/DateUtils","app/account/account.channel","templates/tiger/components/forms/modals/header","templates/tiger/components/forms/modals/modal","templates/tiger/components/forms/modals/promote"],function(a,b,c,d,e,f,g,h,i,j){var k=d.extend({id:"modal-promoteselector",className:"reveal-modal kinja-modal promote-subform large",events:b.extend(d.prototype.events,{"click .js_promoteSubmit":"promotePost","click .js_promoteDisplayCap":"selectDisplayCapText","blur .js_promoteDisplayCap":"checkDisplayCapText","keyup .js_promoteByline":"updatePreviewLinkOnBlur","change .js_promoteByline":"updatePreviewLinkOnBlur"}),ui:{promoteMessage:".promote-message"},forms:{},initialize:function(){this.$el.on("closed",a.proxy(this.remove,this))},str_UnlimitedDisplay:"Unlimited",int_UnlimitedDisplay:-1,displayCapToString:function(a){var b=a;return(isNaN(a)||0>a)&&(b=this.str_UnlimitedDisplay),b},displayCapToInt:function(a){var c,d=a;return void 0===a||a===this.str_UnlimitedDisplay?d=this.int_UnlimitedDisplay:(c=d.replace(/\s+/g,"").match(/-?\d+/g),null!==c&&(d=b.reduce(c,function(a,b){return a+b})),d=parseInt(d,10)),isNaN(d)&&(d=this.int_UnlimitedDisplay),d},selectDisplayCapText:function(b){var c=a(b.currentTarget).find('input[name="displaycap"]');c.focus(),c.select()},checkDisplayCapText:function(b){var c=a(b.currentTarget).find('input[name="displaycap"]'),d=this.displayCapToString(this.displayCapToInt(c.val()));c.val(d)},promotePost:function(c){c.stopPropagation(),c.preventDefault();var d=this,f=this.harvestFormData(d);return a(this.ui.promoteMessage).children().addClass("hide"),e.requireLogin("promoteform").done(function(){b.each(f,function(a){d.promote(a.blogId,a.postId,a.beginTimeMillis,a.endTimeMillis,a.id,a.displayCap,a.byline)})}),!1},harvestFormData:function(c){var d,e,f,g=[],h=this.$el.find(".js_promoteRow"),i=0;return b.each(h,function(b){d=a(b),e=d.find("#has_promotion").val(),g[i]=[],g[i].id=e,g[i].postId=d.find("#post_id_"+e).val(),g[i].blogId=d.find("#blog_id_"+e).val(),g[i].displayCap=c.displayCapToInt(d.find("#displaycap_"+e).val()),g[i].byline=d.find("#byline_"+e).val(),d.find("#promotion_delete_"+e).is(":checked")?(g[i].beginTimeMillis=28136994e4,g[i].endTimeMillis=28136994e4):(g[i].beginTimeMillis=new Date(d.find("#beginning_"+e).val()).getTime(),g[i].endTimeMillis=new Date(d.find("#ending_"+e).val()).getTime()),i+=1}),f=a(".js_promoteNewRow"),f.length>0&&""!==f.find("#promotion_blog_new").val()&&(g[i]=[],g[i].postId=f.find("#post_id_new").val(),g[i].blogId=f.find("#promotion_blog_new").val(),g[i].displayCap=c.displayCapToInt(f.find("#displaycap_new").val()),g[i].byline=f.find("#byline_new").val(),g[i].beginTimeMillis=new Date(f.find("#beginning_new").val()).getTime(),g[i].endTimeMillis=new Date(f.find("#ending_new").val()).getTime()),g},promote:function(b,c,d,f,h,i,k){e.isLoggedIn()||j.trigger("loginRequired",{source:"promoteform"}),h=void 0!==h?h:0,h=parseInt(h,10);var l="",m={blogId:parseInt(b,10),postId:parseInt(c,10),beginTimeMillis:d,endTimeMillis:f,displayCap:i,byline:k},n=this;"number"==typeof h&&h>0?(l="/apiproxy/promotion/"+h+"?token="+e.get("token"),m.promotionId=h):l="/apiproxy/promotion/add?token="+e.get("token"),a.ajax({url:l,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(m),success:function(a){void 0!==a.meta&&200===a.meta.status?(g.trigger("successbox:display",{message:tiger.messages.settingsSaved()}),n.close()):this.error()},error:function(){a(n.ui.promoteMessage).find(".failure").removeClass("hide")}})},render:function(d,g){var j,k,l,m,n=!!d,o=!!g,p=this,q=[],r=[],s=e.get("membership").length,t=0,u=tiger.components.forms.modals.promoteTable;return n?a.ajax({url:"/apiproxy/blog/"+f.id+"/promoted/future",type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",success:function(d){p.el.id="modal-promotedList",m=a("#modal-promotedList"),m.html(),d.data&&d.data.items&&d.data.items.length>0&&b.each(d.data.items,function(a){k=a.promotions[0],k.headline=a.headline,k.start=i.getMDYYYYHHMM(new Date(k.beginTimeMillis)),k.end=i.getMDYYYYHHMM(new Date(k.endTimeMillis)),k.displayCapAsString=p.displayCapToString(k.displayCap),k.displayCountAsString=k.displayCap===p.int_UnlimitedDisplay?k.displayCount:k.displayCount+" of "+k.displayCap,k.postId=a.id,r.push(k)}),a("body").append(p.$el.html(c.Renderer.render(u,{promotions:r}))),m=m.length<1?a("#modal-promotedList"):m,h.create(m).open()}}):o?(j=this.model.id,a.ajax({url:"/apiproxy/promotion/post/"+j,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",success:function(d){p.el.id="modal-promotedList",m=a("#modal-promotedList"),m.html(),d.data&&d.data.items&&d.data.items.length>0&&b.each(d.data.items,function(a){a.start=i.getMDYYYYHHMM(new Date(a.beginTimeMillis)),a.end=i.getMDYYYYHHMM(new Date(a.endTimeMillis)),a.displayCapAsString=p.displayCapToString(a.displayCap),a.displayCountAsString=a.displayCap===p.int_UnlimitedDisplay?a.displayCount:a.displayCount+" of "+a.displayCap,r.push(a)}),a("body").append(p.$el.html(c.Renderer.render(u,{promotions:r,readOnly:!0}))),m=m.length<1?a("#modal-promotedList"):m,h.create(m).open()}})):e.get("membership").length>0&&(j=this.model.id,e.get("membership").map(function(a){var b={id:a.get("blogId"),name:a.get("blog").displayName,canonicalHost:a.get("blog").canonicalHost};q.push(b)}),b.each(q,function(d){a.ajax({url:"/apiproxy/promotion/blog/"+d.id+"/post/"+j+"/future",type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",success:function(a){a.data&&a.data.items&&a.data.items.length>0&&b.each(a.data.items,function(a){a.blog=d,a.start=i.getMDYYYYHHMM(new Date(a.beginTimeMillis)),a.end=i.getMDYYYYHHMM(new Date(a.endTimeMillis)),a.displayCapAsString=p.displayCapToString(a.displayCap),a.displayCountAsString=a.displayCap===p.int_UnlimitedDisplay?a.displayCount:a.displayCount+" of "+a.displayCap,a.postId=j,r.push(a)}),t++,l=new Date,t===s&&p.$el.html(c.Renderer.render(u,{promotions:r,blogs:q,postId:j,formattedBegin:i.getMDYYYYHHMM(l),formattedEnd:i.getMDYYYYHHMM(new Date(l.getTime()+108e5))}))}})})),this},updatePreviewLinks:function(a,b){b.attr("href",b.attr("data-previewTargetLink")+"&promotedby="+a)},updatePreviewLinkOnBlur:function(b){var c=a(b.target),d=c.val(),e=c.attr("id").split("_");d&&2===e.length&&this.updatePreviewLinks(d,a("[data-previewTarget="+e[1]+"]"))}});return k}),define("view/business.promotionView",["underscore","backbone.marionette","singleton/Utils","singleton/DateUtils","singleton/CurrentUser","model/business.promotionModel","templates/tiger/components/forms/modals/promote"],function(a,b,c,d,e,f){var g=b.ItemView.extend({template:tiger.components.forms.modals.promotion,tagName:"tr",className:function(){var a="js_promoteRow promotion_";return a+(this.model.id||"new")},ui:{postIdField:'input[name="post-id"]',blogIdField:'select[name="blog-id"]',displayCapField:'input[name="displaycap"]',bylineField:'input[name="byline"]',beginTimeField:'input[name="begin"]',endTimeField:'input[name="end"]',removeButton:".js_remove",deleteField:'input[name="promotion_delete"]'},events:{"blur @ui.displayCapField":"onDisplayCapFieldBlur","focus @ui.displayCapField":"onDisplayCapFieldFocus","keyup @ui.bylineField":"onBylineFieldChange","change @ui.bylineField":"onBylineFieldChange","click @ui.removeButton":"onRemoveButtonClick"},modelEvents:{request:"onModelRequest",sync:"render",error:"onModelError"},displayCapString:function(a){return 0===a||a&&a!==f.UNLIMITED_DISPLAY_CAP_VALUE?a.toString():g.UNLIMITED_DISPLAY_TEXT},displayCapValue:function(a){return a&&a!==g.UNLIMITED_DISPLAY_TEXT?parseInt(a,10):f.UNLIMITED_DISPLAY_CAP_VALUE},onDisplayCapFieldBlur:function(){var a=this.displayCapString(this.ui.displayCapField.val());this.ui.displayCapField.val(a)},updatePreviewLinks:function(a,b){b.attr("href",b.attr("data-previewTargetLink")+"&promotedby="+a)},onDisplayCapFieldFocus:function(){var a=this.ui.displayCapField.val();a===g.UNLIMITED_DISPLAY_TEXT&&this.ui.displayCapField.val("")},onBylineFieldChange:function(){var a=this.ui.bylineField.val(),b=this.ui.bylineField.attr("id").split("_");a&&2===b.length&&this.updatePreviewLinks(a,this.$("[data-previewTarget="+b[1]+"]"))},syncWithModel:function(){this.ui.deleteField.is(":checked")?this.model.setDeleted():this.model.set({blogId:parseInt(this.ui.blogIdField.val(),10),displayCap:this.displayCapValue(this.ui.displayCapField.val()),byline:this.ui.bylineField.val(),beginTimeMillis:d.getTimeInMilliseconds(this.ui.beginTimeField.val()),endTimeMillis:d.getTimeInMilliseconds(this.ui.endTimeField.val())}),this.model.hasChanged()&&!this.model.hasChanged("blogId")?this.model.save():this.model.hasChanged()||this.model.trigger("sync")},_tdSafeRender:function(a,b){return a(b)},render:function(){var a,b,c;return this.isClosed=!1,this.triggerMethod("before:render",this),this.triggerMethod("item:before:render",this),b=this.serializeData(),b=this.mixinTemplateHelpers(b),a=this.getTemplate(),c=this._tdSafeRender(a,b),this.$el.html(c),this.bindUIElements(),this.triggerMethod("render",this),this.triggerMethod("item:rendered",this),this},serializeData:function(){var b=this.model.toJSON();return b.displayCapString=this.displayCapString(b.displayCap),b.displayCountString=this.model.get("displayCount")||"",b.beginTime=d.getMDYYYYHHMM(b.beginTimeMillis),b.endTime=d.getMDYYYYHHMM(b.endTimeMillis),this.model.collection.postId&&(b.blogList=this.model.collection.userBlogs,b.blog=a.findWhere(this.model.collection.userBlogs,{id:b.blogId})||{nonMembership:!0,name:"(Non-membership blog)"}),b},setErrorState:function(){this.$el.addClass("promotion-error")},resetErrorState:function(){this.$el.removeClass("promotion-error")},onModelRequest:function(){this.resetErrorState()},onModelError:function(){this.setErrorState()},onRemoveButtonClick:function(){this.model.destroy()}},{UNLIMITED_DISPLAY_TEXT:"Unlimited"});return g}),define("view/business.noPromotionsView",["backbone.marionette","templates/tiger/components/forms/modals/promote"],function(a){var b=a.ItemView.extend({template:tiger.components.forms.modals.noPromotions,tagName:"tr",render:function(){var a,b,c;return this.isClosed=!1,this.triggerMethod("before:render",this),this.triggerMethod("item:before:render",this),b=this.serializeData(),b=this.mixinTemplateHelpers(b),a=this.getTemplate(),c=a(b),this.$el.html(c),this.bindUIElements(),this.triggerMethod("render",this),this.triggerMethod("item:rendered",this),this},serializeData:function(){return{showSpinner:this.options.loading}}});return b}),define("view/forms/business.promotionModal",["jquery","underscore","backbone.marionette","singleton/EventDispatcher","app/modal/modal.controller","view/business.promotionView","view/business.noPromotionsView","templates/tiger/components/forms/modals/promote"],function(a,b,c,d,e,f,g){var h=c.CompositeView.extend({id:"promote-modal",className:"modal-body proxima",template:tiger.components.forms.modals.promoteTableNew,itemViewContainer:".js_promotions",itemView:f,_syncCount:-1,_error:!1,itemViewOptions:function(){return{loading:!this.collection.allLoaded}},emptyView:g,ui:{submitButton:".js_promote-submit",promoteMessage:".promote-message",addNewButton:".js_add-new",errorMessage:".js_promotion-error"},events:{"click @ui.submitButton":"onSubmitButtonClick","click @ui.addNewButton":"onAddNewButtonClick","click @ui.cancelNewButton":"onCancelNewButtonClick"},collectionEvents:{sync:"onSync",error:"onError",request:"onRequest"},serializeData:function(){return{blogMode:!this.collection.postId}},showErrorMessage:function(){this.ui.errorMessage.removeClass("hide")},hideErrorMessage:function(){this.ui.errorMessage.addClass("hide")},onSubmitButtonClick:function(){this._syncCount=this.collection.length,this._error=!1,this.children.each(function(a){a.syncWithModel()}.bind(this))},onAddNewButtonClick:function(){this.collection.addNew()},onRequest:function(){this.hideErrorMessage()},onSync:function(){this.collection.allLoaded&&this.isEmpty()&&this.collection.postId?this.collection.addNew():(this.closeEmptyView(),this.checkEmpty()),this._syncCount>0&&this._syncCount--,0!==this._syncCount||this._error||(e.close(),d.trigger("successbox:display",{message:tiger.messages.settingsSaved()}))},onError:function(){this._error=!0,this.showErrorMessage()}});return h}),define("app/post/posttools/controller/posttools.promote.controller",["jquery","underscore","singleton/CurrentBlog","singleton/CurrentUser","singleton/Utils","singleton/ModalManager","singleton/EventDispatcher","singleton/Feature","app/modal/modal.controller","model/business.promotionModel","collection/business.promotionCollection","view/forms/PromoteTargetSelector","view/forms/business.promotionModal"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n={_blogsForCurrentUser:function(){return d.get("membership").map(function(a){return{id:a.get("blogId"),name:a.get("blog").displayName,canonicalHost:a.get("blog").canonicalHost}})},_showPromoteModal:function(a,c){var d,e,f,g,h=new k,j=this._blogsForCurrentUser();e="userBlogs"===a?b.pluck(j,"id"):[a],f=e.length,g=function(){f--,0===f&&(h.allLoaded=!0,h.off("sync",g))},h.on("sync",g),h.on("change:blogId",function(a){var b=a.previous("blogId"),c=a.clone();c.setDeleted(),c.set("blogId",b,{silent:!0}),c.save(),a.unset("id"),a.save()}),d=new m({collection:h}),h.postId=c,h.userBlogs=j,i.create(d,{name:"promotion"}),b.each(e,function(a){h.fetch({blogId:a,postId:c,remove:!1})})},API:{promote:function(a){var b=new l({model:a}),c=function(){f.create(b.render().$el).bind("close",e).open()},e=function(){null!==b&&(b.off("remove",null),b=null)};d.requireLogin("promotemodal").done(function(){c()})},promotionsForBlog:function(a){n._showPromoteModal(a||c.id,null)},promotionsForPost:function(a){n._showPromoteModal(null,a||e.getKinjaMeta().post.id)},promotionsForCurrentUserAndPost:function(a){n._showPromoteModal("userBlogs",a||e.getKinjaMeta().post.id)}}};return n.API}),define("app/post/posttools/controller/posttools.hide.controller",["config","jquery","underscore","singleton/Feature","singleton/CurrentUser","model/post/Post"],function(a,b,c,d,e,f){var g={API:{hide:function(c,g){var h=c.get("id"),i=a.api.core.url+"/post/"+h+"/hide?token="+e.get("token"),j=null,k="/";e.isSuperuser()&&d.isOn("superuser")&&g()&&(c.has("parentId")&&(j=new f({id:c.get("parentId")}),k=j.has("permalink")?j.get("permalink"):"/"+j.id),b.ajax({url:i,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",success:function(a){void 0!==a.meta&&a.meta.success===!0&&window.setTimeout(function(){window.location.href=k},1e3)}}))}}};return g.API}),define("templates/tiger/components/spinner",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.spinner.bounce=function(a,b){var c=b||new d.StringBuilder;return c.append('	<span class="spinner bounce"><span class="one"></span><span class="two"></span><span class="three"></span></span>'),b?"":c.toString()}}),define("view/Spinner",["jquery","view/BaseView","templates/tiger/components/spinner","templates/tiger/messages"],function(a,b){var c=b.extend({visible:!0,fullscreen:!1,tagName:"div",className:"spinner-wrapper",initialize:function(a){this.visible=void 0===a.initiallyVisible?!0:a.initiallyVisible,this.fullscreen=void 0===a.fullscreen?!1:a.fullscreen,this.render()},render:function(){var b;return this.visible&&(b=this.fullscreen?this.soyToHtml(tiger.messages.postSave,{showMessage:!1}):this.soyToHtml(tiger.components.spinner.bounce,{})),this.$el.html(b),this.fullscreen?a(this.el).find(".animate").addClass("in"):a(this.el).addClass("with-margin"),this}});return c}),define("templates/tiger/components/post/meta/avatar-display",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.post.meta.avatarDisplay=function(a,c,e){a=a||{};var f=c||new d.StringBuilder;return f.append('	<div class="avatar avatar-container js_avatar-container"',a.dropdownName?' data-dropdownhover="'+d.$$escapeHtml(a.dropdownName)+'"':"",">"),e.features.svgicons?(f.append('<span class="icon--svg">'),b.icons.essential.checkmark(null,f,e),f.append("</span>")):f.append('<span class="icon icon-checkmark icon-followed"></span>'),f.append(a.url&&"http://"!=a.url?'<a href="'+d.$$escapeHtml(a.url)+'"'+(a.nofollow?' rel="nofollow"':"")+">":"",'<span class="img-border',a.avatar?"":" hide",'"><img src="',a.avatar?d.$$escapeHtml(a.avatar):"",'" /></span><span class="avatar-default',a.avatar?" hide":"",'"></span>',a.url&&"http://"!=a.url?"</a>":"","</div>"),c?"":f.toString()
}}),define("templates/tiger/components/post/meta/meta-avatar-url",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.post.meta.metaAvatarUrl=function(a,c,e){var f=c||new d.StringBuilder;return f.append('	<div class="meta-container without-dropdown"><div class="meta-avatar"><div class="floated-container img-30"><div class="avatar">'),b.components.post.meta.avatarDisplay({avatar:a.avatarUrl},f,e),f.append('</div><div class="txt"><span class="display-name"><span class="js_user-display-name">'),a.displayName?f.append(d.$$escapeHtml(a.displayName)):b.components.post.meta.replyCallout(null,f,e),f.append("</span>",a.parentAuthorDisplayName?'<span class="replyto-author"><span class="icon icon-arrow-small-right text-light"></span><span class="js_author-display-name">'+d.$$escapeHtml(a.parentAuthorDisplayName)+"</span></span>":"",'</span></div><div class="second-line">Now</div></div></div></div>'),c?"":f.toString()},b.components.post.meta.replyCallout=function(a,b){var c=b||new d.StringBuilder;return c.append("You"),b?"":c.toString()}}),define("module/groupchats/view/OpenReplyForms",["jquery","underscore","backbone.marionette","singleton/Feature","singleton/Twitter","view/Spinner","singleton/Utils","templates/tiger/components/post/meta/avatar-display","templates/tiger/components/post/meta/meta-avatar-url"],function(a,b,c,d,e,f,g){var h={replyform:null,triggeredReply:!1,initReplyForms:function(){this.events=b.extend({"click .js_reply-to-selected-post":"replyToSelected","click .js_edit-reply":"editReply"},this.events),this.delegateEvents()},handleStarterInsert:function(){this.unhandleStarterInserts();var a=this.services.resolve("eventDispatcher");a.on("reply:openstarterform",this.insertNewStarter,this)},unhandleStarterInserts:function(){var a=this.services.resolve("eventDispatcher");a.off("reply:openstarterform",this.insertNewStarter,this)},_addCommentRegion:function(a,b){var d=a.commentRegion,e=d?d.currentView:!1;return(!e||e.confirmRemove())&&(d&&(d.reset(),d.off()),d=new c.Region({el:b}),a.addRegions({commentRegion:d})),d},_requireEditor:function(a){g.requireModuleWithCss("module/MarionetteEditor","editor",function(){require(["app/editor/editor.app","app/MarionetteApp"],a)})},replyToSelected:function(b){var c,d=this,e=a(b.currentTarget).closest(".js_reply"),f=parseInt(e.data("id"),10),g=this.services.resolve("PostModel",{args:{id:f}});return b.stopPropagation(),c=a('<div class"js_reply-form-container"></div>').insertAfter(e),this._requireEditor(function(a,b){var f=d._addCommentRegion(b,c);f.once("editor:post:save",function(a,b){e.trigger("approval",{approvedReplyIDs:b}),d.trigger("reply:insert",{$el:"",model:a})}),a.createComment(g)}),!1},insertNewStarter:function(b){var c,e=this,f=this.model,g=this.$el.find(".js_toggle-pending"),h=b.view;return this._requireEditor(function(b,i){c=d.isOn("hide_pending_replies")&&g.length?a("<div />").insertAfter(g):h.$el.find(".js_reply-form-container").length?h.$el.find(".js_reply-form-container"):a(".js_reply-form-container");var j=e._addCommentRegion(i,c);j.once("editor:post:save",function(a){e.trigger("reply:insert",{$el:"",model:a})}),b.createComment(f)}),!1},replyToPost:function(a){return this.closeEditorForm()?(this.closeReplyForm(a),!1):!1},editReply:function(b){var c,d=a(b.currentTarget).closest(".js_reply"),e=this;return c=a('<div class"js_reply-form-container"></div>').insertAfter(d),this._requireEditor(function(b,f){var g=e._addCommentRegion(f,c);g.once("editor:post:save",function(b){var c=a("#reply_"+b.id);c.find(".reply-content").html(b.display)}),b.editComment(d.data("id"))}),!1},createSpinner:function(b,c){return void 0===c&&(c="editor"),new f({fullscreen:b,initiallyVisible:1===a("head>meta[id="+c+"-css-url]").length})},closeReplyForm:function(){var a=this.replyform;if(a&&this.triggeredReply){if(!a.confirmRemove())return!1;a.remove()}},closeEditorForm:function(){var c=a("body").data("post-form");if(void 0!==c&&b.isFunction(c.confirmRemove)){if(!c.confirmRemove())return!1;c.remove(!0)}return!0},getFormAncestor:function(){return this.$elements.branchList}};return h}),define("apiclient/repost",["config","apiclient/apirequest","apiclient/gettoken"],function(a,b,c){return{unschedule:b.postJson(c.append(a.api.core.url+"/blog/{{blogId}}/removeRepostJob/{{postId}}")),reschedule:b.postJson(c.append(a.api.core.url+"/blog/{{blogId}}/updateRepostJob/{{postId}}?repostTime={{repostTime}}"))}}),define("app/post/posttools/posttools.controller",["jquery","underscore","backbone.marionette","config","lib/needly","model/post/Post","singleton/CurrentUser","singleton/CurrentBlog","singleton/EventDispatcher","singleton/Feature","singleton/Utils","singleton/ModalManager","module/KinjaAnalytics","view/BaseView","app/post/common/post.layout","app/post/mixins/post.confirmationPrompt","app/post/posttools/posttools.menuview","app/post/posttools/controller/posttools.dismiss.controller","app/post/posttools/controller/posttools.block.controller","app/post/posttools/controller/posttools.like.controller","app/post/posttools/controller/posttools.promote.controller","app/post/posttools/controller/posttools.hide.controller","module/flagging/ReplyFlaggingModule","app/post/mixins/post.successMessage","view/forms/invite/InviteToPostManuallyModalView","view/forms/PromoteTargetSelector","module/groupchats/view/OpenReplyForms","app/modal/modal.controller","app/MarionetteApp","view/Spinner","apiclient/repost","templates/tiger/messages"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E){var F={};return F.services=new e.Container,F.services.registerMany({PostModel:{type:"class",dependency:f},eventDispatcher:{type:"singleton",dependency:i},feature:{type:"singleton",dependency:j},utils:{type:"singleton",dependency:k}}),F=b.extend(F,A,p,x,{_isBlockeeAMemberCache:{},_like:function(a){a.model.get("tags")&&j.isOn("channels")&&!a.model.get("liked")&&C.vent.trigger("add:channel",{channelName:a.model.get("tags")[0].urlName}),t.like(a.model,a.view)},_reply:function(a){return j.isOn("groupchats_refactor")?void require(["module/DiscussionModule"],function(a){a.replyToStarterPost()}):void i.trigger("reply:openstarterform",a)},_dismiss:function(a){F._confirmationPrompt(tiger.messages.confirmDismissPost)&&r.dismiss(a.model)},_undismiss:function(a){r.undismiss(a.model)},_getDismissState:function(a){a.model.getActionState()},_delete:function(a){var c,d=a.model,e=this,f="dashboard"===k.getKinjaMeta().pageType||"manageblog"===k.getKinjaMeta().pageType;F._confirmationPrompt(tiger.messages.areYouSureToDelPost)&&(d.on("destroy",function(){e._displaySuccessMessage(tiger.messages.postDeleted),c=function(){window.location=f?window.location.pathname:n.prototype.cachebuster.call(n.prototype,"/")},b.delay(c,2e3)}),d.destroy({wait:!0}))},_unscheduleRepost:function(a){var c=this,d=a.view.el.getAttribute("data-postid"),e=a.view.el.getAttribute("data-blogid"),f=function(){window.location="private"===k.getKinjaMeta().pageType?window.location.pathname:n.prototype.cachebuster.call(n.prototype,"/")},g=function(){c._displaySuccessMessage(tiger.messages.repostUnscheduled),b.delay(f,2e3)};F._confirmationPrompt(tiger.messages.areYouSureToUnschedRepost)&&E.unschedule({postId:d,blogId:e}).done(g)},_promote:function(a){var b=a.model.id,c=g.hasPermission("SALES")||g.isSuperUser(),d=window.location.port?"http://kinja.dev:9000":"http://kinja.com";c&&j.isOn("dfpnative")?window.location.href=d+"/dfp/promotions/"+b:j.isOn("marionette_promotions")?u.promotionsForCurrentUserAndPost(b):u.promote(a.model)},_isBlockable:function(a){var b=a.model,c=b.get("defaultBlogId"),d=b.get("targetBlogId"),e=b.get("author").id;return s.isBlockable(b,c,d,e)},_checkBlockStatus:function(a){s.checkBlockStatus(a.model,a.collection)},_postIsBlocked:function(a,b){return-1!==b.indexOf(a.get("authorBlogId"))},_block:function(a){var b=function(a){return F._confirmationPrompt(tiger.messages.confirmBlockBlog,a)};s.block(a.model,a.collection,b,a.targetBlogName)},_hide:function(a){var b=function(){return F._confirmationPrompt(tiger.messages.confirmHidePost)};v.hide(a.model,b)},_unflag:function(a){w.unflag(a,a.model)},_kinjaShare:function(b){var c,d=b.model,e=new D({fullscreen:!0});g.requireLogin("kinjaSharePost").done(function(){a("body").append(e.el),c=function(a){F.closeReplyForm.call(F),k.requireModuleWithCss("module/MarionetteEditor","editor",function(){require(["app/editor/editor.app"],function(b){b.sharePost(a),e.remove()})})}.bind(this),d.has("original")?c(d):d.fetch({success:c,preview:"PUBLISHED"!==d.get("status")}),("dashboard"===k.getKinjaMeta().pageType||"manageblog"===k.getKinjaMeta().pageType)&&(m.setContext(null,"DASHBOARD"),m.pushEvent("SHARE"))})},_externalShare:function(a){var c=a.view.$(".js_share-post-item"),d=c.attr("href"),e={twitter:"toolbar=0,status=0,width=480,height=360",facebook:"toolbar=0,status=0,width=480,height=360",tumblr:"toolbar=0,status=0,width=450,height=430"},f=b.intersection(c.attr("class").split(/\s+/),["twitter","facebook","tumblr"])[0];window.open(d,"share"+f,e[f]),("dashboard"===k.getKinjaMeta().pageType||"manageblog"===k.getKinjaMeta().pageType)&&(m.setContext(null,"DASHBOARD"),m.pushEvent("SHARE"))},_repost:function(a,b){var c="repost",d=this,e=g.get("membership").find(function(a){return a.get("blogId")===parseInt(b,10)});a.setAction(c,b,{success:function(){d._displaySuccessMessage(tiger.messages.postReposted,{blogName:e.get("blog").displayName,blogUrl:"http://"+e.get("blog").canonicalHost})},error:function(a){throw new Error("PostTools.repostPost(): "+a.reason)}})},_undoRepost:function(a){var b="actionreset",c=h.id,d=a.model,e=this;d.setAction(b,c,{success:function(){e._displaySuccessMessage(tiger.messages.repostRemoved)},error:function(a){throw new Error("PostTools.undoRepost(): "+a.reason)}})},_bindEvents:function(a,b){a.on("posttools:like",this._like.bind(this)),a.on("posttools:reply",this._reply.bind(this)),b.on("posttools:dismiss",this._dismiss.bind(this)),b.on("posttools:undismiss",this._undismiss.bind(this)),b.on("posttools:getDismissState",this._getDismissState.bind(this)),b.on("posttools:delete",this._delete.bind(this)),b.on("posttools:promote",this._promote.bind(this)),b.on("posttools:block",this._block.bind(this)),b.on("posttools:checkBlockability",this._isBlockable.bind(this)),b.on("posttools:checkBlockStatus",this._checkBlockStatus.bind(this)),b.on("posttools:hide",this._hide.bind(this)),b.on("posttools:unflag",this._unflag.bind(this)),b.on("posttools:kinjaShare",this._kinjaShare.bind(this)),b.on("posttools:externalShare",this._externalShare.bind(this)),b.on("posttools:repost",this._repost.bind(this)),b.on("posttools:undorepost",this._undoRepost.bind(this)),b.on("close",function(){g.off(null,null,b),i.off(null,null,b),b.model.off(null,null,b)}),b.on("posttools:menuview:togglehidden",function(b){a.togglePostToolsVisibility(b)}),b.on("reposttools:unschedule",this._unscheduleRepost.bind(this))},API:{startPostTools:function(a,b){var c="undefined"!=typeof b.get("defaultBlogId")?b.get("defaultBlogId"):k.getKinjaMeta().blog.id,d=new q({el:a.find(".js_post-dropdown-ct"),model:b,blockedBlogCollection:s.getBlockedBlogCollection(c)}),e=new o({el:a,model:b});e.post.attachView(d),e.bindUIElements(),F._bindEvents(e,d),i.on("posttools:close:"+b.get("id"),function(){d.close()}),g.on("authenticated",d.render,d),d.render()},closePostTools:function(a){i.trigger("posttools:close:"+a)},bindEvents:function(a,b){F._bindEvents(a,b)}}}),F.API}),define("app/post/posttools/view/posttools.blockview",["jquery","underscore","backbone.marionette","app/post/posttools/view/posttools.menuitemview","app/post/posttools/posttools.controller","singleton/CurrentUser"],function(a,b,c,d,e,f){var g=d.extend({permissions:["canBlock"],events:{click:"_blockBlog"},modelEvents:{"posttools:checkedBlockability":"_setDisabledState","posttools:blockStatusUpdated":"_finishRender"},collectionEvents:{"posttools:block posttools:unblock sync":"_checkBlockStatus"},_checkBlockStatus:function(){this.triggerMethod("posttools:checkBlockStatus",{model:this.model,collection:this.collection})},_blockBlog:function(a){a.preventDefault(),this.triggerMethod("posttools:block",{model:this.model,collection:this.collection,targetBlogName:this._getTargetBlogName()}),this.$el.siblings(".js_unfollowforblog").addClass("hide"),this.$el.siblings(".js_followforblog").removeClass("hide"),this.$el.siblings(".js_unfollowforuser").addClass("hide"),this.$el.siblings(".js_followforuser").removeClass("hide")},_correctBlockText:function(a){var b=this.$el.find("span"),c=b.text(),d=a?"Unblock":"Block";d=c.replace(/Unblock|Block/,d),b.text(d)},_setDisabledState:function(a){this.$el.toggleClass("disabled",!a)},_finishRender:function(a){this._correctBlockText(a),d.prototype.onRender.call(this)},_getTargetBlogName:function(){return this.$el.data("targetblogname")},onPosttoolsOpened:function(){var a=this;f.onAuth.always(function(){a.triggerMethod("posttools:checkBlockability",{model:a.model})})},onRender:function(){var a=this;f.onAuth.always(function(){a._canShow()?a._checkBlockStatus():a._hide()})}});return g}),define("app/post/posttools/view/posttools.hideview",["app/post/posttools/view/posttools.menuitemview"],function(a){var b=a.extend({permissions:["userIsSuper"],triggers:{click:"posttools:hide"}});return b}),define("app/post/posttools/view/posttools.kinjashareview",["app/post/posttools/view/posttools.menuitemview","singleton/Utils"],function(a,b){var c=a.extend({permissions:[],triggers:{click:"posttools:kinjaShare"},onPosttoolsOpened:function(){var a=this.model&&parseInt(b.getKinjaMeta().postId,10)===this.model.get("sharedPostId");a&&this.$el.addClass("hide")}});return c}),define("app/post/posttools/view/posttools.kinjaunshareview",["app/post/posttools/view/posttools.menuitemview"],function(a){var b=a.extend({permissions:["canSharePost","canUnshareRepostedPost"],triggers:{click:"posttools:undorepost"}});return b}),define("app/post/posttools/view/posttools.externalshareview",["jquery","app/post/posttools/view/posttools.menuitemview"],function(a,b){var c=b.extend({permissions:[],ui:{sharePostButton:".js_share-post-item"},triggers:{"click @ui.sharePostButton":"posttools:externalShare"},onRender:function(){var b=function(b){return a("<div/>").html(b).text()},c=function(a){return a?a.replace(/&#(\d+);/g,function(a,b){return String.fromCharCode(b)}):""},d=this.model.get("headline")||this.model.get("first100Characters")||this.model.get("compact"),e=this.ui.sharePostButton.attr("href");this.ui.sharePostButton.attr("href",e.replace("POST_TITLE",encodeURIComponent(b(c(d)))))}});return c}),define("templates/tiger/components/post/button/repost-block",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.post.button.repostBlock=function(a,b){a=a||{};var c=b||new d.StringBuilder;if(c.append("	",1==a.repostedToPersonal?'<li><a href="#" class="js_undorepost pvs" data-blogid="'+d.$$escapeHtml(a.personalBlogId)+'"><span class="txt">Undo repost to Personal blog</span></a></li>':""),a.blogsUndo)for(var e=a.blogsUndo,f=e.length,g=0;f>g;g++){var h=e[g];c.append('<li><a href="#" class="js_undorepost pvs" data-blogid="',d.$$escapeHtml(h.id),'"><span class="txt">Undo repost to ',d.$$escapeHtml(h.name),"</span></a></li>")}if(c.append('<li class="js_repostheader repostheader ptm"><span class="icon icon-share mrs"></span><span class="txt text-upper">Share to:</span></li>',!a.personalBlogId||a.kinjaShare||a.repostedToPersonal?"":'<li><a href="#" class="js_repost pvs" data-blogid="'+d.$$escapeHtml(a.personalBlogId)+'"><span class="txt">Personal blog</span></a></li>',a.kinjaShare?'<li><a href="#" class="js_kinja-share pvs"><span class="txt">Kinja</span></a></li>':""),a.blogsRepost)for(var i=a.blogsRepost,j=i.length,k=0;j>k;k++){var l=i[k];c.append('<li><a href="#" class="js_repost pvs" data-blogid="',d.$$escapeHtml(l.id),'"><span class="txt">',d.$$escapeHtml(l.name),"</span></a></li>")}return b?"":c.toString()},b.components.post.button.repostBlockWrapped=function(a,c,e){var f=c||new d.StringBuilder;return f.append('	<li class="repostblock js_repostblock"><ul>'),b.components.post.button.repostBlock(a,f,e),f.append("</ul></li>"),c?"":f.toString()},b.components.post.button.repostBlockMarionette=function(a,c,e){var f=c||new d.StringBuilder;return f.append("	<ul>"),b.components.post.button.repostBlock(a,f,e),f.append("</ul>"),c?"":f.toString()}}),define("app/post/posttools/view/posttools.repostview",["jquery","underscore","backbone.marionette","app/post/posttools/view/posttools.menuitemview","app/post/posttools/posttools.controller","singleton/CurrentUser","singleton/Feature","singleton/Utils","templates/tiger/components/post/button/repost-block"],function(a,b,c,d,e,f,g,h){var i=d.extend({permissions:["canSharePost"],template:tiger.components.post.button.repostBlockMarionette,events:{"click .js_repost":"repostPost","click .js_undorepost":"undoRepost"},modelEvents:{"change:actionState":"render"},serializeData:function(){var a,c,d,e=[],h=[],i=[];return b.each(this.model.get("actionState"),function(a,b){"repost"===a&&e.push(parseInt(b,10))}),a=f.get("defaultBlogId"),c=this.model.get("defaultBlogId"),f.get("membership").each(function(c){c.get("blogId")===a||"ENABLED"!==c.get("blog").status&&"SPAM"!==c.get("blog").status||(-1!==b.indexOf(e,c.get("blog").id)?i.push({name:c.get("blog").displayName,id:c.get("blog").id}):h.push({name:c.get("blog").displayName,id:c.get("blog").id}))},this),d={personalBlogId:a,repostedToPersonal:-1!==b.indexOf(e,a)?!0:!1,currentPostDefaultBlogId:c,kinjaShare:!1,blogsRepost:h,blogsUndo:i},g.isOn("replywithshare")&&(d.kinjaShare=!0),a!==c&&(d.personalBlogId=a),d},repostPost:function(b){b.preventDefault(),this.trigger("posttools:repost",this.model,a(b.currentTarget).data("blogid"))},undoRepost:function(a){a.preventDefault(),this.trigger("posttools:undorepost",{model:this.model})},_createReframeMarkup:function(a){var b="";this.$el.empty(),b=a.personalBlogId===a.currentPostDefaultBlogId&&f.get("membership").length<=1&&!g.isOn("replywithshare")?"":c.Renderer.render(tiger.components.post.button.repostBlockWrapped,a),this.$el.append(b),h.dropdownSentinel()},onPosttoolsOpened:function(){var a=this,b=function(){return f.isLoggedIn()?void a.model.getPostInfo({success:a.render.bind(a)}):!1},c=function(a){return{personalBlogId:a.personalBlogId,repostedToPersonal:a.repostedToPersonal,currentPostDefaultBlogId:a.currentPostDefaultBlogId,blogsRepost:a.blogsRepost,blogsUndo:a.blogsUndo,kinjaShare:!1}},d=function(){a.model.getShareOptionsForUser(f).pipe(c).done(a._createReframeMarkup.bind(a))},e=this.model&&parseInt(h.getKinjaMeta().postId,10)===this.model.get("sharedPostId");f.isLoggedIn()&&!this.model.has("actionState")?e?d():b():f.isLoggedIn()||f.onAuth.always(e?d:b)},render:function(){f.isLoggedIn()&&this.model.has("actionState")&&c.ItemView.prototype.render.call(this)},onRender:function(){d.prototype.onRender.call(this),h.dropdownSentinel()},_canShow:function(){var a=this.model.get("defaultBlogId"),b=f.get("defaultBlogId"),c=this.model.get("parentId"),e=this.model.get("sharedPostId");return c||e?b===a&&f.get("membership").length<=1&&!g.isOn("replywithshare")?!1:d.prototype._canShow.call(this):!1}});return i}),define("app/post/posttools/view/posttools.flagview",["jquery","underscore","singleton/Feature","app/post/posttools/view/posttools.menuitemview","module/flagging/ReplyFlaggingModule"],function(a,b,c,d,e){var f=d.extend({modelEvents:{"change:flagged":"_flaggedChanged","change:flaggingInProgress":"_flaggedChanged"},permissions:[],events:{click:"_onFlagClicked"},_flaggedChanged:function(){this.render()},_canShow:function(){return this.model.get("flagged")!==!0},_isDisabled:function(){return this.model.get("flaggingInProgress")===!0},_onFlagClicked:function(a){a.preventDefault();var b=this.$el.parents(".js_reply");e.openFlagView(b,this.model)}});return f}),define("app/post/posttools/view/posttools.unflagview",["app/post/posttools/view/posttools.menuitemview"],function(a){var b=a.extend({modelEvents:{"change:flagged":"_flaggedChanged","change:flaggingInProgress":"_flaggedChanged"},permissions:[],triggers:{click:"posttools:unflag"},_flaggedChanged:function(){this.render()},_canShow:function(){return this.model.get("flagged")===!0},_isDisabled:function(){return this.model.get("flaggingInProgress")===!0}});return b}),define("app/post/posttools/view/reposttools.unscheduleview",["app/post/posttools/view/posttools.menuitemview"],function(a){return a.extend({permissions:["canSharePost"],triggers:{click:"reposttools:unschedule"}})}),define("app/post/posttools/posttools.menuview",["jquery","underscore","backbone","backbone.marionette","singleton/CurrentUser","singleton/CurrentBlog","singleton/Feature","singleton/EventDispatcher","singleton/Utils","app/post/mixins/post.userPermissions","app/post/posttools/view/posttools.editview","app/post/posttools/view/posttools.editreplyview","app/post/posttools/view/posttools.deleteview","app/post/posttools/view/posttools.invitemanuallyview","app/post/posttools/view/posttools.dismissview","app/post/posttools/view/posttools.promoteview","app/post/posttools/view/posttools.blockview","app/post/posttools/view/posttools.hideview","app/post/posttools/view/posttools.kinjashareview","app/post/posttools/view/posttools.kinjaunshareview","app/post/posttools/view/posttools.externalshareview","app/post/posttools/view/posttools.repostview","app/post/posttools/view/posttools.flagview","app/post/posttools/view/posttools.unflagview","app/post/posttools/view/reposttools.unscheduleview"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){var z=["profilepage","dashboard","manageblog"],A=d.ItemView.extend(b.extend({},j,{menuItemViewClasses:{".js_-post":k,".js_edit-post":k,".js_edit-reply":-1===b.indexOf(z,i.getKinjaMeta().pageType)?l:k,".js_delete-post":m,".js_invite-to-post-manually":n,".js_dismiss":o,".js_promote":p,".js_block":q,".js_hide-post":r,".js_kinja-share":s,".js_kinja-unshare":t,".js_external-share":u,".js_repostblock":v,".js_flag-post":w,".js_unflag-post":x,".js_unschedule-repost":y},triggers:{"opened .js_post-dropdown":"posttools:opened"},menuItemViews:[],permissions:["userIsSuper","canEditPost","canPromote","canDismissPost","canSharePost"],initialize:function(a){h.on("blog:block:success"+this.model.id,this.render,this),this.blockedBlogCollection=a.blockedBlogCollection},_instantiateMenuItemViewClasses:function(){var c=b.map(this.menuItemViewClasses,function(c,d){var e=this.$(d);return e.length?b.map(e,function(b){return new c({el:a(b),model:this.model,collection:".js_block"===d?this.blockedBlogCollection:void 0})},this):!1},this);return b.chain(c).flatten().compact().value()},_bindEvents:function(){e.onAuth.always(this._refreshMenu.bind(this)),e.on("authenticated",this._refreshMenu.bind(this))},_refreshMenu:function(){var a="permalink"===i.getKinjaMeta().pageType,b=this,c=function(){return b.$("li:not(.hide)").length};b._renderMenuItems(),b.trigger("posttools:menuview:togglehidden",!a&&!c())},_renderMenuItems:function(){this.menuItemViews.call("render")},_captureMenuItemEvents:function(){this.menuItemViews.call("on","all",this.trigger,this)},_adjustMenuHeight:function(){var b,c=this.$(".js_post-dropdown"),d=a(window.document).height(),e=this.$el.offset().top,f=d-e-c.height();0>f&&(b=d-e,c.height(b+"px"),c.addClass("scroll"))},onPosttoolsOpened:function(){this.menuItemViews.call("triggerMethod","posttools:opened"),this._adjustMenuHeight()},render:function(){var b,d,h="permalink"===i.getKinjaMeta().pageType;return this.menuItemViews.length||(b=this._instantiateMenuItemViewClasses(),this.menuItemViews=new c.ChildViewContainer(b),this._captureMenuItemEvents()),this._renderMenuItems(),this._bindEvents(),d=h&&this.model.get("liveBlog")===!0&&this.model.get("isStarter")===!0,d&&this.$(".js_reply-to-post").toggleClass("hide",!e.hasRole("AUTHOR",f.id)),g.isOn("replywithshare")&&a(".js_kinja-share-wrapper").removeClass("hide"),h&&this.trigger("posttools:menuview:togglehidden",!1),this}}));return A}),define("templates/tiger/components/groupchats/unapproved-warning",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.groupchats.unapprovedWarning=function(a,b){a=a||{};var c=b||new d.StringBuilder;return c.append('	<div class="js_toggle-pending unapproved-filter"><div class="filtered-view js_toggle-block row"><div class="column medium-9 alert-container"><div class="alert-box info">',a.noReplies?"There are no approved replies for this post. To see additional replies that are pending approval, click Show Pending. Warning: These may contain graphic material.":"The following replies are approved. To see additional replies that are pending approval, click Show Pending. Warning: These may contain graphic material.",'</div></div><div class="column medium-3 button-container"><a href="#" class="button secondary js_pending-reply-switch tiny" onclick="window.ga(\'send\', \'event\', \'Group Chats\', \'click\', \'Show Pending Toggle\');">Show pending</a></div></div><div class="unapproved-view js_toggle-block row hide"><div class="column medium-9 alert-container"><div class="alert-box warning">Warning: Replies that are pending approval may contain graphic material.<br />Please proceed with caution.</div></div><div class="column medium-3 button-container"><a href="#" class="button primary js_pending-reply-switch tiny">Hide pending</a></div></div></div>'),b?"":c.toString()},b.components.groupchats.unapprovedWarningThread=function(a,b){var c=b||new d.StringBuilder;return c.append('	<div class="js_toggle-pending unapproved-filter"><div class="filtered-view js_toggle-block row"><div class="column medium-9 alert-container"><div class="alert-box info"><a href="#" class="js_pending-close close-button">×</a>The following replies are approved. To see additional replies that are pending approval, click Show Pending. Warning: These may contain graphic material.</div></div><div class="column medium-3 button-container"><a href="#" class="button secondary small text-upper js_pending-reply-switch">Show replies</a></div></div></div>'),b?"":c.toString()},b.components.groupchats.unapprovedAnnotationWarning=function(a,b){var c=b||new d.StringBuilder;return c.append('	<div class="js_toggle-pending unapproved-filter"><div class="filtered-view js_toggle-block row"><div class="column medium-9 alert-container"><div class="alert-box info">The following reply is unapproved. Warning: It may contain graphic material.</div></div><div class="column medium-3 button-container"><a href="#" class="button secondary small text-upper js_pending-reply-switch">Show reply</a></div></div></div>'),b?"":c.toString()}}),define("module/discussion/view/warning.view",["backbone.marionette","templates/tiger/components/groupchats/unapproved-warning"],function(a){var b=a.ItemView.extend({ui:{toggleBlocks:".js_toggle-block"},getTemplate:function(){var a=b.warningTypes,c=function(){};switch(this.options.warningType){case a.THREAD:c=tiger.components.groupchats.unapprovedWarningThread;break;case a.COMPLETE:c=tiger.components.groupchats.unapprovedWarning}return c},serializeData:function(){return{noReplies:this.options.noReplies}},toggleFilter:function(){this.ui.toggleBlocks.toggleClass("hide")}},{warningTypes:{THREAD:"thread",COMPLETE:"complete"}});return b}),define("view/ImageLoader",["jquery","underscore","singleton/EventDispatcher","singleton/Feature","view/BaseView","lib/waypoints","lib/jquery.browser.mobile"],function(a,b,c,d,e){var f=a(document),g=a(window),h={initialLookaheadFactor:.8,lookaheadFactor:2.6,containerClass:"lazy-image"},i="loaded",j=e.extend({$allWrappers:a(),$allImages:a(),$watchedWrappers:a(),$watchedImages:a(),viewportHeight:0,scrollTop:0,initialize:function(d){this.options=b.defaults(d||{},h),b.bindAll(this,"loadIfVisible","handleScroll"),this.registerImages(this.$el),this.addScrollEvents(),a(window).resize(b.debounce(b.bind(this.setAbsoluteHeight,this),300)),c.on("rendered.postlist.reply",function(a){this.registerImages(a.el)}.bind(this))},registerImages:function(b){var c=this.options.containerClass,d=b.find("."+c),e=d.find("img");this.$allWrappers=this.$allWrappers.add(d),this.$allImages=this.$allImages.add(e),this.$watchedImages=this.$watchedImages.add(e),this.$watchedWrappers=this.$watchedWrappers.add(d),this.setAbsoluteHeight(),this.$allImages.each(function(b,d){var e=a(d);e.data("wrapper",e.closest("."+c))}),this.trigger("images:registered")},addScrollEvents:function(){var c=b.bind(function(){this.viewportHeight=a.waypoints("viewportHeight")},this);c(),g.resize(b.debounce(c,1e3)),g.scroll(b.throttle(b.partial(this.handleScroll,this.options.lookaheadFactor),500)),this.handleScroll(this.options.initialLookaheadFactor)},setAbsoluteHeight:function(){var b=this.$allImages;b.each(function(){var b,c=a(this),d=c.data("aspectRatio")||c.attr("width")/c.attr("height");c.data("aspectRatio")||c.data("aspectRatio",d),b=Math.round(c.prop("width")/d),b&&c.data("newHeight",b)}),b.each(function(){var b=a(this);b.css("max-height",b.data("newHeight"))})},loadImage:function(b){var c=a(b);c.data(i)||this.waitForPlaceholder(c)},reinitializeInterchange:b.once(function(){a(document).foundation("interchange")}),updateInterchange:b.throttle(function(){this.reinitializeInterchange(),a(document).foundation("interchange","reflow")},150),_loadImage:function(a){var c,d=a.data("src"),e=a.data("lazyInterchange");this.trigger("imageLoading",{$el:a}),c=b.bind(function(){a.off("load",c).addClass("lazy-loaded"),this.trigger("imageLoaded",{$el:a}),this.$watchedImages=this.$watchedImages.not(a),this.$watchedWrappers=this.$watchedWrappers.not(a.data("wrapper"))},this),a.load(c).data(i,!0),d?a.attr("src",d):e?(a.attr("data-interchange",e),this.updateInterchange()):a.load()},waitForPlaceholder:function(a){var c,d="await-placeholder",e=a.data("wrapper");e.hasClass("asset-loading")?a.data(d)||(a.data(d,!0),c=b.bind(function(){a.off("load",c),this._loadImage(a)},this),a.load(c)):this._loadImage(a)},loadIfVisible:function(b,c){var d=a(b);d.data(i)||d.is(":hidden")||!this.inViewPort(d,c)||this.loadImage(d)},inViewPort:function(b,c){var d=this.scrollTop,e=c||this.options.lookaheadFactor,f=this.viewportHeight,g=f*e,h=d+f+g,i=d-g,j=Math.round(a(b).offset().top),k=Math.round(j+a(b).outerHeight()),l=k>i,m=h>j;return l&&m},handleScroll:function(a){this.scrollTop=window.pageYOffset||f.scrollTop(),b.each(this.$watchedImages,function(b){this.loadIfVisible(b,a)},this)}});return j}),define("view/GifImageLoader",["jquery","underscore","singleton/EventDispatcher","singleton/Feature","view/ImageLoader","lib/jquery.browser.mobile"],function(a,b,c,d,e){var f,g={mobileGifs:!0,gifClass:"lazy-gif",thawableClass:"thawable",thawingClass:"thawing",thawedClass:"thawed"};return f=e.extend({initialize:function(a){b.extend(this.options,b.defaults(a||{},g)),this.addEvents(),this.on("images:registered",this.markImagesThawable),e.prototype.initialize.apply(this,arguments)},addEvents:function(){var b=this.options.gifClass,e=function(a){return a.data("wrapper").hasClass(b)};(d.isOn("webm")||!a.browser.mobile)&&(this.on("imageLoading",function(b){var c=b.$el,d=new Image,f=c.data("anim-src");e(c)&&a(d).attr("src",f)},this),this.on("imageLoaded",function(a){var b=a.$el;e(b)&&this.thawImage(b)},this)),c.on("thawImage",function(a){var b=a.$el;"IMG"!==b.prop("tagName")&&(b=b.find("img")),this.thawImage(b)},this)},markImagesThawable:function(){var b=this.options;a.browser.mobile&&b.mobileGifs&&this.$allWrappers.addClass(b.thawableClass)},thawImage:function(b){if(d.isOn("webm")){var c,e=a("<video>");c=b.data(e[0].canPlayType("video/webm")?"webm-src":"mp4-src"),e.attr({autoplay:!0,controls:a.browser.mobile,loop:!0,muted:!0,src:c,poster:b.attr("src"),"class":b.attr("class"),style:b.attr("style"),"data-chomp-id":b.data("chomp-id")}),e.data("wrapper",b.data("wrapper")),this.startLoadIndicator(e),b.replaceWith(e)}else{var f=b.data("animSrc")||b.data("assetUrl"),g=b.data("animInterchange");this.startLoadIndicator(b),f&&b.attr("src",f),g&&(b.attr("data-interchange",g),this.updateInterchange())
}},startLoadIndicator:function(b){var c=a(b),e=c.data("wrapper"),f=this.options,g=function(){e.removeClass(f.thawingClass).addClass(f.thawedClass)};e.removeClass(f.thawableClass).addClass(f.thawingClass),c.load(g).error(g),d.isOn("webm")&&c.on("loadedmetadata",g)}})}),define("templates/tiger/components/groupchats/pending-image-message",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.groupchats.pendingImageMessage=function(a,b){var c=b||new d.StringBuilder;return c.append('	<span class="label pending-image-label">Click to Reveal</span>'),b?"":c.toString()}}),define("singleton/ImageBlurHelper",["jquery","backbone.marionette","templates/tiger/components/groupchats/pending-image-message"],function(a,b){var c={addImageBlur:function(c){var d=b.Renderer.render(tiger.components.groupchats.pendingImageMessage);c.find(".img-border").length||c.find("img").wrap(a("<span>").addClass("img-border")),c.addClass("blurred"),c.find(".img-border").prepend(d.cloneNode(!0)),c.find(".magnifier.lightBox").hide()},removeImageBlur:function(b){b.stopPropagation(),b.preventDefault();var c=a(b.currentTarget);c.find("img").addClass("unblur"),c.find(".pending-image-label").remove(),c.parents(".has-media").find(".magnifier.lightBox").show()}};return c}),define("module/discussion/regionManager/discussionRegionManager",["underscore","backbone.marionette",""],function(a,b){var c=b.RegionManager.extend({addCommentRegion:function(a){var c=this.get("commentRegion"),d=c?c.currentView:!1;return(!d||d.confirmRemove())&&(c&&(c.reset(),c.off()),c=new b.Region({el:a}),this.addRegion("commentRegion",c)),c}});return new c}),define("lib/amd-wrapped/jquery.lightbox-0.5",["jquery"],function(a){a.fn.lightBox=function(b){function c(){return d(this,s),!1}function d(c,d){var g=a(c).siblings("span").find("img");if(a("embed, object, select").css({visibility:"hidden"}),e(),b.imageArray.length=0,b.activeImage=0,1==d.length)b.imageArray.push(new Array(g.attr("data-original-src"),c.getAttribute("title")));else for(var h=0;h<d.length;h++){var i=d.eq(h).siblings("span").find("img");b.imageArray.push(new Array(i.attr("data-original-src"),d[h].getAttribute("title")))}for(;b.imageArray[b.activeImage][0]!=g.attr("data-original-src");)b.activeImage++;f()}function e(){a("body").append('<div id="jquery-overlay"></div><div id="jquery-lightbox"><div id="lightbox-container-image-data-box"><div id="lightbox-container-image-data"><div id="lightbox-image-details"><span id="lightbox-image-details-caption"></span><span id="lightbox-image-details-currentNumber" class="proxima"></span></div><div id="lightbox-secNav"><a href="#" id="lightbox-secNav-btnClose"><span class="icon icon-white icon-x-alt"></span></a></div></div></div><div id="lightbox-container-image-box"><div id="lightbox-container-image"><img id="lightbox-image"><a href="#" id="lightbox-nav-btnPrev"></a><a href="#" id="lightbox-nav-btnNext"></a></div></div></div>');var c=p();a("#jquery-overlay").css({backgroundColor:b.overlayBgColor,opacity:b.overlayOpacity,width:c[0],height:c[1]}).fadeIn();var d=q();a("#jquery-lightbox").css({top:d[1]+c[3]/10,left:d[0]}).show(),a("#jquery-overlay,#jquery-lightbox").click(function(){o()}),a("#lightbox-loading-link,#lightbox-secNav-btnClose").click(function(){return o(),!1}),a(window).resize(function(){var b=p();a("#jquery-overlay").css({width:b[0],height:b[1]});var c=q();a("#jquery-lightbox").css({top:c[1]+b[3]/10,left:c[0]})})}function f(){b.fixedNavigation?a("#lightbox-image,#lightbox-container-image-data-box,#lightbox-image-details-currentNumber").hide():a("#lightbox-image,#lightbox-nav,#lightbox-nav-btnPrev,#lightbox-nav-btnNext,#lightbox-container-image-data-box,#lightbox-image-details-currentNumber").hide();var c=new Image;c.onload=function(){a("#lightbox-image").attr("src",b.imageArray[b.activeImage][0]),g(c.width,c.height),c.onload=function(){}},c.src=b.imageArray[b.activeImage][0],b.activeImage>-1}function g(c,d){a("#lightbox-container-image-box").hide();var e=a("#lightbox-container-image-box").width(),f=a("#lightbox-container-image-box").height(),g=c+2*b.containerBorderSize,i=d+2*b.containerBorderSize,j=e-g,k=f-i;a("#lightbox-container-image-box").css({width:g,height:i}),h(),0==j&&0==k&&r(a.browser.msie?250:100),a("#lightbox-container-image-data-box").css({width:c+20})}function h(){a("#lightbox-image").fadeIn(function(){i(),j(),a("#lightbox-container-image-box").show()}),n()}function i(){a("#lightbox-container-image-data-box").slideDown("fast"),a("#lightbox-image-details-caption").hide(),b.imageArray[b.activeImage][1]&&a("#lightbox-image-details-caption").html(b.imageArray[b.activeImage][1]).show(),b.imageArray.length>1}function j(){0!=b.activeImage?b.fixedNavigation?a("#lightbox-nav-btnPrev").unbind().html('<span class="button-box"><span class="icon icon-white icon-chevron-left"></span></span>').bind("click",function(){return b.activeImage=b.activeImage-1,f(),!1}):a("#lightbox-nav-btnPrev").unbind().hover(function(){a(this).html('<span class="button-box"><span class="icon icon-white icon-chevron-left"></span></span>')},function(){a(this).html("")}).show().bind("click",function(){return b.activeImage=b.activeImage-1,f(),!1}):a("#lightbox-nav-btnPrev").html(""),b.activeImage!=b.imageArray.length-1?b.fixedNavigation?a("#lightbox-nav-btnNext").unbind().html('<span class="button-box"><span class="icon icon-white icon-chevron-right"></span></span>').bind("click",function(){return b.activeImage=b.activeImage+1,f(),!1}):a("#lightbox-nav-btnNext").unbind().hover(function(){a(this).html('<span class="button-box"><span class="icon icon-white icon-chevron-right"></span></span>')},function(){a(this).html("")}).show().bind("click",function(){return b.activeImage=b.activeImage+1,f(),!1}):(a("#lightbox-nav-btnNext").unbind(),a("#lightbox-nav-btnNext").html("")),k()}function k(){a(document).keydown(function(a){m(a)})}function l(){a(document).unbind()}function m(a){null==a?(keycode=event.keyCode,escapeKey=27):(keycode=a.keyCode,escapeKey=a.DOM_VK_ESCAPE||27),key=String.fromCharCode(keycode).toLowerCase(),(key==b.keyToClose||"x"==key||keycode==escapeKey)&&o(),(key==b.keyToPrev||37==keycode)&&0!=b.activeImage&&(b.activeImage=b.activeImage-1,f(),l()),(key==b.keyToNext||39==keycode)&&b.activeImage!=b.imageArray.length-1&&(b.activeImage=b.activeImage+1,f(),l())}function n(){b.imageArray.length-1>b.activeImage&&(objNext=new Image,objNext.src=b.imageArray[b.activeImage+1][0]),b.activeImage>0&&(objPrev=new Image,objPrev.src=b.imageArray[b.activeImage-1][0])}function o(){a("#jquery-lightbox").remove(),a("#jquery-overlay").fadeOut(function(){a("#jquery-overlay").remove()}),a("embed, object, select").css({visibility:"visible"})}function p(){var a,b;window.innerHeight&&window.scrollMaxY?(a=window.innerWidth+window.scrollMaxX,b=window.innerHeight+window.scrollMaxY):document.body.scrollHeight>document.body.offsetHeight?(a=document.body.scrollWidth,b=document.body.scrollHeight):(a=document.body.offsetWidth,b=document.body.offsetHeight);var c,d;return self.innerHeight?(c=document.documentElement.clientWidth?document.documentElement.clientWidth:self.innerWidth,d=self.innerHeight):document.documentElement&&document.documentElement.clientHeight?(c=document.documentElement.clientWidth,d=document.documentElement.clientHeight):document.body&&(c=document.body.clientWidth,d=document.body.clientHeight),pageHeight=d>b?d:b,pageWidth=c>a?a:c,arrayPageSize=new Array(pageWidth,pageHeight,c,d),arrayPageSize}function q(){var a,b;return self.pageYOffset?(b=self.pageYOffset,a=self.pageXOffset):document.documentElement&&document.documentElement.scrollTop?(b=document.documentElement.scrollTop,a=document.documentElement.scrollLeft):document.body&&(b=document.body.scrollTop,a=document.body.scrollLeft),arrayPageScroll=new Array(a,b),arrayPageScroll}function r(a){var b=new Date;c=null;do var c=new Date;while(a>c-b)}b=a.extend({overlayBgColor:"#000",overlayOpacity:.85,fixedNavigation:!1,containerBorderSize:10,containerResizeSpeed:400,txtImage:"Image",txtOf:" / ",keyToClose:"c",keyToPrev:"p",keyToNext:"n",imageArray:[],activeImage:0},b);var s=this;return this.unbind("click").click(c)}}),define("templates/tiger/icons/essential/usage",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.icons.essential.search=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-search"><use xlink:href="#iconset-search" /></svg>'),b?"":c.toString()},b.icons.essential.add=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-add"><use xlink:href="#iconset-add" /></svg>'),b?"":c.toString()},b.icons.essential.siteDefault=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-site-default"><use xlink:href="#iconset-site-default" /></svg>'),b?"":c.toString()},b.icons.essential.zoomIn=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-zoom-in"><use xlink:href="#iconset-zoom-in" /></svg>'),b?"":c.toString()},b.icons.essential.star=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-star"><use xlink:href="#iconset-star" /></svg>'),b?"":c.toString()},b.icons.essential.starCircle=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-star-circle"><use xlink:href="#iconset-star-circle" /></svg>'),b?"":c.toString()},b.icons.essential.chevronRight=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-chevron chevron--right"><use xlink:href="#iconset-chevron-right" /></svg>'),b?"":c.toString()},b.icons.essential.chevronBottom=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-chevron chevron--bottom"><use xlink:href="#iconset-chevron-right" /></svg>'),b?"":c.toString()},b.icons.essential.chevronLeft=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-chevron chevron--left"><use xlink:href="#iconset-chevron-right" /></svg>'),b?"":c.toString()},b.icons.essential.chevronTop=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-chevron chevron--top"><use xlink:href="#iconset-chevron-right" /></svg>'),b?"":c.toString()},b.icons.essential.flame=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-flame"><use xlink:href="#iconset-flame" /></svg>'),b?"":c.toString()},b.icons.essential.kinja=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-logo-kinja"><use xlink:href="#iconset-logo-kinja" /></svg>'),b?"":c.toString()},b.icons.essential.bubble=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-bubble"><use xlink:href="#iconset-bubble" /></svg>'),b?"":c.toString()},b.icons.essential.checkmark=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-checkmark"><use xlink:href="#iconset-checkmark" /></svg>'),b?"":c.toString()},b.icons.essential.close=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-close"><use xlink:href="#iconset-close" /></svg>'),b?"":c.toString()},b.icons.essential.facebook=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-facebook"><use xlink:href="#iconset-facebook" /></svg>'),b?"":c.toString()},b.icons.essential.twitter=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-twitter"><use xlink:href="#iconset-twitter" /></svg>'),b?"":c.toString()},b.icons.essential.googleplus=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-googleplus"><use xlink:href="#iconset-googleplus" /></svg>'),b?"":c.toString()},b.icons.essential.externalLink=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-external-link"><use xlink:href="#iconset-external-link" /></svg>'),b?"":c.toString()},b.icons.essential.burner=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-burner"><use xlink:href="#iconset-burner" /></svg>'),b?"":c.toString()},b.icons.essential.link=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-link"><use xlink:href="#iconset-link" /></svg>'),b?"":c.toString()},b.icons.essential.image=function(a,b){var c=b||new d.StringBuilder;return c.append('	<svg class="svg-icon svg-image"><use xlink:href="#iconset-image" /></svg>'),b?"":c.toString()}}),define("gawkerlib/lightboxer",["jquery","underscore","view/BaseView","singleton/Utils","singleton/Feature","lib/amd-wrapped/jquery.lightbox-0.5","templates/tiger/icons/essential/usage"],function(a,b,c,d,e){function f(c){var f=c.find(".lightBoxWrapper .img-border img"),g=c.find(".lightBox");b.each(f,function(b){var c=a(b);c.attr("data-original-src",d.imageUrl(c.data("chomp-id"),"original",c.data("format")))}),e.isOn("svgicons")&&g.find(".icon-search-plus").replaceWith(a.trim(tiger.icons.essential.zoomIn())),g.removeClass("hide").lightBox()}return f}),define("templates/tiger/components/discussion/comment",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.discussion.comment=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");var g=(e.features.superuser,a.reply.authorStats&&a.reply.authorStats.contributors.length?a.reply.authorStats.contributors.length:1,((null==e.replyData?null:e.replyData.query)==a.reply.author.screenName||!(null==e.replyData?null:e.replyData.query))&&(a.reply.approved||(null==a.reply.qiMeta?null:a.reply.qiMeta.dynamicApproved)),new d.StringBuilder);if(a.reply.blogs)for(var h=a.reply.blogs,i=h.length,j=0;i>j;j++){var k=h[j];g.append(k.id==a.reply.author.defaultBlogId?d.$$escapeHtml(k.canonicalHost):"")}g=g.toString();var l=a.starterAuthor==a.reply.author.screenName,m=e.features.svgicons;return f.append('<article id="reply_',d.$$escapeHtml(a.reply.id),'" class="reply reply--depth-',d.$$escapeHtml(a.depth)," discussion__comment js_reply",a.reply.approved?"":" unapproved",l?" moderator":"",'" data-id="',d.$$escapeHtml(a.reply.id),'" data-parentid="',d.$$escapeHtml(a.reply.parentId),'" data-authorname="',d.$$escapeHtml(a.reply.authorBlogName),'"><header class="no-expand">'),b.components.post.meta.postMetaContainer({post:a.reply,contributors:a.contributors,mode:"reply",showDate:!0,pageType:a.pageType,blog:a.blog},f,e),f.append('</header><div class="reply-content js_reply-content post-content blurable whitelisted-links">',"IMAGE"==(null==a.reply.annotation?null:a.reply.annotation.annotationType)?'<div class="reply-image-annotation" style="background-image: url(\''+d.$$escapeHtml(a.reply.annotation.imageUrl)+"'); background-position: "+d.$$escapeHtml(a.reply.annotation.x)+"% "+d.$$escapeHtml(a.reply.annotation.y)+'%;"></div>':""),"TEXT"==(null==a.reply.annotation?null:a.reply.annotation.annotationType)&&(f.append('<blockquote class="reply-text-annotation" style="">'),m?(f.append('<span class="icon--svg mrs">'),b.icons.actions.quote(null,f,e),f.append("</span>")):f.append('<span class="icon icon-quote mrs"></span>'),f.append(a.reply.annotation.annotationShortText?'<div class="js_annotation-long hide">'+d.$$filterNoAutoescape(a.reply.annotation.annotationText)+'</div><div class="js_annotation-short">'+d.$$filterNoAutoescape(a.reply.annotation.annotationShortText)+' <a href="'+d.$$escapeHtml(a.reply.permalink)+'" class="js_annotation-expand proxima text-small">Show all</a></div>':d.$$filterNoAutoescape(a.reply.annotation.annotationText),"</blockquote>")),f.append(d.$$filterNoAutoescape(a.reply.display),"</div>"),b.components.discussion.replyTools(a,f,e),f.append('<div class="js_reply-flagged reply-flagged ',a.reply.flagged?"":"hide",'">Flagged</div>',a.embeddedReply?'<div class="proxima embed-open-link"><a class="right" href="'+d.$$escapeHtml(a.reply.permalink)+'" target="_blank">Open reply on <img src="//c.kinja-static.com/assets/images/icons/icon-kinja-nav.png"/> <span class="kinja-logo">Kinja</span></a></div>':'<div class="reply-border"></div>','</article><div class="js_region--warning"></div><div class="js_editor-placeholder"></div><div class="js_region--children"></div>'),c?"":f.toString()},b.components.discussion.replyTools=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");var g=a.reply.replyCount?a.reply.replyCount:0,h=e.features.svgicons;return f.append('<div class="reply-tools js_reply-tools ',a.reply.flagged||a.embeddedReply?"hide":"",'">'),"ReplyList"!=a.discussionType&&a.reply._surfaced&&g&&a.depth<2&&(f.append('<a href="#" class="js_toggle-descendants reply-count" data-id="',d.$$escapeHtml(a.reply.id),'" title="Show replies">',d.$$escapeHtml(g)),h?(f.append('<span class="iconset--svg u-oversized">'),b.icons.essential.bubble(null,f,e),f.append("</span>")):f.append('<span class="icon icon-bubble-round oversized js_bubble-icon"></span>'),f.append("</a>")),f.append('<a href="#" class="js_like recommend-reply readonly-hide" title="Recommend">',a.reply.likes&&a.reply.likes>0?'<span class="js_like_count">'+d.$$escapeHtml(a.reply.likes)+"</span>":""),h?(f.append('<span class="icon--svg u-oversized u-appended js_like_icon',a.reply.liked?" active":"",'">'),b.icons.essential.star(null,f,e),f.append("</span>")):f.append('<span class="icon icon-star icon-append js_like_icon oversized ',a.reply.liked?"active":"",'"></span>'),f.append('</a><a href="#" class="js_reply-to-selected-post reply-link readonly-hide" data-id="',d.$$escapeHtml(a.reply.id),"\" title=\"Reply\" onclick=\"window.ga('send', 'event', 'Group Chats', 'click', 'Reply button click');\">Reply</a></div>"),c?"":f.toString()}}),define("templates/tiger/components/post/meta/post-meta-container",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.post.meta.postMetaContainer=function(a,c,e){var f=c||new d.StringBuilder;return f.append('	<div class="meta-container without-dropdown">'),"permalink"==a.pageType?b.components.post.meta.metaAvatar(a,f,e):b.components.post.meta.meta(a,f,e),a.forSharedPost||(f.append('<div class="post-dropdown-ct js_post-dropdown-ct',"permalink"!=a.pageType||a.mode?"":" js_post-dropdown-ct-sticky",'">'),b.components.post.meta.postDropdown(a,f,e),f.append("</div>")),f.append("</div>"),c?"":f.toString()}}),define("templates/tiger/components/post/meta/post-dropdown",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.post.meta.postDropdown=function(a,c,e){var f=c||new d.StringBuilder,g=a.post.defaultBlogId!=(null==a.blog?null:a.blog.id)&&"POSTACTION"==(null==a.post.meta?null:a.post.meta.typ),h=null==a.blog?null:a.blog.name;if(!h){a.post.defaultBlogName}var i=null==a.blog?null:a.blog.displayName;if(!i);var j=e.features.svgicons;if(f.append('<ul id="dropdown-',d.$$escapeHtml(a.post.id),'" class="f-dropdown proxima js_post-dropdown js_follow-controls js_user-follow-controls whitelisted-links" data-postid="',d.$$escapeHtml(a.post.id),'" data-starterid="',d.$$escapeHtml(a.post.starterId),'" data-authorid="',d.$$escapeHtml(a.post.author.id),'" data-blogid="',d.$$escapeHtml(a.post.authorBlogId),'" data-sourceblogid="',d.$$escapeHtml(null==a.blog?null:a.blog.id),'" data-dropdown-content>'),"reply"==a.mode?(f.append('<li class="js_edit-reply hover-icon hide readonly-hide"><a href="#" rel="nofollow"',j?" icon--svg":"",">"),j?b.icons.actions.write(null,f,e):f.append('<i class="icon icon-pencil-alt icon-prepend"></i>'),f.append("Edit</a></li>")):(f.append('<li class="js_edit-post hover-icon hide readonly-hide"><a href="#" rel="nofollow"',j?" icon--svg":"",">"),j?b.icons.actions.write(null,f,e):f.append('<i class="icon icon-pencil-alt icon-prepend"></i>'),f.append("Edit</a></li>")),g?(f.append('<li class="js_kinja-unshare hover-icon hide readonly-hide"><a href="#" rel="nofollow"',j?" icon--svg":"",">"),j?b.icons.essential.externalLink(null,f,e):f.append('<i class="icon icon-share icon-prepend"></i>'),f.append("Unshare</a></li>")):(f.append('<li class="js_delete-post hover-icon hide readonly-hide"><a href="#" rel="nofollow"',j?" icon--svg":"",">"),j?b.icons.essential.close(null,f,e):f.append('<i class="icon icon-x-circle icon-prepend"></i>'),f.append("Delete</a></li>")),(e.features.limit_draft_controls&&"DRAFT"!=a.post.status||!e.features.limit_draft_controls)&&b.components.invites.menuItems.invitePostDropdownItems(null,f,e),"reply"==a.mode?(f.append("<li class=\"js_followforuser hover-icon readonly-hide\" onclick=\"window.ga('send', 'event', 'Group Chats', 'click', 'Drop down - follow user click');\"><a href=\"#\" rel=\"nofollow\"",j?" icon--svg":"",">"),j?b.icons.essential.add(null,f,e):f.append('<i class="icon icon-plus-circle icon-prepend"></i>'),f.append("Follow ",d.$$escapeHtml(a.post.authorBlogName),'</a></li><li class="js_unfollowforuser hover-icon hide readonly-hide"><a href="#" rel="nofollow"',j?" icon--svg":"",">"),j?b.icons.essential.checkmark(null,f,e):f.append('<i class="icon icon-checkmark icon-prepend"></i>'),f.append("Unfollow ",d.$$escapeHtml(a.post.authorBlogName),"</a></li>"),"private"!=a.pageType&&"dashboard"!=a.pageType&&(f.append('<li class="js_followforblog js_approveforblog hover-icon hide readonly-hide"><a href="#" rel="nofollow"',j?" icon--svg":"",">"),e.features.approvemessage?(j?b.icons.essential.add(null,f,e):f.append('<i class="icon icon-plus-circle icon-prepend"></i>'),f.append("Approve ",d.$$escapeHtml(a.post.authorBlogName)," on ",d.$$escapeHtml(i))):(j?b.icons.essential.add(null,f,e):f.append('<i class="icon icon-plus-circle icon-prepend"></i>'),f.append("Follow ",d.$$escapeHtml(a.post.authorBlogName)," for ",d.$$escapeHtml(h))),f.append('</a></li><li class="js_unfollowforblog js_unapproveforblog hover-icon hide readonly-hide"><a href="#" rel="nofollow"',j?" icon--svg":"",">"),e.features.approvemessage?(j?b.icons.essential.checkmark(null,f,e):f.append('<i class="icon icon-checkmark icon-prepend"></i>'),f.append("Remove ",d.$$escapeHtml(a.post.authorBlogName)," from ",d.$$escapeHtml(i)," approve list")):(j?b.icons.essential.checkmark(null,f,e):f.append('<i class="icon icon-checkmark icon-prepend"></i>'),f.append("Unfollow ",d.$$escapeHtml(a.post.authorBlogName)," for ",d.$$escapeHtml(h))),f.append("</a></li>"))):(e.features.limit_draft_controls&&"DRAFT"!=a.post.status||!e.features.limit_draft_controls)&&(f.append('<li class="js_promote hover-icon hide readonly-hide"><a href="#" rel="nofollow"',j?' class="icon--svg"':"",">"),j?b.icons.essential.starCircle(null,f,e):f.append('<i class="icon icon-star-circle icon-prepend"></i>'),f.append("Promote</a></li>")),(e.features.limit_draft_controls&&"DRAFT"!=a.post.status||!e.features.limit_draft_controls)&&"dashboard"!=a.pageType&&(f.append('<li class="js_dismiss hover-icon hide readonly-hide"><a href="#" class="dismiss',j?" icon--svg":"","\" rel=\"nofollow\" onclick=\"window.ga('send', 'event', 'Group Chats', 'click', 'Dismiss click');\">"),j?b.icons.actions.userRemove(null,f,e):f.append('<i class="icon icon-prepend notranslate">X</i>'),f.append('Dismiss</a><a href="#" class="undismiss',j?" icon--svg":"","\" rel=\"nofollow\" onclick=\"window.ga('send', 'event', 'Group Chats', 'click', 'Undismiss click');\">"),j?b.icons.actions.userRemove(null,f,e):f.append('<i class="icon icon-prepend notranslate">X</i>'),f.append('Undismiss</a></li><li class="js_block hover-icon hide disabled readonly-hide" data-blogid="',d.$$escapeHtml(a.post.defaultBlogId),'" data-targetblogid="',d.$$escapeHtml(a.post.authorBlogId),'" data-targetblogname="',d.$$escapeHtml(h),'"><a href="#" rel="nofollow"',j?' class="icon--svg"':"",">"),j?b.icons.actions.disabled(null,f,e):f.append('<i class="icon icon-not-circle icon-prepend"></i>'),f.append("<span>Block for ",d.$$escapeHtml(h),'</span></a></li><li class="js_hide-post hover-icon hide readonly-hide"><a href="#" rel="nofollow"',j?" icon--svg":"",">"),j?b.icons.actions.disabled(null,f,e):f.append('<i class="icon icon-prepend icon-not-circle"></i>'),f.append("Hide</a></li>")),"permalink"==a.pageType&&(e.features.limit_draft_controls&&"DRAFT"!=a.post.status||!e.features.limit_draft_controls)){if("reply"==a.mode?(f.append('<li class="js_flag-post hover-icon readonly-hide"><a href="#" rel="nofollow"',j?" icon--svg":"",">"),j?b.icons.actions.flag(null,f,e):f.append('<i class="icon icon-prepend icon-flag"></i>'),f.append('Flag</a></li><li class="js_unflag-post unflag-post hover-icon readonly-hide"><a href="#" rel="nofollow"',j?" icon--svg":"",">"),j?b.icons.actions.flag(null,f,e):f.append('<i class="icon icon-prepend icon-flag"></i>'),f.append("Unflag</a></li>")):(f.append('<li class="js_kinja-share-block readonly-hide"><a class="js_kinja-share hover-icon',j?" icon--svg":"",'" href="#" rel="nofollow">'),j?b.icons.essential.externalLink(null,f,e):f.append('<i class="icon icon-share icon-prepend"></i>'),f.append("Share to Kinja</a></li>")),e.features.sharingfooter||(f.append('<li class="js_external-share"><a class="js_share-post-item facebook hover-icon',j?" icon--svg":"",'" rel="nofollow" href="http://facebook.com/sharer.php?u=',d.$$escapeUri(a.post.permalink),"\" onclick=\"window.ga('send', 'event', 'Group Chats', 'click', 'Drop down - Share to Facebook click');\">"),j?b.icons.essential.facebook(null,f,e):f.append('<i class="icon icon-facebook icon-prepend"></i>'),f.append("Share to Facebook</a></li>")),e.features.pinterest&&!j){var k=new d.StringBuilder,l=new d.StringBuilder("k-bigpic");l=l.toString(),k.append(a.post.facebookImage?d.$$escapeHtml(window.kinja.imageUrl(a.post.facebookImage.id,l,a.post.facebookImage.format)):"http://kinja.com/assets/images/logos/touchicons/default-touch-icon-200x200.png"),k=k.toString(),f.append('<li class="js_external-share"><a class="js_share-post-item pinterest hover-icon" rel="nofollow" href="http://www.pinterest.com/pin/create/api_other/?url=',d.$$escapeUri(a.post.permalink),"&media=",d.$$escapeUri(k),"&description=",d.$$escapeUri(a.post.plaintext),"\" onclick=\"window.ga('send', 'event', 'Share to Pinterest', 'click', 'Drop down');\"><i class=\"icon icon-pinterest icon-prepend\"></i>Share to Pinterest</a></li>")}e.features.sharingfooter||(f.append('<li class="js_external-share"><a class="js_share-post-item twitter hover-icon',j?" icon--svg":"",'" rel="nofollow" href="http://twitter.com/share?url=',d.$$escapeUri(a.post.permalink),"&amp;text=POST_TITLE\" onclick=\"window.ga('send', 'event', 'Group Chats', 'click', 'Drop down - Share to Twitter click');\">"),j?b.icons.essential.twitter(null,f,e):f.append('<i class="icon icon-twitter icon-prepend"></i>'),f.append("Share to Twitter</a></li>")),f.append('<li class="js_go-to-permalink"><a class="hover-icon',j?" icon--svg":"",'" href="',d.$$escapeHtml(a.post.permalink),"\" onclick=\"window.ga('send', 'event', 'Group Chats', 'click', 'Drop down - Go to permalink click');\">"),j?b.icons.essential.link(null,f,e):f.append('<i class="icon icon-link-alt icon-prepend"></i>'),f.append("Go to permalink</a></li>")}return"dashboard"==a.pageType&&"reply"==a.mode&&(e.features.limit_draft_controls&&"DRAFT"!=a.post.status||!e.features.limit_draft_controls)&&(f.append("<li class=\"js_block readonly-hide\"><a href=\"#\" rel=\"nofollow\" onclick=\"window.ga('send', 'event', 'Group Chats', 'click', 'Block User click');\"",j?' class="icon--svg"':"",">"),j?b.icons.essential.close(null,f,e):f.append('<i class="icon icon-prepend xicon-block-user"></i>'),f.append("Block user for blog</a></li>")),f.append('<li class="repostblock js_repostblock hide"></li></ul>'),j?(f.append('<a href="#" target="_self" class="icon--svg post-dropdown-trigger js_post-menu-toggler" data-dropdown="dropdown-',d.$$escapeHtml(a.post.id),"\" onclick=\"window.ga('send', 'event', 'Group Chats', 'click', 'Drop down click');\">"),b.icons.essential.chevronBottom(null,f,e),f.append("</a>")):f.append('<a href="#" target="_self" class="button dropdown secondary transparent toggle-30 js_post-menu-toggler post-dropdown-trigger" data-dropdown="dropdown-',d.$$escapeHtml(a.post.id),"\" onclick=\"window.ga('send', 'event', 'Group Chats', 'click', 'Drop down click');\"></a>"),c?"":f.toString()}}),define("templates/tiger/components/post/meta/meta-avatar",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.post.meta.metaAvatar=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");for(var g=new d.StringBuilder,h=a.post.blogs,i=h.length,j=0;i>j;j++){var k=h[j];g.append(k.id==a.post.author.defaultBlogId?d.$$escapeHtml(k.canonicalHost):"")}g=g.toString();var l=new d.StringBuilder(d.$$escapeHtml(a.post.id),"-hovercard");return l=l.toString(),f.append('<div class="meta-avatar js_author" data-authorid="',d.$$escapeHtml(a.post.author.id),'" data-blogid="',d.$$escapeHtml(a.post.author.defaultBlogId),'">'),"reply"!=a.mode&&b.components.post.meta.postInfo(a,f,e),f.append('<div class="floated-container img-30" data-dropdownhover-container>'),b.components.post.meta.avatarContainer({post:a.post,canonicalHost:g},f,e),f.append('<div class="txt">',e.features.hide_pending_replies&&!a.post.approved?'<span class="pending-label">Pending approval</span>':"",a.forSharedPost?"Original post by":""),b.components.post.meta.topByline({post:a.post,mode:d.$$escapeHtml(a.mode?a.mode:"post"),forSharedPost:a.forSharedPost,contributors:a.contributors,dropdownName:l,blog:a.blog},f,e),f.append('<div class="second-line post-meta">'),(a.post.sponsored||a.post.isBillboardPost||a.post.isPromoted)&&b.components.post.meta.promotedByline(a,f,e),a.post.tags&&a.post.tags[0]&&!a.forSharedPost&&(f.append("Filed to: "),b.components.post.tag({tag:a.post.tags[0],hasDropdown:a.post.tags.length>1,tagClasses:"first-tag"},f,e),a.post.tags.length>1&&b.components.post.tagList({tags:a.post.tags},f,e)),0==a.showDate||a.forSharedPost||b.components.post.meta.publishTime(a,f,e),f.append("</div></div></div></div>"),c?"":f.toString()}}),define("templates/tiger/components/post/meta/formatted-time",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.post.meta.formattedTime=function(a,c,e){var f=c||new d.StringBuilder;return f.append('	<span class="',a.showRelativeTime?"show-on-hover":"",' published updated">',d.$$escapeHtml(a.time.Mddyyhmma),"</span>"),a.showRelativeTime&&(f.append('<span class="hide-on-hover">'),b.messages.relativeTime({type:a.time.relative.type,amount:a.time.relative.amount,hmma:a.time.hmma,day:a.time.day,Mddyyhmma:a.time.Mddyyhmma,timestamp:a.time.timestamp},f,e),f.append("</span>")),c?"":f.toString()}}),define("templates/tiger/components/invites/menu-items",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.invites.menuItems.invitePostDropdownItems=function(a,b){var c=b||new d.StringBuilder;return c.append('	<li class="js_invite-to-post-manually hover-icon hide"><a href="#" rel="nofollow"><i class="icon icon-mail icon-prepend"></i>Invite manually</a></li>'),b?"":c.toString()}}),define("module/discussion/view/comment.layout",["jquery","underscore","backbone.marionette","module/discussion/model/comment.model","module/discussion/model/comment.collection","module/discussion/discussion.channel","app/post/common/post.layout","app/post/posttools/posttools.menuview","module/discussion/view/warning.view","view/GifImageLoader","singleton/Feature","singleton/Utils","singleton/CurrentBlog","singleton/CurrentUser","singleton/ImageBlurHelper","module/discussion/regionManager/discussionRegionManager","app/post/posttools/posttools.controller","singleton/Twitter","app/post/posttools/controller/posttools.block.controller","singleton/EventDispatcher","gawkerlib/lightboxer","templates/tiger/components/discussion/comment","templates/tiger/components/post/meta/post-meta-container","templates/tiger/components/post/meta/post-dropdown","templates/tiger/components/post/meta/meta-avatar","templates/tiger/components/post/meta/formatted-time","templates/tiger/components/invites/menu-items"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v,w="KinjaNSFWCookie";return v=g.extend({_updateLikeCount:function(){var a=window.parseInt(this.ui.likeCountPlaceholder.text(),10)||0,b=a>0;
a=this.model.get("liked")?a+1:b?a-1:0,this.ui.likeCountPlaceholder.text(a||"")},_expanded:!1,_gifImageLoader:null,_renderDeferred:a.Deferred(),_commentListView:null,tagName:"li",className:function(){var a=this.model;return["commentlist__item","commentlist__item--depth-"+a.collection.getDepth(),a.get("_surfaced")?"surfaced":""].join(" ")},template:tiger.components.discussion.comment,regions:{warningRegion:".js_region--warning:first",childrenRegion:".js_region--children"},ui:b.extend({},g.prototype.ui,{replyContent:".js_reply-content",replyTools:".js_reply-tools",replyFlag:".js_reply-flagged",editorPlaceholder:".js_editor-placeholder",replyButton:".js_reply-to-selected-post",editReply:".js_edit-reply",reply:".js_reply",replyBubbleIcon:".js_bubble-icon"}),events:b.extend({},g.prototype.events,{"click @ui.replyButton":"onClickReplyTo","click @ui.replyContent, .js_toggle-descendants":"onClickReplyContent","click .js_pending-reply-switch":"onClickPendingSwitch","click .js_pending-close:first":"onClickPendingClose","click .blurred .img-border":"onClickImageBlur","click @ui.editReply":"onClickEditReply","click .lazy-gif.thawable":"onClickThawImage"}),modelEvents:b.extend({},g.prototype.modelEvents,{"change:liked":"onChangeLiked","change:approved":"onChangeApproved","change:display":"onChangeDisplay","change:flagged":"onChangeFlagged","posttools:post:dismissed":"onDismissed"}),initialize:function(){},onClickReplyTo:function(){var a,c=p.addCommentRegion(this.ui.editorPlaceholder),d=this.model;return this.listenToOnce(c,"editor:post:save",function(c){a=b.extend(c.toJSON(),{_surfaced:!0,_viaEditor:!0}),this.model._commentCollection.unshift(a),k.isOn("sharingfooter")&&f.trigger("newComment",{comment:a})}),l.requireModuleWithCss("module/MarionetteEditor","editor",function(){require(["app/editor/editor.app"],function(a){a.createComment(d)})}),!1},serializeData:function(){var a=this.model.collection,b=l.getKinjaMeta();return{reply:this.model.attributes,pageType:b.pageType,blog:m,discussionType:a.getDiscussionType(),depth:a.getDepth(),starterAuthor:b.post.authorScreenName}},renderBlurs:function(){var b=this.$(".post-content .has-media:not(.blurred)");b.each(function(b,c){o.addImageBlur(a(c))})},renderPostTools:function(){var a=new h({el:this.$(".js_post-dropdown-ct").eq(0),model:this.model,blockedBlogCollection:s.getBlockedBlogCollection(m.id)});q.bindEvents(this,a),a.render(),a.trigger("posttools:checkBlockStatus",{model:a.model,collection:a.blockedBlogCollection}),n.onAuth.done(function(){var b=n.hasRole("OWNER",m.id)||n.hasRole("ADMIN",m.id)||n.hasRole("AUTHOR",m.id);(b||n.isSuperuser())&&m.getFollowedBlogIds().done(function(b){var c=a.$(".js_follow-controls"),d=a.$(".js_followforblog"),e=a.$(".js_unfollowforblog"),f=c.data("sourceblogid"),g=c.data("blogid");f!==g&&(-1!==b.indexOf(g)?(e.removeClass("hide"),d.addClass("hide")):(d.removeClass("hide"),e.addClass("hide")))})}),this.$(".without-dropdown").removeClass("without-dropdown")},onRender:function(){var a=this.model._commentCollection;a&&a.getSurfacedCommentLength()&&this.ui.reply.addClass("expanded"),this.renderMediaEmbeds(),this.model.get("approved")||this.renderBlurs(),this.renderPostTools(),this.showChildrenView(),this.listenTo(t,"followforblog",function(a){a.id===this.model.id&&this.model.set("approved",!0)}),this._renderDeferred.resolve()},onClickReplyContent:function(b){var c=this.model,d=c.collection,f=d.getDiscussionType(),g=c.get("replyCount");return l.clickedOnLink(b)?void 0:this.model.get("_surfaced")&&f!==e.discussionTypes.ALL&&g?a.cookie(w)||this._expanded?(this._toggleDescendants(),!1):(this.showWarning(),!1):!1},onClickEditReply:function(){var a,c=p.addCommentRegion(this.ui.editorPlaceholder),d=this.model;return this.listenToOnce(c,"editor:post:save",function(c){a=b.extend(c.toJSON(),{_surfaced:!0}),this.model.set({display:a.display})}),l.requireModuleWithCss("module/MarionetteEditor","editor",function(){require(["app/editor/editor.app"],function(a){a.editComment(d.get("id"))})}),!1},onClickPendingSwitch:function(){return a.cookie(w,!0),this._toggleDescendants(),!1},onClickPendingClose:function(){return this.warningRegion.reset(),!1},onClickImageBlur:function(a){return o.removeImageBlur(a),!1},onClickThawImage:function(b){b.preventDefault(),t.trigger("thawImage",{$el:a(b.target)})},onChangeLiked:function(){this._renderDeferred.done(function(){this.ui.likeIcon.toggleClass("active",this.model.get("liked"))}.bind(this))},onChangeApproved:function(){this._renderDeferred.done(function(){this.ui.reply.toggleClass("unapproved",!this.model.get("approved"))}.bind(this))},onChangeDisplay:function(){this._renderDeferred.done(function(){this.ui.replyContent.html(this.model.get("display"))}.bind(this))},onChangeFlagged:function(){this._renderDeferred.done(function(){var a=this.model.get("flagged");this.ui.replyFlag.toggleClass("hide",!a),this.ui.replyTools.toggleClass("hide",a)}.bind(this))},onDismissed:function(){this.$el.fadeOut()},_toggleDescendants:function(){var a=this.getChildrenView();this.hideWarning(),this._expanded?(a.hideNestedChildren(),this.ui.reply.removeClass("expanded"),this.ui.replyBubbleIcon.removeClass("icon-bubble-round-x").addClass("icon-bubble-round")):(a.showNestedChildren(),this.ui.reply.addClass("expanded"),this.ui.replyBubbleIcon.removeClass("icon-bubble-round").addClass("icon-bubble-round-x")),this._expanded=!this._expanded},showWarning:function(){this.warningRegion.show(new i({warningType:i.warningTypes.THREAD}))},hideWarning:function(){this.warningRegion.reset("hide")},getChildrenView:function(){if(!this._commentListView){var a=require("module/discussion/view/commentList.view"),b=this.model.getChildren();this._commentListView=new a({collection:b})}return this._commentListView},showChildrenView:function(){this.childrenRegion.show(this.getChildrenView())},renderMediaEmbeds:function(){this._gifImageLoader=new j({el:this.el}),this.$(".twitter-tweet").length&&r.loadTweets(this.el),u(this.$el)}},{slideAnimationTime:200})}),define("templates/tiger/components/discussion/comment-list",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.discussion.commentList=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");var g=new d.StringBuilder("commentlist--depth-",d.$$escapeHtml(a.depth));return g=g.toString(),"ReplyList"==a.discussionType?(f.append('<div class="js_commentlist-wrap--surface"><ul class="commentlist commentlist--surface js_commentlist--surface ',d.$$escapeHtml(g),'"></ul></div><div class="js_commentlist-wrap--nested" style="display: none"><ul class="commentlist commentlist--nested js_commentlist--nested ',d.$$escapeHtml(g),'"></ul></div>'),a.depth<2&&b.components.discussion.replyFooter(null,f,e)):(f.append('<div class="js_commentlist-wrap--nested" style="display: none"><ul class="commentlist commentlist--nested js_commentlist--nested ',d.$$escapeHtml(g),'"></ul>'),b.components.discussion.replyFooter(null,f,e),f.append('</div><div class="js_commentlist-wrap--surface"><ul class="commentlist commentlist--surface js_commentlist--surface ',d.$$escapeHtml(g),'"></ul></div>')),a.depth<1&&(e.features.discovery_pagination&&(e.features.svgicons?(f.append('<a class="js_button--pagination hide">Load more<span class="icon--svg">'),b.icons.essential.chevronBottom(null,f,e),f.append("</span></a>")):f.append('<a class="js_button--pagination button--pagination hide">Load more</a>')),f.append('<div class="js_spinner-wrap spinner-wrap hide row">'),b.components.spinner.bounce(null,f,e),f.append("</div>")),c?"":f.toString()},b.components.discussion.replyFooter=function(a,b){var c=b||new d.StringBuilder;return c.append('	<footer class="reply-footer-bar js_reply-footer-bar hide"><a class="discussion__button js_discussion__button js_load-more-replies hide">Show more replies</a><a class="discussion__button js_discussion__button js_load-all-replies hide">Show more replies in this thread</a><a class="discussion__button js_discussion__button js_close-replies hide">Collapse replies</a></footer>'),b?"":c.toString()}}),define("module/discussion/view/commentList.view",["jquery","backbone.marionette","module/discussion/model/comment.collection","module/discussion/view/comment.layout","singleton/WindowController","singleton/Feature","templates/tiger/components/discussion/comment-list"],function(a,b,c,d,e,f){var g=b.CompositeView.extend({_expanded:!1,className:function(){return"commentlist-wrap "+this.collection.getDiscussionType().toLowerCase()},itemView:d,template:tiger.components.discussion.commentList,ui:{surfaceList:".js_commentlist--surface",surfaceListWrap:".js_commentlist-wrap--surface",nestedList:".js_commentlist--nested",nestedListWrap:".js_commentlist-wrap--nested",repliesFooter:".js_reply-footer-bar",discussionButtons:".js_discussion__button",loadAllRepliesButton:".js_load-all-replies",loadMoreRepliesButton:".js_load-more-replies",closeRepliesButton:".js_close-replies",paginationButton:".js_button--pagination",spinner:".js_spinner-wrap"},events:{"click @ui.loadAllRepliesButton":"onClickLoadAllReplies","click @ui.loadMoreRepliesButton":"onClickLoadMoreReplies","click @ui.closeRepliesButton":"onClickCloseReplies","click @ui.paginationButton":"onClickPaginationButton"},collectionEvents:{sync:"onCollectionSync"},serializeData:function(){var a=this.collection;return{depth:a.getDepth(),discussionType:a.getDiscussionType()}},onRender:function(){var a=this.collection,b=a.getDepth();a.hasMore()&&(b>0&&(this.ui.repliesFooter.removeClass("hide"),this._toggleButtons()),f.isOn("discovery_pagination")&&0===a.getDepth()&&this.showPaginationButton())},appendHtml:function(a,b){var c=b.$el,d=this.collection.getApprovedOnly(),e=b.model.get("_viaEditor")||!1;e?this.ui.surfaceList.prepend(c):(!d||d&&b.model.get("approved"))&&(b.model.get("_surfaced")?this.ui.surfaceList.append(c):this.ui.nestedList.append(c))},_toggleButtons:function(a){var b=this.ui.closeRepliesButton,c=this.ui.loadAllRepliesButton,d=this.ui.loadMoreRepliesButton;this.ui.discussionButtons.addClass("hide"),a?(c.addClass("hide"),b.removeClass("hide"),this.collection.hasMore()&&d.removeClass("hide")):(b.addClass("hide"),d.addClass("hide"),c.removeClass("hide"))},showNestedChildren:function(){var a,b,c=this.collection;a=function(){this.ui.nestedListWrap.slideDown(g.slideAnimationTime),this._toggleButtons(!0),this._expanded=!0,this.$el.addClass("expanded")}.bind(this),b=function(){this.listenToOnce(c,"sync",a),c.fetch({remove:!1})}.bind(this),this._expanded?c.hasMore()&&b():c.length&&c.length-c.getSurfacedCommentLength()?a():b()},hideNestedChildren:function(){this.ui.nestedListWrap.slideUp(g.slideAnimationTime),this._toggleButtons(),this._expanded=!1,this.$el.removeClass("expanded"),this.collection.getDiscussionType()===c.discussionTypes.ALL&&a.scrollTo(this.ui.surfaceList,g.slideAnimationTime)},onClickLoadAllReplies:function(){return this.showNestedChildren(),!1},onClickLoadMoreReplies:function(){return this.showNestedChildren(),!1},onClickCloseReplies:function(){return this.hideNestedChildren(),!1},onClickPaginationButton:function(){this.showSpinner(),this.hidePaginationButton(),this.collection.fetch({remove:!1})},onCollectionSync:function(){var b=this.collection;b.hasMore()&&a(this.ui.repliesFooter).length&&(this.ui.repliesFooter.removeClass("hide"),this._toggleButtons()),f.isOn("discovery_pagination")&&0===b.getDepth()&&(this.hideSpinner(),b.hasMore()?this.showPaginationButton():this.hidePaginationButton())},initializeWaypoint:function(){var a=this.$(".js_spinner-wrap");a.removeClass("hide"),e.registerWaypoint(a,"100%",function(){this._onWaypointReached()}.bind(this))},teardownWaypoint:function(){e.teardownWaypoint(this.$(".js_spinner-wrap"))},_onWaypointReached:function(){var a=this.$(".js_spinner-wrap");e.teardownWaypoint(a),this.collection.fetch({remove:!1}),this.listenToOnce(this.collection,"sync",function(){a.detach(),this.collection.hasMore()&&(this.$el.append(a),this.initializeWaypoint())})},showPaginationButton:function(){this.ui.paginationButton.removeClass("hide")},hidePaginationButton:function(){this.ui.paginationButton.addClass("hide")},showSpinner:function(){this.$el.append(this.ui.spinner.removeClass("hide"))},hideSpinner:function(){this.ui.spinner.detach()}},{slideAnimationTime:200});return g}),define("module/discussion/view/loading.view",["backbone.marionette","templates/tiger/components/spinner","templates/tiger/messages"],function(a){var b=a.ItemView.extend({template:tiger.components.spinner.bounce});return b}),define("view/behaviors/googleAnalytics.behavior",["jquery","underscore","backbone.marionette","lib/amd-wrapped/modernizr","singleton/Feature","singleton/Utils"],function(a,b,c,d,e,f){var g=c.Behavior.extend({events:{"click [data-ga]:not(form)":"onGAClick","submit form[data-ga]":"onGASubmit"},onGAClick:function(b){var c,d=a(b.currentTarget),e=d.closest("a[href]").eq(0);return this.logGAEvent(b),e.length&&(c=e.attr("href"),!/^((http|https):)?\/\//.test(c)||"_blank"===e.attr("target")||b.shiftKey||b.ctrlKey||b.metaKey||(b.preventDefault(),window.setTimeout(function(){window.location.href=c},500))),!0},onGASubmit:function(b){var c=a(b.currentTarget),d=c.attr("action"),e=c.serialize();this.logGAEvent(b),b.preventDefault(),window.setTimeout(function(){window.location.href=d+"?"+e},500)},logGAEvent:function(c){var d=a(c.currentTarget),e=d.attr("data-ga").replace(/[\[\]]/g,"").split(/\s*,\s*/g);e=e.map(function(a){return b.contains(g.validKeys,a)?g.replacePlaceholder(a):a});var f=["send","event"].concat(e);window.ga.apply(this,f)}},{validKeys:["js_pageType","js_pageUrl"],replacePlaceholder:function(a){var b=f.getKinjaMeta();switch(a=a.replace(/js_/g,"")){case"pageType":return b.pageType;case"pageUrl":return window.location.url;default:return""}}});return g}),define("templates/tiger/components/discussion/applet",["overlord","tiger","mantle","lib/amd-wrapped/soyutils"],function(a,b,c,d){b.components.discussion.applet=function(a,c,e){var f=c||new d.StringBuilder;f.append("	");var g=new d.StringBuilder(a.replyCount>1?"View all "+d.$$escapeHtml(a.replyCount)+" replies":"View all replies");return g=g.toString(),f.append('<dl class="reply-filters-tabbed sub-nav-tabbed js_reply-filters-container hide"><dd class="js_permalink-replies permalink-replies js_groupchats__filter hide"><a class="tab-author"><span class="js_author-name">',d.$$escapeHtml(window.kinja.stripHtmlTags(a.permalinkByline,"")),'</span>’s Discussions</a></dd><dd class="js_personalized personalized js_groupchats__filter"><a class="tab-author" data-ga="[Group Chats, click, Author Chat click]"><span class="js_author-name">',d.$$escapeHtml(window.kinja.stripHtmlTags(a.byline,"")),'</span>’s Discussions</a></dd><dd  class="js_allview allview js_groupchats__filter"><a data-ga="[Group Chats, click, All Replies click, __DEFAULT]" title="',d.$$escapeHtml(g),'">All replies</a></dd></dl><div class="js_editor-placeholder js_reply-form-container"></div><div class="js_region--warning"></div><div class="js_flagging-admin-placeholder"></div><div class="js_content-region"></div><div class="js_replycol js_ad300-companion"><div class="js_reply-loading-progress reply-spinner hide">'),b.components.spinner.bounce(null,f,e),f.append('</div><div class="js_disabled-replies reply-prompt-link hide"><span class="icon transparent icon-bubble-right"></span><span class="text-small text-light proxima">'),b.messages.groupchatsRepliesDisabled(null,f,e),f.append('</span></div><div class="js_load-more"></div><div class="text-right reply-views js_reply-views"><a class="js_author-view-footer js_groupchats__filter personalized hide" data-ga="[Group Chats, click, Popular Chat click]">View ',d.$$escapeHtml(a.byline),'\'s discussions</a><a class="js_allview-footer js_groupchats__filter allview hide" data-ga="[Group Chats, click, All Replies click, __DEFAULT]">',d.$$escapeHtml(g),"<a></div></div>"),c?"":f.toString()}}),define("module/DiscussionModule",["jquery","underscore","backbone.marionette","app/MarionetteApp","model/post/Post","module/discussion/model/comment.collection","module/discussion/model/comment.model","module/discussion/view/commentList.view","module/discussion/view/comment.layout","module/discussion/view/warning.view","module/discussion/view/loading.view","module/discussion/discussion.channel","module/flagging/ReplyFlaggingModule","view/behaviors/googleAnalytics.behavior","module/discussion/regionManager/discussionRegionManager","singleton/CurrentBlog","singleton/Utils","singleton/Feature","templates/tiger/components/discussion/applet","templates/tiger/components/groupchats/flagging-admin-link"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){r.isOn("svgicons")&&require(["module/DiscussionIconModule"],function(){});var s,t,u,v,w,x;return v=new e(r.isOn("postmodelcleanup")?q.getKinjaMeta().post:{id:q.getKinjaMeta().post.id}),u=new g(v.attributes),s={personalized:{collection:new f([],{parent:u,discussionType:f.discussionTypes.PERSONALIZED,approvedOnly:!0}),onFacetShow:function(){}},allApproved:{collection:new f([],{parent:u,discussionType:f.discussionTypes.ALL,approvedOnly:!0}),onFacetShow:function(){this.warningRegion.show(new j({warningType:j.warningTypes.COMPLETE,noReplies:0===t.collection.length})),t.collection.loadFlaggedCommentCount().done(function(){var a=m.flagCount(),b={flagCount:a},d=c.Renderer.render(tiger.components.groupchats.flaggingAdminLink,b);a>0&&this.ui.flaggingAdminPlaceholder.append(d)}.bind(this))}},allUnapproved:{collection:new f([],{parent:u,discussionType:f.discussionTypes.ALL,approvedOnly:!1}),onFacetShow:function(){var a=new j({warningType:j.warningTypes.COMPLETE,noReplies:0===t.collection.length});this.warningRegion.show(a),a.toggleFilter()}}},new(w=c.Layout.extend({showFacet:function(a,b){var c,d=a.collection;t=a,c=function(){this.contentRegion.show(new h({collection:t.collection})),t.onFacetShow.call(this),this.toggleFooterLinks()}.bind(this),b&&(this.warningRegion.reset(),this.ui.flaggingAdminPlaceholder.html(""),d.length||d._hasFirstFetched?c():(d.fetch(),this.contentRegion.reset(),this.listenToOnce(d,"sync",c)))},regions:{contentRegion:".js_content-region",warningRegion:".js_region--warning:first"},ui:{replyFilterContainer:".js_reply-filters-container",filterButtons:".js_groupchats__filter",personalizedRepliesButton:".js_personalized",allRepliesButton:".js_allview",permalinkRepliesButton:".js_permalink-replies",disabledReplies:".js_disabled-replies",spinner:".js_loading-layer",editorPlaceholder:".js_editor-placeholder",flaggingAdminPlaceholder:".js_flagging-admin-placeholder",authorViewFooter:".js_author-view-footer",allViewFooter:".js_allview-footer"},events:{"tap @ui.filterButtons":"onClickFilter","tap .js_pending-reply-switch":"onClickPendingSwitch"},behaviors:{GoogleAnalyticsBehavior:{behaviorClass:n}},template:tiger.components.discussion.applet,className:"replies-wrapper",initialize:function(){var b=q.getKinjaMeta(),c=b.postId;b.starterId!==b.postId&&(x=new g({id:c}),s.permalink={collection:new f([],{discussionType:f.discussionTypes.PERMALINK,parent:u,permalinkComment:x,approvedOnly:!1}),onFacetShow:function(){var b=this.$el.find(".reply[data-id="+c+"]").addClass("anchor");b.length&&a.scrollTo(b,250,{offset:-20})}}),this.listenTo(this.contentRegion,"close",function(){this.contentRegion.show(new k)}),this.listenTo(this.contentRegion,"show",function(a){var b=a.collection;b&&(this.$el.parent().css({"min-height":this.$el.outerHeight()}),!r.isOn("discovery_pagination")&&b.hasMore()&&b.getDiscussionType()!==f.discussionTypes.PERMALINK&&a.initializeWaypoint())})},_initializeFallbacks:function(){var a,b;a=[s.personalized,s.allApproved],x&&a.unshift(s.permalink),(b=function(){var c,d=a.shift();d&&(c=d.collection,this.listenToOnce(c,"sync",function(){this.showFacet(d,!0),c.hasMore()||c.length?(d.$button.addClass("active"),this.ui.replyFilterContainer.removeClass("hide")):(d.$button.remove(),d.$footerButton.remove(),b())}),c.fetch({reset:!0}))}.bind(this))()},replyToStarterPost:function(){var a,c=o.addCommentRegion(this.ui.editorPlaceholder);this.listenToOnce(c,"editor:post:save",function(c){a=b.extend(c.toJSON(),{_surfaced:!0,_viaEditor:!0}),this.contentRegion.currentView.collection.unshift(a),r.isOn("sharingfooter")&&l.trigger("newComment",{comment:a})}),q.requireModuleWithCss("module/MarionetteEditor","editor",function(){require(["app/editor/editor.app"],function(a){a.createComment(u)})})},onClickFilter:function(b){var c,d,e=b.currentTarget.className;if(b.preventDefault(),-1===e.indexOf("active")){if(this.contentRegion.currentView.teardownWaypoint(),-1!==e.indexOf("personalized"))c=s.personalized;else if(-1!==e.indexOf("allview"))c=s.allApproved;else{if(-1===e.indexOf("permalink-replies"))return;c=s.permalink}d=c.collection,this.ui.filterButtons.removeClass("active"),c.$button.addClass("active"),this.showFacet(c,!0),a.scrollTo(this.$el,250,{offset:-50})}},onClickPendingSwitch:function(b){var c,d,e=t.collection;return b.preventDefault(),e===s.allApproved.collection?d=s.allUnapproved:e===s.allUnapproved.collection&&(d=s.allApproved),c=d.collection,this.showFacet(d,!0),a.scrollTo(this.$el,250,{offset:-50}),!1},onRender:function(){b.extend(s.personalized,{$button:this.ui.personalizedRepliesButton,$footerButton:this.ui.authorViewFooter}),b.extend(s.allApproved,{$button:this.ui.allRepliesButton,$footerButton:this.ui.allViewFooter}),b.extend(s.permalink,{$button:this.ui.permalinkRepliesButton,$footerButton:this.ui.allViewFooter}),p.getFollowedBlogIds().done(function(){this._initializeFallbacks()}.bind(this)),r.isOn("discovery_pagination")&&this.listenToOnce(this.contentRegion,"show",function(){this.listenToOnce(s.personalized.collection,"pagination:done",this.toggleFooterLinks).listenToOnce(s.allApproved.collection,"pagination:done",this.toggleFooterLinks).listenToOnce(s.allUnapproved.collection,"pagination:done",this.toggleFooterLinks),s.permalink&&this.listenToOnce(s.permalink.collection,"pagination:done",this.toggleFooterLinks)})},toggleFooterLinks:function(){var a=r.isOn("discovery_pagination"),b=t.collection,c=b._hasFirstFetched&&!b.hasMore(),d=!a||a&&c;this.ui.allViewFooter.addClass("hide"),this.ui.authorViewFooter.addClass("hide"),d&&(t.collection.getDiscussionType()===f.discussionTypes.ALL?this.ui.authorViewFooter.removeClass("hide"):this.ui.allViewFooter.removeClass("hide"))},serializeData:function(){var a=u.get("byline")||u.get("author").displayName;return{byline:a,permalinkByline:a,permalink:u.get("permalink"),replyCount:u.get("replyCount")}}}))});