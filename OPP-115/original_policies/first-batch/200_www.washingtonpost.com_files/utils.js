Date.prototype.setISO8601=function(dString){var regexp=/(\d\d\d\d)(-)?(\d\d)(-)?(\d\d)(T)?(\d\d)(:)?(\d\d)(:)?(\d\d)(\.\d+)?(Z|([+-])(\d\d)(:)?(\d\d))/;if(dString.toString().match(new RegExp(regexp))){var d=dString.match(new RegExp(regexp));var offset=0;this.setUTCDate(1);this.setUTCFullYear(parseInt(d[1],10));this.setUTCMonth(parseInt(d[3],10)-1);this.setUTCDate(parseInt(d[5],10));this.setUTCHours(parseInt(d[7],10));this.setUTCMinutes(parseInt(d[9],10));this.setUTCSeconds(parseInt(d[11],10));if(d[12])this.setUTCMilliseconds(parseFloat(d[12])*
1E3);else this.setUTCMilliseconds(0);if(d[13]!="Z"){offset=d[15]*60+parseInt(d[17],10);offset*=d[14]=="-"?-1:1;this.setTime(this.getTime()-offset*60*1E3)}}else this.setTime(Date.parse(dString));return this};
(function($){TWP=window.TWP||{};TWP.Util=TWP.Util||{};TWP.Comments=TWP.Comments||{};TWP.Util.updateMongoDb=function(mData){updateAction=mData.config.action||"get";if($.browser.msie&&window.XDomainRequest){var xdrAction=new XDomainRequest;xdrAction.open(updateAction,mData.config.remoteUrl);xdrAction.onload=mData.config.onSuccess||null;xdrAction.onerror=mData.config.onError||null;xdrAction.send(JSON.stringify(mData.config.data))}else if($.browser.msie&&!window.XDomainRequest)$.getScript("/rw/sites/twpweb/js/plugin/xhr/flXHR.js",
function(data,textStatus,jqxhr){window.flensed.base_path="/rw/sites/twpweb/js/plugin/xhr/";var flproxy=new flensed.flXHR({autoUpdatePlayer:true});flproxy.xmlResponseText=false;flproxy.onreadystatechange=handleLoading;flproxy.onerror=mData.config.onError;flproxy.open(updateAction.toUpperCase(),mData.config.remoteUrl);flproxy.send(JSON.stringify(mData.config.data));function handleLoading(xdrGet){if(xdrGet.readyState==4)mData.onSuccess}});else if(updateAction=="post")thisPost=$.post(mData.config.remoteUrl,
JSON.stringify(mData.config.data),mData.config.onSuccess).error(mData.config.onError);else thisPost=$.get(mData.config.remoteUrl,JSON.stringify(mData.config.data),mData.config.onSuccess).error(mData.config.onError)};TWP.Comments.addSorts=function(data,sortList){if(typeof sortList=="undefined"||sortList.length<=0)sortList=['\x3coption value\x3d"reverseChronological"\x3eNewest First\x3c/option\x3e','\x3coption value\x3d"chronological"\x3eOldest First\x3c/option\x3e','\x3coption value\x3d"likesDescending"\x3eMost Liked\x3c/option\x3e'];
var thisContainer=$(data.target).closest(".echo_container").attr("id");if(wp_e2[thisContainer].includesorts!=false){var thisCommentTarget=$("#"+thisContainer+" .comment-header").attr("rel");var thisSelectTarget=$(".comment-header",$("#"+thisContainer));if(thisSelectTarget.children().length==0)thisSelectTarget=$($(".echo-stream-header",$("#"+thisContainer)).children()[0]);var tab=$("#"+thisContainer+" .tab.active a").length>0?$("#"+thisContainer+" .tab.active a").attr("rel"):wp_e2[thisContainer].defaulttab;
if(thisSelectTarget.length>0&&typeof thisCommentTarget!="undefined"&&$(".comment-sortorder",$("#"+thisContainer)).length==0){var sortElm=$('\x3cdiv class\x3d"comment-sortorder"\x3e'+"Sort:\x26nbsp;\x26nbsp;"+'\x3cselect  class\x3d"comment-sortorder-select"\x3e'+sortList.join("")+"\x3c/select\x3e\x3c/div\x3e");if(thisSelectTarget.hasClass("comment-header"))thisSelectTarget.append(sortElm);else thisSelectTarget.after(sortElm);if(wp_e2[thisContainer][thisCommentTarget].streamSettings[tab].displaysort==
"false")sortElm.hide();else $('.comment-sortorder-select option[value\x3d"'+wp_e2[thisContainer][thisCommentTarget].streamSettings[tab].sortorder+'"]').attr("selected","selected");$(".comment-sortorder-select",$("#"+thisContainer)).change(function(){var thisContainer=$(data.target).closest(".echo_container").attr("id");var thisCommentTarget=$("#"+thisContainer+" .comment-header").attr("rel");var tab=$("#"+thisContainer+" .tab.active a").length>0?$("#"+thisContainer+" .tab.active a").attr("rel"):wp_e2[thisContainer].defaulttab;
wp_e2[thisContainer][thisCommentTarget].streamSettings[tab].sortorder=$(this).attr("value");wp_e2.renderCommentStream(tab,thisContainer,thisCommentTarget)})}}}})(jQuery);