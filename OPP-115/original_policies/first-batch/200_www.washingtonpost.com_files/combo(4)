(function(a){TWP.Util=TWP.Util||{};TWP.Util.User=function(){var e=false;var p=false;var k=null;var i="";var f="";var l=null;var j=false;var g="washington-post";var h=["wapo_display"];var m=["wapo_login_id"];var d=["at"];function q(u,t){var v=-1,r=-1;v=(u.indexOf(t)+t.length+1);r=(l.indexOf(";",v))==-1?l.length:l.indexOf(";",v);return u.substring(v,r).split("|")[0];}function o(){var v,r,A,z=document.cookie.split(";");for(v=0;v<z.length;v++){var r=z[v].substr(0,z[v].indexOf("="));var A=z[v].substr(z[v].indexOf("=")+1);var r=r.replace(/^\s+|\s+$/g,"");if(r=="at"){var u=unescape(A);var t=u.split("=")[3];var w=false;if(t){t=t.split("&")[0];if(t){var w=b(t);}else{return w;}}else{return w;}return(t.length>0&&typeof t=="string"&&w)?t:false;}}}function b(t){var r=t.indexOf("@");var u=t.lastIndexOf(".");if(r<1||u<r+2||u+2>=t.length){return false;}else{return true;}}function n(){var t=document.location.href;if(t.indexOf("localhost")>-1){var v=a.cookie("TWPNIUCID");if(typeof v=="undefined"||v==null){var u=new Date();var r="TWPNI"+u.getTime()+"."+Math.round(Math.random()*10000);u.setTime(u.getTime()+31104000000);a.cookie("TWPNIUCID",r,{domain:TWP.Data.cookie_domain,expires:u,path:"/"});}}if(t.indexOf("beta")>-1){var v=a.cookie("x-split-override");if(v==null||typeof v=="undefined"){var u=new Date();u.setTime(u.getTime()+(1000*60*60*24*30));a.cookie("x-split-override","B",{domain:TWP.Data.cookie_domain,expires:u,path:"/"});a.cookie("X-WP-Split","B",{domain:TWP.Data.cookie_domain,expires:u,path:"/"});}}}function c(){var t=a.cookie("x-split-override");if(typeof t!="undefined"&&t!=null){a.cookie("x-split-override",null,{domain:TWP.Data.cookie_domain,path:"/"});a.cookie("x-split-override",t,{domain:TWP.Data.cookie_domain,path:"/"});}var r=a.cookie("X-WP-Split");if(typeof r!="undefined"&&r!=null){a.cookie("X-WP-Split",null,{domain:TWP.Data.cookie_domain,path:"/"});a.cookie("X-WP-Split",r,{domain:TWP.Data.cookie_domain,path:"/"});}}return{init:function(){var t="";for(var r=0;r<m.length;r++){if(document.cookie.indexOf(m[r])!=-1){p=true;break;}}for(var r=0;r<h.length;r++){if(document.cookie.indexOf(h[r])!=-1){l=document.cookie;g=h[r];break;}}if(p){switch(g){case"fbuname":t=q(l,g,8);break;default:t=q(l,g,9);break;}k=(t.indexOf("@")!==-1)?t.substring(0,t.indexOf("@")):t;k=k.replace(/"/gi,"");i=t;f=o();}n();},getUserCookie:function(){return(l.length>0&&typeof l=="string")?l:null;},getUserType:function(){return(g.length>0&&typeof g=="string")?g:null;},getUserId:function(){return i;},getUserName:function(){return(typeof k=="string")?k:"";},getUserEmail:function(){return(f.length<0||f==false)?null:f;},getAuthentication:function(){return p;}};}();TWP.Util.User.init();})(jQuery);(function($){window.TWP=window.TWP||{};TWP.Identity=TWP.Identity||{};TWP.Identity.paywall=TWP.Identity.paywall||{};TWP.Identity.paywall.requireTracking=true;TWP.server=TWP.server||window.location.href.match(/^.*?:\/\/.*?\//)[0];var isSSL=(window.location.protocol.indexOf("https"))<0?false:true;var currDomain=(TWP.Data&&(TWP.Data.environment=="prod")||TWP.Data.environment=="stage")?".washingtonpost.com":".digitalink.com";var d=new Date();var expireTime=d.setHours(d.getHours()+24);var userCookie="wapo_login_id";var wpatcCookie="WPATC";var actmgmtCookie="wapo_actmgmt";var gmeCookie="wapo_gme";var acqTestCookie="acq_test";var user=$.cookie(userCookie);var wpatc=$.cookie(wpatcCookie);var wapo_actmgmt=$.cookie(actmgmtCookie);var wapo_gme=$.cookie(gmeCookie);var isMobile=(typeof mobile_browser!="undefined"&&mobile_browser===1)?true:false;var tidValues={"main":"sub_s004","home":"s_001","digital":"s_002","gift":"s_003"};var overlays=new Array();overlays[0]={};overlays[1]={overlay:'<div id="wp_Alert" class="simple-overlay" style="overflow: hidden;"><iframe src height="306px" width="460px" scrolling="no" frameborder="0"></iframe></div>',overlayConfig:{top:260,mask:{color:"#000000",loadSpeed:200,opacity:0},bottom:"0px",left:"0px",closeOnClick:true,closeOnEsc:true,load:true,onClose:function(){if(!!window.s&&typeof s.sendDataToOmniture=="function"){var closeVars={"eVar1":s.eVar1,"eVar2":s.eVar2,"eVar6":s.eVar6,"eVar7":"","eVar17":s.eVar17,"eVar60":s.eVar60,"eVar62":s.eVar62,"eVar64":s.eVar64,"eVar65":s.eVar65,"eVar66":s.eVar66};try{s.sendDataToOmniture("close alert","event67",closeVars);}catch(e){}}}},overflowCss:"",closeSelector:"#wp_Alert a.close"};overlays[2]={overlay:'<div id="wp_Signin" class="simple-overlay" style="overflow: hidden;"><a class="close"></a><iframe src height="100%" width="100%" scrolling="no" frameborder="0"></iframe></div>',overlayConfig:{top:260,mask:{color:"#000000",loadSpeed:200,opacity:0.7},top:"center",left:"center",closeOnClick:false,closeOnEsc:false,load:true,onClose:function(){if($(arguments[0].target).is("a.close")){window.location.href="/";}$("body").css("overflow-y","");$(document).unbind("touchmove mousewheel mousemove scroll",_scrollHandler);if(!!window.s&&typeof s.sendDataToOmniture=="function"){var closeVars={"eVar1":s.pageName,"eVar2":s.channel,"eVar5":s.prop3};try{s.sendDataToOmniture("close overlay","event69",closeVars);}catch(e){}}}},overflowCss:"hidden",closeSelector:"#wp_Signin a.close"};overlays[3]={overlay:'<div id="wp_Signin" class="simple-overlay" style="overflow: hidden;"><a class="close"></a><iframe src height="100%" width="100%" scrolling="no" frameborder="0"></iframe></div>',overlayConfig:{top:260,mask:{color:"#000000",loadSpeed:200,opacity:0.7},top:"center",left:"center",closeOnClick:false,closeOnEsc:false,load:true,onClose:function(){if($(arguments[0].target).is("a.close")){window.location.href="/";}$("body").css("overflow-y","");$(document).unbind("touchmove mousewheel mousemove scroll",_scrollHandler);if(!!window.s&&typeof s.sendDataToOmniture=="function"){var closeVars={"eVar1":s.pageName,"eVar2":s.channel,"eVar5":s.prop3};try{s.sendDataToOmniture("close overlay","event63",closeVars);}catch(e){}}}},overflowCss:"hidden",closeSelector:"#wp_Signin a.close"};overlays[4]={overlay:'<div id="wp_Signin" class="simple-overlay" style="overflow: hidden;"><a class="close"></a><iframe src height="100%" width="100%" scrolling="no" frameborder="0"></iframe></div>',overlayConfig:{top:260,mask:{color:"#000000",loadSpeed:200,opacity:0.7},top:"center",left:"center",closeOnClick:true,closeOnEsc:true,load:true,onClose:function(){$("body").css("overflow-y","");$(document).unbind("touchmove mousewheel mousemove scroll",_scrollHandler);if(!!window.s&&typeof s.sendDataToOmniture=="function"){var closeVars={"eVar1":s.pageName,"eVar2":s.channel,"eVar5":s.prop3,"eVar63":"one-time overlay"};try{s.sendDataToOmniture("close overlay","event69",closeVars);}catch(e){}}}},overflowCss:"hidden",closeSelector:"#wp_Signin a.close"};overlays["mobile"]={overlay:'<div id="wp_Alert" class="simple-overlay" style="overflow: hidden;"><iframe src height="100%" width="100%" scrolling="no" frameborder="0"></iframe></div>',overlayConfig:{top:0,mask:{color:"#000000",loadSpeed:200,opacity:0},left:"0px",closeOnClick:true,closeOnEsc:true,load:true,onClose:function(){if(!!window.s&&typeof s.sendDataToOmniture=="function"){var closeVars={"eVar1":s.eVar1,"eVar2":s.eVar2,"eVar6":s.eVar6,"eVar7":"","eVar17":s.eVar17,"eVar60":s.eVar60,"eVar62":s.eVar62,"eVar64":s.eVar64,"eVar65":s.eVar65,"eVar66":s.eVar66};try{s.sendDataToOmniture("close alert","event67",closeVars);}catch(e){}}}},overflowCss:"",closeSelector:"#wp_Alert a.close"};TWP.Identity.omniture={sub:{"-1":"N/A","0":"Unsubscribed","1":"Subscribed"},mtr:{"-1":"Unmetered","1":"Metered","20":"Unmetered: content_type","21":"Unmetered: referer","22":"Unmetered: domain"},tracking:{"wp_evar60":"not available","wp_evar64":"not available","wp_evar65":"not available","wp_evar66":"not available"}};TWP.Identity.setAuthenticationLink=function(data){if(typeof data=="object"){$.extend(TWP.Identity.paywall.pwresp,data.pwresp);}var wrapperElm=$("#utility-wrapper");if(wrapperElm.length<=0){return;}var userName="";var provider="";var currentURL=window.location.href.split("?")[0];if(TWP.server.match(/digitalink\.com|washingtonpost\.com|wpprivate\.com/ig)==null){return;
}TWP.Identity.isSignedIn=TWP.Util.User.getAuthentication();if(TWP.Identity.isSignedIn){userName=TWP.Util.User.getUserName();provider=(typeof TWP.signedInProvider=="function")?TWP.signedInProvider():"Washington Post";provider=(typeof provider!="undefined")?provider.toLowerCase():"";}var freeAccessLink=(TWP.Identity.paywall.pwresp.fr===1)?'<li class="no-right">'+'<a href="'+TWP.signin.free_access+'">GET FREE ACCESS</a>'+"</li>":"";var signinLinks={"pw":{"anon":'<li id="global-signin"style="min-width:32px;">'+'<a href="'+TWP.signin.loginurl_page+currentURL+'">Sign In</a>'+"</li>"+'<li class="no-right"><a href="'+TWP.signin.profileurl+currentURL+'&refresh=true">My Account </a></li>'+freeAccessLink+'<ul class="subscribe-links left">'+'<li class="no-right subscribe"><a href="'+TWP.signin.subscribe+"?oscode=RPWH&tid="+tidValues.main+'&promo=dghpnav">SUBSCRIBE: </a></li>'+'<li ><a href="'+TWP.signin.print_offer+"&tid="+tidValues.home+'&promo=dghpnav">Home Delivery</a></li>'+'<li class="no-right"><a href="'+TWP.signin.digital_offer+"&tid="+tidValues.digital+'&promo=dghpsubtn">Digital</a></li>'+"</ul>","0":"<li>"+((provider.indexOf("facebook")>=0)?'<a class="icon share facebook" ':"<a ")+' href="'+TWP.signin.profileurl+currentURL+'&refresh=true"> Hi, '+userName+"!</a>"+"</li>"+'<li><a href="'+TWP.signin.profileurl+currentURL+'&refresh=true">My Account </a></li>'+'<li class="no-right"><a href="'+TWP.signin.logouturl_page+'">Sign Out</a></li>'+freeAccessLink+'<ul class="subscribe-links left">'+'<li class="no-right subscribe"><a href="'+TWP.signin.subscribe+"?oscode=RPWH&tid="+tidValues.main+'&promo=dghpnav">SUBSCRIBE: </a></li>'+'<li ><a href="'+TWP.signin.print_offer+"&tid="+tidValues.home+'&promo=dghpnav">Home Delivery</a></li>'+'<li class="no-right"><a href="'+TWP.signin.digital_offer+"&tid="+tidValues.digital+'&promo=dghpsubtn">Digital</a></li>'+"</ul>","1":"<li>"+((provider.indexOf("facebook")>=0)?'<a class="icon share facebook" ':"<a ")+' href="'+TWP.signin.profileurl+currentURL+'&refresh=true">Hi, '+userName+"!</a>"+"</li>"+'<li><a href="'+TWP.signin.profileurl+currentURL+'&refresh=true">My Account </a></li>'+'<li class="no-right"><a href="'+TWP.signin.logouturl_page+'">Sign Out</a></li>'+'<ul class="subscribe-links left">'+"</ul>"},"np":{"anon":'<li id="global-signin" style="min-width:32px;">'+'<a href="'+TWP.signin.loginurl_page+currentURL+'">Sign In</a>'+"</li>"+'<li><a href="'+TWP.signin.profileurl+currentURL+'&refresh=true">My Account </a></li>'+'<li id="global-registration" class="no-right" style="margin-right:25px;">'+'<a href="'+TWP.signin.registrationurl_page+currentURL+'">Register</a>'+"</li>","signedin":'<li id="global-signin" style="min-width:32px;">'+((provider.indexOf("facebook")>=0)?'<a class="icon share facebook" ':"<span>Hello </span><a ")+' href="'+TWP.signin.profileurl+currentURL+'&refresh=true">'+userName+"</a>"+"</li>"+'<li><a href="'+TWP.signin.profileurl+currentURL+'&refresh=true">My Account </a></li>'+'<li  id="global-registration" class="no-right" style="margin-right:25px;"><a href="'+TWP.signin.logouturl_page+'">Sign Out</a></li>'}};var linkString="";if(TWP.Identity.paywall.pwresp.sub<0){if(TWP.Identity.isSignedIn){linkString=signinLinks.np.signedin;}else{linkString=signinLinks.np.anon;}}else{if(TWP.Identity.isSignedIn){linkString=signinLinks.pw[TWP.Identity.paywall.pwresp.sub];}else{linkString=signinLinks.pw.anon;}}wrapperElm.find("ul#utility-links.inline-list.left").remove();wrapperElm.prepend('<ul id="utility-links" class="inline-list left">'+linkString+"</ul>");};TWP.Identity.setHandlers=function(){try{$(window.document).on("onTwpLoginComplete",function(event,data){(typeof TWP_Debug!="undefined")&&TWP_Debug.pagedebug&&window.console&&console.log&&console.log(event.type+"fired!");event.stopPropagation();TWP.Util.User.init();TWP.Identity.setAuthenticationLink(data);try{$("body").css("overflow-y","");$("#wp_Signin.simple-overlay").overlay().close();}catch(e){}});}catch(e){}try{$(window.document).on("onTwpMeterReady",function(event,data){if(TWP.Identity.paywall.pwresp.action===0&&TWP.Identity.paywall.pwresp.fr===1&&wapo_gme!=="1"){$.cookie(gmeCookie,"1",{domain:currDomain,expires:new Date(expireTime),path:"/"});_openOverlay(event,{pwresp:{action:4,url:TWP.signin.free_access_overlay}});}});}catch(e){}try{$(window.document).on("onTwpWarningFreeAccess",function(event,data){_openOverlay(event,data);});}catch(e){}try{$(window.document).on("onTwpMastheadComplete",function(event,data){event.stopPropagation();TWP.Identity.setAuthenticationLink();});}catch(e){}try{$(window.document).on("onTwpLoginInit",function(event,data){_openOverlay(event,data);});}catch(e){}};TWP.Identity.auth=function(identityData){var origUrl,origReferrer=document.referrer;if(typeof identityData!="undefined"){origUrl=identityData.url;origReferrer=identityData.referrer;}else{origUrl=(window.originalWashingtonPostURl&&window.originalWashingtonPostURl.substring(window.originalWashingtonPostURl.indexOf(".com/")+4))||location.pathname;origUrl=origUrl+location.search;}try{$.ajax({type:"GET",url:TWP.signin.auth_api_url+(encodeURI(origUrl+((origUrl.indexOf("?")>=0)?"&":"?")+"rplapisplit=1&referrer="+origReferrer)),dataType:"jsonp",timeout:2000,cache:"false"}).always(function(data,status){(typeof TWP_Debug!="undefined")&&TWP_Debug.pagedebug&&window.console&&console.log&&console.log("RegWall action: "+data.pwresp.action+"\nRegWall - url: "+data.pwresp.url+"\n");(typeof TWP_Debug!="undefined")&&TWP_Debug.pagedebug&&window.console&&console.log&&console.log(data);window.console&&console.log&&console.log("PAYWALL CHECK STATUS: "+status);window.console&&console.log&&console.log("PWAPI URL: "+TWP.signin.auth_api_url+(encodeURI(origUrl+((origUrl.indexOf("?")>=0)?"&":"?")+"rplapisplit=1&referrer="+origReferrer)));if(status=="success"&&data&&data.pwresp){window.console&&console.log&&console.log("PAYWALL ACTION: "+data.pwresp.action);window.console&&console.log&&console.log("PAYWALL URL: "+data.pwresp.url);window.console&&console.log&&console.log("PAYWALL SUB: "+TWP.Identity.omniture.sub[data.pwresp.sub]);window.console&&console.log&&console.log("PAYWALL METERED: "+TWP.Identity.omniture.mtr[data.pwresp.mtr]);window.console&&console.log&&console.log("PAYWALL METER COUNT: "+data.pwresp.mtrct);window.console&&console.log&&console.log("PAYWALL MODE: "+data.pwresp.mtfn);$.extend(TWP.Identity.paywall,eval(data));TWP.Identity.setAuthenticationLink();var tmpVal=_getKey(($.cookie(actmgmtCookie)||"").toLowerCase(),"partner");TWP.Identity.omniture.tracking.wp_evar60=(tmpVal==null)?"none":tmpVal;TWP.Identity.omniture.tracking.wp_evar64=(data.pwresp.sub==1)?TWP.Identity.omniture.sub[data.pwresp.sub]:(data.pwresp.action>1)?"overlay":data.pwresp.mtrct;var tmpVal=_getKey(($.cookie(actmgmtCookie)||""),"omniture");TWP.Identity.omniture.tracking.wp_evar65=(tmpVal==null)?"none":tmpVal;TWP.Identity.omniture.tracking.wp_evar66=data.pwresp.mtr;for(trackingVar in TWP.Identity.omniture.tracking){window[trackingVar]=TWP.Identity.omniture.tracking[trackingVar];}_openOverlay(null,data);$(window.document).trigger("onTwpMeterReady");}$(window.document).trigger("onTwpMeterComplete");});}catch(err){$(window.document).trigger("onTwpMeterComplete");}};TWP.Identity.init=function(){if(!TWP.Identity.initComplete&&window.top==window.self){TWP.Identity.setHandlers();_signInInit();$(document).ready(function(){TWP.Identity.auth();TWP.Identity.initComplete=true;});}};var _scrollHandler=function(event){event.stopPropagation();return false;};var _getKey=function(cookieString,cookieKeyValue,valueDelimiter,keyDelimiter){valueDelimiter=(typeof valueDelimiter=="undefined"||!valueDelimiter)?"|":valueDelimiter;keyDelimiter=(typeof keyDelimiter=="undefined"||!keyDelimiter)?":":keyDelimiter;var returnValue=null;if(cookieString==null||typeof cookieString=="undefined"||cookieString.indexOf(valueDelimiter)<0){return returnValue;}var tmpArry=cookieString.split(valueDelimiter);$.each(tmpArry||[],function(key,value){if(value.indexOf(cookieKeyValue)>=0){if(value.indexOf(keyDelimiter)>=0){returnValue=value.split(keyDelimiter)[1];
}}});return returnValue;};var _signInInit=function(){try{if(!user||user.length==0||user==null){}else{if(user&&(!wpatc||wpatc.length==0)||(user&&wpatc&&!wpatc.match(/\:K\=\d+/))){var url=TWP.signin.api_url+"?username="+user;var thisDate=new Date();$.ajax({type:"GET",url:url,dataType:"jsonp",timeout:2000,cache:"false",success:function(data){if(data.K){}}});}}}catch(e){}};var _openOverlay=function(event,data){(typeof TWP_Debug!="undefined")&&TWP_Debug.pagedebug&&window.console&&console.log&&console.log(event.type+"fired!");try{event&&event.stopPropagation();}catch(e){}if(data.pwresp.action===0){return;}try{var obj=$.extend({},TWP.Identity.paywall.pwresp,data.pwresp);var params="";$.each(obj,function(i,v){if(i!="url"){params=params+"&"+i+"="+v;}});var url=data.pwresp.url+((data.pwresp.url.indexOf("?")>=0)?"&":"?")+encodeURI("page="+(!!window.s&&s.eVar1)+"&section="+(!!window.s&&s.eVar2)+"&prev="+(!!window.s&&s.eVar6)+"&geo="+(!!window.s&&s.eVar7)+"&ctype="+(!!window.s&&s.eVar17)+"&signedin="+(!!window.s&&s.eVar62)+"&mcount="+(data.pwresp.mtrct||(TWP.Identity.paywall.pwresp&&TWP.Identity.paywall.pwresp.mtrct))+"&sub="+(data.pwresp.sub||(TWP.Identity.paywall.pwresp&&TWP.Identity.paywall.pwresp.sub))+"&ismetered="+(data.pwresp.mtr||(TWP.Identity.paywall.pwresp&&TWP.Identity.paywall.pwresp.mtr))+params);window.console&&console.log&&console.log("PAYWALL OVERLAY/REDIRECT URL: "+url);if(data.pwresp.action>=3&&_isOverlayDisplayed(data)===false){window.location.href=url+"&acq_test=1";return;}if(typeof overlays[data.pwresp.action].overlay!=="undefined"&&data.pwresp.action>0){(typeof TWP_Debug!="undefined")&&TWP_Debug.pagedebug&&window.console&&console.log&&console.log("Regwall: preparing to display overlay");(typeof TWP_Debug!="undefined")&&TWP_Debug.pagedebug&&window.console&&console.log&&console.log(TWP.Identity.paywall);var thisAction=data.pwresp.action;if(isMobile&&thisAction===1){thisAction="mobile";}var overlay=$(overlays[thisAction].overlay);$("body").css("overflow-y",overlays[thisAction].overflowCss);$("body").prepend(overlay);if(thisAction>1){$(document).on("touchmove mousewheel mousemove scroll",_scrollHandler);}overlay.overlay(overlays[thisAction].overlayConfig);overlay.find("iframe").attr("src",url);}}catch(e){}};var _isOverlayDisplayed=function(data){var displayOverlay=false;if((window.wp_pb&&wp_pb.BrowserInfo&&wp_pb.BrowserInfo.browser=="Explorer"&&wp_pb.BrowserInfo.version<=9)||($.browser&&$.browser.msie&&$.browser.version<=9)){displayOverlay=false;}return displayOverlay;};TWP.Identity.init();})(jQuery);