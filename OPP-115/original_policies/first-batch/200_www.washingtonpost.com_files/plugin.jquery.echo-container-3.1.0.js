(function($){$.fn.buildecho=function(options){return this.each(function(){new $.buildecho(this,options)})};var dserv=window.TWP&&TWP.Data&&TWP.Data.environment=="dev"?"//pb-new-dev.digitalink.com":"//js.washingtonpost.com";var defaults={config:{dserv:dserv,badgeTextUrl:dserv+"/pb/resources/js/echo2/twp/util/html-utils.jsp",echoContainer:"echo_container",badgeTextContainer:"echo-tip-text-container",echoVars:"comment-vars"},commentHeaderTemplate:"\x3c!-- comment header --\x3e"+'\x3cdiv class\x3d"echo-header-container"\x3e'+
'\x3cp class\x3d"comment-count-label"\x3e Comments\x3c/p\x3e'+'\x3cdiv id\x3d"comment-info-links"\x3e'+'\x3cspan class\x3d"discussion-policy"\x3e\x3ca  href\x3d"http://www.washingtonpost.com/blogs/ask-the-post/discussion-and-submission-guidelines/" target\x3d"_policy"\x3eDiscussion Policy\x3c/a\x3e\x3c/span\x3e'+"\x3c/div\x3e"+"\x3c/div\x3e",titleElementTemplate:'\x3cp class\x3d"echo-header-title"\x3e{elementTitle}\x3c/p\x3e',descriptionElementTemplate:'\x3cp class\x3d"echo-header-description"\x3e{elementDescription}\x3c/p\x3e',
counterElement:'\x3cspan class\x3d"echo-counter"\x3e\x3c/span\x3e',submitboxTemplate:"\x3c!--comment stream  --\x3e"+'\x3cdiv id\x3d"echo_stream_container{elementIndex}" class\x3d"echo-stream-container echo-stream"\x3e \x3c/div\x3e'+"\x3c!-- /comment stream --\x3e",streamTemplate:"\x3c!--comment stream  --\x3e"+'\x3cdiv id\x3d"echo_stream_container{elementIndex}" class\x3d"echo-stream-container echo-stream"\x3e \x3c/div\x3e'+"\x3c!-- /comment stream --\x3e",overlayConfig:{mask:{color:"#000000",loadSpeed:200,
opacity:.7},top:"20%",left:"center",closeOnClick:true,closeOnEsc:true,onBeforeLoad:function(){$(this.getTrigger().attr("rel")).find("iframe").attr("src",this.getTrigger().attr("href"))}}};$.buildecho=function(el,options){this.options=$.extend(defaults,options);this.props={};this.init(el)};$.buildecho.fn=$.buildecho.prototype={};$.buildecho.fn.extend=$.buildecho.extend=jQuery.extend;$.buildecho.fn.extend({createDataObject:function(elm){var data={};if(typeof elm.attr("data")!=="undefined"&&elm.attr("data").length>
0){var attrbs=elm.attr("data").split("\x26");for(var i=0;i<attrbs.length;i++)if(attrbs[i]!=""){var valArry=attrbs[i].split("\x3d");data[valArry[0].toLowerCase()]=valArry[1]=="true"?true:valArry[1]=="false"?false:valArry[1]}}else{var attrbs;attrbs=elm[0].attributes;for(var i=0;i<attrbs.length;i++){var thisVal=attrbs[i].nodeValue;data[attrbs[i].nodeName.toLowerCase()]=thisVal=="true"?true:thisVal=="false"?false:thisVal}}return data},init:function(el){var self=this,commentContainers=$(el);if(commentContainers.length==
0)return;commentContainers.each(function(i,echoObj){var echoContainer=$(echoObj);var curDate="";var elementKey="";if(echoContainer.attr("id")==self.options.config.echoContainer){curDate=new Date;elementKey="_"+curDate.getTime()+"_"+Math.floor(Math.random()*1E3);echoContainer.attr("id",self.options.config.echoContainer+elementKey)}else elementKey=echoContainer.attr("id").slice(echoContainer.attr("id").indexOf(self.options.config.echoContainer)+self.options.config.echoContainer.length);if($("#echo-tip-text-container").length==
0)echoContainer.after('\x3cdiv id\x3d"'+self.options.config.badgeTextContainer+'"\x3e\x3c/div\x3e');if($(".badgetext").length==0){var url=self.options.config.badgeTextUrl+"?id\x3d"+(typeof wp_section!="undefined"?wp_section:"")+(typeof wp_subsection!="undefined"?"\x26sectionid\x3d"+wp_subsection:"")+(typeof wp_content_type!="undefined"?"\x26contenttype\x3d"+wp_content_type:"")+(typeof wp_meta_data!="undefined"&&wp_meta_data.contentName&&wp_meta_data.contentName[0]?"\x26columnname\x3d"+wp_meta_data.contentName[0]:
"");self.loadTextFile(url,$("#"+self.options.config.badgeTextContainer))}if(echoContainer.children().length==0){var classList=echoContainer.attr("class").replace(/\s+/g," ").split(" ");var data=self.createDataObject(echoContainer);if(classList.indexOf("stream")>0||classList.indexOf("submitbox")>0){if(data.includeheader!==false)echoContainer.html($(self.options.commentHeaderTemplate));var overlay=$("#comment_policy_overlay");overlay.hide();$("body").prepend(overlay);try{echoContainer.find("a.iframe-overlay").overlay(self.options.overlayConfig)}catch(e){}}$.each(classList,
function(index,value){if(value!=self.options.config.echoContainer&&value!=self.options.config.echoVars){value=value.replace("-","");var thisEcho="";var thisStream="";try{thisStream=self.options[value+"Template"]}catch(e){}if(value=="count")echoContainer.find(".comment-count-label").prepend(self.options["counterElement"]);if(value=="submitbox");if(value=="stream"||value=="submitbox"){if($("#"+"echo_stream_container"+elementKey).length==0){thisEcho=$(thisStream.replace(/{elementIndex}/gi,elementKey));
thisEcho.addClass("echo-canvas")}echoContainer.addClass("canvas");$(echoContainer).append(thisEcho)}}});echoContainer.addClass("comments processed").removeClass("unprocessed")}else echoContainer.addClass("processed").removeClass("unprocessed")})},loadTextFile:function(fileName,thisNode){var request="";request=$.ajax({url:fileName,async:false});thisNode.append($(request.responseText))}})})(jQuery);