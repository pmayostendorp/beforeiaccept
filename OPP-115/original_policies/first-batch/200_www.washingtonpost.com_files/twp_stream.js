(function(jQuery){var $=jQuery;var plugin=Echo.Plugin.manifest("TWP_Stream","Echo.StreamServer.Controls.Stream");if(Echo.Plugin.isDefined(plugin))return;plugin.init=function(){var self=this,item=this.component;var thisContainer=this.config.get("thisContainer");item.config.set("thisContainer",thisContainer)};plugin.config={"thisContainer":"#echo_container"};plugin.events={"Echo.StreamServer.Controls.Stream.onRender":function(topic,data){},"Echo.StreamServer.Controls.Stream.onRerender":function(topic,
data){}};plugin.component.renderers.more=function(element){var self=this.component;this.parentRenderer("more",arguments);var thisContainer=self.config.get("thisContainer");if(wp_e2[thisContainer].display_more===false)element.remove();if(self.data.hasMoreChildren===false)element.append("No more comments.")};plugin.component.renderers.container=function(element){var self=this.component,plugin=this;this.parentRenderer("container",arguments);var thisContainer=self.config.get("thisContainer");var streamSorter=
$(".echo-apps-conversations-streamSorter");if(streamSorter.find(".dropdown-toggle .fa").length==0)streamSorter.find(".dropdown-toggle").append('\x3ci class\x3d"fa fa-caret-down"\x3e\x3c/i\x3e');return element};Echo.Plugin.create(plugin)})(Echo.jQuery);
(function(jQuery){var $=jQuery;var plugin=Echo.Plugin.manifest("TWP_Stream_Item","Echo.StreamServer.Controls.Stream.Item");if(Echo.Plugin.isDefined(plugin))return;plugin.init=function(){var self=this,item=this.component;var thisContainer=this.config.get("thisContainer");item.config.set("thisContainer",thisContainer);if(plugin.methods._ignoreVisible(this.component))this.extendTemplate("insertBefore","buttons",plugin.ignoreUserTemplate);if(thisContainer&&wp_e2[thisContainer]&&wp_e2[thisContainer].includeshare)item.addButtonSpec(this.name,
this._assembleButton("share"));Echo.Labels.set({"childrenMoreItems":"View More Replies"},"Echo.StreamServer.Controls.Stream.Item")};plugin.config={"thisContainer":"#echo_container","includeshare":true,"ignoreuser":true,"verifiedUserMarkers":"verified_preferred","editConfig":{"editMarker":"edited","editText":'\x3cspan class\x3d"edited"\x3e [Edited]\x3c/span\x3e'}};plugin.labels={"share":"Share","ignore_user":"Ignore User","verification_complete":"verification_approved"};plugin.events={"Echo.StreamServer.Controls.Stream.Item.onAdd":function(topic,
data){plugin.methods._markNew(data)},"Echo.UserSession.onInit":function(topic,data){},"Echo.StreamServer.Controls.Stream.Item.Plugins.CommunityFlag.onFlagComplete":function(topic,data){if(data&&data.response.result=="success"&&data.response.skipped.length==0)plugin.methods._processFlag(topic,data)}};plugin.ignoreUserTemplate=function(){return'\x3cdiv class\x3d"{plugin.class:wrapper} {class:buttons} {class:ignore_user}"\x3e'+'\x3ca class\x3d"{class:button}  {plugin.class:ignore_user}"\x3e\x3cspan class\x3d" {class:buttonCaption} ignore-user"\x3eIgnore User\x3c/span\x3e\x3c/a\x3e'+
"\x3c/div\x3e"};plugin.component.renderers.authorName=function(element){var item=this.component;this.parentRenderer("authorName",arguments);var thisContainer=item.config.get("thisContainer");if(plugin.methods._isVerifiedCommenter(thisContainer,item))$(element).html("\x3cspan\x3e"+wp_e2[thisContainer].verifiedcommenteridlist.userArray[item.data.actor.id].name+" ("+item.data.actor.title+")"+"\x3c/span\x3e")};plugin.component.renderers.date=function(element){var plugin=this;var item=this.component;this.parentRenderer("date",
arguments);var thisContainer=item.config.get("thisContainer");var currDate=new Date;var markers=typeof item.data.object.markers!="undefined"?item.data.object.markers.join(","):"";currDate.setISO8601(item.data.object.published);var currDateFmt=currDate.format("h:MM TT Z");var prevDateFmt=currDate.format("m/d/yyyy h:MM TT Z");var thisCommentURL=item.data.object.id;thisCommentURL=thisCommentURL.replace("http://","");var thisCommentPermalink=wp_e2[thisContainer].commentpermalinkurlfacet+"?commentID\x3d"+
thisCommentURL;if(wp_e2[thisContainer]&&wp_e2[thisContainer].includepermalink&&(item.data.target.id!=item.data.target.conversationID&&item.data.target.id==item.data.object.context[0].uri)){var currDatePermalink='\x3ca href\x3d"'+thisCommentPermalink+'"\x3e'+currDateFmt+"\x3c/a\x3e";var prevDatePermalink='\x3ca href\x3d"'+thisCommentPermalink+'"\x3e'+prevDateFmt+"\x3c/a\x3e";currDate.format("m/d/yyyy")==(new Date).format("m/d/yyyy")?$(element).html(currDatePermalink):$(element).html(prevDatePermalink)}else{currDate.format("m/d/yyyy")==
(new Date).format("m/d/yyyy")?$(element).html(currDateFmt):$(element).html(prevDateFmt);thisCommentPermalink=wp_e2[thisContainer].commentpermalinkurlfacet+"?commentID\x3d"+item.data.targets[0].id}var editConfig=this.config.get("editConfig");if(markers.indexOf(editConfig.editMarker)>=0)$(element).append(editConfig.editText);return element};plugin.component.renderers.children=function(element){var item=this.component;this.parentRenderer("children",arguments);if(!TWP.isSignedIn()||TWP.isSignedIn()&&
wapoIdentity&&!wapoIdentity.isMemberOfCommentingGroup())jQuery(item.view.get("plugin-Reply-replyForm")).find("echo-streamserver-controls-submit-body").remove()};plugin.component.renderers.expandChildrenLabel=function(element){var item=this.component;this.parentRenderer("expandChildrenLabel",arguments);return element.append('\x3cspan class\x3d"fa fa-chevron-down"\x3e\x3c/span\x3e')};plugin.renderers.ignore_user=function(element){var plugin=this,item=this.component;var thisContainer=item.config.get("thisContainer");
return element.on("click",function(){var ignoreUser={};ignoreUser.actionData={};ignoreUser.actionData.user_id=wp_e2.echo_user.get("identityUrl");ignoreUser.actionData.action="Ignore";ignoreUser.actionData.target_user_id=item.data.actor.id;ignoreUser.actionData.target_user_name=item.data.actor.title;ignoreUser.actionData.ignoring_date=(new Date).getTime();var mData={};mData.config={"action":"post","remoteUrl":wp_e2.mongoUserActionUrl,"data":ignoreUser.actionData};TWP.Util.updateMongoDb(mData);if(!wp_e2.ignoredUsers)wp_e2.ignoredUsers=
[];wp_e2.ignoredUsers.push(item.data.actor.id);plugin._IgnoreOmniture();plugin._removeIgnoredComments(item,thisContainer)})};plugin.methods._assembleButton=function(name){var plugin=this,item=this.component;var thisContainer=item.config.get("thisContainer");switch(name){case "share":return function(){var item=this;return{"name":name,"label":plugin.labels.get(name),"visible":plugin._shareVisible()}};break;case "ignore_user":return function(){var item=this;var callback=function(){var ignoreUser={};
ignoreUser.actionData={};ignoreUser.actionData.user_id=wp_e2.echo_user.get("identityUrl");ignoreUser.actionData.action="Ignore";ignoreUser.actionData.target_user_id=item.data.actor.id;ignoreUser.actionData.target_user_name=item.data.actor.title;ignoreUser.actionData.ignoring_date=(new Date).getTime();var mData={};mData.config={"action":"post","remoteUrl":wp_e2.mongoUserActionUrl,"data":ignoreUser.actionData};TWP.Util.updateMongoDb(mData);if(!wp_e2.ignoredUsers)wp_e2.ignoredUsers=[];wp_e2.ignoredUsers.push(item.data.actor.id);
plugin._IgnoreOmniture();plugin._removeIgnoredComments(item,thisContainer)};return{"name":name,"label":plugin.labels.get(name),"template":'\x3ca class\x3d"{class:button} {class:ignore_user}"\x3e\x3cspan class\x3d"ignore-user"\x3eIgnore User\x3c/span\x3e\x3c/a\x3e',"visible":plugin._ignoreVisible(),"callback":callback}};break}};plugin.component.renderers.container=function(element){var plugin=this,item=this.component;this.parentRenderer("container",arguments);var thisContainer=item.config.get("thisContainer");
var markerDisplay=wp_e2[thisContainer]&&wp_e2[thisContainer].markerDisplay||{};var classes=[];var postMarkers=[];$.map(item.data.actor.roles||[],function(role){if(role!="")classes.push("echo-item-user-role-"+role)});var markerTranslated="";$.map(item.data.actor.markers||[],function(marker){if(marker!="")if(marker==plugin.config.get("verifiedUserMarkers")&&!plugin._isVerifiedCommenter(thisContainer,item));else{classes.push("echo-item-user-marker-"+marker);markerTranslated=markerDisplay[marker]||"";
postMarkers.push('\x3cdiv class\x3d"marker" title\x3d"'+markerTranslated+'..."\x3e\x3cspan class\x3d"marker echo-item-user-'+marker+'" rel\x3d"#echo-'+marker+'" \x3e\x3c/span\x3e\x3c/div\x3e')}});if(classes.length)$(element).addClass(classes.join(" "));var thisHeader=item.view.get("plugin-CardUIShim-header-box");if(thisHeader&&thisHeader.length>0){$("div.marker",thisHeader).remove();thisHeader.prepend(postMarkers.join(" "));item.view.get("avatar-wrapper").after(thisHeader)}var isIgnoredPoster=false;
if(wp_e2&&typeof wp_e2.ignoredUsers!=="undefined"&&wp_e2.ignoredUsers.length>0)for(var x=0;x<wp_e2.ignoredUsers.length;x++)if(wp_e2.ignoredUsers[x]==item.data.actor.id){isIgnoredPoster=true;break}if(isIgnoredPoster){$(element).addClass("ignored-comment");if(item.children.length>0)$(element).html('\x3cdiv class\x3d"ignored-comment"\x3eYou are ignoring a comment from '+item.data.actor.title+" that has these replies.\x3c/div\x3e");else $(element).empty();return element}if(wp_e2[thisContainer].includevoteofftopic){var thisMarker=
"flag-offtopic";var markerMatchCheck=plugin.methods._markerCheck(item,thisMarker),voteSettings=wp_e2["voteSettings_"+thisMarker]||{};if(markerMatchCheck)if($(element).find("."+voteSettings.markClass+".comment-item-hidden").length==0)$(item.view.get("date")).after('\x3cdiv class\x3d"'+voteSettings.markClass+' comment-item-hidden"\x3e'+voteSettings.markText+"\x3c/div\x3e")}return element};plugin.component.renderers.content=function(element){var item=this.component;this.parentRenderer("content",arguments);
var thisContainer=item.config.get("thisContainer");if(wp_e2[thisContainer].includevoteofftopic){var thisMarker="flag-offtopic",classes=[],voteSettings=wp_e2["voteSettings_"+thisMarker]||{};var markerMatchCheck=plugin.methods._markerCheck(item,thisMarker);if(markerMatchCheck){classes.push(voteSettings.markClass);if(classes.length)$(element).addClass(classes.join(" "))}}};plugin.component.renderers.body=function(element){var item=this.component;item.data.object.content=item.data.object.content||"";
var thisContainer=item.config.get("thisContainer");if(!wp_e2[thisContainer].allow_photos)item.data.object.content=item.data.object.content.replace(/<(img|.echo-item-files)(.|\n)*?>/i,"");if(!wp_e2[thisContainer].allow_videos)item.data.object.content=item.data.object.content.replace(/<(object|embed|iframe|.echo-item-files)(.|\n)*?>/i,"");if(!wp_e2[thisContainer].allow_links)item.data.object.content=item.data.object.content.replace(/<(a)(.|\n)*?>/i,"");this.parentRenderer("body",arguments)};plugin.component.renderers.buttons=
function(element){var item=this.component;this.parentRenderer("buttons",arguments);var thisConfig=this;wp_e2._shareRender(element,thisConfig);if(element.find(".echo-streamserver-controls-stream-item-button-Edit").length>0)if(!plugin.methods._editVisible(item))element.find(".echo-streamserver-controls-stream-item-button-Edit").remove();else{if(item.itemsRefreshInterval)clearInterval(item.itemsRefreshInterval);item.itemsRefreshInterval=setInterval(function(){plugin.methods._refreshItems(item)},3E4)}return element};
plugin.component.renderers.inlineButtons=function(element){var item=this.component;this.parentRenderer("buttons",arguments);var thisConfig=this;wp_e2._shareRender(element,thisConfig);if(element.find(".echo-streamserver-controls-stream-item-button-Edit").length>0)if(!plugin.methods._editVisible(item))element.find(".echo-streamserver-controls-stream-item-button-Edit").remove();else{if(item.itemsRefreshInterval)clearInterval(item.itemsRefreshInterval);item.itemsRefreshInterval=setInterval(function(){plugin.methods._refreshItems(item)},
3E4)}return element};plugin.component.renderers.footer=function(element){var item=this.component;this.parentRenderer("footer",arguments);var thisButtons=item.view.get("buttons");element.find(".echo-streamserver-controls-stream-item-plugin-LikeCardUI-likesArea").insertAfter(thisButtons);return element};plugin.component.renderers.avatar=function(element){var item=this.component;var avatar=item.data.actor.avatar;avatar=(avatar||"").replace("http://akiajc2strzaac3fwsta.post-avatars.s3.amazonaws.com",
"https://s3.amazonaws.com/akiajc2strzaac3fwsta.post-avatars").replace("http://","https://").replace("'",'"');item.data.actor.avatar=avatar;this.parentRenderer("avatar",arguments);var thisElm=element.find("div");var bkg=thisElm.css("background-image");if(bkg){bkg=bkg.split(",")[0];thisElm.css("background-image",bkg)}return element};plugin.methods._removeIgnoredComments=function(item,thisContainer){if(typeof thisContainer=="undefined"||typeof item=="undefined")return;var ignoredUserTitle=item.data.actor.title;
var ignoredElms=$(".echo-streamserver-controls-stream-item-authorName:contains('"+ignoredUserTitle+"')").closest(".echo-streamserver-controls-stream-item-container");$.each(ignoredElms,function(idx,elm){var thisElm=$(elm);if(thisElm.hasClass("echo-streamserver-controls-stream-item-container-root-thread")){thisElm.addClass("ignored-comment");thisElm.html('\x3cdiv class\x3d"ignored-comment"\x3eYou are ignoring a comment from '+ignoredUserTitle+" that has these replies.\x3c/div\x3e")}else thisElm.closest(".echo-streamserver-controls-stream-item ").remove()})};
plugin.methods._publishEventComplete=function(args){var item=this.component;this.events.publish({"topic":args.topic,"data":args.data})};plugin.methods._markerCheck=function(item,thisMarker){var markerSettings=wp_e2.markerSettings,voteSettings=wp_e2["voteSettings_"+thisMarker]||{},markerMatchCheck=false;$.map(item.data.object.markers||[],function(tag,item){if(tag.indexOf(markerSettings.modPrefix+markerSettings.delimiter+voteSettings.flag)>=0||tag.indexOf(markerSettings.userPrefix+markerSettings.delimiter+
voteSettings.flag)>=0)markerMatchCheck=true});return markerMatchCheck};plugin.methods._markNew=function(data){var thisDom=$(data.item.target);thisDom.mouseenter(function(event){thisDom.animate({"border-left-color":"#ffffff","border-left-width":"0"},800,function(){thisDom.removeClass("newComment");thisDom.unbind("mouseenter")})});thisDom.addClass("newComment")};plugin.methods._editVisible=function(item){var timeLimit=wp_e2.editTime*60*1E3;var currDate=new Date;return wp_e2.allowEdit==true&&currDate-
new Date(item.data.postedTime)<timeLimit};plugin.methods._IgnoreOmniture=function(){var debug=wp_e2.debug;var onIgnoreVars={};onIgnoreVars.eVar26="ignore - user";sendDataToOmniture("echo.ignorecomplete","event74",onIgnoreVars);onIgnoreVars.eVar26=""};plugin.methods._shareVisible=function(){var item=this.component;return item.data.target.id!=item.data.target.conversationID};plugin.methods._ignoreVisible=function(item){if(typeof item=="undefined")item=this.component;var readerID=wp_e2&&wp_e2.echo_user&&
wp_e2.echo_user.get("identityUrl");var staffComment=false;var markerArray=item.data.actor.markers||[];for(var x=0;x<markerArray.length;x++)if(markerArray[x].indexOf("staff")>=0||markerArray[x].indexOf("contrib")>=0)staffComment=true;return wp_e2.echo_user.is("logged")&&item.data.provider.name!="Arktan"&&item.data.provider.name!="jskit"&&(readerID&&readerID!=item.data.actor.id)&&!staffComment};plugin.methods._refreshItems=function(item){if(!plugin.methods._editVisible(item)){item.view.render({"name":"buttons"});
clearInterval(item.itemsRefreshInterval)}};plugin.methods._isVerifiedCommenter=function(thisContainer,item){var isVerifiedHere=false;if(wp_e2[thisContainer].includeverifiedcommenters==true)if(wp_e2[thisContainer].verifiedcommenteridlist&&wp_e2[thisContainer].verifiedcommenteridlist.userArray&&wp_e2[thisContainer].verifiedcommenteridlist.userArray[item.data.actor.id]&&wp_e2[thisContainer].verifiedcommenteridlist.userArray[item.data.actor.id].verification_status==plugin.labels.verification_complete)isVerifiedHere=
true;return isVerifiedHere};plugin.methods._processFlag=function(topic,data){var item=data.item,response=data.response,thisMarker=response.markers;var currMarker="",markerClass="",updatedMarkers=[],foundCounter=false;var markerSettings=wp_e2.markerSettings,voteSettings=wp_e2["voteSettings_"+thisMarker]||{};$.each(item.data.object.markers||[],function(index,value){if(value.indexOf(markerSettings.counterPrefix+markerSettings.delimiter+thisMarker)==0){foundCounter=true;currMarker=value;var tempArray=
value.split(markerSettings.delimiter);var tempCount=(parseInt(tempArray[2])||0)+1;updatedMarkers.push(markerSettings.counterPrefix+markerSettings.delimiter+thisMarker+markerSettings.delimiter+tempCount);if(tempCount>=voteSettings.threshold)updatedMarkers.push(markerSettings.votedPrefix+markerSettings.delimiter+thisMarker)}});if(foundCounter){var data='{"verb": "unmark","target": "'+item.data.object.id+'","markers": "'+currMarker+'"}';$.ajax({"url":wp_e2.metaUrl,"data":{"appkey":wp_e2.appkey,"content":data,
"sessionID":wp_e2.echo_user&&wp_e2.echo_user.get("sessionID","")},"dataType":"jsonp"})}else updatedMarkers.push(markerSettings.counterPrefix+markerSettings.delimiter+thisMarker+markerSettings.delimiter+"1");$.each(updatedMarkers||[],function(index,value){var data='{"verb": "mark","target": "'+item.data.object.id+'","markers": "'+value+'"}';$.ajax({"url":wp_e2.metaUrl,"data":{"appkey":wp_e2.appkey,"content":data,"sessionID":wp_e2.echo_user&&wp_e2.echo_user.get("sessionID","")},"dataType":"jsonp"})})};
Echo.Plugin.create(plugin)})(Echo.jQuery);
(function(jQuery){var $=jQuery;var plugin=Echo.Plugin.manifest("TWP_Stream_Item_Top","Echo.StreamServer.Controls.Stream.Item");if(Echo.Plugin.isDefined(plugin))return;plugin.init=function(){var self=this,item=this.component;var thisContainer=this.config.get("thisContainer");item.config.set("thisContainer",thisContainer)};plugin.config={"thisContainer":"#echo_container","showCollapsed":true,"includeShowConversation":true};plugin.component.renderers.content=function(element){var plugin=this,item=this.component,
itemId=plugin.config.get("itemId"),thisContainer=plugin.config.get("thisContainer");this.parentRenderer("content",arguments);if(plugin.config.get("includeShowConversation")!==false)if(item.data.parentUnique.indexOf(item.data.object.context[0].uri)<0&&item.depth==0)$(element).addClass("has-reply-conversation");return element};plugin.component.renderers.container=function(element){var plugin=this,item=this.component,itemId=plugin.config.get("itemId"),thisContainer=plugin.config.get("thisContainer");
this.parentRenderer("container",arguments);if(item.data.object.id==itemId)$(element).parent(".echo-streamserver-controls-stream-item-plugin-CardUIShim-wrapper").addClass("current-comment");if(plugin.config.get("includeShowConversation")!==false)if(item.data.parentUnique.indexOf(item.data.object.context[0].uri)<0&&item.depth==0){var tagValue=item.data.object.tags&&item.data.object.tags[0]&&item.data.object.tags[0].split("_")[1]?item.data.object.tags[0].split("_")[1]:"in reply to ";var replyToTag=' \x3cdiv class\x3d"replyto-link"\x3e'+
'\x3ca class\x3d"replyto" \x3e\x3cspan class\x3d"replyto-text"\x3eShow conversation\x3c/span\x3e'+"\x3c/a\x3e"+"\x3c/div\x3e";$(element).prepend(replyToTag);$(".replyto",$(element)).on("click",function(){plugin._loadReplyConversation(thisContainer,plugin,element,item.data.object.id)})}return element};plugin.component.renderers.authorName=function(element){var plugin=this,item=this.component,itemId=plugin.config.get("itemId"),thisContainer=plugin.config.get("thisContainer");this.parentRenderer("authorName",
arguments);if(item.data.object.id==itemId)$(element).parent(".echo-streamserver-controls-stream-item-plugin-CardUIShim-wrapper").addClass("current-comment");if(plugin.config.get("includeShowConversation")!==false)if(item.data.parentUnique.indexOf(item.data.object.context[0].uri)<0){var tagValue=item.data.object.tags&&item.data.object.tags[0]&&item.data.object.tags[0].split("_")[1]?item.data.object.tags[0].split("_")[1]:"in reply to ";var replyToTag=' \x3cdiv class\x3d"replyto-text"\x3e'+'\x3cspan class\x3d"fa fa-share"\x3e '+
tagValue+"\x3c/span\x3e"+"\x3c/div\x3e";$(element).append(replyToTag)}return element};plugin.component.renderers.subwrapper=function(element){var plugin=this,item=this.component,thisContainer=item.config.get("thisContainer");this.parentRenderer("subwrapper",arguments);if(plugin.config.get("showCollapsed")===false)return;var thisContent=item.view.get("content");if(item.depth==0&&item.children.length>0){if(!thisContent.hasClass("collapsed")&&!thisContent.hasClass("expanded"))thisContent.addClass("collapsible collapsed");
var thisWrapper=item.view.get("subwrapper");thisWrapper.append('\x3cdiv class\x3d"view-replies collapsed"\x3eSee Replies\x3cspan class\x3d"fa fa-chevron-down icon-chevron-down"\x3e\x3c/span\x3e\x3c/div\x3e');thisWrapper.append('\x3cdiv class\x3d"view-replies expanded"\x3eHide Replies\x3cspan class\x3d"fa fa-chevron-up icon-chevron-up"\x3e\x3c/span\x3e\x3c/div\x3e');$(".view-replies",thisWrapper).on("click",function(){if($(this).hasClass("collapsed"))$(this).closest(".echo-streamserver-controls-stream-item-content.collapsible").addClass("expanded").removeClass("collapsed");
else $(this).closest(".echo-streamserver-controls-stream-item-content.collapsible").addClass("collapsed").removeClass("expanded")})}};plugin.methods._loadReplyConversation=function(thisContainer,plugin,element,itemId){var item=plugin.component;var thisContainer=plugin.config.get("thisContainer");var replyConversationTemplate='\x3cdiv class\x3d"reply-conversation expanded" style\x3d"display:none;"\x3e'+'\x3cdiv class\x3d"reply-conversation-buffer"\x3e\x3c/div\x3e'+'\x3cdiv class\x3d"reply-conversation-close"\x3eHide conversation\x3c/div\x3e'+
'\x3cdiv class\x3d"reply-conversation-container"\x3e\x3c/div\x3e'+"\x3c/div\x3e";var $replyConversation=$(replyConversationTemplate);var pluginArray=[];pluginArray=pluginArray.concat([{"name":"Like"},{"name":"CommunityFlagCardUI","showUserList":false},{"name":"CardUIShim","collapsedContentHeight":280,"labels":{"seeMore":"See More"}}]);pluginArray=pluginArray.concat(wp_e2[thisContainer].plugins.streamPluginArray);pluginArray=pluginArray.concat([{"name":"TWP_Stream_Item_Top","thisContainer":thisContainer,
"showCollapsed":false,"itemId":itemId,"includeShowConversation":false}]);var streamConfig=$.extend({},wp_e2[thisContainer].streamSettings,wp_e2[thisContainer].streamSettings.top,{"target":$replyConversation.find(".reply-conversation-container"),"query":wp_e2.getQuery(wp_e2[thisContainer].guid,thisContainer,item.data.targets[0].id,wp_e2[thisContainer].verifiedcommenteridlist.idlist,"top"),"apiBaseURL":wp_e2.apiBaseURL+"/v1/","plugins":pluginArray,"state":{"label":{"icon":false,"text":false}}});var replyStream=
new Echo.StreamServer.Controls.Stream(streamConfig);var eventInfo={"replyStream":replyStream,"thisContainer":thisContainer,"element":element};$replyConversation.find(".reply-conversation-close").on("click",eventInfo,function(event){$(this).parent(".reply-conversation.expanded").slideUp("fast",function(){event.data.element.parents(".echo-streamserver-controls-stream-item-content").slideDown("slow");event.data.replyStream.destroy();$(this).remove()})});$(element).parents(".echo-streamserver-controls-stream-item-content").slideUp("slow",
function(){$(element).parents(".echo-streamserver-controls-stream-item").prepend($replyConversation);$replyConversation.slideDown("slow")})};Echo.Plugin.create(plugin)})(Echo.jQuery);
(function(jQuery){var $=jQuery;var plugin=Echo.Plugin.manifest("TWP_My_Comments","Echo.StreamServer.Controls.Stream.Item");if(Echo.Plugin.isDefined(plugin))return;plugin.init=function(){var self=this,item=this.component;var thisContainer=this.config.get("thisContainer");this.extendTemplate("insertBefore","buttons",plugin.templates.accumulators);item.config.set("thisContainer",thisContainer);if(thisContainer&&wp_e2[thisContainer]&&wp_e2[thisContainer].includeshare)item.addButtonSpec(this.name,this._assembleButton("share"))};
plugin.config={"thisContainer":"#echo_container","includeshare":true,"ignoreuser":true,"zebraCount":0};plugin.labels={"share":"Share"};plugin.events={"Echo.StreamServer.Controls.Stream.Item.onAdd":function(topic,data){},"Echo.StreamServer.Controls.Stream.Item.onButtonClick":function(topic,data){},"Echo.UserSession.onInit":function(topic,data){}};plugin.templates.accumulators=function(){return'\x3cdiv class\x3d"echo-flag-container" style\x3d"display:inline;"\x3e'+'\x3cdiv class\x3d"{plugin.class:likesIndicator}"\x3e\x3c/div\x3e'+
'\x3cdiv class\x3d"{plugin.class:childrenIndicator}"\x3e\x3c/div\x3e'+"\x3c/div\x3e"};plugin.component.renderers.avatar=function(element){$(element).remove()};plugin.component.renderers.authorName=function(element){var item=this.component;this.parentRenderer("authorName",arguments);if(item.data.actor.title==wp_e2.echo_user.get("username"))$(element).html("You");if(item.depth===0)$(element).remove()};plugin.component.renderers.buttons=function(element){var item=this.component;this.parentRenderer("buttons",
arguments);var thisConfig=this;wp_e2._shareRender(element,thisConfig);if(element.find(".echo-streamserver-controls-stream-item-button-Edit").length>0)if(!plugin.methods._editVisible(item))element.find(".echo-streamserver-controls-stream-item-button-Edit").remove();else{if(item.itemsRefreshInterval)clearInterval(item.itemsRefreshInterval);item.itemsRefreshInterval=setInterval(function(){plugin.methods._refreshItems(item)},3E4)}return element};plugin.component.renderers.children=function(element){var item=
this.component;this.parentRenderer("children",arguments);if(!TWP.isSignedIn()||TWP.isSignedIn()&&wapoIdentity&&!wapoIdentity.isMemberOfCommentingGroup())jQuery(item.view.get("plugin-Reply-replyForm")).find("echo-streamserver-controls-submit-body").remove()};plugin.component.renderers.expandChildrenLabel=function(element){var item=this.component;this.parentRenderer("expandChildrenLabel",arguments);var repliesCount=item.data.object.accumulators.repliesCount;if(repliesCount>0)element.css("display","none")};
plugin.renderers.childrenIndicator=function(element){var item=this.component;if(!item.data.object.accumulators.repliesCount){element.remove();return}var repliesCount=item.data.object.accumulators.repliesCount;if(repliesCount>0){var self=item;var extra=extra||{};extra.state=extra.state||"regular";var states={"loading":{"css":"echo-item-message-loading","label":"loading"},"regular":{"css":"echo-linkColor echo-message-icon","label":"childrenMoreItems"}};element.html(repliesCount+(repliesCount>1?" Replies":
" Reply"));element.html('\x3ca href\x3d"javascript:void();"\x3e'+repliesCount+(repliesCount>1?" Replies \x3cspan class\x3d'children-arrow'\x3e\x26#9660;\x3c/span\x3e":" Reply \x3cspan class\x3d'children-arrow'\x3e\x26#9660;\x3c/span\x3e\x3c/a\x3e"));element.addClass("closed").removeClass("open");element.find(".children-arrow").html("\x26#9660;");element.closest(".echo-streamserver-controls-stream-item-content").find(".echo-streamserver-controls-stream-item-children").hide();element.closest(".echo-streamserver-controls-stream-item-content").find(".echo-streamserver-controls-stream-item-expandChildren").hide();
element.bind("click",function(event){event.stopPropagation();if(element.hasClass("open")){element.addClass("closed").removeClass("open");element.find(".children-arrow").html("\x26#9660;");element.closest(".echo-streamserver-controls-stream-item-content").find(".echo-streamserver-controls-stream-item-children").hide();element.closest(".echo-streamserver-controls-stream-item-content").find(".echo-streamserver-controls-stream-item-expandChildren").hide()}else if(element.hasClass("closed")){element.addClass("open").removeClass("closed");
element.find(".children-arrow").html("\x26#9650;");element.closest(".echo-streamserver-controls-stream-item-content").find(".echo-streamserver-controls-stream-item-children").show();element.closest(".echo-streamserver-controls-stream-item-content").find(".echo-streamserver-controls-stream-item-expandChildren").show();element.closest(".echo-streamserver-controls-stream-item-content").find(".echo-streamserver-controls-stream-item-expandChildrenLabel").show();element.closest(".echo-streamserver-controls-stream-item-content").find(".echo-streamserver-controls-stream-item-expandChildrenLabel.echo-streamserver-controls-stream-item-message-loading").hide()}})}else element.remove()};
plugin.renderers.likesIndicator=function(element){var plugin=this,item=this.component;if(!item.data.object.accumulators.likesCount){element.remove();return}var likesCount=item.data.object.accumulators.likesCount;if(likesCount>0){element.css("display","block");element.html(likesCount+(likesCount>1?" Likes":" Like"))}else element.remove()};plugin.component.renderers.container=function(element){var item=this.component;if(item.depth==1)element.find(".echo-item-footer").prepend('\x3cdiv class\x3d"echo-item-authorname"\x3e'+
item.data.actor.title+"\x3c/div\x3e responded on ")};plugin.component.renderers.content=function(element){var item=this.component;this.parentRenderer("content",arguments)};plugin.component.renderers.date=function(element){var item=this.component;this.parentRenderer("date",arguments);var thisContainer=item.config.get("thisContainer");var markers=typeof item.data.object.markers!="undefined"?item.data.object.markers.join():"";var currDate=new Date;currDate.setISO8601(item.data.object.published);var currDateFmt=
currDate.format("h:MM TT Z");var prevDateFmt=currDate.format("m/d/yyyy h:MM TT Z");var isPhoto=typeof item.data.object.markers!="undefined"&&markers.indexOf("photo")>=0;if(wp_e2[thisContainer].includepermalink&&!isPhoto&&(item.data.target.id!=item.data.target.conversationID&&item.data.target.id==item.data.object.context[0].uri)){var thisCommentURL=item.data.object.id;thisCommentURL=thisCommentURL.replace("http://","").replace("https://","");var thisCommentPermalink=item.data.object.context[0].uri;
var currDatePermalink='\x3ca href\x3d"'+thisCommentPermalink+"?commentID\x3d"+thisCommentURL+'"\x3e'+currDateFmt+"\x3c/a\x3e";var prevDatePermalink='\x3ca href\x3d"'+thisCommentPermalink+"?commentID\x3d"+thisCommentURL+'"\x3e'+prevDateFmt+"\x3c/a\x3e";currDate.format("m/d/yyyy")==(new Date).format("m/d/yyyy")?$(element).html(currDatePermalink):$(element).html(prevDatePermalink)}else currDate.format("m/d/yyyy")==(new Date).format("m/d/yyyy")?$(element).html(currDateFmt):$(element).html(prevDateFmt);
this.component.view.get("data").after(element);element.after(this.component.view.get("re"));return element};plugin.component.renderers.re=function(element){var item=this.component;var thisElm=this.parentRenderer("re",arguments);if(typeof thisElm!="undefined")if(item.data.parentUnique.indexOf(item.data.object.context[0].uri)<0){var thisCommentURL=item.data.target.id;thisCommentURL=thisCommentURL.replace("http://","").replace("https://","");var thisCommentPermalink=item.data.object.context[0].uri;thisElm.html(" in reply to "+
'\x3cdiv class\x3d"echo-streamserver-controls-stream-item-re-container"\x3e\x3ca href\x3d"'+thisCommentPermalink+"?commentID\x3d"+thisCommentURL+'"\x3ethis comment\x3c/a\x3e\x3c/div\x3e')}else thisElm.html(" on "+'\x3ca href\x3d"'+item.data.object.context[0].uri+'"\x3e'+item.data.object.context[0].uri+"\x3c/a");return element};plugin.component.renderers.text=function(element){var item=this.component;this.parentRenderer("text",arguments);element.find(".echo-item-photo img").each(function(idx,elm){var img=
$(elm);img.attr("src",img.attr("data-src-preview"));element.find(".echo-item-files").append('\x3cdiv class\x3d"photo-caption"\x3e'+img.attr("alt")+"\x3c/div\x3e");var photo=element.find(".echo-item-photo");photo.attr("rel","#simple-overlay");photo.attr("href",img.attr("data-src-web"));photo.find("a").remove();photo.append(img)})};plugin.methods._assembleButton=function(name){var plugin=this,item=this.component;switch(name){case "share":return function(){var item=this;return{"name":name,"label":plugin.labels.get(name),
"visible":plugin._shareVisible()}};break}};plugin.methods._editVisible=function(item){var timeLimit=wp_e2.editTime*60*1E3;var currDate=new Date;return wp_e2.allowEdit==true&&currDate-new Date(item.data.postedTime)<timeLimit};plugin.methods._shareVisible=function(){var item=this.component;return item.data.target.id!=item.data.target.conversationID};Echo.Plugin.create(plugin)})(Echo.jQuery);
(function($){var plugin=Echo.Plugin.manifest("TWP_Conversations_App","Echo.Apps.Conversations");plugin.init=function(){var self=this,app=this.component;var thisContainer=this.config.get("thisContainer");app.config.set("thisContainer",thisContainer);Echo.Labels.set({"live":"Pause live updates","paused":"Resume live updates"},"Echo.Apps.Conversations")};plugin.config={"thisContainer":"#echo_container","pauseOnReply":true};plugin.events={"Echo.Apps.Conversations.onRender":function(topic,data){var plugin=
this.component;var container=plugin.view.get("container")},"Echo.StreamServer.Controls.Stream.Item.Plugins.ReplyCardUI.onExpand":function(topic,args){try{data.savedStreamingState=this.component.get("streamingState");this.component.setStreamingState("paused")}catch(err){}},"Echo.StreamServer.Controls.Stream.Item.Plugins.ReplyCardUI.onCollapse":function(topic,args){try{data.savedStreamingState?this.component.setStreamingState(data.savedStreamingState):""}catch(err){}},"Echo.StreamServer.Controls.Submit.onReady":function(topic,
args){try{if($(args.target).hasClass("echo-streamserver-controls-submit-plugin-Edit")){data.savedStreamingState=this.component.get("streamingState");this.component.setStreamingState("paused")}}catch(err){}},"Echo.StreamServer.Controls.Submit.Plugins.Edit.onEditError":function(topic,args){try{data.savedStreamingState?this.component.setStreamingState(data.savedStreamingState):""}catch(err){}},"Echo.StreamServer.Controls.Submit.Plugins.Edit.onEditComplete":function(topic,args){try{data.savedStreamingState?
this.component.setStreamingState(data.savedStreamingState):""}catch(err){}}};plugin.component.renderers.container=function(element){var self=this,plugin=this.component;this.parentRenderer("postComposer",arguments);var thisContainer=this.component.config.get("thisContainer");if(wp_e2[thisContainer].includeverifiedcommenters===true)$(element).addClass("verified-commenters");element.off("TWP.Comments.RequestRefresh");element.on("TWP.Comments.RequestRefresh",function(event,data){try{event.stopPropagation();
event.stopImmediatePropagation();if(wp_e2[thisContainer].guid!==data.url){wp_e2[thisContainer].guid=data.url;wp_e2[thisContainer].allow_comments=data.allow_comments||false;var $elm=$("#"+thisContainer);wp_e2._getNotes($elm);wp_e2.renderCommentCount($elm);var allPosts=plugin.getComponent("allPosts");if(typeof allPosts!="undefined")allPosts.destroy();var topPosts=plugin.getComponent("topPosts");if(typeof topPosts!="undefined")topPosts.destroy();var postComposerConfig=plugin.config.get("postComposer");
postComposerConfig.visible=wp_e2[thisContainer].allow_comments;var query=plugin.config.get("allPosts").queryOverride;plugin.config.get("allPosts").queryOverride=query.replace(/childrenof: \S+/,"childrenof: "+data.url);query=plugin.config.get("topPosts").queryOverride;plugin.config.get("topPosts").queryOverride=query.replace(/scope: \S+/,"scope: "+data.url);plugin.config.set("targetURL",data.url);plugin.config.remove("data");plugin.refresh()}jQuery(window.document).trigger("TWP.Comments.RefreshComplete")}catch(e){}})};
plugin.component.renderers.postComposer=function(element){this.parentRenderer("postComposer",arguments);var thisContainer=this.component.config.get("thisContainer");if(wp_e2[thisContainer].allow_comments!=true&&!$("#"+thisContainer).hasClass("permalink"))$(element).prepend($('\x3cdiv class\x3d"closed"\x3e \x3cspan\x3eComments are closed.\x3c/span\x3e\x3c/div\x3e'));return element};plugin.component.renderers.streamingStateContainer=function(element){var thisContainer=this.component.config.get("thisContainer");
if(wp_e2[thisContainer].includepause!==true){$(element).remove();return}this.parentRenderer("streamingStateContainer",arguments);return element};plugin.component.renderers.streamingState=function(element){var thisContainer=this.component.config.get("thisContainer");if(wp_e2[thisContainer].includepause!==true){$(element).remove();return}this.parentRenderer("streamingState",arguments);if(this.component.get("streamingState")=="live")element.append('\x3cspan class\x3d"fa fa-pause"\x3e\x3c/span\x3e');
else element.append('\x3cspan class\x3d"fa fa-play"\x3e\x3c/span\x3e');return element};plugin.component.renderers.topPostsHeader=function(element){this.parentRenderer("topPostsHeader",arguments);$(element).find(".echo-apps-conversations-streamHeader").append('\x3cli class\x3d"pull-right"\x3e\x3cspan\x3e\x3ca class\x3d"fa fa-info-circle" href\x3d"http://www.washingtonpost.com/blogs/ask-the-post/wp/2014/02/27/comments-what-is-a-preferred-commenter/" target\x3d"_new"\x3e\x3c/a\x3e\x3c/span\x3e\x3c/li\x3e')};
plugin.component.renderers._streamSorter=function(element,extra){this.parentRenderer("_streamSorter",arguments);if(element.find(".dropdown-toggle .fa").length==0)element.find(".dropdown-toggle").append('\x3ci class\x3d"fa fa-caret-down icon-chevron-down"\x3e\x3c/i\x3e');element.find(".dropdown-menu").removeClass("pull-right").addClass("pull-left");element.removeClass("pull-right").addClass("pull-left");return element};plugin.component.renderers.allPostsContainer=function(element){this.parentRenderer("allPostsContainer",
arguments);var thisContainer=this.component.config.get("thisContainer");if(wp_e2[thisContainer].includevoteofftopic===true){var thisMarker="flag-offtopic",actionTarget=$(element);var voteSettings=wp_e2["voteSettings_"+thisMarker]||{},offtopicCookie=wp_e2._getCookie(voteSettings.cookie);if($("#"+thisContainer+" .control-"+thisMarker).length==0){if(offtopicCookie=="hiding")$("#"+thisContainer+" .echo-streamserver-controls-stream").addClass(voteSettings.markClass+"-hidden");actionTarget.prepend('\x3cdiv class\x3d"control-'+
thisMarker+'"\x3e'+'\x3cspan class\x3d"comment-'+voteSettings.markClass+"-state "+offtopicCookie+'"\x3e'+(offtopicCookie=="hiding"?voteSettings.controlTextHiding:voteSettings.controlTextShowing)+"\x3c/span\x3e");actionTarget.find(".comment-"+voteSettings.markClass+"-state").bind("click",function(event){event.stopPropagation();var thisTarget=$(event.target);thisContainer=$(this).closest(".echo_container").attr("id");if(thisTarget.hasClass("hiding")){thisTarget.removeClass("hiding").html(voteSettings.controlTextShowing);
$("#"+thisContainer+" .echo-streamserver-controls-stream").removeClass(voteSettings.markClass+"-hidden");var cookieOptions={expires:-1,domain:"."+window.document.domain,path:"/"};wp_e2._setCookie(voteSettings.cookie,null,cookieOptions)}else{thisTarget.addClass("hiding").html(voteSettings.controlTextHiding);$("#"+thisContainer+" .echo-streamserver-controls-stream").addClass(voteSettings.markClass+"-hidden");var cookieOptions={domain:"."+window.document.domain,path:"/"};wp_e2._setCookie(voteSettings.cookie,
"hiding",cookieOptions)}})}}return element};plugin.component.renderers.streamHeader=function(element){this.parentRenderer("streamHeader",arguments);var thisContainer=this.component.config.get("thisContainer");var streamingStateContainer=this.component.view.get("streamingStateContainer");var listContainer=$('\x3cli class\x3d"pull-right"\x3e\x3c/li\x3e').prepend(streamingStateContainer);$(element).append(listContainer);return element};Echo.Plugin.create(plugin)})(Echo.jQuery);
(function($){var plugin=Echo.Plugin.manifest("PageVisibilityDetector","Echo.StreamServer.Controls.Stream");if(Echo.Plugin.isDefined(plugin))return;plugin.events={"Echo.Control.onDestroy":function(){clearInterval(this.component.itemsRefreshInterval)},"Echo.StreamServer.Controls.Stream.onReady":function(){var self=this,stream=this.component,hideTS;this._reactOnPageVisibilityChanges(function(){var curTS=self._getTS();if(curTS-hideTS<2*60)stream&&stream.request&&stream.request.liveUpdates&&stream.request.liveUpdates.start();
else{clearInterval(stream.itemsRefreshInterval);stream&&stream.request&&stream.request.liveUpdates&&stream.request.liveUpdates.start(true)}},function(){hideTS=self._getTS();stream&&stream.request&&stream.request.liveUpdates&&stream.request.liveUpdates.stop()})}};plugin.methods._getTS=function(){return Math.round((new Date).valueOf()/1E3)};plugin.methods._reactOnPageVisibilityChanges=function(onShow,onHide){var self=this;var visProp=this._getHiddenProp();if(visProp){var evtname=visProp.replace(/[H|h]idden/,
"")+"visibilitychange";document.addEventListener(evtname,function(){if(self._isHidden())onHide();else onShow()})}};plugin.methods._getHiddenProp=function(){var prefixes=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var i=0;i<prefixes.length;i++)if(prefixes[i]+"Hidden"in document)return prefixes[i]+"Hidden";return null};plugin.methods._isHidden=function(){var prop=this._getHiddenProp();return prop?document[prop]:false};Echo.Plugin.create(plugin)})(Echo.jQuery);
(function($){var plugin=Echo.Plugin.manifest("PageVisibilityDetectorCount","Echo.StreamServer.Controls.Counter");if(Echo.Plugin.isDefined(plugin))return;plugin.events={"Echo.Control.onDestroy":function(){clearInterval(this.component.itemsRefreshInterval)},"Echo.StreamServer.Controls.Counter.onRender":function(){var self=this,stream=this.component,hideTS;this._reactOnPageVisibilityChanges(function(){var curTS=self._getTS();if(curTS-hideTS<2*60)stream&&stream.request&&stream.request.liveUpdates&&stream.request.liveUpdates.start();
else{clearInterval(stream.itemsRefreshInterval);stream&&stream.request&&stream.request.liveUpdates&&stream.request.liveUpdates.start()}},function(){hideTS=self._getTS();stream&&stream.request&&stream.request.liveUpdates&&stream.request.liveUpdates.stop()})}};plugin.methods._getTS=function(){return Math.round((new Date).valueOf()/1E3)};plugin.methods._reactOnPageVisibilityChanges=function(onShow,onHide){var self=this;var visProp=this._getHiddenProp();if(visProp){var evtname=visProp.replace(/[H|h]idden/,
"")+"visibilitychange";document.addEventListener(evtname,function(){if(self._isHidden())onHide();else onShow()})}};plugin.methods._getHiddenProp=function(){var prefixes=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var i=0;i<prefixes.length;i++)if(prefixes[i]+"Hidden"in document)return prefixes[i]+"Hidden";return null};plugin.methods._isHidden=function(){var prop=this._getHiddenProp();return prop?document[prop]:false};Echo.Plugin.create(plugin)})(Echo.jQuery);