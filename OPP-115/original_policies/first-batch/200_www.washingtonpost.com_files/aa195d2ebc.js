jQuery.fn.extend({getUrlParam:function(strParamName){strParamName=escape(unescape(strParamName));var returnVal=new Array;var qString=null;if($(this).attr("nodeName")=="#document"){if(window.location.search.search(strParamName)>-1)qString=window.location.search.substr(1,window.location.search.length).split("\x26")}else if(typeof $(this).attr("src")!="undefined"){var strHref=$(this).attr("src");if(strHref.indexOf("?")>-1){var strQueryString=strHref.substr(strHref.indexOf("?")+1);qString=strQueryString.split("\x26")}}else if(typeof $(this).attr("href")!=
"undefined"){var strHref=$(this).attr("href");if(strHref.indexOf("?")>-1){var strQueryString=strHref.substr(strHref.indexOf("?")+1);qString=strQueryString.split("\x26")}}else if(typeof $(this).attr("url")!="undefined"){var strHref=$(this).attr("url");if(strHref.indexOf("?")>-1){var strQueryString=strHref.substr(strHref.indexOf("?")+1);qString=strQueryString.split("\x26")}}else return null;if(qString==null)return null;for(var i=0;i<qString.length;i++)if(escape(unescape(qString[i].split("\x3d")[0]))==
strParamName)returnVal.push(qString[i].split("\x3d")[1]);if(returnVal.length==0)return null;else if(returnVal.length==1)return returnVal[0];else return returnVal}});
function PostRecommendsInit(optionsValue){var SLIM_WIDTH=480;var RESIZE_RATE_MS=200;var ITEM_CLICK_WAIT=150;var AJAX_TIMEOUT=6E3;return function($,undefined){var $contentFeedMarker=$(".postrecommends");$contentFeedMarker.addClass("contentfeed");if(!!$contentFeedMarker.length){var $window=$(window),requestMade=false,options=$.extend({"title":"The Post Recommends","separator":"","showSummary":false,"imageSizeSm":"w\x3d300\x26h\x3d200","imageSizeSmAlt":"w\x3d300\x26h\x3d200","imageSizeLg":"w\x3d300\x26h\x3d200",
"loadStripThreshhold":750,"resizeBaseWindow":true,"ajax":{"identity":true,"cache":false}},optionsValue);options.ajax=options.ajax||{};function init(){var FeatureObj=TWP.Features.Page.PostRecommends;if(!requestMade&&$contentFeedMarker.offset().top-options.loadStripThreshhold<=$window.scrollTop()+$window.height()){requestMade=true;$window.off("scroll.load-contentfeed");var itemsPerRow=3,rowsToShow=1,prefetchData=FeatureObj.data,contentFeedUrl=!!window.contentFeedUrl?window.contentFeedUrl:FeatureObj.url,
contentFeedSource=!!window.contentFeedSource?window.contentFeedSource:FeatureObj.source,currentUrl=encodeURIComponent(FeatureObj.canonicalUrl),wapo_login_id=document.cookie.match(/wapo_login_id=([^;]+)/)?RegExp.$1:"",s_vi=document.cookie.match(/s_vi=([^;]+)/)?RegExp.$1:"",prop68=[],prop69=[],prop72="",ad={"positions":{3:false},"slug":"recommended_module"};if(!prefetchData&&options.ajax.identity){if(!!wapo_login_id)contentFeedUrl=updateUrlParam(contentFeedUrl,"wapo_login_id",wapo_login_id);if(!!s_vi)contentFeedUrl=
updateUrlParam(contentFeedUrl,"s_vi",s_vi);if(!!currentUrl)contentFeedUrl=updateUrlParam(contentFeedUrl,"url",currentUrl)}wp_pb.report("contentfeed-postrecommends","api-before",{$target:$contentFeedMarker,options:options});var reqOptions={dataType:"json",url:contentFeedUrl,timeout:AJAX_TIMEOUT,cache:options.ajax.cache,complete:function(jqXHR,textStatus){if(!textStatus.match(/success/)){wp_pb.report("contentfeed-postrecommends","api-error",{jqXHR:jqXHR,textStatus:textStatus});removeModule();s.sendDataToOmniture("post_recommends_failed",
"",{prop72:contentFeedSource+"_na_na_na-failed"})}},success:function(data){wp_pb.report("contentfeed-postrecommends","api-success",{$target:$contentFeedMarker,data:data});if(data==null||(data.results==undefined||data.results==null||!data.results)&&(data.payload==undefined||data.payload==null||!data.payload||data.payload.articles==undefined||data.payload.articles==null||!data.payload.articles)){removeModule();return}var results=data.results||data.payload.articles,contentFeedOutput="",maxToShow=results.length<
3?results.length:3,numbers=["one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve"];if(maxToShow>0){contentFeedOutput+="\x3cdiv class\x3d'content-strip contentfeed'\x3e";contentFeedOutput+="\x3cp class\x3d'heading heading2'\x3e\x3cspan class\x3d'heading2-bar'\x3e\x3c/span\x3e\x3cspan class\x3d'heading2-label'\x3e"+options.title+"\x3c/span\x3e\x3c/p\x3e"}var itemsShown=0;for(var i=0;itemsShown<=maxToShow-1;i++){prop72=(prop72?[prop72,results[i].responsetype]:[results[i].responsetype]).join(",");
var result=results[i],headline=!!result.title?result.title:result.headline,summary=options.showSummary&&!!result.summary?result.summary:"",isAdPosition=!!ad.positions[itemsShown+1],position=itemsShown%itemsPerRow,positionClass=" "+numbers[itemsShown],firstClass=itemsShown==0?" first":"",firstInRowClass=position==0?" first-in-row":"",lastClass=itemsShown==maxToShow-1?" last":"",lastInRowClass=position==itemsPerRow-1?" last-in-row":"",hasSummary=!!result.summary,hasSummaryDisplay=hasSummary?"with-summary":
"without-summary",hasMethodePhoto=isAdPosition||!!result.photo&&!!result.photo.path&&result.photo.path.match(/\/rf\/image_/),hasOtherPhoto=isAdPosition||!!result.photo&&!!result.photo.path||!!result.image,hasPhoto=hasMethodePhoto||hasOtherPhoto,hasPhotoDisplay=hasPhoto?"with-photo":"without-photo",contentUrl=!!result.url?result.url.split("?")[0]:result.displayUrl.split("?")[0],linkUrl=contentUrl+"?tid\x3d"+(result.responsetype?result.responsetype:contentFeedSource+"_"+(itemsShown+1)),clickUrl=!!result.clickUrl?
result.clickUrl:"",responseType=!!result.responsetype?result.responsetype:!!contentFeedSource?contentFeedSource:"unknown",itemsStillInData=results.length-i,itemsStillToRender=maxToShow-itemsShown,isCurrentPage=FeatureObj.canonicalUrl==contentUrl,isItemEligible=isAdPosition||itemsStillToRender==itemsStillInData,isSponsoredContent=contentUrl.match(/brand-connect/),sponsoredClass=isAdPosition||isSponsoredContent?" is-sponsored-content":"";results[i]._responseType=responseType;results[i]._contentUrl=
contentUrl;var tplContentImage=function(dimSm1Value,dimSm2Value){var value="";var dim1=dimSm1Value||"w\x3d200\x26h\x3d133";var dim2=dimSm2Value||"w\x3d200\x26h\x3d133";var pdim1=dim1.split("\x26");var pdim2=dim2.split("\x26");var fdim1=[pdim1[0].match(/[0-9]+/g),"x",pdim1[1].match(/[0-9]+/g)].join("");var fdim2=[pdim2[0].match(/[0-9]+/g),"x",pdim2[1].match(/[0-9]+/g)].join("");if(hasMethodePhoto)value+='\x3ca class\x3d"rec-img" href\x3d"'+linkUrl+'" data-click-href\x3d"'+clickUrl+'" data-index-0\x3d"'+
i+'"\x3e\x3cimg class\x3d"main-art unprocessed" src\x3d"https://img.washingtonpost.com/wp-apps/imrs.php?src\x3d'+encodeURIComponent(result.photo.path.replace(/\/image_\d+[xwh]\d*\//,"/image_"+fdim1+"/").replace(/www.washingtonpost.com/,"img.washingtonpost.com"))+"\x26"+dim1+'" data-low-res-src\x3d"https://img.washingtonpost.com/wp-apps/imrs.php?src\x3d'+result.photo.path.replace(/\/image_\d+[xwh]\d*\//,"/image_"+fdim1+"/").replace(/www.washingtonpost.com/,"img.washingtonpost.com")+"\x26"+dim1+'" data-sm2-src\x3d"https://img.washingtonpost.com/wp-apps/imrs.php?src\x3d'+
encodeURIComponent(result.photo.path.replace(/\/image_\d+[xwh]\d*\//,"/image_"+fdim2+"/").replace(/www.washingtonpost.com/,"img.washingtonpost.com"))+"\x26"+dim2+'" data-low-res-src\x3d"https://img.washingtonpost.com/wp-apps/imrs.php?src\x3d'+result.photo.path.replace(/\/image_\d+[xwh]\d*\//,"/image_"+fdim1+"/").replace(/www.washingtonpost.com/,"img.washingtonpost.com")+"\x26"+dim1+'" data-hi-res-src\x3d"https://img.washingtonpost.com/wp-apps/imrs.php?src\x3d'+result.photo.path.replace(/\/image_\d+[xwh]\d*\//,
"/image_300x200/").replace(/www.washingtonpost.com/,"img.washingtonpost.com")+"\x26"+dim1+'"\x3e\x3c/a\x3e';else if(hasOtherPhoto){var img=!!result.photo?result.photo.path:result.image;value+='\x3ca class\x3d"rec-img" href\x3d"'+linkUrl+'" data-click-href\x3d"'+clickUrl+'" data-index-0\x3d"'+i+'"\x3e\x3cimg class\x3d"main-art unprocessed" src\x3d"https://img.washingtonpost.com/wp-apps/imrs.php?src\x3d'+encodeURIComponent(img.replace(/www.washingtonpost.com/,"img.washingtonpost.com"))+"\x26"+dim1+
'" data-sm2-src\x3d"https://img.washingtonpost.com/wp-apps/imrs.php?src\x3d'+encodeURIComponent(img.replace(/www.washingtonpost.com/,"img.washingtonpost.com"))+"\x26"+dim2+'"\x3e\x3c/a\x3e'}return value};if(isItemEligible){itemsShown+=1;if(isAdPosition)i-=1;prop68.push(hasSummaryDisplay+"-displayed");prop69.push(hasPhotoDisplay+"-displayed");contentFeedOutput+='\x3cdiv class\x3d"content-item'+firstClass+firstInRowClass+lastClass+lastInRowClass+positionClass+sponsoredClass+" "+hasPhotoDisplay+" "+
hasSummaryDisplay+'"\x3e';if(isAdPosition){trendingStripOutput+='\x3cdiv class\x3d"sponsorship-admonition"\x3e\x26nbsp;\x26nbsp;Sponsored Content \x3ci class\x3d"info-icon"\x3e\x3c/i\x3e\x3cspan class\x3d"bc-info-popup"\x3eBrandConnect\x26raquo; is content provided by our advertisers. \x3ca rel\x3d"nofollow" href\x3d"//www.washingtonpost.com/sf/brand-connect/"\x3eLearn more.\x3c/a\x3e\x3c/span\x3e\x3c/div\x3e';trendingStripOutput+='\x3cdiv id\x3d"slug_'+ad.slug+'" class\x3d"'+ad.slug+'" data-ad-type\x3d"pb-ad-container"\x3e';
trendingStripOutput+='\x3cscript type\x3d"text/javascript" language\x3d"Javascript"\x3eplaceAd2({what: "'+ad.slug+'"});\x3c/script\x3e';trendingStripOutput+="\x3c/div\x3e"}else{if(isSponsoredContent)contentFeedOutput+='\x3cdiv class\x3d"sponsorship-admonition"\x3e\x26nbsp;\x26nbsp;Sponsored Content \x3ci class\x3d"info-icon"\x3e\x3c/i\x3e\x3cspan class\x3d"bc-info-popup"\x3eBrandConnect\x26raquo; is content provided by our advertisers. \x3ca rel\x3d"nofollow" href\x3d"//www.washingtonpost.com/sf/brand-connect/"\x3eLearn more.\x3c/a\x3e\x3c/span\x3e\x3c/div\x3e';
if(firstClass)contentFeedOutput+=tplContentImage(options.imageSizeLg);else if("right"!==options.imagePosition)contentFeedOutput+=tplContentImage(options.imageSizeLg);contentFeedOutput+='\x3ca class\x3d"item-caption" href\x3d"'+linkUrl+'" data-click-href\x3d"'+clickUrl+'" data-index-0\x3d"'+i+'"\x3e';contentFeedOutput+='\x3cp class\x3d"heading heading3"\x3e'+headline+"\x3c/p\x3e";if(summary)contentFeedOutput+='\x3cp class\x3d"summary"\x3e'+summary+"\x3c/p\x3e";contentFeedOutput+="\x3c/a\x3e";if(!firstClass&&
"right"===options.imagePosition)contentFeedOutput+=tplContentImage(options.imageSizeSm,options.imageSizeSmAlt)}contentFeedOutput+=options.separator+"\x3c/div\x3e"}}if(maxToShow>0){contentFeedOutput+='\x3cdiv class\x3d"clear"\x3e\x3c/div\x3e';contentFeedOutput+="\x3c/div\x3e"}if(!!contentFeedOutput){$contentFeedMarker.empty().append(contentFeedOutput);if(!!window.wp_pb&&!!wp_pb.report)wp_pb.report("global","domChanged",this);$("img.unprocessed",$contentFeedMarker).each(function(i){var $this=$(this);
var src="";if($contentFeedMarker.width()>480){src=$this.attr("data-hi-res-src");$this.attr("src",src)}else;$this.removeClass("unprocessed")});if(!!window.s&&!!s.sendDataToOmniture)s.sendDataToOmniture("post_recommends_loaded","",{prop68:prop68.join(","),prop69:prop69.join(","),prop72:prop72});$("a",$contentFeedMarker).on("click",function(ev){var $target=$(ev.target),$a=$target.closest("a");if(!!$a.attr("data-click-href"))$a.attr("href",$a.attr("data-click-href"));if(!!window.s&&!!s.sendDataToOmniture){var clickedItemHasPhoto=
!!$target.closest("div.content-item.with-photo").length,clickedItemHasSummary=!!$target.closest("div.content-item.with-summary").length;var p68=(clickedItemHasSummary?"with-summary":"without-summary")+"-clicked",p69=(clickedItemHasPhoto?"with-photo":"without-photo")+"-clicked";s.sendDataToOmniture("post_recommends_clicked","",{prop68:p68,prop69:p69})}ev.preventDefault();var promise=$.Deferred();promise.done(function(){var url=$a.attr("href");if(url)window.location=url});var result=results[$a.attr("data-index-0")];
wp_pb.report("contentfeed-postrecommends","item-click",{$target:$contentFeedMarker,$link:$a,promise:promise,result:result,contentUrl:result._contentUrl,responseType:result._responseType});setTimeout(function(){promise.resolve()},ITEM_CLICK_WAIT);return false})}$.each(data.results,function(rIndex,result){result.$item=$contentFeedMarker.find("[data-index-0]").eq(rIndex+1)});wp_pb.report("contentfeed-postrecommends","loaded",{$target:$contentFeedMarker,data:data})}};if(!prefetchData)$.ajax(reqOptions);
else{reqOptions.success(prefetchData);reqOptions.complete(null,"success")}}}function attach(initAttach){$window.on("scroll.load-contentfeed",function(){if(initAttach)initAttach();init()});if(isInView($(".contentfeed")[0]))$(window).trigger("scroll.load-contentfeed")}function applyAltOptions(optionsValue){options.separator='\x3cspan class\x3d"contentfeed-sep"\x3e\x3c/span\x3e';options.imagePosition="right";options.showSummary=true;var opt=optionsValue||{};$.extend(options,opt)}function slim(){var result=
(options.resizeBaseWindow?window.outerWidth||window.innerWidth:$contentFeedMarker.width())<=SLIM_WIDTH;$contentFeedMarker.toggleClass("cf-slim-false",!result).toggleClass("cf-slim-true",result);return result}function isInView(el){var rect=el.getBoundingClientRect();var h=$(el).height();return rect.top+h>=0&&rect.bottom-h<=(window.innerHeight||document.documentElement.clientHeight)}function switchImageSrc(attr,$images){return!!attr&&$images.each(function(){var $el=$(this);if(!$el.attr("data-sm1-src"))$el.attr("data-sm1-src",
$(this).attr("src"));$el.attr("src",$el.attr(attr))})}function applyMainArtBg($target){var $style=$target.data("_styleBgMainArt");var $mainArt=$target.find(".content-item.first img.main-art");var src;if(src=$mainArt.attr("src")){if($style)$style.remove();$style=$("\x3cstyle\x3e"+".cf-slim-false.cf-alt1-true .content-strip.contentfeed .content-item.first .rec-img {"+"background-image: url("+src+");"+"}"+"\x3c/style\x3e");$target.prepend($style);$target.data("_styleBgMainArt",$style)}}function debounce(func,
wait,immediate){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate)func.apply(context,args)};var callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow)func.apply(context,args)}}function updateUrlParam(url,key,value){var n=new RegExp("([?\x26])"+key+"\x3d.*?(\x26|$)","i");var i=-1!==url.indexOf("?")?"\x26":"?";return url.match(n)?url.replace(n,"$1"+key+"\x3d"+value+"$2"):url+i+key+"\x3d"+value}function removeModule(){var rm=
$contentFeedMarker.closest(".pb-feature").remove();if(!rm.length)rm=$contentFeedMarker.remove();return rm}$(function anonymousAttacher(){if(!!window.localStorage&&window.localStorage.getItem("PostRecommends-disabled")){removeModule();return}var _attached=false;attach(function(){if(!!_attached)return;_attached=true;var preSlim=slim();applyAltOptions({imageSizeSm:preSlim?"w\x3d60\x26h\x3d60":"w\x3d138\x26h\x3d92",imageSizeSmAlt:preSlim?"w\x3d138\x26h\x3d92":"w\x3d60\x26h\x3d60",imageSizeLg:"w\x3d270\x26h\x3d195"});
wp_pb.register("contentfeed-postrecommends","loaded",function(params){applyMainArtBg(params.$target);$(window).off("resize.contentfeed").on("resize.contentfeed",debounce(resizehandler,RESIZE_RATE_MS));resizehandler()});function resizehandler(){var resizeSlim=slim();var $images=$contentFeedMarker.find(".content-item:not(.first-in-row) .rec-img img.main-art");var attr=preSlim?resizeSlim?"data-sm1-src":"data-sm2-src":resizeSlim?"data-sm2-src":"data-sm1-src";switchImageSrc(attr,$images);if(resizeSlim)$contentFeedMarker.removeClass("cf-alt1-true").addClass("cf-alt1-false").removeClass("cf-sidebar_alt1-false").addClass("cf-sidebar_alt1-true");
else $contentFeedMarker.removeClass("cf-alt1-false").addClass("cf-alt1-true").removeClass("cf-sidebar_alt1-true").addClass("cf-sidebar_alt1-false")}})})}return $contentFeedMarker}(jQuery)};