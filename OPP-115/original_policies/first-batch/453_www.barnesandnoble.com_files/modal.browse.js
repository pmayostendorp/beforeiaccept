/*! BARNES-BUILDER 2015-06-29 */
BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.Base=BN.Modal.Browse.Base||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.Base")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/search/"}},a}(),BN.Modal.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.BulkOrderSearch=BN.Modal.Browse.BulkOrderSearch||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.BulkOrderSearch")};return a.prototype={tplName:"bulk-order-search",defaultOptions:{useCache:!1},currentIndex:0,firstAdd:!1,initView:function(){{var a=this;$(this.modal),$(this.data.target)}this.on("display",function(){var b=$("#resultsMainContainer"),c=$("#frmBulkSearch");b.hide(),$("#bulkSearchFilterSelect").selectBox(),c.find(".selectBox-dropdown .selectBox-label").attr("style","width: 114px !important"),BN.uXHR.Form.apply(c),c.on("amplifiFormSuccess",function(b,c){a.displayResults(c.redirectUrl)}).on("amplifiFormBeforeSubmit",function(){a.unready()}),""!=$("#txtBulkSrch").val()?c.find("#bulkSearchSubmit").click():$(".loading-indicator-holder").hide()})},unready:function(){this.$spinner&&this.$spinner.length>0&&this.$spinner.remove(),$(".loading-indicator-holder").show(),$("#resultsMainContainer").hide(),this.displaySpinner()},ready:function(){$("#resultsMainContainer").show(),$(".loading-indicator-holder").hide(),this.$spinner.remove()},addItem:function(){var a=$(this.data.target);that=this,0==that.currentIndex&&(that.currentIndex=a.attr("id").split("_")[1]),$("#resultsMainContainer").find(".add-isbn-info a").on("click",function(){var b=$(this);if("Added"!=b.html()){{a.parents("li:first")}if(that.firstDone){var c=$(".bulk-order-container section.quote-items");c.find("a.add-item").click(),that.currentIndex=parseInt(that.currentIndex)+1;var d=c.find("#search_"+that.currentIndex);that.fillValues(d,b)}else that.firstDone=!0,that.fillValues(a,b);b.html("Added").removeClass("btn").addClass("not-active")}})},displayResults:function(a){var b=this;$("#resultsMainContainer").load(a,function(){$(this).html($("#resultsListContainer").html()),b.initOpeners(),b.ready(),b.addItem(),b.paginate(),b.close()})},fillValues:function(a,b){var c=a.parents("li:first"),d=c.find("[id^='item_title']"),e=c.find("[id^='item_isbn']"),f=b.data("isbn-id"),g=b.data("title");a.hide(),a.siblings().show(),d.val(g),e.val(f)},paginate:function(){var a=this;$("#resultsMainContainer").find("li.pagination ul li a").on("click",function(b){b.preventDefault(),a.unready();var c=$(this).attr("href");a.displayResults(c)})},close:function(){$("#sectionBulkSrch div.confirm .btn").on("click",function(){that.Close()})}},a}(),BN.Modal.Browse.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.Formats=BN.Modal.Browse.Formats||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.Formats")};return a.prototype={tplName:"allFormats",defaultOptions:{useCache:!1},initView:function(){var a=this,b=$dom=$(this.modal),c=($(this.data.target).attr("id"),$(this.data.target).attr("data-formatsUrl")),d=$("body").hasClass("pdpPage"),e=($(this.data.target).data("formats-edition")?$(this.data.target).data("formats-edition"):!1,$(this.data.target).attr("data-product-id")||$(this.data.target).attr("id")),f=$(this.data.target).data("work-id"),g=$(this.data.target).attr("data-sku-id"),h=$(this.data.target).attr("data-digital-ean"),i=($(this.data.target).attr("data-total-formats"),$(this.data.target).attr("data-ismarketplace"));this.displaySpinner(),this.on("display",function(){b.find("#pdpModalContent").load(c,function(){b.find("#otherAvailableFormatsContainer .actions form span").hide(),a.$spinner.remove(),b.find(".tabgroup section:nth-of-type(n + 2)").css("display","none"),b.find(".alt-format").hide(),("false"==d||0==d)&&(b.find("#qvTitleBar li:first").siblings().find("a#open-prod-details").show(),("true"==i||1==i)&&b.find("#qvTitleBar li:first").siblings().find("a.open-marketplace").show()),b.find(".tabgroup h3:first-child a").addClass("activeTab"),b.find(".tabgroup h3:first-child").next("section").show(),b.find(".tabgroup h3 a").on("click",function(a){a.preventDefault(),b.find(".tabgroup section").css("display","none"),$(this).parent().next("section").css("display","block"),b.find(".tabgroup h3 a").each(function(){$(this).removeClass("activeTab")}),$(this).addClass("activeTab")}),$(".format-list-container").on("scroll",function(c){var d=$(c.currentTarget),e=$(this).find(".section-items"),i=e.attr("data-total-items"),j=e.attr("data-format-type");if(d[0].scrollHeight-d.scrollTop()==d.outerHeight()){var k=e.children().length,l=parseInt(e.children().last().attr("data-start")),m=parseInt(e.children().last().attr("data-end"));i>k&&(l+=10,m+=10,$.ajax({url:"/cartridges/ProductDetailContent/ProductDetailTypes/includes/all-format-list-content.jsp",type:"get",cache:!1,data:{skuId:g,workId:f,digitalEan:h,format:j,start:l,end:m},dataType:"html",beforeSend:function(){a.displaySpinner()}}).done(function(c){e.append(c),attachCartAction(!0),b.find("#otherAvailableFormatsContainer .actions form span").hide(),setTimeout(function(){a.$spinner.remove()},500)}))}}),attachCartAction(!0)});var j=this.flow().get("quickview"),k=b.find("#open-prod-details"),l=a.flow().get("marketplace"),m=$(a.modal).find(".open-marketplace");l&&l.pureModal?(m.removeAttr("data-sku-id"),m.removeAttr("data-product-id"),m.removeAttr("data-modal-class"),m.removeAttr("data-formats-edition"),m.attr("data-crumb","marketplace"),m.each(function(){a.__initCrumbEvent(this)})):(m.attr("data-sku-id",g),m.attr("data-product-id",e),m.attr("data-work-id",f),m.attr("data-modal-class","BN.Modal.Browse.Marketplace"),m.attr("data-formats-edition","true"),m.attr("data-formatsUrl",c),m.attr("data-ismarketplace",i)),j&&j.pureModal&&(this.__initCrumbEvent(k.attr("data-crumb","quickview").get(0)),$dom.find("#qvTitleBar").on("click","a#open-prod-details",function(a){a.preventDefault(),showProductDetails($(j.modal)),$("#pdpModalContent").show()})),a.initOpeners(),b.on("click",".close-modal",function(a){a.preventDefault();var b=Modal.prototype.openModals;for(var c in b){var d=b[c];d&&d.Close&&d.Close()}}),b.on("click",".potterMoreModal",function(b){b.preventDefault(),new BN.Modal.Browse.PDP.PottermoreBuy(null,{target:{id:$(this).attr("id"),href:$(this).attr("href")}},null,a)})})}},a}(),BN.Modal.Browse.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.ISBN=BN.Modal.Browse.ISBN||Extend(function(){var a=function(a,b){this.data=b,consoleLog("Instantiating BN.Modal.Browse.ISBN")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/"},tplName:"isbn-index"},a}(),BN.Modal.Base,!0),BN.Modal.Browse.GiftMessage=BN.Modal.Browse.GiftMessage||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.GiftMessage")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/"},tplName:"gift-message",initView:function(){var a=this,b=$(this.modal),c=a.data.target,d=$(c).data("messageid"),e=$("#"+d).text();b.find("#giftMessageModal").text(e)}},a}(),BN.Modal.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.Isbndef=BN.Modal.Browse.Isbndef||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.Isbndef")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/"},tplName:"m-isbn-definition-details"},a}(),BN.Modal.Browse.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.Condition=BN.Modal.Browse.Condition||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.Condition")};return a.prototype={tplName:"m-condition",defaultOptions:{useCache:!1,tplDir:SITE_ROOT+"/modals/marketplace/"},initView:function(){var a=this.data,b=$(a.target),c=b.attr("href")||"";!a.redirectSuccessUrl&&b.length>-1&&""!=c&&"#"!=c&&("/"==c.substr(0,1)&&(c=SITE_DOMAIN_URL+c),consoleLog(c),a.redirectSuccessUrl=c),this.initGenericView(),this.initForm()}},a}(),BN.Modal.Browse.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.Marketplace=BN.Modal.Browse.Marketplace||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.Marketplace")};return a.prototype={tplName:"marketplace",listOptions:{condition:"All",sortBy:"pricel"},sorters:{rating:{desc:"Seller Rating"},bnPrice:{asc:"Price - Low to High",desc:"Price - High to Low"},condition:{condition:"Condition"}},lists:{},reviewsURL:null,firstReady:!0,defaultOptions:{useCache:!1},trimText:function(a,b){var c=a,d=b;if(c.length>d){var e=c.lastIndexOf(" ");if(-1===e)c=c.slice(0,d-3),c+="...";else if(e>-1){c=c.slice(0,d-3);var f=c.lastIndexOf(" ");c=c.slice(0,f),c+="..."}}return c},initToolTip:function(){var a=$("span[data-icon=plus-expand]");$(".expand-tooltip-container").hide(),a.on("click",function(){var a=$(this);a.parents("li").siblings().find(".expand-tooltip-container").hide().end().find("span[data-icon=plus-expand]").removeClass("expandicon-change"),a.prev(".expand-tooltip-container").toggle(),a.toggleClass("expandicon-change")})},closeToolTips:function(){$(".marketplace-tab h3 label").on("click",function(){$(this).parents(".tabgroup").find(".expand-tooltip-container").hide().end().find("span[data-icon=plus-expand]").removeClass("expandicon-change")})},readMore:function(){$(".seller-info dl dd .down-arrowhead").on("click",function(){var a=$(this),b=a.siblings(".full-comments").text();a.parent().find("[data-prop=comments]").text(b),a.addClass("no-display")})},initConditionsModal:function(){var a=$(".tab-select");a.on("click",function(){new BN.Modal.Browse.Condition(null,{target:this},null,null)})},initView:function(){var a=$(this.modal),b=this;return this.unready(),this.initGenericView(),this.on("display",function(){var c={streamID:this.data["work-id"],categoryID:"Products",containerID:"gigyaRating",ratingTemplate:a.find("data#gigyaRating").html(),onLoad:function(){$("#gigyaRating .gig-rating-readReviewsLink").attr("href",b.reviewsURL)},onReadReviewsClicked:function(){window.location=b.reviewsURL}};"undefined"!=typeof gigya&&gigya.comments.showRatingUI(c)}),BN.uXHR.getService("marketplace-items",{productId:this.data["product-id"]},function(){b.initContainerDom.apply(b,arguments)}),!0},unready:function(){$(this.modal).find(".mrkt-prod-name,.marketplace-tab").css({visibility:"hidden"}),this.$spinner&&this.$spinner.length>0&&this.$spinner.remove(),this.displaySpinner()},ready:function(){$(this.modal).find(".mrkt-prod-name,.marketplace-tab").css({visibility:"visible"}),this.$spinner.remove(),$(this.dom).off("click","a",this.__anchorClick),$(this.dom).on("click","a",this.__anchorClick)},__anchorClick:function(a){"#"==$(this).attr("href")&&a.preventDefault()},initContainerDom:function(a){this.servResp=a.service;var b=this,c=$(this.modal),d=$(this.data.target).data("formats-edition")?$(this.data.target).data("formats-edition"):!1,e=this.servResp.product,f="",g="",h="",i="",j=$("body").hasClass("pdpPage")?!0:!1,k=["All","New","Used"],l=this.servResp.items,m=this.itemsByCond=this.separateByCondition(l),n=$(this.data.target).data("work-id")||"",o=($(this.data.target).attr("data-formatsurl"),$(this.data.target).attr("data-ismarketplace"));if(e.hasOwnProperty("skus")){var p=e.skus;p.length>1?(f=p[0],h=f.displayName,i=f.contributor):(f=p,h=f[0].displayName,i=f[0].contributor)}f.hasOwnProperty("edition")&&(g=""!=f.edition?"("+f.edition+")":""),b.reviewsURL=f.reviewsUrl,c.find('[data-prop="productTitle"]').html(h+" "+g),c.find("[data-template]").remove(),c.find('[data-prop="contributor"]').text(i);var q=this.flow().get("quickview"),r=c.find("#open-prod-details");if(j&&r.parent().remove(),d){$('<li class="qvLink"><a href="#" class="formatModal">All Formats & Editions</a></li>').insertAfter(c.find("ul.quick-view-nav li")[1]);var s=c.find(".formatModal");s.attr("data-ismarketplace",o),c.find("#qvTitleBar").on("click",".formatModal",function(a){a.preventDefault(),new BN.Modal.Browse.Formats(null,b.data,null,b)})}if(q&&q.pureModal)this.__initCrumbEvent(r.attr("data-crumb","quickview").get(0)),c.find("#qvTitleBar").on("click","a#open-prod-details",function(a){a.preventDefault(),showProductDetails($(q.modal)),$("#pdpModalContent").show()}),c.on("click",".close-modal",function(a){a.preventDefault(),b.Close(),q.Close()});else if(window.location.toString().indexOf(f.pdpUrl)>-1)r.on("click",function(){b.Close()});else{r.attr("data-product-id",e.id),r.attr("data-quickview-url",f.pdpUrl),r.attr("data-work-id",n),r.attr("data-modal-class","BN.Modal.Browse.Quickview"),this.initOpeners(r.parent().get(0));var t=c.find("#qvTitleBar #showAllFormats");t.attr("data-product-id",e.id),t.attr("data-quickview-url",f.pdpUrl),t.attr("data-pdp-view","seeAllFormats"),t.attr("data-modal-class","BN.Modal.Browse.Quickview"),b.initOpeners(t.parent().get(0))}for(this.unready(),x=0;x<k.length;x++){var u=k[x];m.hasOwnProperty(u)&&this.initTab(u)}this.initToolTip(),this.initSorter(),this.initConditionsModal(),this.closeToolTips(),this.readMore(),c.find("#AllSection").click(),this.ready()},initSorter:function(){var a=this,b=this.sorters,c=$(this.modal).find(".tabgroup .sorter");c.empty();for(var d in b){var e=b[d];for(var f in e){var g=e[f];title="object"==typeof g?g.title:g,c.append($("<option/>").attr("value",d+" "+f).text(title))}}c.on("change",function(){var b=this.value.split(/\s+/);a.sortItems(b[0],b[1])}),c.val("bnPrice asc").change(),c.selectBox()},sortItems:function(a,b){var c=this.lists,d=this.sorters[a][b];if("condition"==b){var e=["New","Like New","Very Good","Good","Acceptable","Used","Refurbished"];d=function(b){return b.sort(function(b,c){{var d=b.item[a],f=c.item[a];e.indexOf(d),e.indexOf(f)}return f>d?-1:d>f?1:0}),b.reverse(),b}}else"object"!=typeof d&&(d=function(c){return c.sort(function(b,c){var d=b.item[a],e=c.item[a],f=parseFloat(d),g=parseFloat(e);return d==f&&(d=f),e==g&&(e=g),e>d?-1:d>e?1:0}),"desc"==b&&c.reverse(),c});for(var f in c){for(var g=c[f],h=g.listDom,i=g.items,j=i.length,k=d(g.items),l=0;j>l;l++){var m=k[l];h.append(m.dom)}h.append(h.find("div.clear:empty"))}return!0},separateByCondition:function(a){var b={All:a||[]};b.Used=[];for(var c=0;c<b.All.length;c++){var d=b.All[c],e=d.condition;void 0!=b[e]?b[e].push(d):b[e]=[d],"New"!=e&&(void 0!=b[e]?b.Used.push(d):b.Used=[d])}return b},initTab:function(a){var b=(a+"Section").replace(/\s/gi,""),c=this.itemsByCond[a],d=$(this.modal),e=$(this.tpl()),f=d.find(".tabgroup"),g=$("<div/>"),h=e.find('[data-template="tabset"]').clone();return h.attr("data-template",null),g.append(h),g.children().filter("section").attr("data-condition",a),g.children().filter('.tab[type="radio"]').attr("id",b).next().find("label").attr("for",b),g.find('data[value="condition"]').text(a),g.find('data[value="conditionCount"]').text(c.length),this.initTabItems(c,g,a),f.append(g.children()),f.append(f.find("div.clear:empty")),this},initTabItems:function(a,b,c){var d=this,e=$(this.tpl()),f=b.find("section"),g=f.find(".section-items"),h=e.find(".section-items li").first().clone(),i=a.length,j=this.lists[c]={name:c,listDom:g,items:[]};g.empty();for(var k=0;i>k;k++){var l=a[k],m=a[k].ean,n=h.clone();j.items.push({dom:n,ean:m,item:l}),n.find("[data-prop]").each(function(){var a=$(this),b=a.attr("data-prop");if(void 0!=l[b])if("bnPrice"==b){var c=parseFloat(l[b]),e=c.toFixed(2);a.html("$"+e||" ")}else if("comments"==b){var f=l.comments,g=d.trimText(f,60);f.length>60?(a.html(g||" "),a.next("span").html(f),a.parent().find("a.down-arrowhead").removeClass("no-display")):a.html(f)}else a.html(l[b]||" ")}),n.find("data[value]").each(function(){var a=$(this).attr("value");if(void 0!=l[a])if("bnPrice"==a){var b=parseFloat(l[a]),c=b.toFixed(2);$(this).html(c||" ")}else $(this).html(l[a]||" ")});for(method in l.shipMethods){var o="<li>"+l.shipMethods[method]+"</li>";n.find(".ship-method-list").append(o)}n.find('[data-prop="sellerName"]').attr("href",l.sellerUrl),n.find('[data-prop="feedbackNum"]').attr("href",l.sellerReviewsUrl);var p=l.rating,q=p.split("."),r=n.find(".gig-rating-stars");r.attr("title",p),r.attr("alt",p),r.empty();for(var s=1;5>=s;s++)r.append(s>q[0]?s-1==q[0]&&q[1]>0?$("<div/>").attr("class","gig-rating-star gig-rating-star-half"):$("<div/>").attr("class","gig-rating-star gig-rating-star-empty"):$("<div/>").attr("class","gig-rating-star gig-rating-star-full"));n.find(".btn-addtocart").attr("data-ean",m).on("click",function(a){a.preventDefault(),d.displaySpinner(),BN.uXHR.getService("add-marketplace-to-cart",{mean:$(this).attr("data-ean"),productId:d.data["product-id"],skuId:d.data["sku-id"]},function(a){if(0==a.service.success){{var b=a.service.response.items,c=b.length,e=$(d.modal).find("#marketplaceError");e.find("p").length}e.empty();for(var f=0;c>f;f++)e.append($("<p/>").text(b[f]));e.show()}else{var e=$(d.modal).find("#marketplaceError");e.empty().hide(),new BN.Modal.Success(null,{title:"Success!",messages:[{type:"success",message:"The item has successfully been added to your cart!"}]}),loadHeaderElement($("#bagContentsContainer"),webContextRoot+"/includes/shopping-bag.jsp",!0)}d.$spinner.remove()},function(){$(d.modal).find("#marketplaceError").append($("<p/>").text("There was a problem adding your item to cart. Please try again later.")),d.$spinner.remove()})}),g.append(n)}return this}},a}(),BN.Modal.Browse.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.Quickview=BN.Modal.Browse.Quickview||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.Quickview")};return a.prototype={tplName:"quickview",defaultOptions:{useCache:!1},initView:function(){var a=this,b=$(this.modal),c=$(this.data.target).attr("data-product-id")||$(this.data.target).attr("id"),d=$(this.data.target).attr("data-sku-id"),e=$(this.data.target).attr("data-quickview-url"),f=$(this.data.target).data("pdp-view"),g=$(this.data.target).data("work-id");e+=e.indexOf("?")>=0?"&quickview=true":"?quickview=true","undefined"!=typeof s_setP&&s_setP("digitalData.event[0].eventInfo.eventName","prodQuickView"),this.displaySpinner(),b.find("[data-product-id]").attr("data-product-id",c),this.on("display",function(){$("#pdpModalContent").hide(),$("#pdpModalContent").load(e+" #productDetail",function(){function h(){window.location.href=u}$(".quickview-holder").remove();var i=b.find(".formatModal.all-formats").parent().html(),j=b.find(".formatModal.all-formats").length,k=$("#showAllFormats").text(),l=$("#qvTitleBar .open-marketplace").length>0?"true":"false",m=a.flow().get("marketplace"),n=$(a.modal).find(".open-marketplace");if(j){b.find("#otherAvailableFormatsContainer .actions form span").hide();var o=$('<li class="qvLink">'+i+"</li>"),p=o.find("a"),q=p.attr("data-formatsUrl");p.text(k).removeClass("all-formats chevron"),l&&p.attr("data-ismarketplace",l),p.attr("data-sku-id",d),p.attr("data-product-id",c),p.attr("data-work-id",g),p.attr("data-crumb","allFormats"),p.attr("data-formats-edition","true"),o.insertAfter(b.find("ul.quick-view-nav li")[0])}if(m&&m.pureModal?(n.removeAttr("data-sku-id"),n.removeAttr("data-product-id"),n.removeAttr("data-modal-class"),n.removeAttr("data-formats-edition"),n.attr("data-crumb","marketplace"),n.each(function(){a.__initCrumbEvent(this)}),b.on("click",".close-modal",function(b){b.preventDefault(),a.Close(),m.Close()})):(n.attr("data-sku-id",d),n.attr("data-product-id",c),n.attr("data-work-id",g),n.attr("data-modal-class","BN.Modal.Browse.Marketplace"),j?n.attr("data-formats-edition","true"):n.attr("data-formats-edition","false"),n.attr("data-formatsUrl",q),n.attr("data-ismarketplace",l)),a.initOpeners(),""!=b.find("#alsoAvailableAs").html()){var r=b.find("#alsoAvailableAs").html();b.find("#quickView .alt-format").html(r)}""==$.trim(b.find("#alsoAvailableAs").text())&&b.find("#quickView .alt-format").hide(),a.$spinner.remove();var s=b.find(".format-content").text().length,t=b.find(".format-content").text();s>120?b.find(".format-content").html("<p>"+t.substring(0,120).trim(this)+'.</p><a href="'+e+'">See complete product details</a>'):$("#quickView div.format-content a").html("See complete product details"),b.find("#componentDiv").appendTo(b.find("#prodInfoContainer")),b.find("#componentDiv").css({display:"block",width:"100%",clear:"both",paddingTop:"10px",marginTop:"10px",borderTop:"1px solid #ebebeb",textAlign:"center"}),b.find("#ratingsDisplay").attr("id","modalRatingsDisplay");var u=e.replace("/w/","/reviews/");ratingsParams={categoryID:"Products",streamID:g,containerID:"modalRatingsDisplay",onReadReviewsClicked:h},"undefined"!=typeof gigya&&gigya.comments.showRatingUI(ratingsParams),$(".bn-share-link").off("click").click(function(a){a.preventDefault();var b=$(this).data("socialsharetype"),c=location.host+e;console.log("this is location.host:  "+location.host),console.log("this is the prod URL:  "+c);var d="http:"+$("#pdpMainImage").attr("src");console.log("this img the share url: "+d);var f=$("#prodSummary h1").text()+" by "+$("#prodSummary .contributors a").text().replace(/(\r\n|\n|\r)/gm,"").trim();console.log("this is the share title: "+f);var g={url:c,provider:b,title:f,thumbnailURL:d,shortURLs:"never"};gigya.socialize.postBookmark(g)}),b.find("#quickView ul.options li").each(function(){""==$(this).html().trim()&&$(this).remove()}),b.find("#ratingsSocial span:not(.count)").remove(),b.find("a.all-formats").parent("p").hide(),initInstantPurchaseSignIn(),b.find(".tabgroup section:not(first-child)").css("display","none"),b.find("#qvTitleBar").on("click","#showAllFormats",function(a){a.preventDefault(),showAllFormats(b)}),b.find("#qvTitleBar").on("click","a#backToDetails",function(a){var c=b.find("#prodSummary");a.preventDefault(),c.parents("#productDetail").removeClass("formats-n-editions"),c.children().not("#qvFormatsTabContent").show(),c.find("#qvFormatsLink").hide(),c.find("#qvFormatsTabContent").hide(),c.find("#availableFormats").hide(),b.find("#prodInfoContainer, #prodImage, .alt-format").show(),b.find(".quick-view-nav li.qvLink").show(),b.find(".quick-view-nav h1").html("Product Details"),$(".pure-modal").find(".quick-view-nav .qv-pdp-details").hide()}),b.find(".tabgroup h3:first-child a").addClass("activeTab"),b.find(".tabgroup h3 a").on("click",function(a){a.preventDefault(),b.find(".tabgroup section").css("display","none"),$(this).parent().next("section").css("display","block"),b.find(".tabgroup h3 a").each(function(){$(this).removeClass("activeTab")}),$(this).addClass("activeTab")}),"seeAllFormats"==f?(showAllFormats(b),$("#pdpModalContent").show()):$("#pdpModalContent").show(),$("input[name=rental-options]","#quickView").each(function(a){var b=$(this),c=$(this).attr("id"),d=c+"-"+a.toString();b.attr("id",d),b.parent().attr("for",d)});var v=$("#quickView input[name=rental-options]:checked"),w=$("#quickView input[name=rental-options]").not(v);if(w.parents("label").siblings().slideUp("fast"),w.parents("form").siblings().slideUp("fast"),w.siblings(".price").removeClass("no-display"),v.siblings(".price").addClass("no-display"),$("input[name=rental-options]","#quickView").on("click",function(){var a=$(this),b=$("#quickView input[name=rental-options]"),c=b.not(a),d=a.parents("li"),e=b.parents(".subscriptions-container");d.is(":first-child")?e.children("li:first-child").removeClass("top-border"):e.children("li:first-child").addClass("top-border"),d.removeClass("grdnt-fade-white"),d.siblings().addClass("grdnt-fade-white"),c.removeAttr("checked"),c.parents("label").siblings().slideUp("fast"),c.parents("form").siblings().slideUp("fast"),c.siblings(".price").removeClass("no-display"),a.parents("label").siblings().not("select").slideDown("fast"),a.parents("form").siblings().slideDown("fast"),a.siblings(".price").addClass("no-display"),$(".selectBox-container").css("overflow","visible")}),$("#rentalRates").on("change",function(){var a=$("option:selected",this).attr("data-rental-rate"),b=$("option:selected",this).attr("data-rental-return-date"),c=$(".rental-price"),d=$(".return-date");c.text(a),d.text(b)}),initImageSwitcher(),attachCartAction(!0),$("#quickView .prim-image a").attr("href",e),$("#quickView .prim-image a").bind("click",function(){window.location.href=$(this).attr("href")}),$("#quickView p.nook-devices-apps a").on("click",function(a){a.preventDefault(),b.find("#quickView .expand-cvv-container").toggle()}),$("#quickView div.format-content a").attr("href",e),getThumbsCarousel(b),$("[data-tooltip-trigger]").length>0&&showTooltip(!0),$(".btn-goToEpisodes").length){var x=$("<div></div>");$.ajax({url:"/cartridges/ProductDetailContent/ProductDetailTypes/includes/episodes-list.jsp",cache:!1,type:"post",data:{eans:$("#dataEpisodes").attr("data-eans")}}).done(function(a){x.html(a),$("#lowestPriceEpisodeButton").text(x.find("#lowestPriceEpisode").attr("data-lowpriceepisode")),x.remove()})}})})}},a}(),BN.Modal.Browse.Base,!0);