define(["jquery","underscore","managers/siteconfig"],function(e,t,i){"use strict";var s=function(){this.initialize()};return s.prototype={initialize:function(s){s=e.extend({siteModules:i.getSiteConfig().siteModules},s),this.siteModules=s.siteModules||{},this.$stylesheets=e([]),this.stylesheets=[],this.staticUrl=window.site_static_url||"/static/",this.staticVersion=window.site_static_version||"off",e("link[data-identifier]").each(t.bind(function(t,i){var s=e(i).data("identifier");"main"!=s&&(this.stylesheets.push(e(i).data("identifier")),this.$stylesheets.push(i))},this))},fetchStyles:function(i,s,n){var o=t.difference(i,this.stylesheets),r=t.difference(this.stylesheets,i);n&&r.length&&console.log("removing styles from dom: ",r),n&&o.length&&console.log("adding styles to dom: ",o);var l=this._findStyleTags(r);this.stylesheets=i,this.$stylesheets=e(t.filter(this.$stylesheets,function(e){return!t.include(l,e)})),this._addStylesToHead(o),l.length&&s.done(function(){l.remove()})},fetchJavascript:function(i,s,n){return e.Deferred(t.bind(function(e){i&&s?require([i],t.bind(function(){require([s],t.bind(function(t){this._resolveFetchJavascript(e,t,n)},this))},this)):s?require([s],t.bind(function(t){this._resolveFetchJavascript(e,t,n)},this)):this._resolveFetchJavascript(e,null,n)},this)).promise()},_resolveFetchJavascript:function(e,t,i){this.fetchPageModules(i).done(function(i){e.resolve(t,i)})},fetchPageModules:function(i){return i=i||[],e.Deferred(t.bind(function(e){var s=i.length,n=[];return s?void t.each(i,function(i){n.push(i),this.getSiteModuleByName(i.name).done(function(e){i.selector=e.selector||"."+e.name+"-module",i.ModuleClass=e.ModuleClass}).fail(function(){n=t.reject(n,function(e){return e.name===i.name})}).always(function(){s--,0===s&&e.resolve(n)})},this):void e.resolve(n)},this)).promise()},getSiteModuleByName:function(i){return e.Deferred(t.bind(function(e){var t=this.siteModules[i];t?t.ModuleClass?e.resolve(t):t.path?require([t.path],function(s){t.ModuleClass=s,t.name=i,e.resolve(t)},function(i){console.error("Failed loading "+t.path+": "+i.message,i),e.reject(i)}):e.reject():e.reject("No Such Module Found")},this)).promise()},_findStyleTags:function(i){return e(t.filter(this.$stylesheets,function(s){var n=e(s).data("identifier");return t.find(i,function(e){return n===e})}))},_addStylesToHead:function(i){if(i&&i.length>0){var s=e([]);t.each(i,function(t){var i=e('<link rel="stylesheet" data-identifier="'+t+'" href="'+this.staticUrl+"css/bundles/"+t+(window.use_minified_css?".min":"")+".css?v="+this.staticVersion+'">')[0];s.push(i),this.$stylesheets.push(i)},this),e("head").append(s)}}},new s});
//# sourceMappingURL=resourcemanager.js
//# sourceMappingURL=resourcemanager.js.map