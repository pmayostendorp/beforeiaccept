define(["jquery","underscore","pubsub","admanager","utils"],function(t,e,n,i,s){"use strict";var o=function(){this.pubSub={"page:load":this._onPageLoad,"page:unload":this._onPageUnload}};return o.prototype={start:function(){this._pageIndex=0,this.reset(),this._autoPlayOrder=s.getNested(window.site_vars,"autoplay","default")||[],n.attach(this.pubSub,this)},reset:function(){this._currentModules={},this._playedModules=[]},stop:function(){n.unattach(this.pubSub,this)},register:function(t,n){e.isFunction(n)&&(this._currentModules[t]=n)},_onPageLoad:function(){i.getActiveSlotStatistics().done(e.bind(function(){this._go(0,this._pageIndex)},this))},_onPageUnload:function(){this._pageIndex++,this.reset()},_go:function(t,n){n===this._pageIndex&&this._triggerAutoPlay(t||0).then(e.bind(function(){this._go(t+1,n)},this))},_triggerAutoPlay:function(n){var i=this._getAutoPlayResult(n);return i&&e.isFunction(i.then)?i:t.Deferred(e.bind(function(t){i===!1?t.reject():i===!0?t.resolve():(console.error("AutoPlayManager: Invalid return value from "+this._autoPlayOrder[n]+".startAutoPlay()"),t.resolve())},this))},_getAutoPlayResult:function(t){var e=this._autoPlayOrder[t],n=this._playedModules,i=this._currentModules[e];return i?(this._playedModules=this._playedModules.concat(e),i(n)):t<this._autoPlayOrder.length}},new o});
//# sourceMappingURL=autoplay.js
//# sourceMappingURL=autoplay.js.map