r.ui.TOCScroller=Backbone.View.extend({scrollSpeed:.4,events:{"click a":"scrollToLinkHash"},initialize:function(e){this.$doc=$(e.doc),this.$toc=$(e.toc),this.$progress=$('<div class="location">').appendTo(this.$toc),this.updateProgress=_.throttle(this._updateProgress,10)},start:function(){$(window).bind("scroll",$.proxy(this,"updateProgress")),$(window).bind("hashchange",_.bind(function(e){this.updateProgress()},this)),this.updateProgress()},scrollToLinkHash:function(e){var t=$(e.target).attr("href").match(/#.*/)[0];this.smoothScrollToHash(t),this.updateProgress(),e.preventDefault()},smoothScrollToHash:function(e){var t=this._headingForHash(e),n=$(document).scrollTop(),r=Math.min(this._scrollMax(),t.offset().top);$("html, body").stop(!0).animate({scrollTop:r},{duration:this.scrollSpeed*Math.abs(r-n),step:function(e,t){var r=$(this).scrollTop();if(n>0&&r==0)return;Math.abs(r-n)>5&&$("html, body").stop(),n=t.now},complete:function(){location.replace(location.toString().replace(/#.*$/,"")+e)}})},_scrollMax:function(){return $(document).height()-$(window).height()},_headingForHash:function(e){return this.$doc.find(document.getElementById(e.substr(1)))},_tocFor:function(e){return $(this.$toc[0].getElementsByClassName(e.attr("id"))).children("a")},_updateProgress:function(){var e=$(document).scrollTop(),t=this._scrollMax(),n=this._headingForHash(location.hash).filter("h2");if(n.length){var i=Math.min(t,n.offset().top)-e;if(Math.abs(i)<=10){this.$progress.css("top",this._tocFor(n).position().top);return}}var s=$(_.find(this.$doc.children("h2"),function(t){return $(t).offset().top>=e},this)),o=s.prevAll("h2").first();if(!s.length||e==t)o=s=$("h2:last");if(!o.length)this.$progress.css("top",0);else{var u=s.offset().top,a=o.offset().top,f=(e-a)/(u-a),l=this._tocFor(s),c=this._tocFor(o),h=l.position().top,p=c.position().top;f=r.utils.clamp(f,0,1);var d=p+(h-p)*f;this.$progress.css("top",d)}}}),$(function(){new r.ui.scrollFixed($(".policy-page .doc-info")),(new r.ui.TOCScroller({el:$(".policy-page"),doc:$(".policy-page .md"),toc:$(".policy-page .doc-info .toc")})).start()});