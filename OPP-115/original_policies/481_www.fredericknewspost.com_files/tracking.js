window.TNCMS||(window.TNCMS={});
window.TNCMS.Tracking=function(){function h(a){console.warn&&console.warn(a)}function n(a){a=a.replace("\\","\\\\");return a=a.replace('"','"')}function p(a){var b="?";if(d[a]){var b=b+"d=%7B",c;for(c in d[a])b+='"'+n(c)+'":"',b+=n(d[a][c])+'",';b+="%7D&"}return b+"i="}function q(a){for(var b=["app","url","metric","bucket","id"],c=0;c<b.length;c++)if(!a[b[c]]){h("Missing required parameter: "+b[c]);return}b=p(a.bucket);c=a.domain||document.domain;b+=escape(a.id)+"&r="+escape(a.url).replace("%3A",
":");return"//"+c+"/tncms/tracking/"+a.app+"/"+a.metric+"/"+b}function u(){var a=g;g={};k=null;for(var b in a){for(var c=b.split(":",2),l=c[0].split("|",2),f=p(l[1]),e="//"+l[0]+"/tncms/tracking/"+c[1]+"/"+f;a[b].length;){var r=a[b].pop();2E3<e.length+r.length&&((new Image).src=e,e="//"+l[0]+"/tncms/tracking/"+c[1]+"/"+f);e+=r+","}(new Image).src=e}}function s(a){if(a.app)if(a.metric)if(a.id){var b=(a.domain||document.domain)+"|"+a.bucket+":"+a.app+"/"+a.metric;g[b]||(g[b]=[]);g[b]=g[b].concat(a.id);
k&&window.clearTimeout(k);k=window.setTimeout(u,1E3)}else h("Missing required parameter: id");else h("Missing required parameter: metric");else h("Missing required parameter: app")}function m(a){d[a.bucket]||(d[a.bucket]={});d[a.bucket][a.name]=a.value}function t(a){d[a.bucket]&&delete d[a.bucket][a.name]}var g={},d={},k=null,v=0;return{addEvent:function(a){a.bucket="global";s(a)},getRedirectURL:function(a){a.bucket="global";return q(a)},addData:function(a){a.bucket="global";m(a)},removeData:function(a){a.bucket=
"global";t(a)},trackDeclarativeEvents:function(a){a=a||{};var b=a.root||document.body,c=a.domain||document.domain;if("undefined"==typeof jQuery)throw"Declarative event tracking requires jQuery";jQuery(b).find("[data-tncms-tracking]").filter(":visible").each(function(){var a=jQuery(this),b=a.data("tncmsTracking").split("/",3);3<=b.length&&TNCMS.Tracking.addEvent({domain:c,id:b[2],metric:b[1],app:b[0]});h("Removing tncms tracking: "+a.data("tncmsTracking"));a.removeData("tncmsTracking")})},createBucket:function(a){var b=
a.app||null,c=a.metric||null,d=a.domain||document.domain,f="bucket"+v++;a=a.data||{};for(var e in a)m({bucket:f,name:e,value:a[e]});return{addEvent:function(a){s({domain:d,bucket:f,id:a,app:b,metric:c})},addData:function(a){a.bucket=f;m(a)},removeData:function(a){a.bucket=f;t(a)},getRedirectURL:function(a){a.bucket=f;a.domain=d;return q(a)}}}}}();
