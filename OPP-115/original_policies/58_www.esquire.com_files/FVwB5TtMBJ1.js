/*!CK:131618609!*//*1436151142,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["jlIT2"]); }

__d("AjaxRequest",["ErrorUtils","Keys","URI","UserAgent_DEPRECATED","getSameOriginTransport","setTimeoutAcrossTransitions","PHPQuerySerializer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();function n(r,s,t){this.xhr=k();if(!(s instanceof i))s=new i(s);if(t&&r=='GET'){s.setQueryData(t);}else this._params=t;this.method=r;this.uri=s;this.xhr.open(r,s);}var o=window.XMLHttpRequest&&('withCredentials' in new XMLHttpRequest());n.supportsCORS=function(){return o;};n.ERROR='ar:error';n.TIMEOUT='ar:timeout';n.PROXY_ERROR='ar:proxy error';n.TRANSPORT_ERROR='ar:transport error';n.SERVER_ERROR='ar:http error';n.PARSE_ERROR='ar:parse error';n.SERVICE_UNAVAILABLE='ar:noservice';n._inflight=[];function p(){var r=n._inflight;n._inflight=[];r.forEach(function(s){s.abort();});}function q(r){r.onJSON=r.onError=r.onSuccess=null;clearTimeout(r._timer);if(r.xhr&&r.xhr.readyState<4){r.xhr.abort();r.xhr=null;}n._inflight=n._inflight.filter(function(s){return s&&s!=r&&s.xhr&&s.xhr.readyState<4;});}Object.assign(n.prototype,{timeout:60000,streamMode:true,prelude:/^for \(;;\);/,status:null,_eol:-1,_call:function(r){if(this[r])this[r](this);},_parseStatus:function(){var r;try{this.status=this.xhr.status;r=this.xhr.statusText;}catch(s){if(this.xhr.readyState>=4){this.errorType=n.TRANSPORT_ERROR;this.errorText=s.message;}return;}if(this.status===0&&!(/^(file|ftp)/.test(this.uri))){this.errorType=n.TRANSPORT_ERROR;}else if(this.status>=100&&this.status<200){this.errorType=n.PROXY_ERROR;}else if(this.status>=200&&this.status<300){return;}else if(this.status>=300&&this.status<400){this.errorType=n.PROXY_ERROR;}else if(this.status>=400&&this.status<500){this.errorType=n.SERVER_ERROR;}else if(this.status===503){this.errorType=n.SERVICE_UNAVAILABLE;}else if(this.status>500&&this.status<600){this.errorType=n.PROXY_ERROR;}else if(this.status==1223){return;}else if(this.status>=12001&&this.status<=12156){this.errorType=n.TRANSPORT_ERROR;}else{r='unrecognized status code: '+this.status;this.errorType=n.ERROR;}if(!this.errorText)this.errorText=r;},_parseResponse:function(){var r,s=this.xhr.readyState;try{r=this.xhr.responseText||'';}catch(t){if(s>=4){this.errorType=n.ERROR;this.errorText='responseText not available - '+t.message;}return;}while(this.xhr){var u=this._eol+1,v=this.streamMode?r.indexOf('\n',u):r.length;if(v<0&&s==4)v=r.length;if(v<=this._eol)break;var w=r;if(this.streamMode)w=r.substr(u,v-u).replace(/^\s*|\s*$/g,'');if(u===0&&this.prelude)if(this.prelude.test(w))w=w.replace(this.prelude,'');this._eol=v;if(w){try{this.json=JSON.parse(w);}catch(t){var x=(/(<body[\S\s]+?<\/body>)/i).test(r)&&RegExp.$1,y={message:t.message,'char':u,excerpt:((u===0&&x)||w).substr(512)};this.errorType=n.PARSE_ERROR;this.errorText='parse error - '+JSON.stringify(y);return;}g.applyWithGuard(this._call,this,['onJSON']);}}},_onReadyState:function(){var r=this.xhr&&this.xhr.readyState||0;if(this.status==null&&r>=2)this._parseStatus();if(!this.errorType&&this.status!=null)if((r==3&&this.streamMode)||r==4)this._parseResponse();if(this.errorType||r==4){this._time=Date.now()-this._sentAt;this._call(!this.errorType?'onSuccess':'onError');q(this);}},send:function(r){this.xhr.onreadystatechange=function(){g.applyWithGuard(this._onReadyState,this,arguments);}.bind(this);var s=this.timeout;if(s)this._timer=l((function(){this.errorType=n.TIMEOUT;this.errorText='timeout';this._time=Date.now()-this._sentAt;this._call('onError');q(this);}).bind(this),s);n._inflight.push(this);if(this.method=='POST')this.xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');this._sentAt=Date.now();this.xhr.send(r?m.serialize(r):'');},abort:function(){q(this);},toString:function(){var r='[AjaxRequest readyState='+this.xhr.readyState;if(this.errorType)r+=' errorType='+this.errorType+' ('+this.errorText+')';return r+']';},toJSON:function(){var r={json:this.json,status:this.status,errorType:this.errorType,errorText:this.errorText,time:this._time};if(this.errorType)r.uri=this.uri;for(var s in r)if(r[s]==null)delete r[s];return r;}});if(window.addEventListener&&j.firefox())window.addEventListener('keydown',function(event){if(event.keyCode===h.ESC)event.prevent();},false);if(window.attachEvent)window.attachEvent('onunload',p);e.exports=n;},null);
__d("SystemEvents",["Arbiter","ErrorUtils","SystemEventsInitialData","UserAgent_DEPRECATED","setIntervalAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=new g(),m=[],n=1000;k(function(){for(var x=0;x<m.length;x++)m[x]();},n);function o(){return (/c_user=(\d+)/.test(document.cookie)&&RegExp.$1)||0;}function p(){return i.ORIGINAL_USER_ID;}var q=p(),r=navigator.onLine;function s(){if(!r){r=true;l.inform(l.ONLINE,r);}}function t(){if(r){r=false;l.inform(l.ONLINE,r);}}if(j.ie()){if(j.ie()>=11){window.addEventListener('online',s,false);window.addEventListener('offline',t,false);}else if(j.ie()>=8){window.attachEvent('onload',function(){document.body.ononline=s;document.body.onoffline=t;});}else m.push(function(){(navigator.onLine?s:t)();});}else if(window.addEventListener)if(!j.chrome()){window.addEventListener('online',s,false);window.addEventListener('offline',t,false);}var u=q;m.push(function(){var x=o();if(u!=x){l.inform(l.USER,x);u=x;}});var v=Date.now();function w(){var x=Date.now(),y=x-v,z=y<0||y>10000;v=x;if(z)l.inform(l.TIME_TRAVEL,y);return z;}m.push(w);m.push(function(){if(window.onerror!=h.onerror)window.onerror=h.onerror;});Object.assign(l,{USER:'SystemEvents/USER',ONLINE:'SystemEvents/ONLINE',TIME_TRAVEL:'SystemEvents/TIME_TRAVEL',isPageOwner:function(x){return (x||o())==q;},isOnline:function(){return j.chrome()||r;},checkTimeTravel:w});e.exports=l;},null);
__d("ChannelSubdomain",["Event","JSLogger","Run","setTimeoutAcrossTransitions","LogHistory","WebStorage"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=b('LogHistory').getInstance('channel'),l=b('WebStorage').getLocalStorage(),m=h.create('channel'),n='channel_sub:',o=7,p=100*1000,q=null,r;function s(){if(r){clearTimeout(r);r=null;}if(l&&q!=null)l.removeItem(n+q);q=null;}function t(u,v,w){var x=(u-1)*o;if(w){if(r)clearTimeout(r);q=r=null;}if(v==null)v=Math.floor(Math.random()*x);if(q==null)if(l){var y=[];for(var z=0;z<l.length;z++){var aa=l.key(z);if(aa.indexOf(n)===0){var ba=parseInt(aa.substr(n.length),10);y[ba]=parseInt(l.getItem(aa),10);}}var ca=Date.now()-p;for(z=0;z<x;z++){var da=(z+v)%x;if(!y[da]||y[da]<ca){q=da;break;}}if(q!=null){var ea=function(){try{l.setItem(n+q,Date.now());}catch(fa){k.warn('subdomain set failed',fa.message);}r=j(ea,p/2);};ea();}else{k.warn('no channel subdomain',y);m.error('subdomain_overflow');}if(typeof window.onpageshow!='undefined'){g.listen(window,'pagehide',s);}else i.onUnload(s);}else q=v;return q==null?null:q%o;}e.exports={allocate:t,clear:s};},null);
__d("DocRPC",["ErrorUtils"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={_apis:{},_dispatch:function(i){var j;try{i=JSON.parse(i);}catch(k){throw new Error('DocRPC unparsable dispatch: "'+i+'"');}if(h._apis.hasOwnProperty(i.api)){var l=h._apis[i.api];if(l[i.method])j=g.applyWithGuard(l[i.method],l,i.args);}if(j===(void 0))j=null;return JSON.stringify(j);},publish:function(i,j){h._apis[j]=i;},proxy:function(i,j,k){var l={};k.forEach(function(m){l[m]=function(){var n={api:j,method:m,args:Array.prototype.slice.call(arguments)},o;try{if(i.closed)throw new Error('DocRPC window closed');o=i.DocRPC._dispatch(JSON.stringify(n));}catch(p){g.reportError(p);return;}if(typeof(o)=='string')try{o=JSON.parse(o);}catch(p){throw new Error('DocRPC '+j+'.'+m+' unparsable return: "'+o+'"');}return o;};});return l;}};e.exports=a.DocRPC=h;},null);
__d("ChannelTransport",["AjaxRequest","ChannelConstants","DocRPC","LogHistory","URI","bind","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=j.getInstance('channel');function o(){return (1048576*Math.random()|0).toString(36);}function p(y,z){var aa=y.subdomain;aa=aa===null?'':(aa+'-');var ba=new k(z).setDomain(aa+y.host+'.'+y.domain).setPort(y.port).setSecure(new k(window.location.href).isSecure());return ba;}function q(y){var z={partition:y.partition,cb:o()};if(y.sticky_token)z.sticky_token=y.sticky_token;var aa=p(y,'/p').setQueryData(z);n.log('start_p',{uri:aa.toString()});var ba=new g('GET',aa);if(g.supportsCORS())ba.xhr.withCredentials=true;var ca=function(da){n.log('finish_p',{xhr:da.toJSON?da.toJSON():da});};ba.timeout=y.P_TIMEOUT;ba.onError=ba.onSuccess=ca;ba.send();}function r(y,z,aa){var ba=new Image(),ca=0,da=function(ga){ba.abort();return ga?z():aa();};ba.onload=function(){n.log('ping_ok',{duration:Date.now()-ca});da(true);};ba.onerror=function(){q(y);da(false);};var ea=m(ba.onerror,10000);ba.abort=function(){if(ea){clearTimeout(ea);ea=null;}ba.onload=ba.onerror=null;};var fa={partition:y.partition,cb:o()};if(y.sticky_token)fa.sticky_token=y.sticky_token;if(y.sticky_pool)fa.sticky_pool=y.sticky_pool;if(y.lastRequestErrorReason){fa.reason=y.lastRequestErrorReason;y.lastRequestErrorReason=null;}if(y.uid&&y.viewerUid){fa.uid=y.uid;fa.viewer_uid=y.viewerUid;}if(y.watchdog&&y.watchdog.enabled)fa.wtc=y.watchdog.doSerialize();ca=Date.now();ba.src=p(y,'/ping').setQueryData(fa);return ba;}function s(y){var z={channel:y.user_channel,partition:y.partition,clientid:y.sessionID,cb:o(),cap:0,uid:y.uid,viewer_uid:y.viewerUid};if(y.sticky_token)z.sticky_token=y.sticky_token;if(y.sticky_pool)z.sticky_pool=y.sticky_pool;if(y.is_offline||y.shouldSuppressPresence){z.state='offline';}else z.state='active';if(z.state===y.lastPresenceState)return;y.lastPresenceState=z.state;if(y.profile)z.profile=y.profile;if(y.capabilities)z.cap=y.capabilities;var aa=p(y,'/active_ping').setQueryData(z),ba=new g('GET',aa);if(g.supportsCORS())ba.xhr.withCredentials=true;ba.onError=function(ca){n.warn('active_ping_error');};ba.onSuccess=function(ca){n.log('active_ping_ok');};ba.timeout=y.P_TIMEOUT;ba.send();}function t(y,z,aa,ba){var ca=new Date(),da=-1;if(y.userActive>0){da=(ca-y.userActive)/1000|0;if(da<0)n.warn('idle_regression',{idleTime:da,now:ca.getTime(),userActive:y.userActive});}var ea={channel:y.user_channel,seq:y.seq,partition:y.partition,clientid:y.sessionID,cb:o(),idle:da,cap:0};if(!!y.watchdog&&y.watchdog.enabled)ea.wtc=y.watchdog.doSerialize();ea.msgs_recv=y.estimatedReceived;if(y.uid&&y.viewerUid){ea.uid=y.uid;ea.viewer_uid=y.viewerUid;}if(y.stableDeviceId)ea.sdi=1;if(y.sticky_token){ea.sticky_token=y.sticky_token;}else if(y.msgr_region)ea.msgr_region=y.msgr_region;if(y.sticky_pool)ea.sticky_pool=y.sticky_pool;if('trace_id' in y)ea.traceid=y.trace_id;if(y.is_offline||y.shouldSuppressPresence){ea.state='offline';}else if(y.userActive>0&&da<60)ea.state='active';y.lastPresenceState=ea.state;if(y.streamingCapable){ea.mode='stream';ea.format='json';}if(y.profile)ea.profile=y.profile;if(y.capabilities)ea.cap=y.capabilities;var fa=p(y,'/pull').setQueryData(ea),ga=y.fantail_enabled?'POST':'GET',ha=new g(ga,fa);if(g.supportsCORS())ha.xhr.withCredentials=true;ha.timeout=y.streamingCapable?y.STREAMING_TIMEOUT:y.LONGPOLL_TIMEOUT;ha.onJSON=z;ha.onSuccess=aa;ha.onError=function(){var ka=(this.status==12002&&this._time>=y.MIN_12002_TIMEOUT)||(this.status==504&&this._time>=y.MIN_504_TIMEOUT),la=ka?aa:ba;return la&&la.apply(this,arguments);};if(y.fantail_logs&&y.fantail_logs.length>0){var ia={};for(var ja=0;ja<y.fantail_logs.length;ja++)Object.assign(ia,y.fantail_logs[ja]);ha.send(ia);y.fantail_logs=[];}else ha.send();y.inStreaming=y.streamingCapable;return ha;}function u(y){this.manager=y;(this.init&&this.init());}function v(y){u.apply(this,arguments);}Object.assign(v.prototype,{logName:'CORS',enterState:function(y,z){if(this._request){this._request.abort();this._request=null;}if(y=='init')m(l(this.manager,'exitState',{status:h.OK,stateId:z.stateId}),3000);if(!/pull|ping/.test(y))return;var aa=this.manager;if(y=='ping'){this._request=r(z,l(aa,'exitState',{status:h.OK,stateId:z.stateId}),l(aa,'exitState',{status:h.ERROR,stateId:z.stateId}));}else if(y=='pull')this._request=t(z,l(aa,'_processTransportData',z.stateId),l(aa,'exitState',{status:h.OK,stateId:z.stateId}),l(aa,'exitState',{status:h.ERROR,stateId:z.stateId}));}});function w(y){n.log('iframe_init_constructor');u.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);i.publish(this,'outerTransport');}Object.assign(w.prototype,{logName:'iframe',_initIframe:function(y){n.log('iframe_init_start');window.onchanneliframeready=function(){n.log('iframe_resources');return y.resources;};window.onchanneliframeloaded=function(){n.log('iframe_loaded');};if(y){this._iframeURI=p(y,y.path);if(y.resources){var z=this._iframeURI.getDomain();y.resources=y.resources.map(function(ca){var da=new k(ca);if(da.getPath().startsWith('/intern/rsrc.php')&&da.getQueryData().origin!==(void 0))return da.addQueryData('origin',z).toString();return ca;});}if(y.bustIframe){var aa={partition:y.partition,cb:o()};this._iframeURI.setQueryData(aa);}}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);n.log('iframe_uri_set');}catch(ba){n.error('iframe_uri_set_error',ba);this.exitState({status:h.ERROR,stateId:y.stateId},ba+'');}},enterState:function(y,z){if(y=='init'){this._initIframe(z);}else if(/idle|ping|pull/.test(y)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(y!='idle')this.exitState({status:h.ERROR,stateId:z.stateId},'iframe not yet loaded');}else if(y=='shutdown')this._initIframe();},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function(y){if(this.manager.state=='init'&&y.status==h.OK)this._iframeProxy=i.proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}});function x(){this.init=this.init.bind(this);u.apply(this,arguments);}Object.assign(x.prototype,{logName:'iframe(inner)',init:function(){i.publish(this,'innerTransport');try{var z=i.proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);Object.assign(this,z);this.exitState({status:h.OK,stateId:1e+06});}catch(y){n.error('iframe_inner_init_error',y);}},enterState:function(y,z){if(this._request){this._request.abort();this._request=null;}if(y=='ping'){this._request=r(z,l(this,'exitState',{status:h.OK,stateId:z.stateId}),l(this,'exitState',{status:h.ERROR,stateId:z.stateId}));}else if(y=='pull')this._request=t(z,l(this,'_processTransportData',z.stateId),l(this,'exitState',{status:h.OK,stateId:z.stateId}),l(this,'exitState',{status:h.ERROR,stateId:z.stateId}));}});e.exports={getURI:p,Transport:u,CORSTransport:v,IframeTransport:w,IframeInnerTransport:x,sendActivePing:s};},null);
__d("FBAjaxRequest",["AjaxRequest","getAsyncParams"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();function i(j,k,l){l=Object.assign({},h(j),l);var m=new g(j,k,l);m.streamMode=false;var n=m._call;m._call=function(o){if(o=='onJSON'&&this.json){if(this.json.error){this.errorType=g.SERVER_ERROR;this.errorText='AsyncResponse error: '+this.json.error;}this.json=this.json.payload;}n.apply(this,arguments);};m.ajaxReqSend=m.send;m.send=function(o){this.ajaxReqSend(Object.assign({},o,l));};return m;}e.exports=i;},null);
__d("MovingStat",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(h){h=h||60000;var i={t:new Date(),count:0,v:0},j=i,k=0,l=0;function m(){var n=new Date()-h;while(j&&j.next&&j.t<n){k-=j.v;l-=j.count;j=j.next;}}this.add=function(n){k+=n;l++;var o=new Date();if(o-i.t<1000){i.v+=n;i.count++;}else{i.next={t:o,v:n,count:1};i=i.next;m();}};this.tally=function(n){n=n||1000;m();return {sum:k,count:l,timeAverage:k*n/h};};}e.exports=g;},null);
__d("Dcode",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g,h={},i={_:'%',A:'%2',B:'000',C:'%7d',D:'%7b%22',E:'%2c%22',F:'%22%3a',G:'%2c%22ut%22%3a1',H:'%2c%22bls%22%3a',I:'%2c%22n%22%3a%22%',J:'%22%3a%7b%22i%22%3a0%7d',K:'%2c%22pt%22%3a0%2c%22vis%22%3a',L:'%2c%22ch%22%3a%7b%22h%22%3a%22',M:'%7b%22v%22%3a2%2c%22time%22%3a1',N:'.channel%22%2c%22sub%22%3a%5b',O:'%2c%22sb%22%3a1%2c%22t%22%3a%5b',P:'%2c%22ud%22%3a100%2c%22lc%22%3a0',Q:'%5d%2c%22f%22%3anull%2c%22uct%22%3a',R:'.channel%22%2c%22sub%22%3a%5b1%5d',S:'%22%2c%22m%22%3a0%7d%2c%7b%22i%22%3a',T:'%2c%22blc%22%3a1%2c%22snd%22%3a1%2c%22ct%22%3a',U:'%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',V:'%2c%22blc%22%3a0%2c%22snd%22%3a0%2c%22ct%22%3a',W:'%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a',X:'%2c%22ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1',Y:'%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',Z:'%2c%22sb%22%3a1%2c%22t%22%3a%5b%5d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a'};(function(){var k=[];for(var l in i){h[i[l]]=l;k.push(i[l]);}k.reverse();g=new RegExp(k.join("|"),'g');})();var j={encode:function(k){return encodeURIComponent(k).replace(/([_A-Z])|%../g,function(l,m){return m?'%'+m.charCodeAt(0).toString(16):l;}).toLowerCase().replace(g,function(l){return h[l];});},decode:function(k){return decodeURIComponent(k.replace(/[_A-Z]/g,function(l){return i[l];}));}};e.exports=j;},null);
__d("PresenceCookieManager",["Cookie","CurrentUser","Dcode","ErrorUtils","JSLogger","PresenceInitialData","PresenceUtil","URI"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o=l.cookieVersion,p=l.dictEncode,q='presence',r={},s=null,t=null,u=k.create('presence_cookie');function v(){try{var z=g.get(q);if(s!==z){s=z;t=null;if(z&&z.charAt(0)=='E')z=i.decode(z.substring(1));if(z)t=JSON.parse(z);}if(t&&(!t.user||t.user===h.getID()))return t;}catch(y){u.warn('getcookie_error',y);}return null;}function w(){return parseInt(Date.now()/1000,10);}var x={register:function(y,z){r[y]=z;},store:function(){var y=v();if(y&&y.v&&o<y.v){u.debug('stale_cookie',o);return;}var z={v:o,time:w(),user:h.getID()};for(var aa in r)z[aa]=j.applyWithGuard(r[aa],r,[y&&y[aa]],function(ea){ea.presence_subcookie=aa;});var ba=JSON.stringify(z);if(p)ba='E'+i.encode(ba);if(m.hasUserCookie()){var ca=ba.length;if(ca>1024)u.warn('big_cookie',ca);var da=n.getRequestURI(false).isSecure()&&!!g.get('csm');g.set(q,ba,null,null,da);}},clear:function(){g.clear(q);},getSubCookie:function(y){var z=v();if(!z)return null;return z[y];}};e.exports=x;},null);
__d("PresenceState",["Arbiter","ErrorUtils","JSLogger","PresenceCookieManager","debounceAcrossTransitions","setIntervalAcrossTransitions","PresenceInitialData"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=m.cookiePollInterval||2000,o=m.shouldSuppress||false,p=[],q=[],r=null,s=null,t=0,u=null,v=0,w=['sb2','t2','lm2','uct2','tr','tw','at','wml'],x=i.create('presence_state');function y(){return j.getSubCookie('state');}function z(){t=Date.now();j.store();da(s);}var aa=k(z,0);function ba(ia){if(typeof ia=='undefined'||isNaN(ia)||ia==Number.POSITIVE_INFINITY||ia==Number.NEGATIVE_INFINITY)ia=0;return ia;}function ca(ia){var ja={};if(ia){w.forEach(function(ma){ja[ma]=ia[ma];});if(t<ia.ut)x.error('new_cookie',{cookie_time:ia.ut,local_time:t});}ja.ut=t;for(var ka=0,la=p.length;ka<la;ka++)h.applyWithGuard(p[ka],null,[ja]);s=ja;return s;}function da(ia){v++;t=ba(ia.ut);if(!r)r=l(ga,n);s=ia;if(u===null)u=ia;for(var ja=0,ka=q.length;ja<ka;ja++)h.applyWithGuard(q[ja],null,[ia]);v--;}function ea(ia){if(ia&&ia.ut)if(t<ia.ut){return true;}else if(ia.ut<t)x.error('old_cookie',{cookie_time:ia.ut,local_time:t});return false;}function fa(){var ia=y();if(ea(ia))s=ia;return s;}function ga(){var ia=y();if(ea(ia))da(ia);}j.register('state',ca);g.subscribe(i.DUMP_EVENT,function(ia,ja){ja.presence_state={initial:Object.assign({},u),state:Object.assign({},s),update_time:t,sync_paused:v,poll_time:n};});(function(){var ia=fa();if(ia){da(ia);}else{x.debug('no_cookie_initial');da(ca());return;}})();var ha={doSync:function(ia){if(v)return;if(ia){z();}else aa();},registerStateStorer:function(ia){p.push(ia);},registerStateLoader:function(ia){q.push(ia);},get:function(){return fa();},getInitial:function(){return u;},shouldSuppress:function(){return o;},verifyNumber:ba};e.exports=ha;},null);
__d("VideoCallSupport",["ChannelConstants","RTCConfig","UserAgent"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j={isSendWebrtcSupported:function(){return h.SendNewVCGK;},isReceiveWebrtcSupported:function(){return h.ReceiveNewVCGK;},isVideoInteropSupported:function(){return h.VideoInteropGK;},isVideoCallSupported:function(){return j.isSendWebrtcSupported();},isWebrtcSupported:function(){return (i.isBrowser('Chrome >= 28')||i.isBrowser('Firefox >= 25')||i.isBrowser('Opera >= 20'));},isOSSupported:function(){return !i.isPlatform('Android')&&!i.isPlatform('iOS');},getCapabilities:function(){var k=0;if(this.isReceiveWebrtcSupported())k=g.CAPABILITY_VOIP_INTEROP;return k;}};e.exports=j;},null);
__d("RTISession",["URI","AjaxRequest","invariant","ErrorUtils"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k='.facebook.com';function l(m,n,o,p,q,r,s,t,u){i(m);i(p);i(q);this.domain=m;this.port=n;this.edgePoolName=o;this.stickyToken=p;this.loggedInId=q;this.accountId=r;this.clientProfile=s||'desktop';this.clientId=t;this.capabilities=u;}l.prototype.issueRequest=function(m,n,o,p,q){i(m);i(n);i(p);var r=this.domain.length-k.length,s=r>0&&this.domain.indexOf(k,r)!==-1,t=s?this.domain:this.domain+k,u=(1048576*Math.random()|0).toString(36),v={cb:u,sticky_token:this.stickyToken,uid:this.loggedInId,viewer_uid:this.accountId,sticky_pool:this.edgePoolName,profile:this.clientProfile,clientid:this.clientId,cap:this.capabilities};for(var w in v)i(!n[w]);Object.assign(v,n);var x=new g(m).setDomain(t).setPort(this.port).setSecure(new g(window.location.href).isSecure()).setQueryData(v),y=o?'POST':'GET',z=new h(y,x);z.timeout=q?q*1000:30000;if(z.xhr)z.xhr.withCredentials=true;var aa={};z.onSuccess=function(){};z.onJSON=(function(){aa.data=z.json;aa.error=null;j.applyWithGuard(p,this,[aa]);}).bind(this);z.onError=(function(){aa.data=null;aa.error=z.errorType||'error';j.applyWithGuard(p,this,[aa]);}).bind(this);z.send(JSON.stringify(o));};e.exports=l;},null);
__d("ChannelManager",["AjaxRequest","Arbiter","AsyncRequest","ChannelConstants","ChannelInitialData","ChannelSubdomain","ChannelTransport","ChatVisibility","DTSG","Env","FBAjaxRequest","ISB","JSLogger","MessagingRealtimeConstants","MovingStat","PresenceCookieManager","PresenceState","PresenceUtil","Run","SystemEvents","URI","UserActivity","VideoCallSupport","RTISession","createArrayFromMixed","errorCode","setIntervalAcrossTransitions","setTimeoutAcrossTransitions","WebStorage"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){b.__markCompiled&&b.__markCompiled();var ia=b('WebStorage').getSessionStorage(),ja='chproxy_base_sess',ka,la=s.create('channel'),ma=null;function na(cb){ma=cb;}var oa={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect',sys_online:'init',sys_timetravel:'init'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'reconnect',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping',error_stale:'reconnect!'},reconnect:{ok:'init!',error:'reconnect',sys_online:'reconnect',sys_timetravel:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!',sys_owner:'reconnect',sys_nonowner:'idle!',sys_online:'ping',sys_offline:'idle!',sys_timetravel:'ping'}},pa={reconnectOverrideTimeMillis:Date.now(),userActive:Date.now(),lastPresenceState:null,lastRequestErrorReason:null,seq:0,estimatedReceived:0,fantail_logs:[],sessionID:(Math.random()*2147483648|0).toString(16),stableDeviceId:false,capabilities:ca.getCapabilities(),streamingCapable:false,inStreaming:false,shouldSuppressPresence:w.shouldSuppress(),LONGPOLL_TIMEOUT:60000,STREAMING_TIMEOUT:60000,P_TIMEOUT:30000,IFRAME_LOAD_TIMEOUT:30000,MIN_RETRY_INTERVAL:5000,MAX_RETRY_INTERVAL:320000,MIN_12002_TIMEOUT:9000,MIN_504_TIMEOUT:20000,STALL_THRESHOLD:180000,JUMPSTART_THRESHOLD:90000,MIN_INIT_PROBE_DELAY:3000,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12000,CHANNEL_PROXY_REPORTING_MIN_INTERVAL:10000,PROBE_DELAY:60000,PROBE_HEARTBEATS_INTERVAL_LOW:1000,PROBE_HEARTBEATS_INTERVAL_HIGH:5000,STREAMING_EXIT_STATE_ON_CONTINUE:false,FANTAIL_QUEUE_CAPACITY:50},qa={MAX_CONTINUOUS_PULL_FAILS:3,enabled:false,uptimeMillis:Date.now(),timeInGoodStatesStartMillis:Date.now(),timeInGoodStatesMillis:0,initialized:false,firstPullSentTimeMillis:Date.now(),accumulatedPullTimeMillis:0,pullStartTimeMillis:0,pingCount:0,pullCount:0,continuousPullFails:0,getTimeSinceFirstPullSentSeconds:function(){return (Date.now()-this.firstPullSentTimeMillis)/1000;},getUptimeSeconds:function(){return (Date.now()-this.uptimeMillis)/1000;},getAccumulatedPullTimeSeconds:function(){var cb=this.accumulatedPullTimeMillis,db=Date.now();if(this.pullStartTimeMillis>0&&db-this.pullStartTimeMillis<=pa.LONGPOLL_TIMEOUT)cb+=(db-this.pullStartTimeMillis);var eb=cb/1000;if(eb>=this.getTimeSinceFirstPullSentSeconds())this.initialize();return eb;},getPingToPullRatio:function(){return this.pullCount===0?0:this.pingCount/this.pullCount;},reportPullSent:function(){if(!this.enabled)return;if(!this.initialized)this.initialize();this.pullStartTimeMillis=Date.now();},initialize:function(){this.initialized=true;this.firstPullSentTimeMillis=Date.now();this.pullStartTimeMillis=0;this.accumulatedPullTimeMillis=0;this.pingCount=0;this.pullCount=0;this.timeInGoodStatesStartMillis=Date.now();this.timeInGoodStatesMillis=0;this.uptimeMillis=Date.now();},reportPullReturned:function(cb,db){if(!this.enabled)return;if(this.pullStartTimeMillis>0){this.accumulatedPullTimeMillis+=(Date.now()-this.pullStartTimeMillis);if(cb){this.pullCount++;this.continuousPullFails=0;}else this.continuousPullFails++;}this.pullStartTimeMillis=0;},reportPingSent:function(){if(!this.enabled)return;this.pingCount++;},isGoodState:function(cb){return cb.indexOf('pull')===0||cb.indexOf('init')===0||cb.indexOf('idle')===0;},getTotalTimeInGoodStatesSeconds:function(){var cb=this.timeInGoodStatesMillis;if(this.timeInGoodStatesStartMillis>0)cb+=(Date.now()-this.timeInGoodStatesStartMillis);return cb/1000;},clientEnteredState:function(cb){if(!this.enabled)return;var db=this.isGoodState(cb);if(db&&this.timeInGoodStatesStartMillis===0){this.timeInGoodStatesStartMillis=Date.now();}else if(!db&&this.timeInGoodStatesStartMillis>0){this.timeInGoodStatesMillis=Date.now()-this.timeInGoodStatesStartMillis;this.timeInGoodStatesStartMillis=0;}},transportEnteredState:function(cb){if(!this.enabled)return;if(cb.indexOf('pull')===0){this.reportPullSent();}else if(cb.indexOf('ping')===0&&pa.lastRequestErrorReason!==j.SYS_TIMETRAVEL&&pa.lastRequestErrorReason!==j.SYS_ONLINE&&pa.lastRequestErrorReason!==j.SYS_OWNER&&pa.lastRequestErrorReason!==j.SYS_NONOWNER)this.reportPingSent();},doSerialize:function(){if(!this.enabled)return "";return (this.getTimeSinceFirstPullSentSeconds()).toFixed(0)+','+(this.getAccumulatedPullTimeSeconds()).toFixed(0)+','+(this.getPingToPullRatio()).toFixed(3)+','+(this.getUptimeSeconds()).toFixed(0)+','+(this.getTotalTimeInGoodStatesSeconds()).toFixed(0);}},ra=1,sa={},ta=0;function ua(){return i.lastSuccessTime?Math.round((Date.now()-i.lastSuccessTime)/1000):-1;}function va(){var cb={};if(ka.getConfig('host'))cb[ka.getConfig('user_channel')]=ka.getConfig('seq',0);return cb;}function wa(){var cb=Date.now(),db=Date.now(),eb={total:0},fb='idle',gb=false;z.subscribe([z.USER,z.ONLINE,z.TIME_TRAVEL],function(jb,kb){ya(true);db=null;ka.lastPullTime=Date.now();var lb;switch(jb){case z.USER:lb=z.isPageOwner()?j.SYS_OWNER:j.SYS_NONOWNER;break;case z.ONLINE:lb=kb?j.SYS_ONLINE:j.SYS_OFFLINE;break;case z.TIME_TRAVEL:lb=j.SYS_TIMETRAVEL;break;}ka.exitState({status:lb,stateId:ra});});var hb=function(jb,kb){var lb=Date.now(),mb;if(kb){cb=lb;mb=kb.nextState||kb.state;}else mb=fb;z.checkTimeTravel();if(db){var nb=Math.round((lb-db)/1000);if(nb>0){eb[fb]=(eb[fb]||0)+nb;eb.total+=nb;}}fb=mb;db=lb;if(!jb){eb.lastSuccessTime=ua();eb.online=z.isOnline();la.log('rollup',eb);}};h.subscribe(j.ON_ENTER_STATE,hb);ga(hb,60000);h.subscribe(s.DUMP_EVENT,function(jb,kb){kb.channelRollup=eb;});var ib=function(){if(ka.isShutdown()||ka.shouldIdle())return;z.checkTimeTravel();var jb=Date.now()-(ka.lastPullTime||p.start);if(!gb&&jb>pa.STALL_THRESHOLD){var kb=ua();la.error('stall',{lastSuccessTime:kb,rollupState:fb});gb=true;}var lb=Date.now()-cb;if(ka.state=='pull'&&lb>pa.JUMPSTART_THRESHOLD){cb=null;la.warn('jumpstart',{state:ka.state,dormant:lb});ka.enterState('init');}};ga(ib,10000);}function xa(){var cb=Date.now(),db=1;function eb(){ha(eb,db*1000);var jb=ka.state;if(jb=='idle'&&ka.shouldIdle())return;la.bump('conn_t',db);if(jb=='pull')la.bump('conn_t_pull',db);}eb();var fb=[15,30,60,120,240],gb=false,hb=false;function ib(jb){ha(function(){la.rate('pullenter_'+jb,gb);la.rate('pullexit_'+jb,hb);},jb*1000);}while(fb.length)ib(fb.shift());h.subscribe(j.ON_ENTER_STATE,function(jb,kb){if(kb.state=='pull')gb=true;cb=Date.now();});h.subscribe(j.ON_EXIT_STATE,function(jb,kb){if(kb.state!='pull'||!cb)return;var lb='other';if(kb.status==j.OK){hb=true;lb='ok';}else if(kb.xhr&&kb.xhr.errorType){lb=/ar:(\w+)/.test(kb.xhr.errorType)&&RegExp.$1;}else if(/^sys_/.test(kb.status))return;var mb=(Date.now()-cb)/1000;if(mb<0){return;}else if(mb>3600)mb=3600;la.bump('conn_num');la.bump('conn_exit',mb);la.bump('conn_num_'+lb);la.bump('conn_exit_'+lb,mb);});}function ya(cb){if(cb){ta=0;sa={};}else ta++;}function za(){if(!pa.stableDeviceId)return;var cb={};cb.sessionID=pa.sessionID;cb.seq=pa.seq;cb.estimatedReceived=pa.estimatedReceived;ia.setItem(ja,JSON.stringify(cb));}function ab(cb){if(!cb)return false;cb=cb.trim();if(cb.length===0)return false;try{var eb=JSON.parse(cb),fb=function(hb){if(typeof(eb[hb])=="number")return eb[hb];la.error("not an integer: "+hb+"="+eb[hb]);throw "NotAnInteger";};pa.seq=fb('seq');pa.estimatedReceived=fb('estimatedReceived');var gb=eb.sessionID;if(gb&&gb.length&&gb.trim()){pa.sessionID=gb;return true;}return false;}catch(db){la.error("unable to parse state: "+cb);return false;}}ka={state:'idle',nextState:null,proxyDown:false,lastPullTime:Date.now(),lastReportOnMisguidedMsgTime:Date.now(),heartbeats:[],setTestCallback:na,backoff:false,init:function(cb){this.init=function(){};this._logFantail('client initialized',j.FANTAIL_INFO);var db=!!pa.use_sticky_session,eb=false;pa.stableDeviceId=false;if(db&&ia){pa.stableDeviceId=true;var fb=true;for(var gb=0;gb<ia.length;gb++){var hb=ia.key(gb);if(hb.indexOf(ja)===0){eb=ab(ia.getItem(hb));fb=!eb;break;}}if(fb)za();}this._logFantail('using session id: '+pa.sessionID+(eb?' [restored]':' [new]'),j.FANTAIL_INFO);qa.enabled=!!pa.watchdog_enabled;pa.watchdog=qa;if(typeof(ba)!='undefined'){ba.subscribe(function(){pa.userActive=Date.now();m.sendActivePing(pa);}.bind(this));}else la.error('user_activity_undefined');v.register('ch',va);var ib=this.getConfig('max_conn',2);pa.subdomain=l.allocate(ib);this._transportRate=new u(30000);var jb=(g.supportsCORS()&&!pa.forceIframe)?'CORSTransport':'IframeTransport';this.transport=new m[jb](this);if(cb)this.enterState.apply(this,arguments);h.subscribe(s.DUMP_EVENT,function(event,lb){lb.transportRate=this._transportRate.tally();lb.transportType=jb;lb.transportVersion=2;}.bind(this));wa();xa();if(ka.getConfig('tryStreaming')&&ka.getConfig('host')&&g.supportsCORS()&&!pa.forceIframe){var kb=pa.MIN_INIT_PROBE_DELAY+Math.random()*pa.INIT_PROBE_DELAY_RANDOMIZE_RANGE;ha(this._probeTest,kb);}},configure:function(){var cb=ea(arguments);la.log('configure',cb);cb.forEach(function(db){return Object.assign(pa,db);});h.inform(j.ON_CONFIG,this);},getConfig:function(cb,db){return cb in pa?pa[cb]:db;},getCompleteConfig:function(){return pa;},getWatchdog:function(){return qa;},isShutdown:function(){return this.state=='shutdown';},shouldIdle:function(){return !(z.isPageOwner()&&z.isOnline());},_sendIframeError:function(cb){var db=new i().setURI('/ajax/presence/reconnect.php').setData({reason:cb,fb_dtsg:o.getToken()}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);db.specifiesWriteRequiredParams()&&db.send();},_getDelay:function(){var cb=Math.min(pa.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,ta-1)),pa.MAX_RETRY_INTERVAL);if(this.proxyDown&&'proxy_down_delay_millis' in pa)cb=pa.proxy_down_delay_millis;this.proxyDown=false;return Math.floor(cb*(1+Math.random()*.5));},enterState:function(){if(this._inEnterState)la.warn('enterstate_recursion');this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(cb){this._inEnterState=false;throw cb;}},_enterState:function(cb){if((cb.indexOf('pull')===0||cb.indexOf('ping')===0||cb.indexOf('shutdown')===0)&&!!pa.active_config_refresh){var db=Date.now(),eb=(db-pa.reconnectOverrideTimeMillis)/1000;if('config_refresh_seconds' in pa&&pa.config_refresh_seconds>0&&eb>pa.config_refresh_seconds){cb='reconnect';this._logFantail('forcing reconnect to refresh config'+' - this is normal behavior',j.FANTAIL_DEBUG);}}if(cb.indexOf('reconnect')===0)pa.reconnectOverrideTimeMillis=Date.now();var fb=this.backoff?this._getDelay():0;this.backoff=false;var gb=ea(arguments);if(this.isShutdown()){this._logFantail('not executing state due to shutdown mode: '+cb,j.FANTAIL_WARN);return;}if(cb!='idle!'&&this.shouldIdle()){this._logFantail('forced idleness',j.FANTAIL_WARN);return;}ra++;pa.stateId=ra;clearTimeout(this._deferredTransition);this._deferredTransition=null;this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(cb)){var hb=this._transportRate.tally().timeAverage,ib=ka.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(hb>=ib){if(!this._throttled){this._throttled=true;la.warn('throttled');}la.bump('throttle');fb=1000/ib;}}else if(!(/#$/.test(cb)))fb=this._getDelay();cb=cb.replace(/\W*$/,'');if(!oa[cb]){this._logFantail('invalid state: '+cb,j.FANTAIL_ERROR);throw new Error('invalid state:'+cb);}var jb;if(fb<=0){jb={state:cb};this._transportRate.add(1);this.state=cb;var kb=this['_enter_'+this.state];if(kb){gb.shift();kb.apply(this,gb);}if(/init|idle|pull|ping/.test(this.state)){if(pa.streamingCapable&&/pull/.test(this.state))this.heartbeats=[];qa.transportEnteredState(cb);qa.clientEnteredState(cb);pa.is_offline=!n.isOnline();pa.capabilities=ca.getCapabilities();this._logFantail('entering transport state: '+this.state,j.FANTAIL_INFO);this.transport.enterState(this.state,pa);if(this.state=='ping'){jb.url=m.getURI(pa).toString();jb.port=pa.port||'undefined';}}}else{this.state='idle';this.nextState=cb;jb={state:this.state,delay:fb,nextState:cb};gb[0]=cb+'#';this._deferredTransition=ha((function(){this._deferredTransition=null;this.enterState.apply(this,gb);}).bind(this),fb);}if(/pull/.test(cb)){jb.client_id=pa.sessionID;jb.streaming=pa.inStreaming;}la.log('enter_'+this.state,jb);h.inform(j.ON_ENTER_STATE,jb);},exitState:function(cb,db){var eb=cb.stateId,fb=cb.status;if((fb==j.SYS_TIMETRAVEL||fb==j.SYS_ONLINE||fb==j.SYS_NONOWNER||fb==j.SYS_OWNER)&&qa)qa.initialize();if(this.isShutdown()||eb<ra)return;var gb=ea(arguments),hb=this.state;gb[0]=cb.status;var ib={state:hb,status:fb};if(/pull/.test(hb)){ib.client_id=pa.sessionID;ib.streaming=pa.inStreaming;}if(/ping/.test(hb)&&fb!=j.OK)ib.url=m.getURI(pa).toString();if(this.nextState)ib.nextState=this.nextState;if(db&&db.errorType){pa.lastRequestErrorReason=db.errorType;ib.xhr=db.toJSON?db.toJSON():db;if(db.errorType==g.SERVICE_UNAVAILABLE){this._logFantail('got 5xx http status code, setting long delay',j.FANTAIL_ERROR);this.proxyDown=true;}delete ib.xhr.json;}else if(fb!=j.OK)pa.lastRequestErrorReason=fb;if(db&&db.json){if(db.json.t)ib.t=db.json.t;if(db.json.reason)ib.reason=db.json.reason;if(db.json.seq)ib.seq=db.json.seq;}la.log('exit_'+hb,ib);h.inform(j.ON_EXIT_STATE,ib);var jb=this['_exit_'+hb];if(jb)fb=jb.apply(this,gb)||fb;if(fb!=j.OK){ya();sa[hb]=(sa[hb]||0)+1;}var kb=oa[this.nextState||hb][fb]||oa._all[fb],lb=kb&&kb.replace(/!*$/,'');if(!lb){la.error('terminal_transition',ib);this._shutdownHint=j.HINT_INVALID_STATE;kb='shutdown!';this._logFantail('entering shutdown state',j.FANTAIL_ERROR);}this._lastState=hb;this._lastStatus=fb;this.enterState(kb);},_processTransportData:function(cb,db){var eb=db.json,fb=eb.t;if('s' in eb){eb.seq=eb.s;delete eb.s;}if(eb.u&&pa.user&&eb.u!=pa.user){la.warn('misguided_msg',{user:pa.user,target:eb.u});this._reportProxyMisguidedMsg(eb.u,pa.user);return;}var gb=pa.seq;if('seq' in eb){pa.seq=eb.seq;w.doSync();}switch(fb){case 'continue':if(pa.inStreaming&&this.heartbeats.length<1){pa.streamingCapable=false;la.log('switch_to_longpoll');ha(this._probeTest,pa.PROBE_DELAY);}ya(true);if(!pa.inStreaming||pa.STREAMING_EXIT_STATE_ON_CONTINUE)this.exitState({status:j.OK,stateId:cb});break;case 'refresh':case 'refreshDelay':this._logFantail('got refresh with reason: '+eb.reason,j.FANTAIL_INFO);this.exitState({status:'refresh_'+(eb.reason||0),stateId:cb},db);break;case 'backoff':this._logFantail('server told client to back off',j.FANTAIL_WARN);ya();this.backoff=true;break;case 'lb':var hb=eb.lb_info;if(hb){pa.sticky_token=hb.sticky;if('pool' in hb){pa.sticky_pool=hb.pool;}else pa.host=hb.vip;if(g.supportsCORS()&&!pa.forceIframe){var ib=pa.subdomain===null?pa.host:(pa.subdomain+'-'+pa.host),jb=new da(ib,pa.port,pa.sticky_pool,pa.sticky_token,pa.uid,pa.viewer_uid,pa.profile,pa.sessionID,pa.capabilities);h.inform(j.RTI_SESSION,jb);}}else la.error('bad lb info');break;case 'test_streaming':ha(this._probeTest,500);break;case 'fullReload':v.clear();la.log('invalid_history');h.inform(j.ON_INVALID_HISTORY);ya(true);this._logFantail('full reload incurred',j.FANTAIL_INFO);this.exitState({status:j.ERROR_MISSING,stateId:cb},db);break;case 'msg':var kb,lb,mb,nb;ya(true);if('tr' in eb)pa.trace_id=eb.tr;lb=eb.ms;mb=pa.seq-lb.length;for(kb=0;kb<lb.length;kb++,mb++){pa.estimatedReceived++;if(mb>=gb){nb=lb[kb];if(nb.type){var ob=j.getArbiterType(nb.type);if(nb.type==='messaging'){var pb={type:'messaging',event:nb.event};if(nb.message){pb.inbox_unread=nb.unread_counts&&nb.unread_counts.inbox;pb.tid=nb.message.tid;pb.mid=nb.message.mid;this._logFantail('got message with id: '+nb.message.mid,j.FANTAIL_INFO);}la.debug('message',pb);}else if(nb.type==='m_messaging'){la.debug('message',{type:'m_messaging',tid:nb.tid,mid:nb.uuid});}else if(nb.type==='pages_messaging'){if(nb.unread_counts&&nb.unread_counts.inbox)h.inform(j.getArbiterType('pages_inbox_count_update'),{page_id:nb[t.VIEWER_FBID],inbox_unread:nb.unread_counts.inbox});}else if(nb.type==='skywalker'){ob=j.SKYWALKER;}else la.debug('message',{type:nb.type});h.inform(ob,{obj:nb});}}else la.warn('seq_regression',{seq:mb,last_seq:gb,messages:lb.length});}break;case 'heartbeat':if(pa.inStreaming){var qb=Date.now();if(this.heartbeats.length>0){var rb=qb-this.heartbeats[this.heartbeats.length-1];la.log('heartbeat_interval',{client_id:pa.sessionID,interval:rb});}this.heartbeats.push(qb);}break;default:this._logFantail('got an unknown protocol message: '+fb,j.FANTAIL_ERROR);la.error('unknown_msg_type',{type:fb});break;}za();},_enter_init:function(){if(sa.init>=ka.getConfig('MAX_INIT_FAILS',2))return setTimeout(this.exitState.bind(this,{status:j.ERROR_MAX,stateId:ra}),0);this._initTimer=ha(this.exitState.bind(this,{status:j.ERROR,stateId:ra},'timeout'),pa.IFRAME_LOAD_TIMEOUT);},_enter_reconnect:function(cb){this._logFantail('entered reconnect with reason: '+cb,j.FANTAIL_INFO);var db=ra;if(!x.hasUserCookie()){this._logFantail('user has no cookie???',j.FANTAIL_WARN);la.warn('no_user_cookie');setTimeout(function(){ka._shutdownHint=j.HINT_AUTH;ka.exitState({status:j.ERROR_SHUTDOWN,stateId:db});},0);return;}var eb={reason:cb,fb_dtsg:o.getToken()};if(r.token)eb.fb_isb=r.token;if(ma)ma(eb);var fb=new q('GET','/ajax/presence/reconnect.php',eb);fb.onSuccess=(function(){ka.configure(fb.json);v.store();this.exitState({status:j.OK,stateId:db});}).bind(this);fb.onError=(function(){var gb=fb.json&&fb.json.error;this._logFantail('reconnect error: '+fb.errorType,j.FANTAIL_ERROR);if(fb.errorType==g.TRANSPORT_ERROR||fb.errorType==g.PROXY_ERROR||fb.errorType==g.SERVICE_UNAVAILABLE)this._shutdownHint=j.HINT_CONN;if(gb&&gb==1356007){this._shutdownHint=j.HINT_MAINT;}else if(gb==1357001||gb==1357004||gb==1348009){this._shutdownHint=j.HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?j.ERROR_SHUTDOWN:j.ERROR,stateId:db},fb);}).bind(this);fb.send();},_enter_shutdown:function(){h.inform(j.ON_SHUTDOWN,{reason:this._shutdownHint});if(!!pa.shutdown_recovery_enabled&&'shutdown_recovery_interval_seconds' in pa&&pa.shutdown_recovery_interval_seconds>0){var cb=pa.shutdown_recovery_interval_seconds*1000;ha((function(){h.inform(j.ATTEMPT_RECONNECT);this.state='reconnect!';this.enterState('reconnect!');}).bind(this),cb);}},_exit_init:function(cb){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(cb==j.ERROR_MAX)this._sendIframeError(j.reason_IFrameLoadGiveUp);},_exit_pull:function(cb,db){var eb=cb==j.OK;qa.reportPullReturned(eb,this);if(eb){this.lastPullTime=Date.now();}else{var fb="exit status: "+cb;if(db&&db.errorType)fb+=" ajax request error: "+db.errorType;this._logFantail('pull failed with status: '+fb,j.FANTAIL_ERROR);}},_exit_ping:function(cb){if(cb==j.OK){var db=Date.now()-(this.lastPullTime||p.start);if(db>pa.STALL_THRESHOLD){this._logFantail('didnt complete a successful pull for too long',j.FANTAIL_ERROR);return j.ERROR_STALE;}}else this._logFantail('ping failed with status: '+cb,j.FANTAIL_ERROR);},_reportProxyMisguidedMsg:function(cb,db){this._logFantail('misguided message to '+db+' meant for '+cb,j.FANTAIL_ERROR);var eb=Date.now();if(eb-this.lastReportOnMisguidedMsgTime<=pa.CHANNEL_PROXY_REPORTING_MIN_INTERVAL)return;this.lastReportOnMisguidedMsgTime=eb;var fb={received_uid:cb,expected_uid:db};if(pa.sticky_token)fb.sticky_token=pa.sticky_token;var gb=new aa('/err_misguided_msg').setDomain(pa.host+'.'+pa.domain).setPort(pa.port).setSecure(new aa(window.location.href).isSecure()).setQueryData(fb),hb=new g('GET',gb);if(g.supportsCORS())hb.xhr.withCredentials=true;hb.onSuccess=function(ib){};hb.onError=function(ib){};hb.onJSON=function(ib,jb){};hb.send();},_probeTest:function(){pa.streamingCapable=false;var cb=[],db={mode:'stream',format:'json'};if(pa.sticky_token)db.sticky_token=pa.sticky_token;var eb=new aa('/probe').setDomain(pa.host+'.'+pa.domain).setPort(pa.port).setSecure(new aa(window.location.href).isSecure()).setQueryData(db),fb=new g('GET',eb);fb.onJSON=function(gb,hb){if(gb&&gb.json&&gb.json.t==='heartbeat'){cb.push(Date.now());if(cb.length>=2){var ib=cb[1]-cb[0];if(ib>=pa.PROBE_HEARTBEATS_INTERVAL_LOW&&ib<=pa.PROBE_HEARTBEATS_INTERVAL_HIGH){pa.streamingCapable=true;la.log('switch_to_streaming');}la.log('probe_ok',{time:ib});}}};fb.onSuccess=function(gb){if(cb.length!=2){pa.streamingCapable=false;la.error('probe_error',{error:'beats.length = '+cb.length});}};fb.onError=function(gb){pa.streamingCapable=false;la.error('probe_error',gb);};la.log('probe_request');fb.send();},_logFantail:function(cb,db){var eb=pa.fantail_queue_capacity||pa.FANTAIL_QUEUE_CAPACITY;if(!pa.fantail_enabled||pa.fantail_logs.length>eb)return;var fb='fantail queue size exceeded',gb=j.FANTAIL_WARN;if(pa.fantail_logs.length<eb){fb=cb;gb=db;}var hb=pa.fantail_logs.length,ib={};ib['time'+hb]=Date.now();ib['log'+hb]=fb;ib['severity'+hb]=gb;pa.fantail_logs.push(ib);}};e.exports=ka;function bb(){if(k.channelConfig){ka.configure(k.channelConfig);if(/shutdown/.test(k.state))ka._shutdownHint=j[k.reason];ka.init(k.state,k.reason);}}y.onAfterLoad(bb);},null);
__d("ChannelConnection",["Arbiter","Run","SystemEvents","ChannelConstants","ChannelManager","JSLogger","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=l.create('channel_connection'),o=null,p=null,q=null,r=null,s=0,t=Object.assign(new g(),{CONNECTED:'chat-connection/connected',RECONNECTING:'chat-connection/reconnecting',SHUTDOWN:'chat-connection/shutdown',MUTE_WARNING:'chat-connection/mute',UNMUTE_WARNING:'chat-connection/unmute'});h.onBeforeUnload(function(){});function u(){if(p){clearTimeout(p);p=null;}}function v(){u();n.log('unmute_warning');t.inform(t.UNMUTE_WARNING);}function w(ba){u();p=m(v,ba);n.log('mute_warning',{time:ba});t.inform(t.MUTE_WARNING);}function x(){if(q){clearTimeout(q);q=null;}}function y(ba,ca){x();if(ba===j.ON_ENTER_STATE&&(ca.nextState||ca.state)==='pull'){if(r!==t.CONNECTED){n.log('connected');var da=!r;r=t.CONNECTED;s=0;t.inform(t.CONNECTED,{init:da});}}else if(ba===j.ON_ENTER_STATE&&((ca.nextState||ca.state)==='ping'||(!ca.nextState&&ca.state==='idle'))){q=m(function(){var ea=null;if(!(ca.state==='idle'&&!ca.nextState))ea=(ca.delay||0);n.log('reconnecting',{delay:ea});if(t.disconnected())n.log('reconnecting_ui',{delay:ea});r=t.RECONNECTING;(ca.state==='idle')&&s++;if(s>1){t.inform(t.RECONNECTING,ea);}else if(!ca.nextState&&ca.state==='idle')y(ba,ca);},500);}else if(ba===j.ON_SHUTDOWN){n.log('shutdown',{reason:ca.reason});r=t.SHUTDOWN;s=0;t.inform(t.SHUTDOWN,ca.reason);}}function z(){if(k.isShutdown()){y(j.ON_SHUTDOWN,k._shutdownHint);}else y(j.ON_ENTER_STATE,{state:k.state,nextState:k.nextState,delay:0});}h.onAfterLoad(z);Object.assign(t,{disconnected:function(){return r===t.SHUTDOWN||(r===t.RECONNECTING&&!p&&s>1);},isShutdown:function(){return r===t.SHUTDOWN;},reconnect:function(ba){if(k.state==='ping'||k.isShutdown())return;n.log('reconnect',{now:ba});t.inform(t.RECONNECTING,0);if(!!ba){if(o!==null){clearTimeout(o);o=null;}k.enterState('ping!');}else if(!o)o=m(function(){k.enterState('ping!');o=null;},j.CHANNEL_MANUAL_RECONNECT_DEFER_MSEC);},unmuteWarning:v});function aa(){g.subscribe([j.ON_ENTER_STATE,j.ON_SHUTDOWN],y);g.subscribe(j.ATTEMPT_RECONNECT,function(){if(t.disconnected())t.reconnect();});i.subscribe(i.TIME_TRAVEL,function(){t.reconnect();w(j.MUTE_WARNING_TIME_MSEC);});h.onBeforeUnload(x,false);}h.onAfterLoad(aa);t.mockAfterLoad=function(){z();aa();};e.exports=t;},null);
__d("ChatContexts",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={};function h(k){var l=k?k.subtext:'';return l;}function i(k,l){g[k]=l;}var j={get:function(k){if(k in g){return g[k];}else return null;},update:function(k){for(var l in k)i(l,k[l]);},getShortDisplay:function(k){return h(j.get(k));}};e.exports=j;},null);
__d("PresencePoller",["AvailableListConstants","AvailableListInitialData","BanzaiODS","ChannelConnection","ChatContexts","ChatVisibility","CurrentUser","JSLogger","LastMobileActiveTimes","Poller","PresencePrivacy","PresenceStatus","ServerTime","ShortProfiles","UserActivity","debounceAcrossTransitions","errorCode"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){b.__markCompiled&&b.__markCompiled();var x=5,y='/ajax/chat/buddy_list.php',z=1800000,aa=h.pollInterval,ba=h.lazyPollInterval,ca=h.lazyThreshold,da=n.create('available_list'),ea='presence_poller';i.setEntitySample(ea,.01);function fa(ga){"use strict";this.$PresencePoller0=ga;this.$PresencePoller1=false;this.$PresencePoller2=h.chatNotif;this.$PresencePoller3=[];this.$PresencePoller4=new p({interval:aa,setupRequest:this.$PresencePoller5.bind(this),clearOnQuicklingEvents:false,dontStart:true});if(l.isOnline()){this.$PresencePoller6=Date.now();this.$PresencePoller7=Date.now();this.$PresencePoller8=Date.now();this.$PresencePoller9=h.updateTime;}else{this.$PresencePoller6=0;this.$PresencePoller9=0;this.$PresencePoller7=0;this.$PresencePoller8=0;}this.$PresencePollera=0;this.$PresencePollerb('available_initial_data',h.updateTime,h.availableList,h.lastActiveTimes,h.mobileFriends);u.subscribe(function(ha,ia){if(ia.idleness>aa)this.forceUpdate();}.bind(this));q.subscribe('privacy-user-presence-changed',function(){this.forceUpdate();}.bind(this));}fa.prototype.start=function(){"use strict";setTimeout(this.$PresencePoller4.start.bind(this.$PresencePoller4),0);};fa.prototype.restart=function(){"use strict";if(this.$PresencePoller4.isMuted()){this.$PresencePoller4.resume();this.forceUpdate();}};fa.prototype.stop=function(){"use strict";this.$PresencePoller4.mute();};fa.prototype.forceUpdate=function(){"use strict";this.$PresencePoller4.request();};fa.prototype.getIsUserIdle=function(){"use strict";return this.$PresencePoller1;};fa.prototype.getWebChatNotification=function(){"use strict";return this.$PresencePoller2;};fa.prototype.getCallback=function(){"use strict";return this.$PresencePoller0;};fa.prototype.addExtraBuddy=function(ga){"use strict";if(this.$PresencePoller3.indexOf(ga)!==-1)return;this.$PresencePoller3.push(ga);};fa.prototype.$PresencePollerc=function(){"use strict";return v(function(){this.$PresencePoller0(g.ON_AVAILABILITY_CHANGED);}.bind(this),0)();};fa.prototype.$PresencePollerb=function(ga,ha,ia,ja,ka){"use strict";this.$PresencePoller9=ha;if(!Array.isArray(ia)){r.resetPresenceData();for(var la in ia)r.set(la,ia[la].a,false,ga,ia[la].c,ia[la].p);}if(ja&&!Array.isArray(ja))o.update(ja);if(ka)r.setMobileFriends(ka);this.$PresencePollerc();};fa.prototype.$PresencePoller5=function(ga){"use strict";if(j.isShutdown()||!l.isOnline()){this.$PresencePoller4.skip();i.bumpEntityKey(ea,'skip.offline');return;}if(Date.now()-this.$PresencePoller6<aa){this.$PresencePoller4.skip();i.bumpEntityKey(ea,'skip.recent');return;}i.bumpEntityKey(ea,'request');this.$PresencePoller6=Date.now();var ha=Date.now()-this.$PresencePoller8,ia=t.getCachedProfileIDs().join(",");ga.setHandler(this.$PresencePollerd.bind(this)).setErrorHandler(this.$PresencePollere.bind(this)).setOption('suppressErrorAlerts',true).setOption('retries',1).setData({user:m.getID(),cached_user_info_ids:ia,fetch_mobile:(ha>z),additional_buddies:this.$PresencePoller3}).setURI(y).setAllowCrossPageTransition(true);};fa.prototype.$PresencePollerd=function(ga){"use strict";var ha=ga.getPayload(),ia=ha.buddy_list;if(!ia){this.$PresencePollere(ga);return;}i.bumpEntityKey(ea,'response');this.$PresencePollerf();this.$PresencePoller7=Date.now();s.update(ha.time);if(ia.mobile_friends)this.$PresencePoller8=Date.now();this.$PresencePollera=0;this.$PresencePollerg();var ja=ia.userInfos;if(ja)t.setMulti(ja);var ka=ia.chatContexts;ka&&k.update(ka);this.$PresencePoller1=ia.userIsIdle;if(ia.chatNotif!==(void 0)&&ia.chatNotif!==this.$PresencePoller2){this.$PresencePoller2=ia.chatNotif;this.$PresencePoller0(g.ON_CHAT_NOTIFICATION_CHANGED,this.$PresencePoller2);}this.$PresencePollerb('buddy_list_poller',ha.time,ia.nowAvailableList,ia.last_active_times,ia.mobile_friends);};fa.prototype.$PresencePollere=function(ga){"use strict";i.bumpEntityKey(ea,'error');if(ga.getError()==1356007)return;this.$PresencePollera++;if(this.$PresencePollera>=x)this.$PresencePoller0(g.ON_UPDATE_ERROR);};fa.prototype.$PresencePollerg=function(){"use strict";var ga=u.isActive(ca)?aa:ba;i.bumpEntityKey(ea,'period.'+ga);this.$PresencePoller4.setInterval(ga);};fa.prototype.$PresencePollerf=function(){"use strict";var ga=Date.now(),ha=ga-this.$PresencePoller7;da.log('buddylist_presence_stats',Object.assign({duration:ha},r.getPresenceStats()));};e.exports=fa;},null);
__d("TypingStates",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={INACTIVE:0,TYPING:1,QUITTING:2};e.exports=g;},null);
__d("AvailableList",["Arbiter","ArbiterMixin","AsyncRequest","AvailableListConstants","BanzaiODS","ChannelConnection","ChannelConstants","ChatConfig","ChatVisibility","ErrorUtils","JSLogger","LastMobileActiveTimes","PresencePoller","PresencePrivacy","PresenceStatus","ServerTime","ShortProfiles","TypingStates","debounceAcrossTransitions","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){b.__markCompiled&&b.__markCompiled();'use strict';k.setEntitySample('presence',.0001);var aa=Object.assign({},j,h);aa.subscribe([j.ON_AVAILABILITY_CHANGED,j.ON_UPDATE_ERROR],function(ka,la){g.inform(ka,la);});var ba=y(function(){return aa.inform(j.ON_AVAILABILITY_CHANGED);},0);function ca(ka,la,ma,na,oa,pa){var qa=u.set(ka,la,ma,na,oa,pa);if(qa){var ra=y(function(){return aa.inform(j.ON_AVAILABILITY_CHANGED,ka);},0);ra();}}function da(ka){var la=ka.payload.availability||{};for(var ma in la)ca(ma&&ma.toString(),la[ma].a,true,'mercury_tabs',la[ma].c,la[ma].p);}function ea(){ia&&ia.restart();}function fa(){ia&&ia.stop();}function ga(ka){var la=aa.getDebugInfo(ka),ma=(la.presence==j.ACTIVE);new i('/ajax/mercury/tabs_presence.php').setData({target_id:ka,to_online:ma,presence_source:la.overlaySource,presence_time:la.overlayTime}).setHandler(da).setErrorHandler(z).setAllowCrossPageTransition(true).send();}function ha(ka,la){la.chat_config=n.getDebugInfo();la.available_list_debug_info={};u.getAvailableIDs().forEach(function(ma){la.available_list_debug_info[ma]=aa.getDebugInfo(ma);});la.available_list_poll_interval=aa._poller&&aa._poller.getInterval();}var ia;try{ia=new s(function(event){aa.inform(event);});}catch(ja){p.reportError&&p.reportError(ja,false);}Object.assign(aa,{get:function(ka){return u.get(ka);},updateForID:function(ka){ga(ka);ia&&ia.addExtraBuddy(ka);},shouldUpdateForID:function(ka){if(n.get('avoid_available_list_updates',false))return u.getCapabilities(ka)===0;return true;},getWebChatNotification:function(){return ia&&ia.getWebChatNotification&&ia.getWebChatNotification();},isUserIdle:function(){return ia&&ia.getIsUserIdle();},isReady:function(){return !!ia;},set:function(ka,la,ma,na,oa){ca(ka,la,true,ma,na,oa);},update:function(){ia&&ia.forceUpdate();},isIdle:function(ka){return aa.get(ka)==j.IDLE;},getDebugInfo:function(ka){var la=u.getDebugInfo(ka),ma=w.getNow(ka);if(ma)la.name=ma.name;return la;}});ia&&ia.start();g.subscribe(q.DUMP_EVENT,ha);g.subscribe('chat-visibility/go-online',ea);g.subscribe('chat-visibility/go-offline',fa);t.subscribe(['privacy-changed','privacy-availability-changed','privacy-user-presence-response'],ba);l.subscribe([l.CONNECTED,l.RECONNECTING,l.SHUTDOWN,l.MUTE_WARNING,l.UNMUTE_WARNING],ba);g.subscribe(m.getArbiterType('buddylist_overlay'),function(ka,la){var ma={},na=la.obj.overlay;for(var oa in na){aa.set(oa,na[oa].a,na[oa].s||'channel',na[oa].vc,na[oa].p);if(na[oa].la)ma[oa]=na[oa].la;}r.update(ma);});g.subscribe([m.getArbiterType('typ'),m.getArbiterType('ttyp')],function(ka,la){var ma=la.obj;if(ma.st===x.TYPING){var na=ma.from;if(o.isOnline()){k.bumpEntityKey('presence','stale_presence_check_typing');var oa=u.get(na);if(oa!=j.ACTIVE){var pa=r.get(na)*1000,qa=v.get();if(!pa){k.bumpEntityKey('presence','no_detailed_presence_typing');}else if(qa-pa>5*60*1000){var ra='stale_presence_typing',sa=qa-pa;if(sa<10*60*1000){ra+='600';}else if(sa<60*60*1000)ra+='3600';k.bumpEntityKey('presence',ra);}}}aa.set(na&&na.toString(),j.ACTIVE,'channel-typing');}});g.subscribe(m.getArbiterType('messaging'),function(ka,la){if(!o.isOnline())return;var ma=la.obj;if(ma.message&&ma.message.timestamp&&ma.message.sender_fbid){var na=v.get(),oa=ma.message.timestamp;if(na-oa<2*60*1000){k.bumpEntityKey('presence','stale_presence_check');var pa=ma.message.sender_fbid,qa=u.get(pa);if(qa==j.ACTIVE)return;var ra=r.get(pa)*1000;if(!ra){k.bumpEntityKey('presence','no_detailed_presence');}else if(oa-ra>5*60*1000){var sa='stale_presence',ta=oa-ra;if(ta<10*60*1000){sa+='600';}else if(ta<60*60*1000)sa+='3600';k.bumpEntityKey('presence',sa);}}}});a.AvailableList=e.exports=aa;},null);